const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/StaffAppointmentManager-g1NktoFh.js","assets/react-vendor-2s10cGd1.js","assets/chart-vendor-BsnJAHr2.js","assets/bootstrap-vendor-CM53U_Of.js","assets/bootstrap-vendor-BJ1jyr7P.css","assets/vendor-axios-ngrFHoWO.js","assets/pdf-vendor-BZobkf7J.js","assets/vendor-utils-DLELI0UM.js","assets/excel-vendor-6kUf8nhb.js","assets/AppointmentFinder-De2lxLRl.js","assets/VisitTrackerManager-q-rrklrr.js","assets/DentistScheduleManager-Cpl80tkl.js"])))=>i.map(i=>d[i]);
import{r as t,j as e,u as we,a as es,L as je,z as K,b as ua,N as Ha,F as ss,c as Xs,d as ut,e as he,O as gs,B as Fs,$ as Va,P as pt,f as bt,g as ta,M as Rs,h as ia,i as Da,k as ft,R as gt,l as Z,m as jt}from"./react-vendor-2s10cGd1.js";import"./bootstrap-vendor-CM53U_Of.js";import{a as vt}from"./vendor-axios-ngrFHoWO.js";import{_ as Ae}from"./pdf-vendor-BZobkf7J.js";import{i as Nt}from"./vendor-utils-DLELI0UM.js";import{m as zs,i as As,a as yt,e as wt,c as Oa,r as Se,v as _t,t as St,d as kt,b as Ct,A as Ua,f as Qs,g as Js,C as pa,h as ba,j as fa,k as ga,p as ja,l as va,n as Na,o as Rt}from"./chart-vendor-BsnJAHr2.js";import{E as qa}from"./excel-vendor-6kUf8nhb.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const d of r)if(d.type==="childList")for(const l of d.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function a(r){const d={};return r.integrity&&(d.integrity=r.integrity),r.referrerPolicy&&(d.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?d.credentials="include":r.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function n(r){if(r.ep)return;r.ep=!0;const d=a(r);fetch(r.href,d)}})();const z=vt.create({baseURL:"/",withCredentials:!0,headers:{"X-Requested-With":"XMLHttpRequest","ngrok-skip-browser-warning":"true"}});z.interceptors.request.use(s=>{const i=document.cookie.match(/XSRF-TOKEN=([^;]+)/);return i&&(s.headers["X-XSRF-TOKEN"]=decodeURIComponent(i[1])),s});z.interceptors.response.use(s=>s,s=>{var o,x,g,p;const i=(o=s.response)==null?void 0:o.status,a=((x=s.config)==null?void 0:x.url)||"";let n=a;try{n=new URL(a,window.location.origin).pathname}catch{}if((g=s.config)!=null&&g.skip401Handler||i===401&&new Set(["/api/user","/user"]).has(n)||i===403)return Promise.reject(s);const d=["/app/admin","/app/staff","/app/patient"],l=window.location.pathname,h=d.some(m=>l.startsWith(m));if(i===401&&h){(p=z.setToken)==null||p.call(z,null),window.location.href="/app/login";return}return Promise.reject(s)});z.logout=()=>z.post("/logout");const Ya=t.createContext();function Pt({children:s}){const[i,a]=t.useState(null),[n,r]=t.useState(!0);t.useEffect(()=>{let l=!0;return z.get("/api/user",{skip401Handler:!0}).then(h=>l&&a(h.data)).catch(()=>l&&a(null)).finally(()=>l&&r(!1)),()=>{l=!1}},[]);const d=async()=>{try{await z.post("/api/logout")}catch(l){console.error("Logout error:",l)}finally{a(null)}};return e.jsx(Ya.Provider,{value:{user:i,setUser:a,authLoading:n,logout:d},children:s})}function Ce(){return t.useContext(Ya)}const Ka=t.createContext(null);function Dt({children:s}){const[i,a]=t.useState([]),[n,r]=t.useState(0),[d,l]=t.useState(!1),[h,o]=t.useState(""),x=t.useRef(!1),g=v=>(v||[]).map(S=>({...S,data:typeof S.data=="string"?p(S.data):S.data||null}));function p(v){try{return JSON.parse(v)}catch{return null}}const m=t.useCallback(async()=>{var v;try{const S=await z.get("/api/notifications/unread-count");r(((v=S==null?void 0:S.data)==null?void 0:v.unread)??0)}catch{}},[]),y=t.useCallback(async()=>{var v,S;if(!x.current){x.current=!0,l(!0),o("");try{const u=await z.get("/api/notifications");a(g(u.data))}catch(u){o(((S=(v=u==null?void 0:u.response)==null?void 0:v.data)==null?void 0:S.message)||"Failed to load notifications."),a([])}finally{l(!1),x.current=!1}}},[]),N=t.useCallback(async()=>{try{await z.post("/api/notifications/mark-all-read"),r(0)}catch{}},[]);t.useEffect(()=>{m();const v=setInterval(()=>{m()},12e4);return()=>clearInterval(v)},[m]);const R=t.useMemo(()=>({items:i,unread:n,loading:d,error:h,loadList:y,loadUnread:m,markAllRead:N}),[i,n,d,h,y,m,N]);return e.jsx(Ka.Provider,{value:R,children:s})}function Ga(){const s=t.useContext(Ka);if(!s)throw new Error("useNotifications must be used inside <NotificationsProvider>");return s}const Xa=t.createContext({loading:!1,accepting:!1,error:null,policy:null,needsAcceptance:!1,acceptedPolicyId:null,acceptedAt:null,hasDismissed:!1,shouldShowModal:!1,refresh:()=>{},accept:async()=>{},dismissModal:()=>{},reopenModal:()=>{}});function At({children:s}){const{user:i,authLoading:a}=Ce(),[n,r]=t.useState(!1),[d,l]=t.useState(!1),[h,o]=t.useState(null),[x,g]=t.useState(!1),[p,m]=t.useState(null),[y,N]=t.useState(null),[R,v]=t.useState(null),[S,u]=t.useState(!1),j=t.useRef(null),b=t.useCallback(()=>{g(!1),m(null),N(null),v(null),u(!1),o(null),j.current=null},[]),C=t.useCallback(async()=>{var w,A;if(!a){if(!i||(i==null?void 0:i.role)!=="patient"){b();return}r(!0),o(null);try{const{data:_}=await z.get("/api/policy/consent"),H=(_==null?void 0:_.active_policy)??null,T=(H==null?void 0:H.id)??null;j.current!==T&&(u(!1),j.current=T),m(H),g(!!(_!=null&&_.needs_acceptance)),N((_==null?void 0:_.accepted_policy_id)??null),v((_==null?void 0:_.accepted_at)??null)}catch(_){const H=((A=(w=_==null?void 0:_.response)==null?void 0:w.data)==null?void 0:A.message)||(_==null?void 0:_.message)||"Unable to load policy consent status.";o(H)}finally{r(!1)}}},[a,b,i]);t.useEffect(()=>{C()},[C]);const f=t.useCallback(async()=>{var w,A;if(!(!i||(i==null?void 0:i.role)!=="patient")){l(!0),o(null);try{await z.post("/api/policy/consent/accept"),u(!1),await C()}catch(_){const H=((A=(w=_==null?void 0:_.response)==null?void 0:w.data)==null?void 0:A.message)||(_==null?void 0:_.message)||"Failed to accept the updated policy. Please try again.";o(H)}finally{l(!1)}}},[C,i]),D=t.useCallback(()=>{u(!0)},[]),L=t.useCallback(()=>{u(!1)},[]),I=t.useMemo(()=>({loading:n,accepting:d,error:h,policy:p,needsAcceptance:x,acceptedPolicyId:y,acceptedAt:R,hasDismissed:S,shouldShowModal:!!((i==null?void 0:i.role)==="patient"&&x&&!S),refresh:C,accept:f,dismissModal:D,reopenModal:L}),[f,R,y,d,D,C,S,n,x,p,h,L,i==null?void 0:i.role]);return e.jsx(Xa.Provider,{value:I,children:s})}function Qa(){return t.useContext(Xa)}class Mt extends t.Component{constructor(i){super(i),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(i){return{hasError:!0}}componentDidCatch(i,a){console.error("ErrorBoundary caught an error:",i,a),this.setState({error:i,errorInfo:a})}render(){return this.state.hasError?e.jsxs("div",{style:{padding:"20px",fontFamily:"Arial, sans-serif"},children:[e.jsx("h1",{children:"Something went wrong."}),e.jsxs("details",{style:{whiteSpace:"pre-wrap"},children:[this.state.error&&this.state.error.toString(),e.jsx("br",{}),this.state.errorInfo&&this.state.errorInfo.componentStack?this.state.errorInfo.componentStack:"No component stack available."]})]}):this.props.children}}function Pe({message:s="Loading..."}){return e.jsx("div",{className:"position-fixed top-0 start-0 w-100 h-100 d-flex justify-content-center align-items-center bg-dark bg-opacity-50",style:{zIndex:1050},children:e.jsxs("div",{className:"bg-white p-4 rounded shadow text-center",children:[e.jsx("div",{className:"spinner-border text-primary mb-3",role:"status"}),e.jsx("div",{children:s})]})})}function Lt(){const{user:s,authLoading:i}=Ce(),a=we(),n=es();return t.useEffect(()=>{if(i)return;const r=n.pathname||"/",d=["/","/login","/register","/forgot-password"],l=d.some(o=>r===o)||r.startsWith("/password-reset/")||r.startsWith("/verify-email")||r.startsWith("/verify-success")||r.startsWith("/pay/"),h=o=>{switch(o){case"admin":return"/admin";case"staff":return"/staff";case"patient":return"/patient";case"dentist":return"/dentist";default:return"/"}};if(s){const o=h(s.role);if(d.includes(r)){a(o,{replace:!0});return}const x={admin:["/admin"],staff:["/staff"],patient:["/patient"],dentist:["/dentist"]};for(const[g,p]of Object.entries(x))if(s.role!==g){for(const m of p)if(r.startsWith(m)){a(o,{replace:!0});return}}}!s&&!l&&r!=="/notifications"&&a("/",{replace:!0})},[s,i,n.pathname,a]),i?e.jsx(Pe,{message:"Checking session..."}):null}const Ft=`
  .promo-card {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-radius: 15px;
    overflow: hidden;
  }
  
  .discount-circle {
    width: 80px;
    height: 80px;
    background: linear-gradient(135deg, #dc3545, #c82333);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
  }
  
  .discount-text {
    color: white;
    font-size: 1.5rem;
    font-weight: bold;
    text-shadow: 0 1px 3px rgba(0,0,0,0.3);
  }
  
  .promo-highlight {
    position: relative;
  }
  
  .carousel-control-prev,
  .carousel-control-next {
    width: 50px;
    height: 50px;
    background: rgba(0, 0, 0, 0.5);
    border-radius: 50%;
    top: 50%;
    transform: translateY(-50%);
    border: none;
  }
  
  .carousel-control-prev {
    left: -25px;
  }
  
  .carousel-control-next {
    right: -25px;
  }
  
  .carousel-indicators {
    bottom: -50px;
  }
  
  .carousel-indicators button {
    background-color: #6c757d;
    border-radius: 50%;
    width: 12px;
    height: 12px;
    margin: 0 5px;
  }
  
  .carousel-indicators button.active {
    background-color: #198754;
  }
  
  .promo-card .card-body {
    position: relative;
  }
  
  .promo-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, #dc3545, #ffc107, #198754);
  }
`,la=s=>s===!0||s===1||s==="1";function Aa(){const[s,i]=t.useState([]),[a,n]=t.useState([]),[r,d]=t.useState(!0),[l,h]=t.useState(""),o=we(),{user:x}=Ce();t.useEffect(()=>{g()},[]);const g=async()=>{var j;try{d(!0);const b=await z.get("/api/public/services"),C=Array.isArray(b.data)?b.data:Array.isArray((j=b.data)==null?void 0:j.data)?b.data.data:[],f={};C.forEach(D=>{const L=Array.isArray(D==null?void 0:D.discounts)?D.discounts:[];f[D.id]=L}),i(C),n(f)}catch(b){console.error("Failed to fetch services and promos:",b),h("Failed to load services and promotions")}finally{d(!1)}},p=j=>{if(!x){o("/login",{state:{message:"Please log in to book an appointment",redirectTo:"/patient/appointment",preselectedService:j}});return}o("/patient/appointment",{state:{preselectedService:j}})},m=j=>{const b=a[j.id]||[],C=new Date().toISOString().split("T")[0],f=b.find(D=>D.status==="launched"&&D.start_date<=C&&D.end_date>=C);return f?{price:f.discounted_price,originalPrice:j.price,isPromo:!0,promoEndDate:f.end_date}:{price:j.price,originalPrice:null,isPromo:!1,promoEndDate:null}},y=j=>{const b=new Date().toISOString().split("T")[0];return j.is_special&&j.special_start_date&&j.special_end_date?j.special_start_date<=b&&j.special_end_date>=b:!(a[j.id]||[]).find(D=>D.status==="planned"&&D.start_date>b)},N=(j,b=!1)=>{const C=`â‚±${Number(j).toFixed(2)}`;return la(b)?`${C} per tooth`:C},R=j=>new Date(j).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),v=()=>{const j=new Date().toISOString().split("T")[0],b=[];return s.forEach(C=>{const D=(a[C.id]||[]).find(L=>L.status==="launched"&&L.start_date<=j&&L.end_date>=j);D&&b.push({...D,service:C})}),b.sort((C,f)=>new Date(C.start_date)-new Date(f.start_date))},S=(j,b)=>{if(!j||!b)return 0;const C=(j-b)/j*100;return Math.round(C)},u=()=>e.jsx("div",{className:"col-lg-4 col-md-6",children:e.jsx("div",{className:"card h-100 shadow-sm border-0 service-card",children:e.jsxs("div",{className:"card-body d-flex flex-column",children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[e.jsx("div",{className:"placeholder-glow",children:e.jsx("span",{className:"placeholder col-8 placeholder-lg"})}),e.jsx("div",{className:"placeholder-glow",children:e.jsx("span",{className:"placeholder col-3 placeholder-sm"})})]}),e.jsx("div",{className:"placeholder-glow mt-2",children:e.jsx("span",{className:"placeholder col-4 placeholder-sm"})})]}),e.jsxs("div",{className:"placeholder-glow mb-3",children:[e.jsx("span",{className:"placeholder col-12"}),e.jsx("span",{className:"placeholder col-8"})]}),e.jsxs("div",{className:"placeholder-glow mb-3",children:[e.jsx("span",{className:"placeholder col-6 placeholder-lg"}),e.jsx("div",{className:"placeholder-glow mt-1",children:e.jsx("span",{className:"placeholder col-4 placeholder-sm"})})]}),e.jsx("div",{className:"mt-auto",children:e.jsx("div",{className:"placeholder-glow",children:e.jsx("span",{className:"placeholder col-12 placeholder-lg"})})})]})})});return r?e.jsx("section",{className:"services-promos-section py-5 bg-light",children:e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"text-center mb-5",children:[e.jsx("h2",{className:"display-5 fw-bold text-primary mb-3",children:"Our Services & Promotions"}),e.jsx("p",{className:"lead text-muted",children:"Professional dental care with special offers and packages"})]}),e.jsx("div",{className:"row g-4",children:Array.from({length:6},(j,b)=>e.jsx(u,{},`skeleton-${b}`))})]})}):l?e.jsxs("div",{className:"alert alert-warning text-center",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),l]}):e.jsxs(e.Fragment,{children:[e.jsx("style",{children:Ft}),e.jsx("section",{className:"services-promos-section py-5 bg-light",children:e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"text-center mb-5",children:[e.jsx("h2",{className:"display-5 fw-bold text-primary mb-3",children:"Our Services & Promotions"}),e.jsx("p",{className:"lead text-muted",children:"Professional dental care with special offers and packages"})]}),v().length>0?e.jsxs("div",{className:"mb-5",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsxs("h3",{className:"h4 fw-bold text-success mb-2",children:[e.jsx("i",{className:"bi bi-percent me-2"}),"Current Promotions"]}),e.jsx("p",{className:"text-muted",children:"Limited time offers - Book now!"})]}),e.jsxs("div",{id:"promotionsCarousel",className:"carousel slide","data-bs-ride":"carousel",children:[e.jsx("div",{className:"carousel-inner",children:v().map((j,b)=>{const C=S(j.service.price,j.discounted_price),f=la(j.service.per_teeth_service);return e.jsx("div",{className:`carousel-item ${b===0?"active":""}`,children:e.jsx("div",{className:"container",children:e.jsx("div",{className:"row justify-content-center",children:e.jsx("div",{className:"col-lg-10",children:e.jsx("div",{className:"card border-0 shadow-lg promo-card",children:e.jsx("div",{className:"card-body p-4",children:e.jsxs("div",{className:"row align-items-center",children:[e.jsxs("div",{className:"col-lg-8",children:[e.jsxs("div",{className:"d-flex align-items-center mb-3",children:[e.jsxs("span",{className:"badge bg-danger fs-6 me-3",children:[e.jsx("i",{className:"bi bi-percent me-1"}),C,"% OFF"]}),e.jsxs("span",{className:"badge bg-warning text-dark",children:[e.jsx("i",{className:"bi bi-clock me-1"}),"Limited Time"]})]}),e.jsx("h4",{className:"card-title text-primary fw-bold mb-3",children:j.service.name}),e.jsx("p",{className:"card-text text-muted mb-3",children:j.service.description||"Professional dental service with special pricing"}),e.jsxs("div",{className:"d-flex align-items-center gap-4 mb-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"h3 text-success fw-bold mb-0",children:N(j.discounted_price,f)}),e.jsx("span",{className:"text-decoration-line-through text-muted ms-2",children:N(j.service.price,f)})]}),e.jsx("div",{className:"text-muted",children:e.jsxs("small",{children:[e.jsx("i",{className:"bi bi-calendar-check me-1"}),"Valid until: ",R(j.end_date)]})})]})]}),e.jsx("div",{className:"col-lg-4 text-center",children:e.jsxs("div",{className:"promo-highlight",children:[e.jsx("div",{className:"discount-circle mx-auto mb-3",children:e.jsxs("span",{className:"discount-text",children:[C,"%"]})}),e.jsxs("button",{className:"btn btn-success btn-lg w-100",onClick:()=>p(j.service),children:[e.jsx("i",{className:"bi bi-calendar-plus me-2"}),"Book This Offer"]})]})})]})})})})})})},j.id)})}),v().length>1&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"carousel-control-prev",type:"button","data-bs-target":"#promotionsCarousel","data-bs-slide":"prev",children:[e.jsx("span",{className:"carousel-control-prev-icon","aria-hidden":"true"}),e.jsx("span",{className:"visually-hidden",children:"Previous"})]}),e.jsxs("button",{className:"carousel-control-next",type:"button","data-bs-target":"#promotionsCarousel","data-bs-slide":"next",children:[e.jsx("span",{className:"carousel-control-next-icon","aria-hidden":"true"}),e.jsx("span",{className:"visually-hidden",children:"Next"})]}),e.jsx("div",{className:"carousel-indicators",children:v().map((j,b)=>e.jsx("button",{type:"button","data-bs-target":"#promotionsCarousel","data-bs-slide-to":b,className:b===0?"active":"","aria-current":b===0?"true":"false","aria-label":`Slide ${b+1}`},b))})]})]})]}):e.jsx("div",{className:"mb-5",children:e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"card border-0 bg-light",children:e.jsxs("div",{className:"card-body py-4",children:[e.jsx("i",{className:"bi bi-calendar-x text-muted",style:{fontSize:"3rem"}}),e.jsx("h5",{className:"text-muted mt-3 mb-2",children:"No Active Promotions"}),e.jsx("p",{className:"text-muted mb-0",children:"Check back soon for special offers and discounts on our services!"})]})})})}),e.jsx("div",{className:"row g-4",children:Array.isArray(s)&&s.map(j=>{var D;const b=m(j),C=y(j),f=la(j.per_teeth_service);return e.jsx("div",{className:"col-lg-4 col-md-6",children:e.jsx("div",{className:"card h-100 shadow-sm border-0 service-card",children:e.jsxs("div",{className:"card-body d-flex flex-column",children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[e.jsx("h5",{className:"card-title fw-bold text-primary mb-2",children:j.name}),j.is_special?e.jsxs("span",{className:"badge bg-warning text-dark",children:[e.jsx("i",{className:"bi bi-star-fill me-1"}),"Special"]}):e.jsx("span",{})]}),j.category&&e.jsx("span",{className:"badge bg-secondary mb-2",children:typeof j.category=="string"?j.category:((D=j.category)==null?void 0:D.name)||""})]}),e.jsx("p",{className:"card-text text-muted flex-grow-1",children:j.description||"Professional dental service"}),e.jsx("div",{className:"mb-3",children:b.isPromo?e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("span",{className:"h4 text-success fw-bold mb-0",children:N(b.price,f)}),e.jsx("span",{className:"text-decoration-line-through text-muted",children:N(b.originalPrice,f)}),e.jsxs("span",{className:"badge bg-danger",children:[e.jsx("i",{className:"bi bi-percent me-1"}),"Sale"]})]}),e.jsxs("small",{className:"text-muted",children:["Promo ends: ",R(b.promoEndDate)]})]}):e.jsxs("div",{children:[e.jsx("div",{className:"h4 text-primary fw-bold mb-0",children:N(b.price,f)}),f&&e.jsxs("small",{className:"text-info",children:[e.jsx("i",{className:"bi bi-info-circle me-1"}),"Total cost depends on number of teeth treated"]})]})}),e.jsx("div",{className:"mt-auto",children:C?e.jsxs("button",{className:"btn btn-primary w-100",onClick:()=>p(j),children:[e.jsx("i",{className:"bi bi-calendar-plus me-2"}),"Book Now"]}):e.jsxs("div",{className:"text-center",children:[e.jsxs("button",{className:"btn btn-outline-secondary w-100",disabled:!0,children:[e.jsx("i",{className:"bi bi-clock me-2"}),"Coming Soon"]}),j.is_special&&j.special_start_date&&j.special_end_date?e.jsxs("small",{className:"text-muted d-block mt-2",children:["Available: ",R(j.special_start_date)," - ",R(j.special_end_date)]}):e.jsx("span",{})]})})]})})},j.id)})}),e.jsx("div",{className:"text-center mt-5",children:e.jsx("div",{className:"row justify-content-center",children:e.jsx("div",{className:"col-md-8",children:e.jsx("div",{className:"card bg-primary text-white",children:e.jsxs("div",{className:"card-body py-4",children:[e.jsxs("h4",{className:"card-title mb-3",children:[e.jsx("i",{className:"bi bi-heart-pulse me-2"}),"Ready to Book Your Appointment?"]}),e.jsx("p",{className:"card-text mb-4",children:"Choose from our professional services and take advantage of our current promotions. Book online for a convenient and seamless experience."}),e.jsxs("button",{className:"btn btn-light btn-lg",onClick:()=>p(null),children:[e.jsx("i",{className:"bi bi-calendar-check me-2"}),"Book Appointment Now"]})]})})})})})]})})]})}const us="/assets/logo-CRfANuD7.png";function zt(){const{user:s,authLoading:i}=Ce();return i?e.jsx(Pe,{message:"Checking session..."}):s&&s.role==="patient"?e.jsxs("div",{className:"container mt-5 px-3 px-md-4",children:[e.jsxs("div",{className:"text-center mb-5",children:[e.jsxs("h2",{className:"mb-3",children:["Welcome, ",s.name||"Patient"," ðŸ¦·"]}),e.jsx("p",{className:"lead",children:"Select an action below or browse our services:"}),e.jsxs("div",{className:"mb-4 d-flex flex-column flex-sm-row justify-content-center align-items-center gap-2 flex-wrap",children:[e.jsx(je,{to:"/patient/appointment",className:"btn btn-primary",children:"Book Appointment"}),e.jsx(je,{to:"/patient/appointments",className:"btn btn-outline-secondary",children:"View Appointments"}),e.jsx(je,{to:"/patient/profile",className:"btn btn-outline-info",children:"Profile"})]})]}),e.jsx(Aa,{})]}):e.jsxs("div",{className:"landing-page",children:[e.jsxs("header",{className:"site-header shadow-sm",children:[e.jsxs("div",{className:"container d-flex justify-content-between align-items-center py-2 py-md-3",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("img",{src:us,alt:"Kreative Dental Logo",className:"site-logo me-2"}),e.jsx("span",{className:"logo-text",children:"Kreative Dental Clinic"})]}),e.jsx("button",{className:"navbar-toggler d-md-none border-0 p-2",type:"button",onClick:()=>{const a=document.getElementById("mobile-nav");a&&a.classList.toggle("show")},"aria-label":"Toggle navigation",style:{background:"transparent"},children:e.jsx("i",{className:"bi bi-list fs-4",style:{color:"var(--brand-dark)"}})}),e.jsx("nav",{className:"d-none d-md-block",children:e.jsxs("ul",{className:"nav-list d-flex gap-2 gap-lg-3 mb-0",children:[e.jsx("li",{children:e.jsx("a",{href:"#home",className:"nav-link",children:"Home"})}),e.jsx("li",{children:e.jsx("a",{href:"#services",className:"nav-link",children:"Services"})}),e.jsx("li",{children:e.jsx("a",{href:"#about",className:"nav-link",children:"About"})}),e.jsx("li",{children:e.jsx("a",{href:"#contact",className:"nav-link",children:"Contact"})})]})})]}),e.jsx("nav",{id:"mobile-nav",className:"d-md-none mobile-nav",children:e.jsxs("ul",{className:"nav-list flex-column mb-0 p-3",children:[e.jsx("li",{children:e.jsx("a",{href:"#home",className:"nav-link",onClick:()=>{var a;return(a=document.getElementById("mobile-nav"))==null?void 0:a.classList.remove("show")},children:"Home"})}),e.jsx("li",{children:e.jsx("a",{href:"#services",className:"nav-link",onClick:()=>{var a;return(a=document.getElementById("mobile-nav"))==null?void 0:a.classList.remove("show")},children:"Services"})}),e.jsx("li",{children:e.jsx("a",{href:"#about",className:"nav-link",onClick:()=>{var a;return(a=document.getElementById("mobile-nav"))==null?void 0:a.classList.remove("show")},children:"About"})}),e.jsx("li",{children:e.jsx("a",{href:"#contact",className:"nav-link",onClick:()=>{var a;return(a=document.getElementById("mobile-nav"))==null?void 0:a.classList.remove("show")},children:"Contact"})})]})})]}),e.jsx("section",{id:"home",className:"hero-section d-flex align-items-center text-white",children:e.jsxs("div",{className:"container text-center px-3 px-md-4",children:[e.jsxs("h1",{className:"hero-title mb-3 mb-md-4",children:["Your Smile, Our Passion ",e.jsx("br",{className:"d-none d-sm-inline"}),e.jsx("span",{className:"d-inline d-sm-none",children:e.jsx("br",{})}),e.jsx("span",{className:"d-block d-sm-inline",children:"Kreative Dental & Orthodontics"})]}),e.jsx("p",{className:"hero-subtitle mb-4 mb-md-5",children:"Trusted dental care for families and individuals."}),e.jsxs("div",{className:"hero-buttons mt-4 d-flex flex-column flex-sm-row justify-content-center align-items-center gap-2 gap-md-3",children:[e.jsx(je,{to:"/login",className:"btn btn-light btn-lg shadow w-100 w-sm-auto px-4",children:"Login"}),e.jsx(je,{to:"/register",className:"btn btn-outline-light btn-lg w-100 w-sm-auto px-4",children:"Register"})]})]})}),e.jsx("section",{id:"services",children:e.jsx(Aa,{})}),e.jsx("section",{className:"features-section py-4 py-md-5",children:e.jsx("div",{className:"container px-3 px-md-4",children:e.jsxs("div",{className:"row text-center g-3 g-md-4",children:[e.jsx("div",{className:"col-12 col-sm-6 col-md-4 mb-2 mb-md-0",children:e.jsxs("div",{className:"feature-box p-3 p-md-4 h-100 shadow-sm rounded",children:[e.jsx("i",{className:"bi bi-shield-check fs-1 text-primary"}),e.jsx("h5",{className:"mt-3",children:"Safe & Secure"}),e.jsx("p",{className:"mb-0",children:"We ensure a sterile and hygienic environment in all treatments."})]})}),e.jsx("div",{className:"col-12 col-sm-6 col-md-4 mb-2 mb-md-0",children:e.jsxs("div",{className:"feature-box p-3 p-md-4 h-100 shadow-sm rounded",children:[e.jsx("i",{className:"bi bi-calendar2-check fs-1 text-success"}),e.jsx("h5",{className:"mt-3",children:"Easy Appointment"}),e.jsx("p",{className:"mb-0",children:"Book your slot online and avoid waiting queues."})]})}),e.jsx("div",{className:"col-12 col-sm-6 col-md-4 mb-2 mb-md-0",children:e.jsxs("div",{className:"feature-box p-3 p-md-4 h-100 shadow-sm rounded",children:[e.jsx("i",{className:"bi bi-person-heart fs-1 text-danger"}),e.jsx("h5",{className:"mt-3",children:"Caring Dentists"}),e.jsx("p",{className:"mb-0",children:"Experienced, friendly professionals to guide your oral care."})]})})]})})}),e.jsx("section",{id:"about",className:"about-section py-4 py-md-5 bg-primary",children:e.jsxs("div",{className:"container text-center px-3 px-md-4",children:[e.jsx("h2",{className:"mb-3 mb-md-4",children:"About Us"}),e.jsx("p",{className:"lead mb-0",children:"Kreative Dental Clinic is committed to providing high-quality dental care in a friendly, safe, and comfortable environment. Our team of professionals ensures that every patient receives the best oral health solutions tailored to their needs."})]})}),e.jsx("section",{id:"contact",className:"contact-section py-4 py-md-5 bg-light",children:e.jsxs("div",{className:"container text-center px-3 px-md-4",children:[e.jsx("h2",{className:"mb-3 mb-md-4 fw-bold",children:"Contact Us"}),e.jsx("p",{className:"lead text-muted mb-4 mb-md-5",children:"We'd love to hear from you! Reach out through any of the options below."}),e.jsxs("div",{className:"row justify-content-center mb-4 g-3",children:[e.jsx("div",{className:"col-12 col-sm-6 col-md-4",children:e.jsxs("div",{className:"p-3 p-md-4 bg-white shadow-sm rounded h-100",children:[e.jsx("i",{className:"bi bi-geo-alt-fill fs-2 text-danger"}),e.jsx("h5",{className:"mt-2",children:"Location"}),e.jsx("p",{className:"mb-0",children:"Cabuyao | Calamba"})]})}),e.jsx("div",{className:"col-12 col-sm-6 col-md-4",children:e.jsxs("div",{className:"p-3 p-md-4 bg-white shadow-sm rounded h-100",children:[e.jsx("i",{className:"bi bi-telephone-fill fs-2 text-success"}),e.jsx("h5",{className:"mt-2",children:"Call Us"}),e.jsx("p",{className:"mb-0",children:"0927 759 2845"})]})}),e.jsx("div",{className:"col-12 col-sm-6 col-md-4",children:e.jsxs("div",{className:"p-3 p-md-4 bg-white shadow-sm rounded h-100",children:[e.jsx("i",{className:"bi bi-envelope-fill fs-2 text-primary"}),e.jsx("h5",{className:"mt-2",children:"Email"}),e.jsx("p",{className:"mb-0",children:"kreativedent@gmail.com"})]})})]}),e.jsx("div",{className:"row justify-content-center mt-4 mb-4",children:e.jsx("div",{className:"col-12 col-lg-10",children:e.jsx("div",{className:"map-container shadow-sm rounded overflow-hidden",children:e.jsx("iframe",{src:"https://www.google.com/maps?q=14.2540966,121.1284223&hl=en&z=14&output=embed",width:"100%",height:"450",style:{border:0},allowFullScreen:!0,loading:"lazy",referrerPolicy:"no-referrer-when-downgrade",title:"Kreative Dental Clinic Location - Cabuyao, Calamba"})})})}),e.jsxs("div",{className:"d-flex justify-content-center gap-2 gap-md-3 flex-wrap mt-4",children:[e.jsxs("a",{href:"mailto:kreativedent@gmail.com",className:"btn btn-primary",children:[e.jsx("i",{className:"bi bi-envelope-fill me-2"})," Email"]}),e.jsxs("a",{href:"https://www.facebook.com/kreativedent",target:"_blank",rel:"noopener noreferrer",className:"btn btn-outline-primary",children:[e.jsx("i",{className:"bi bi-facebook me-2"})," Facebook"]}),e.jsxs("a",{href:"https://www.instagram.com/kreativedental/",target:"_blank",rel:"noopener noreferrer",className:"btn btn-outline-danger",children:[e.jsx("i",{className:"bi bi-instagram me-2"})," Instagram"]}),e.jsxs("a",{href:"https://www.tiktok.com/@kreativedental",target:"_blank",rel:"noopener noreferrer",className:"btn btn-dark",children:[e.jsx("i",{className:"bi bi-tiktok me-2"})," TikTok"]}),e.jsxs("a",{href:"https://www.google.com/maps/dir/14.2721246,121.1544842/14.2540966,121.1284223/@14.2667727,121.1189606,14z/data=!3m1!4b1!4m4!4m3!1m1!4e1!1m0?entry=ttu&g_ep=EgoyMDI1MDkyNC4wIKXMDSoASAFQAw%3D%3D",target:"_blank",rel:"noopener noreferrer",className:"btn btn-success",children:[e.jsx("i",{className:"bi bi-geo-alt-fill me-2"})," ",e.jsx("span",{className:"d-none d-sm-inline",children:"Get "}),"Directions"]})]})]})}),e.jsx("footer",{className:"text-center py-3 py-md-4 bg-primary text-white",children:e.jsx("div",{className:"container px-3 px-md-4",children:e.jsxs("p",{className:"mb-0 small",children:["Â© ",new Date().getFullYear()," Kreative Dental Clinic. All Rights Reserved."]})})})]})}function Tt({onCreated:s}){const[i,a]=t.useState({name:"",sku_code:"",type:"supply",unit:"pcs",low_stock_threshold:0,default_pack_size:"",is_controlled:!1,is_sellable:!1,patient_price:"",sellable_notes:"",notes:""}),[n,r]=t.useState(!1),d=(h,o)=>a(x=>({...x,[h]:o})),l=async h=>{var o,x;h.preventDefault(),r(!0);try{await z.post("/api/inventory/items",i),a({name:"",sku_code:"",type:"supply",unit:"pcs",low_stock_threshold:0,default_pack_size:"",is_controlled:!1,is_sellable:!1,patient_price:"",sellable_notes:"",notes:""}),s==null||s()}catch(g){K.error(((x=(o=g==null?void 0:g.response)==null?void 0:o.data)==null?void 0:x.message)||"Failed to save item")}finally{r(!1)}};return e.jsxs("form",{onSubmit:l,children:[e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Item Name *"}),e.jsx("input",{className:"form-control",placeholder:"Item name",value:i.name,onChange:h=>d("name",h.target.value),required:!0})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"SKU Code *"}),e.jsx("input",{className:"form-control",placeholder:"SKU code",value:i.sku_code,onChange:h=>d("sku_code",h.target.value),required:!0})]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Type"}),e.jsxs("select",{className:"form-select",value:i.type,onChange:h=>d("type",h.target.value),children:[e.jsx("option",{value:"drug",children:"Drug"}),e.jsx("option",{value:"equipment",children:"Equipment"}),e.jsx("option",{value:"supply",children:"Supply"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Unit"}),e.jsx("input",{className:"form-control",placeholder:"pcs/ml/g",value:i.unit,onChange:h=>d("unit",h.target.value)})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Low-stock Threshold"}),e.jsx("input",{className:"form-control",type:"number",min:"0",placeholder:"0",value:i.low_stock_threshold,onChange:h=>d("low_stock_threshold",h.target.value)})]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Default Pack Size (optional)"}),e.jsx("input",{className:"form-control",type:"number",min:"0",step:"0.001",placeholder:"e.g., 100",value:i.default_pack_size,onChange:h=>d("default_pack_size",h.target.value)})]}),e.jsx("div",{className:"col-md-6 d-flex align-items-end",children:e.jsxs("div",{className:"form-check",children:[e.jsx("input",{type:"checkbox",className:"form-check-input",checked:i.is_controlled,onChange:h=>d("is_controlled",h.target.checked)}),e.jsx("label",{className:"form-check-label",children:"Controlled item"})]})})]}),e.jsx("div",{className:"row mb-3",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"form-check",children:[e.jsx("input",{type:"checkbox",className:"form-check-input",checked:i.is_sellable,onChange:h=>d("is_sellable",h.target.checked)}),e.jsxs("label",{className:"form-check-label fw-semibold",children:[e.jsx("i",{className:"fas fa-shopping-cart me-2"}),"This item can be sold to patients separately (not included in procedure)"]})]})})}),i.is_sellable&&e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsxs("label",{className:"form-label",children:["Patient Price (â‚±) ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("span",{className:"input-group-text",children:"â‚±"}),e.jsx("input",{className:"form-control",type:"number",step:"0.01",min:"0",placeholder:"0.00",value:i.patient_price,onChange:h=>d("patient_price",h.target.value),required:i.is_sellable})]}),e.jsx("small",{className:"text-muted",children:"Price that patients will pay for this item"})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Sellable Notes (optional)"}),e.jsx("textarea",{className:"form-control",rows:2,placeholder:"e.g., Antibiotic for post-procedure infection prevention",value:i.sellable_notes,onChange:h=>d("sellable_notes",h.target.value)}),e.jsx("small",{className:"text-muted",children:"Notes shown to staff when selecting this item"})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Notes"}),e.jsx("textarea",{className:"form-control",rows:3,placeholder:"Additional notes...",value:i.notes,onChange:h=>d("notes",h.target.value)})]}),e.jsx("div",{className:"d-flex justify-content-end",children:e.jsx("button",{type:"submit",disabled:n,className:"btn btn-primary",children:n?"Saving...":"Save Item"})})]})}function Et(s=new Date){const i=a=>String(a).padStart(2,"0");return`${s.getFullYear()}-${i(s.getMonth()+1)}-${i(s.getDate())}T${i(s.getHours())}:${i(s.getMinutes())}`}function $t(s=new Date){const i=a=>String(a).padStart(2,"0");return`${s.getFullYear()}-${i(s.getMonth()+1)}-${i(s.getDate())}`}function It({items:s=[],onReceived:i,initialItemId:a}){const[n,r]=t.useState({item_id:"",qty_received:"",received_at:Et(),cost_per_unit:"",lot_number:"",batch_number:"",expiry_date:"",supplier_id:"",invoice_no:"",invoice_date:"",pack_size:"",notes:""}),[d,l]=t.useState(!1),[h,o]=t.useState([]),[x,g]=t.useState(!1),[p,m]=t.useState(!1),[y,N]=t.useState({name:"",contact_person:"",phone:"",email:"",address:"",notes:""});t.useEffect(()=>{a&&r(j=>({...j,item_id:String(a)}))},[a]),t.useEffect(()=>{(async()=>{try{const{data:j}=await z.get("/api/inventory/suppliers");o(j)}catch(j){console.error("Failed to load suppliers",j)}})()},[]);const R=s.find(j=>j.id===Number(n.item_id)),v=(j,b)=>r(C=>({...C,[j]:b})),S=async j=>{var b,C;j.preventDefault(),l(!0);try{await z.post("/api/inventory/receive",{...n,received_at:n.received_at?n.received_at.replace("T"," ")+":00":null}),r(f=>({...f,qty_received:"",cost_per_unit:"",lot_number:"",batch_number:"",expiry_date:"",invoice_no:"",invoice_date:"",pack_size:"",notes:""})),i==null||i(),K.success("Stock received.")}catch(f){K.error(((C=(b=f==null?void 0:f.response)==null?void 0:b.data)==null?void 0:C.message)||"Receive failed")}finally{l(!1)}},u=!d&&n.item_id&&n.qty_received&&n.received_at&&n.batch_number&&((R==null?void 0:R.type)!=="drug"||n.lot_number&&n.expiry_date);return e.jsxs("form",{onSubmit:S,children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Item *"}),e.jsxs("select",{className:"form-select",value:n.item_id,onChange:j=>v("item_id",j.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Select itemâ€¦"}),s.map(j=>e.jsxs("option",{value:j.id,children:[j.name," (",j.sku_code,")"]},j.id))]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Quantity received *"}),e.jsx("input",{className:"form-control",type:"number",step:"0.001",min:"0.001",placeholder:"e.g., 10",value:n.qty_received,onChange:j=>v("qty_received",j.target.value),required:!0})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Date & time received *"}),e.jsx("input",{className:"form-control",type:"datetime-local",value:n.received_at,onChange:j=>v("received_at",j.target.value),required:!0}),e.jsx("div",{className:"form-text",children:"Must be within the allowed backdate window (â‰¤ 24 hours; not in the future)."})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Cost per unit (optional)"}),e.jsx("input",{className:"form-control",type:"number",step:"0.01",min:"0",placeholder:"e.g., 12.50",value:n.cost_per_unit,onChange:j=>v("cost_per_unit",j.target.value)})]})]}),(R==null?void 0:R.type)==="drug"&&e.jsx("div",{className:"alert alert-info mb-3",children:e.jsxs("small",{children:["For ",e.jsx("strong",{children:"drugs"}),", ",e.jsx("strong",{children:"Lot number"})," and ",e.jsx("strong",{children:"Expiry date"})," are required."]})}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsxs("label",{className:"form-label",children:["Lot number",(R==null?void 0:R.type)==="drug"?" *":""]}),e.jsx("input",{className:"form-control",placeholder:"e.g., LOT-ABC-123",value:n.lot_number,onChange:j=>v("lot_number",j.target.value),required:(R==null?void 0:R.type)==="drug"})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Batch number *"}),e.jsx("input",{className:"form-control",placeholder:"e.g., BATCH-2025-09",value:n.batch_number,onChange:j=>v("batch_number",j.target.value),required:!0})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs("label",{className:"form-label",children:["Expiry date",(R==null?void 0:R.type)==="drug"?" *":""]}),e.jsx("input",{className:"form-control",type:"date",min:$t(),value:n.expiry_date,onChange:j=>v("expiry_date",j.target.value),required:(R==null?void 0:R.type)==="drug"}),e.jsxs("div",{className:"form-text",children:["If the item is a ",e.jsx("strong",{children:"drug"}),", expiry is required and must be a ",e.jsx("strong",{children:"future"})," date."]})]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Invoice no. (optional)"}),e.jsx("input",{className:"form-control",placeholder:"e.g., INV-000123",value:n.invoice_no,onChange:j=>v("invoice_no",j.target.value)})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Invoice date (optional)"}),e.jsx("input",{className:"form-control",type:"date",value:n.invoice_date,onChange:j=>v("invoice_date",j.target.value)})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Pack size note (optional)"}),e.jsx("input",{className:"form-control",placeholder:"e.g., 1 box = 100 pcs",value:n.pack_size,onChange:j=>v("pack_size",j.target.value)})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Supplier (optional)"}),e.jsxs("div",{className:"input-group",children:[e.jsxs("select",{className:"form-select",value:n.supplier_id,onChange:j=>v("supplier_id",j.target.value),children:[e.jsx("option",{value:"",children:"No supplier"}),h.map(j=>e.jsx("option",{value:j.id,children:j.name},j.id))]}),e.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>g(!0),title:"Add new supplier",children:"+ Add"})]}),e.jsx("div",{className:"form-text",children:"Linking a supplier improves audit trail and costing."})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Notes (optional)"}),e.jsx("textarea",{className:"form-control",rows:3,placeholder:"Additional remarksâ€¦",value:n.notes,onChange:j=>v("notes",j.target.value)})]}),e.jsx("div",{className:"d-flex justify-content-end",children:e.jsx("button",{type:"submit",disabled:!u,className:"btn btn-primary",children:d?"Receivingâ€¦":"Receive Stock"})}),x&&e.jsx("div",{className:"modal fade show d-block",role:"dialog","aria-modal":"true",style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:2100,backgroundColor:"rgba(0, 0, 0, 0.5)",overflowY:"auto",display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem"},onMouseDown:j=>{j.target===j.currentTarget&&g(!1)},children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",style:{margin:"0 auto",maxHeight:"calc(100vh - 2rem)",width:"100%"},children:e.jsxs("div",{className:"modal-content",style:{display:"flex",flexDirection:"column",maxHeight:"calc(100vh - 2rem)",overflow:"hidden"},children:[e.jsxs("div",{className:"modal-header flex-shrink-0",style:{position:"sticky",top:0,zIndex:1,backgroundColor:"#fff",borderBottom:"1px solid #dee2e6"},children:[e.jsx("h5",{className:"modal-title",children:"Add Supplier"}),e.jsx("button",{type:"button",className:"btn-close",onClick:()=>g(!1),"aria-label":"Close"})]}),e.jsxs("div",{className:"modal-body flex-grow-1",style:{overflowY:"auto",overflowX:"hidden",flex:"1 1 auto",minHeight:0},children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Name *"}),e.jsx("input",{className:"form-control",value:y.name,onChange:j=>N(b=>({...b,name:j.target.value})),required:!0})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Contact person"}),e.jsx("input",{className:"form-control",value:y.contact_person||"",onChange:j=>N(b=>({...b,contact_person:j.target.value}))})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Phone"}),e.jsx("input",{className:"form-control",value:y.phone||"",onChange:j=>N(b=>({...b,phone:j.target.value}))})]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Email"}),e.jsx("input",{type:"email",className:"form-control",value:y.email||"",onChange:j=>N(b=>({...b,email:j.target.value}))})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Address"}),e.jsx("input",{className:"form-control",value:y.address||"",onChange:j=>N(b=>({...b,address:j.target.value}))})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Notes"}),e.jsx("textarea",{className:"form-control",rows:3,value:y.notes||"",onChange:j=>N(b=>({...b,notes:j.target.value}))})]})]}),e.jsxs("div",{className:"modal-footer flex-shrink-0",style:{position:"sticky",bottom:0,zIndex:1,backgroundColor:"#fff",borderTop:"1px solid #dee2e6"},children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>g(!1),children:"Cancel"}),e.jsx("button",{type:"button",className:"btn btn-primary",disabled:p||!y.name,onClick:async()=>{var j,b;try{m(!0);const{data:C}=await z.post("/api/inventory/suppliers",y);o(f=>[...f,C]),r(f=>({...f,supplier_id:String(C.id)})),g(!1),N({name:"",contact_person:"",phone:"",email:"",address:"",notes:""})}catch(C){K.error(((b=(j=C==null?void 0:C.response)==null?void 0:j.data)==null?void 0:b.message)||"Failed to add supplier")}finally{m(!1)}},children:p?"Savingâ€¦":"Save Supplier"})]})]})})})]})}function Wt({items:s=[],user:i=null,onConsumed:a}){const n=(i==null?void 0:i.role)==="staff",[r,d]=t.useState({item_id:"",quantity:"",ref_type:n?"visit":"",ref_id:"",notes:""});t.useMemo(()=>s.find(o=>o.id===Number(r.item_id)),[s,r.item_id]);const l=(o,x)=>d(g=>({...g,[o]:x})),h=async o=>{var g,p,m;o.preventDefault();const x={item_id:Number(r.item_id),quantity:Number(r.quantity)};n?(x.ref_type="visit",r.ref_id&&(x.ref_id=Number(r.ref_id))):(r.ref_type&&(x.ref_type=r.ref_type),r.ref_id&&(x.ref_id=Number(r.ref_id))),(g=r.notes)!=null&&g.trim()&&(x.notes=r.notes.trim());try{await z.post("/api/inventory/consume",x),d(y=>({...y,quantity:"",ref_id:"",notes:""})),a==null||a(),K.success("Stock consumed.")}catch(y){K.error(((m=(p=y==null?void 0:y.response)==null?void 0:p.data)==null?void 0:m.message)||"Consume failed")}};return e.jsxs("form",{onSubmit:h,children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Item *"}),e.jsxs("select",{className:"form-select",value:r.item_id,onChange:o=>l("item_id",o.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Select itemâ€¦"}),s.map(o=>e.jsxs("option",{value:o.id,children:[o.name," (",o.sku_code,")"]},o.id))]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Quantity *"}),e.jsx("input",{className:"form-control",type:"number",step:"0.001",min:"0.001",placeholder:"e.g., 1",value:r.quantity,onChange:o=>l("quantity",o.target.value),required:!0})]}),e.jsx("div",{className:"col-md-6",children:n?e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Visit ID (required for staff) *"}),e.jsx("input",{className:"form-control",type:"number",min:"1",placeholder:"Finished Visit ID",value:r.ref_id,onChange:o=>l("ref_id",o.target.value),required:!0}),e.jsxs("div",{className:"form-text",children:["Backend requires a ",e.jsx("strong",{children:"finished"})," visit for staff consumption."]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Reference type (optional)"}),e.jsxs("select",{className:"form-select",value:r.ref_type,onChange:o=>l("ref_type",o.target.value),children:[e.jsx("option",{value:"",children:"None"}),e.jsx("option",{value:"visit",children:"Visit"}),e.jsx("option",{value:"appointment",children:"Appointment"})]})]})})]}),!n&&r.ref_type&&e.jsx("div",{className:"row mb-3",children:e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:r.ref_type==="visit"?"Visit ID":"Appointment ID"}),e.jsx("input",{className:"form-control",type:"number",min:"1",placeholder:"e.g., 123",value:r.ref_id,onChange:o=>l("ref_id",o.target.value)})]})}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Notes (optional)"}),e.jsx("textarea",{className:"form-control",rows:3,placeholder:"Additional notes...",value:r.notes,onChange:o=>l("notes",o.target.value)})]}),e.jsx("div",{className:"d-flex justify-content-end",children:e.jsx("button",{type:"submit",className:"btn btn-warning",children:"Consume Stock"})})]})}const Bt=["damaged","expired","count_correction","return_to_supplier","stock_take_variance","theft","other"],Ht=s=>{if(!s)return"";const i=String(s);return i.includes("T")?i.split("T")[0]:i};function Vt({items:s=[],onAdjusted:i,onNeedReceive:a}){const[n,r]=t.useState({item_id:"",batch_id:"",direction:"decrease",quantity:"",adjust_reason:"damaged",notes:"",custom_reason:""}),[d,l]=t.useState([]),[h,o]=t.useState(!1),x=(m,y)=>r(N=>({...N,[m]:y}));t.useEffect(()=>{const m=Number(n.item_id);if(r(y=>({...y,batch_id:""})),!m){l([]);return}(async()=>{o(!0);try{const{data:y}=await z.get(`/api/inventory/items/${m}/batches`),R=[...Array.isArray(y==null?void 0:y.batches)?y.batches:[]].sort((v,S)=>{const u=v.expiry_date?0:1,j=S.expiry_date?0:1;if(u!==j)return u-j;const b=v.expiry_date||"",C=S.expiry_date||"";if(b!==C)return b.localeCompare(C);const f=v.received_at||"",D=S.received_at||"";return f.localeCompare(D)});l(R),R.length&&r(v=>v.batch_id?v:{...v,batch_id:String(R[0].id)})}catch{l([])}finally{o(!1)}})()},[n.item_id]);const g=Number(n.item_id)>0&&Number(n.batch_id)>0&&Number(n.quantity)>0&&!!n.adjust_reason&&!h,p=async m=>{var v,S,u;if(m.preventDefault(),!d.find(j=>String(j.id)===String(n.batch_id))){K.error("Please select a valid batch.");return}let N=((v=n.notes)==null?void 0:v.trim())||"";n.adjust_reason==="other"&&n.custom_reason.trim()&&(N=N?`${n.custom_reason.trim()} â€” ${N}`:n.custom_reason.trim());const R={item_id:Number(n.item_id),batch_id:Number(n.batch_id),direction:n.direction,quantity:Number(n.quantity),adjust_reason:n.adjust_reason,...N?{notes:N}:{}};try{await z.post("/api/inventory/adjust",R),r(j=>({...j,quantity:"",notes:"",custom_reason:""})),i==null||i(),K.success("Inventory adjusted.")}catch(j){K.error(((u=(S=j==null?void 0:j.response)==null?void 0:S.data)==null?void 0:u.message)||"Adjust failed")}};return e.jsxs("form",{onSubmit:p,children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Item *"}),e.jsxs("select",{className:"form-select",value:n.item_id,onChange:m=>x("item_id",m.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Select itemâ€¦"}),s.map(m=>e.jsxs("option",{value:String(m.id),children:[m.name," (",m.sku_code,")"]},m.id))]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label",children:["Batch ",h&&e.jsx("span",{className:"text-muted small",children:"(loadingâ€¦)"})]}),e.jsxs("select",{className:"form-select",value:n.batch_id,onChange:m=>x("batch_id",m.target.value),required:!0,disabled:!n.item_id||h||d.length===0,children:[e.jsx("option",{value:"",disabled:!0,children:h?"Loadingâ€¦":"Select batchâ€¦"}),d.map(m=>e.jsxs("option",{value:String(m.id),children:["#",m.id,m.lot_number?` â€¢ Lot ${m.lot_number}`:"",m.expiry_date?` â€¢ Exp ${Ht(m.expiry_date)}`:"",` â€¢ On hand ${m.qty_on_hand}`]},m.id))]}),n.item_id&&d.length===0&&!h&&e.jsxs("div",{className:"form-text",children:["No batches yet."," ",e.jsx("button",{type:"button",className:"btn btn-link p-0 text-decoration-underline",onClick:()=>a==null?void 0:a(Number(n.item_id)),children:"Create one via Receive"}),"."]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Direction *"}),e.jsxs("select",{className:"form-select",value:n.direction,onChange:m=>x("direction",m.target.value),required:!0,children:[e.jsx("option",{value:"decrease",children:"Decrease"}),e.jsx("option",{value:"increase",children:"Increase"})]})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Quantity *"}),e.jsx("input",{className:"form-control",type:"number",step:"0.001",min:"0.001",placeholder:"e.g., 1",value:n.quantity,onChange:m=>x("quantity",m.target.value),required:!0})]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Reason *"}),e.jsx("select",{className:"form-select",value:n.adjust_reason,onChange:m=>x("adjust_reason",m.target.value),required:!0,children:Bt.map(m=>e.jsx("option",{value:m,children:m.replace("_"," ").replace(/\b\w/g,y=>y.toUpperCase())},m))})]}),n.adjust_reason==="other"&&e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Describe reason *"}),e.jsx("input",{className:"form-control",placeholder:"e.g., audit note",value:n.custom_reason,onChange:m=>x("custom_reason",m.target.value),required:!0})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Notes (optional)"}),e.jsx("textarea",{className:"form-control",rows:3,placeholder:"Additional notes...",value:n.notes,onChange:m=>x("notes",m.target.value)})]}),e.jsx("div",{className:"d-flex justify-content-end",children:e.jsx("button",{type:"submit",className:"btn btn-secondary",disabled:!g,children:"Adjust Stock"})})]})}function fs({open:s,onClose:i,title:a,children:n,maxWidth:r="md"}){const d=t.useRef(null),l=t.useRef(null);if(t.useEffect(()=>{if(!s)return;l.current=document.activeElement;const o=document.body.style.overflow;document.body.style.overflow="hidden";const x=p=>{var R;if(p.key==="Escape"&&(i==null||i()),p.key!=="Tab")return;const m=(R=d.current)==null?void 0:R.querySelectorAll('a,button,input,select,textarea,[tabindex]:not([tabindex="-1"])');if(!m||m.length===0)return;const y=m[0],N=m[m.length-1];p.shiftKey&&document.activeElement===y?(p.preventDefault(),N.focus()):!p.shiftKey&&document.activeElement===N&&(p.preventDefault(),y.focus())};document.addEventListener("keydown",x);const g=setTimeout(()=>{var p;return(p=d.current)==null?void 0:p.focus()},0);return()=>{clearTimeout(g),document.removeEventListener("keydown",x),document.body.style.overflow=o,l.current instanceof HTMLElement&&l.current.focus()}},[s,i]),!s)return null;const h={sm:"modal-sm",md:"",lg:"modal-lg",xl:"modal-xl"};return ua.createPortal(e.jsx("div",{className:"modal fade show d-block",role:"dialog","aria-modal":"true",style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:2e3,backgroundColor:"rgba(0, 0, 0, 0.5)",overflowY:"auto",display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem"},onMouseDown:o=>{o.target===o.currentTarget&&(i==null||i())},children:e.jsx("div",{className:`modal-dialog modal-dialog-scrollable ${h[r]}`,style:{maxHeight:"calc(100vh - 2rem)",margin:"0 auto",width:"100%"},children:e.jsxs("div",{ref:d,tabIndex:-1,className:"modal-content",style:{maxHeight:"calc(100vh - 2rem)",display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsxs("div",{className:"modal-header flex-shrink-0",style:{position:"sticky",top:0,zIndex:1,backgroundColor:"#fff",borderBottom:"1px solid #dee2e6"},children:[e.jsx("h5",{className:"modal-title",children:a}),e.jsx("button",{type:"button",className:"btn-close",onClick:i,"aria-label":"Close"})]}),e.jsx("div",{className:"modal-body flex-grow-1",style:{overflowY:"auto",overflowX:"hidden",minHeight:0,padding:"1rem",flex:"1 1 auto"},children:n})]})})}),document.body)}function Ot(){const[s,i]=t.useState(!0),[a,n]=t.useState(!1),[r,d]=t.useState({staff_can_receive:!1,near_expiry_days:30,low_stock_debounce_hours:24}),l=async()=>{i(!0);try{const{data:o}=await z.get("/api/inventory/settings");d(o)}finally{i(!1)}},h=async()=>{var o,x;n(!0);try{await z.patch("/api/inventory/settings",r),K.success("Settings saved.")}catch(g){K.error(((x=(o=g==null?void 0:g.response)==null?void 0:o.data)==null?void 0:x.message)||"Save failed")}finally{n(!1)}};return t.useEffect(()=>{l()},[]),s?e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 p-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded w-1/3 mb-4"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/2"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/4"})]})]})}):e.jsxs("div",{children:[e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"form-check",children:[e.jsx("input",{type:"checkbox",className:"form-check-input",checked:r.staff_can_receive,onChange:o=>d(x=>({...x,staff_can_receive:o.target.checked}))}),e.jsx("label",{className:"form-check-label",children:"Allow staff to receive stock"})]})}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Near-expiry days"}),e.jsx("input",{className:"form-control",type:"number",min:"1",max:"365",value:r.near_expiry_days,onChange:o=>d(x=>({...x,near_expiry_days:Number(o.target.value)}))})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Low-stock debounce (hours)"}),e.jsx("input",{className:"form-control",type:"number",min:"1",max:"168",value:r.low_stock_debounce_hours,onChange:o=>d(x=>({...x,low_stock_debounce_hours:Number(o.target.value)}))})]})]}),e.jsx("div",{className:"d-flex justify-content-end",children:e.jsx("button",{className:"btn btn-primary",onClick:h,disabled:a,children:a?"Savingâ€¦":"Save Settings"})})]})}function Ma(){const[s,i]=t.useState([]),[a,n]=t.useState(""),[r,d]=t.useState(!1),[l,h]=t.useState(null),[o,x]=t.useState(null),[g,p]=t.useState(!1),[m,y]=t.useState(!1),[N,R]=t.useState(!1),[v,S]=t.useState(!1),[u,j]=t.useState(!1),[b,C]=t.useState(null),f=_=>{C(_),S(!1),y(!0)},D=async(_="")=>{d(!0);try{const{data:H}=await z.get("/api/inventory/items",{params:{q:_}});i(H.data||[])}finally{d(!1)}},L=_=>{if(n(_),o&&clearTimeout(o),_.length===0||_.length>=2){const H=setTimeout(()=>{D(_)},300);x(H)}},I=async()=>{try{const{data:_}=await z.get("/api/user");h(_)}catch(_){console.error("Failed to load user",_)}};t.useEffect(()=>{D(),I()},[]);const w=t.useMemo(()=>s.length,[s]),A=g||m||N||v||u;return e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"h3 mb-1",children:"Inventory"}),e.jsx("p",{className:"text-muted small",children:"Manage your stock and supplies"})]}),e.jsxs("div",{className:"d-flex align-items-center gap-3",children:[e.jsx("div",{className:"card border-0 bg-light",children:e.jsxs("div",{className:"card-body py-2 px-3",children:[e.jsx("div",{className:"h5 mb-0 text-primary",children:w}),e.jsx("div",{className:"small text-muted",children:"Total Items"})]})}),(l==null?void 0:l.role)==="admin"&&e.jsx("button",{className:`btn btn-outline-secondary btn-sm ${A?"disabled":""}`,onClick:()=>!A&&j(!0),disabled:A,title:"Inventory Settings",children:e.jsx("i",{className:"bi bi-gear"})})]})]}),e.jsxs("div",{className:"d-flex flex-wrap gap-2 align-items-center mb-4",children:[e.jsxs("div",{className:"input-group flex-grow-1",style:{minWidth:"300px"},children:[e.jsx("span",{className:"input-group-text",children:e.jsx("i",{className:"bi bi-search"})}),e.jsx("input",{className:`form-control ${A?"opacity-50":""}`,placeholder:"Search items... (min 2 characters)",value:a,onChange:_=>!A&&L(_.target.value),disabled:A})]}),e.jsx("button",{className:`btn btn-outline-secondary ${A?"disabled":""}`,onClick:()=>!A&&D(a),disabled:A||a.length>0&&a.length<2,children:"Search"}),a.length>0&&a.length<2&&e.jsxs("div",{className:"text-warning small mt-1",children:[e.jsx("i",{className:"bi bi-info-circle me-1"}),"Please enter at least 2 characters to search"]}),e.jsxs("div",{className:"d-flex gap-2 ms-auto",children:[e.jsx("button",{className:`btn btn-success btn-sm ${A?"disabled":""}`,onClick:()=>!A&&p(!0),disabled:A,children:"+ Add Item"}),e.jsx("button",{className:`btn btn-primary btn-sm ${A?"disabled":""}`,onClick:()=>!A&&y(!0),disabled:A,children:"â‡ª Receive Stock"}),e.jsx("button",{className:`btn btn-warning btn-sm ${A?"disabled":""}`,onClick:()=>!A&&R(!0),disabled:A,children:"âˆ’ Consume"}),(l==null?void 0:l.role)==="admin"&&e.jsx("button",{className:`btn btn-secondary btn-sm ${A?"disabled":""}`,onClick:()=>!A&&S(!0),disabled:A,children:"âœŽ Adjust"})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header d-flex justify-content-between align-items-center",children:[e.jsxs("h5",{className:"card-title mb-0",children:["Items (",w,")"]}),r&&e.jsx("span",{className:"badge bg-secondary",children:"Loadingâ€¦"})]}),e.jsx("div",{className:"card-body p-0",children:e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover mb-0",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"SKU"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Unit"}),e.jsx("th",{children:"Threshold"}),e.jsx("th",{children:"On Hand"}),e.jsx("th",{children:"Sellable"})]})}),e.jsxs("tbody",{children:[s.map(_=>{const H=Number(_.total_on_hand||0),T=_.low_stock_threshold??0,c=H<=T;return e.jsxs("tr",{children:[e.jsx("td",{className:"fw-medium",children:_.name}),e.jsx("td",{className:"font-monospace text-muted",children:_.sku_code}),e.jsx("td",{children:e.jsx("span",{className:"badge bg-primary",children:_.type})}),e.jsx("td",{className:"text-muted",children:_.unit}),e.jsx("td",{className:"text-muted",children:T}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("span",{className:`fw-medium ${c?"text-danger":"text-success"}`,children:H}),c&&e.jsx("span",{className:"badge bg-danger",children:"Low"})]})}),e.jsx("td",{children:_.is_sellable?e.jsxs("span",{className:"badge bg-success",title:_.sellable_notes,children:[e.jsx("i",{className:"fas fa-shopping-cart me-1"}),"â‚±",Number(_.patient_price||0).toLocaleString()]}):e.jsx("span",{className:"text-muted",children:"-"})})]},_.id)}),s.length===0&&!r&&e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"text-center text-muted py-4",children:"No items yet."})})]})]})})})]}),e.jsx(fs,{open:g,onClose:()=>p(!1),title:"Add Item",children:e.jsx(Tt,{onCreated:()=>{p(!1),D(a)}})}),e.jsx(fs,{open:m,onClose:()=>{y(!1),C(null)},title:"Receive Stock",children:e.jsx(It,{items:s,initialItemId:b,onReceived:()=>{y(!1),C(null),D(a)}})}),e.jsx(fs,{open:N,onClose:()=>R(!1),title:"Consume Stock",children:e.jsx(Wt,{items:s,user:l,onConsumed:()=>{R(!1),D(a)}})}),e.jsx(fs,{open:v,onClose:()=>S(!1),title:"Adjust Stock (Admin)",children:e.jsx(Vt,{items:s,onAdjusted:()=>{S(!1),D(a)},onNeedReceive:f})}),e.jsx(fs,{open:u,onClose:()=>j(!1),title:"Inventory Settings",children:e.jsx(Ot,{})})]})}function na({allow:s,to:i="/404",children:a}){const[n,r]=t.useState({loading:!0,user:null,settings:null}),d=es();return t.useEffect(()=>{let h=!0;return(async()=>{try{const[o,x]=await Promise.all([z.get("/api/user"),z.get("/api/inventory/settings")]);h&&r({loading:!1,user:o.data,settings:x.data})}catch{h&&r({loading:!1,user:null,settings:null})}})(),()=>{h=!1}},[]),n.loading?e.jsx("div",{className:"p-4",children:"Loadingâ€¦"}):s({user:n.user,settings:n.settings})?a:e.jsx(Ha,{to:i,state:{from:d},replace:!0})}const Ut=({user:s,settings:i})=>(s==null?void 0:s.role)==="admin"||(s==null?void 0:s.role)==="staff"&&!!(i!=null&&i.staff_can_receive),qt=({user:s,settings:i,visitFinished:a})=>(s==null?void 0:s.role)==="admin"||(s==null?void 0:s.role)==="staff"&&!!(i!=null&&i.staff_can_receive)&&a===!0;function Zs({children:s}){return e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"100vh",width:"100%"},children:s})}const Ts=async()=>{const s=localStorage.getItem("fingerprint");if(s)return s;const a=await(await Nt.load()).get();return localStorage.setItem("fingerprint",a.visitorId),a.visitorId};function Yt(){var L,I,w;const[s,i]=t.useState(""),[a,n]=t.useState(""),[r,d]=t.useState(""),[l,h]=t.useState(!1),o=we(),x=es(),{setUser:g}=Ce(),p=((L=x.state)==null?void 0:L.message)||"",m=((I=x.state)==null?void 0:I.redirectTo)||null,y=((w=x.state)==null?void 0:w.preselectedService)||null;t.useEffect(()=>{p&&d(p)},[p]);const N=async A=>{var _,H,T,c,F,P;A.preventDefault();try{h(!0),await z.get("/sanctum/csrf-cookie");const k=await Ts(),E=await z.post("/api/login",{email:s,password:a,device_id:k}),O=E.data.user||E.data;if(E.data.requires_password_change){d("Login successful. Please change your password."),g(O),v(!0),h(!1);return}d("Login successful!"),g(O),setTimeout(()=>{O.role==="admin"?o("/admin"):O.role==="staff"?o("/staff"):O.role==="patient"?m==="/patient/appointment"?o("/patient/appointment",{state:{preselectedService:y}}):o("/patient"):O.role==="dentist"?o("/dentist"):d("Login successful, but no dashboard yet for this role.")},150)}catch(k){console.error(k);const E=((c=(T=(H=(_=k.response)==null?void 0:_.data)==null?void 0:H.errors)==null?void 0:T.email)==null?void 0:c[0])||((P=(F=k.response)==null?void 0:F.data)==null?void 0:P.message)||"Login failed";K.error(E,{style:{background:"#dc3545",color:"#fff"},iconTheme:{primary:"#fff",secondary:"#dc3545"}})}finally{h(!1)}},[R,v]=t.useState(!1),[S,u]=t.useState(""),[j,b]=t.useState(""),[C,f]=t.useState(""),D=async()=>{var A,_;if(f(""),!S||S.length<8){f("Password must be at least 8 characters.");return}if(S!==j){f("Passwords do not match.");return}try{await z.post("/api/dentist/change-password",{password:S}),v(!1),d("Password changed successfully!"),o("/dentist")}catch(H){f(((_=(A=H.response)==null?void 0:A.data)==null?void 0:_.message)||"Failed to change password")}};return e.jsxs(Zs,{children:[e.jsx(ss,{position:"top-center"}),e.jsxs("div",{className:"auth-layout",children:[l&&e.jsx(Pe,{message:"Logging in..."}),e.jsxs("div",{className:"login-container",children:[e.jsxs("div",{className:"login-left",children:[e.jsxs("div",{className:"brand-block",children:[e.jsx("img",{src:us,alt:"Kreative Dental Logo",className:"site-logo"}),e.jsxs("div",{className:"brand-text",children:[e.jsx("h2",{className:"clinic-name m-0",children:"Kreative Dental & Orthodontics"}),e.jsx("span",{className:"tagline",children:"Your smile, thoughtfully crafted."})]})]}),e.jsx("h1",{className:"welcome-title",children:"Hello, welcome!"}),e.jsxs("p",{className:"login-description",children:["Please log in to access your appointments, treatment history, and personalized dental care. ",e.jsx("br",{}),"Your oral health is just a click away!"]}),p&&e.jsxs("div",{className:"alert alert-info mb-4",children:[e.jsx("i",{className:"bi bi-info-circle me-2"}),p]}),e.jsxs("div",{className:"left-highlights",children:[e.jsxs("div",{className:"highlight",children:[e.jsx("span",{className:"emoji"}),e.jsx("span",{children:"Comprehensive dental services"})]}),e.jsxs("div",{className:"highlight",children:[e.jsx("span",{className:"emoji"}),e.jsx("span",{children:"Easy online appointment booking"})]}),e.jsxs("div",{className:"highlight",children:[e.jsx("span",{className:"emoji"}),e.jsx("span",{children:"Secure and private records"})]})]})]}),e.jsx("div",{className:"login-right",children:e.jsxs("form",{className:"login-form card-glass",onSubmit:N,children:[e.jsx("div",{className:"form-head",children:e.jsx("h3",{className:"m-0",children:"Sign in"})}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Email address"}),e.jsx("input",{type:"email",value:s,onChange:A=>i(A.target.value),required:!0,placeholder:"name@gmail.com"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Password"}),e.jsx("input",{type:"password",value:a,onChange:A=>n(A.target.value),required:!0})]}),e.jsxs("div",{className:"form-options",children:[e.jsxs("label",{className:"form-check",children:[e.jsx("input",{type:"checkbox",className:"form-check-input me-2"})," Remember me"]}),e.jsx(je,{to:"/forgot-password",className:"forgot-link",children:"Forgot password?"})]}),e.jsx("button",{type:"submit",className:"btn-primary-lg w-100",children:"Login"}),e.jsxs("div",{className:"btn-row",children:[e.jsx("button",{type:"button",className:"btn-secondary-lg",onClick:()=>o("/register"),children:"Create account"}),e.jsx("button",{type:"button",className:"btn-outline-lg",onClick:()=>o("/"),children:"Go to Homepage"})]}),r&&!r.toLowerCase().includes("credentials")&&!r.toLowerCase().includes("failed")&&e.jsx("p",{className:"login-message",children:r})]})})]})]}),R&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.7)",zIndex:1050,backdropFilter:"blur(2px)"},children:e.jsx("div",{style:{position:"fixed",inset:0,display:"flex",alignItems:"center",justifyContent:"center",zIndex:1060},children:e.jsxs("div",{className:"card shadow-lg border-warning",style:{width:450,maxWidth:"90vw"},children:[e.jsx("div",{className:"card-header bg-warning text-dark text-center",children:e.jsxs("h4",{className:"mb-0",children:[e.jsx("i",{className:"bi bi-shield-exclamation me-2"}),"Account Security Required"]})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"alert alert-warning mb-3",children:[e.jsx("i",{className:"bi bi-info-circle me-2"}),e.jsx("strong",{children:"You must change your temporary password to continue."}),e.jsx("br",{}),e.jsx("small",{children:"This is required for account security and cannot be skipped."})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-semibold",children:"New Password:"}),e.jsx("input",{type:"password",className:"form-control",value:S,onChange:A=>u(A.target.value),placeholder:"Enter your new password",autoFocus:!0})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-semibold",children:"Confirm Password:"}),e.jsx("input",{type:"password",className:"form-control",value:j,onChange:A=>b(A.target.value),placeholder:"Confirm your new password"})]}),C&&e.jsxs("div",{className:"alert alert-danger mb-3",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),C]}),e.jsx("div",{className:"d-grid",children:e.jsxs("button",{className:"btn btn-primary btn-lg",onClick:D,disabled:!S||!j,children:[e.jsx("i",{className:"bi bi-shield-check me-2"}),"Secure My Account"]})})]})]})})})]})}const bs={privacy_policy:`**Data Protection Act Compliance**

Kreative Dental Clinic is committed to protecting your privacy and personal information in accordance with the Data Protection Act. We collect, use, store, and process your personal data only for the purpose of providing dental services and managing your patient records.

**Information We Collect:**

- Personal identification information (name, email, contact number)
- Medical and dental history
- Appointment records and treatment information
- Billing and payment information
- Device and usage information when you access our online services

**How We Use Your Information:**

- To provide and improve our dental services
- To schedule and manage appointments
- To communicate with you about your treatment and appointments
- To maintain your medical records as required by law
- To process payments and billing
- To send important updates and notifications

**Data Security:**

We implement appropriate technical and organizational measures to protect your personal information against unauthorized access, alteration, disclosure, or destruction. Your data is stored securely and access is restricted to authorized personnel only.

**Your Rights:**

- Right to access your personal information
- Right to rectification of inaccurate data
- Right to erasure (in certain circumstances)
- Right to data portability
- Right to object to processing
- Right to withdraw consent

**Data Retention:**

We retain your personal information for as long as necessary to provide our services and as required by applicable laws and regulations. Medical records are typically retained for a minimum period as mandated by law.`,terms_conditions:`**Acceptance of Terms:**

By creating an account and using our services, you agree to comply with and be bound by these Terms and Conditions. If you do not agree with any part of these terms, please do not use our services.

**Account Responsibilities:**

- You are responsible for maintaining the confidentiality of your account credentials
- You must provide accurate and complete information
- You must notify us immediately of any unauthorized use of your account
- You are responsible for all activities that occur under your account

**Appointment Policies:**

- Appointments should be made in advance through the system
- Cancellations should be made at least 24 hours in advance
- Late arrivals may result in rescheduling of your appointment
- Missed appointments without proper notice may incur a fee

**Medical Information:**

The information provided in this system is for your convenience only. It is not a substitute for professional medical advice, diagnosis, or treatment. Always consult with qualified dental professionals for proper diagnosis and treatment.

**Service Availability:**

We reserve the right to modify, suspend, or discontinue any aspect of the service at any time. We do not guarantee uninterrupted or error-free access to our systems.

**Limitation of Liability:**

To the fullest extent permitted by law, Kreative Dental Clinic shall not be liable for any indirect, incidental, special, consequential, or punitive damages resulting from your use of our services.

**Changes to Terms:**

We reserve the right to modify these Terms and Conditions at any time. Continued use of our services after changes constitutes acceptance of the modified terms.`,contact_email:"kreativedent@gmail.com",contact_phone:"0927 759 2845",effective_date:new Date().toISOString().split("T")[0]};function Kt(){const[s,i]=t.useState({name:"",email:"",contact_number:"",password:"",confirmPassword:""}),[a,n]=t.useState({}),[r,d]=t.useState(""),[l,h]=t.useState(!1),[o,x]=t.useState(!1),[g,p]=t.useState(!1),[m,y]=t.useState(bs),[N,R]=t.useState(!1),v=we();t.useEffect(()=>{g&&S()},[g]);const S=async()=>{R(!0);try{const{data:f}=await z.get("/api/policy",{skip401Handler:!0});y({privacy_policy:f.privacy_policy||bs.privacy_policy,terms_conditions:f.terms_conditions||bs.terms_conditions,contact_email:f.contact_email||bs.contact_email,contact_phone:f.contact_phone||bs.contact_phone,effective_date:f.effective_date||bs.effective_date})}catch(f){console.error("Failed to fetch policy, using default",f)}finally{R(!1)}},u=f=>{if(!f)return"";const D=f.split(`
`),L=[];let I=!1,w=[];return D.forEach((A,_)=>{A.startsWith("**")&&A.endsWith("**")?(I&&(L.push(e.jsx("ul",{children:w},`ul-${_}`)),w=[],I=!1),L.push(e.jsx("p",{children:e.jsx("strong",{children:A.replace(/\*\*/g,"")})},_))):A.startsWith("- ")?(I||(I=!0),w.push(e.jsx("li",{children:A.substring(2)},`li-${_}`))):A.trim()===""?(I&&(L.push(e.jsx("ul",{children:w},`ul-${_}`)),w=[],I=!1),L.push(e.jsx("br",{},_))):(I&&(L.push(e.jsx("ul",{children:w},`ul-${_}`)),w=[],I=!1),L.push(e.jsx("p",{children:A},_)))}),I&&w.length>0&&L.push(e.jsx("ul",{children:w},"ul-final")),L},j=()=>{const f={};return/^09\d{9}$/.test(s.contact_number)||(f.contact_number="Contact number must start with 09 and be 11 digits."),/(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{8,}/.test(s.password)||(f.password="Password must have at least 1 uppercase, 1 lowercase, 1 number, and be 8+ characters."),s.password!==s.confirmPassword&&(f.confirmPassword="Passwords do not match."),o||(f.terms="You must accept the Terms and Conditions and Privacy Policy to register."),n(f),Object.keys(f).length===0},b=f=>{i({...s,[f.target.name]:f.target.value}),n({...a,[f.target.name]:null})},C=async f=>{var D,L,I,w;if(f.preventDefault(),d(""),!!j())try{h(!0),await z.get("/sanctum/csrf-cookie");const A=await z.post("/api/register",{name:s.name,email:s.email,contact_number:s.contact_number,password:s.password,password_confirmation:s.confirmPassword});localStorage.setItem("token",A.data.token),K.success("Successful registration",{style:{background:"#28a745",color:"#fff",borderRadius:"8px",padding:"16px",fontSize:"16px"},duration:3e3,position:"top-center"}),i({name:"",email:"",contact_number:"",password:"",confirmPassword:""}),n({}),d(""),setTimeout(()=>{v("/login")},1500)}catch(A){if((L=(D=A.response)==null?void 0:D.data)!=null&&L.errors){const H={};Object.keys(A.response.data.errors).forEach(T=>{T==="contact_number"?H.contact_number=A.response.data.errors[T][0]:T==="password"?H.password=A.response.data.errors[T][0]:T==="email"?H.email=A.response.data.errors[T][0]:T==="name"&&(H.name=A.response.data.errors[T][0])}),n(H)}const _=((w=(I=A.response)==null?void 0:I.data)==null?void 0:w.message)||"Registration failed";d(_)}finally{h(!1)}};return e.jsxs(Zs,{children:[e.jsx(ss,{position:"top-center"}),l&&e.jsx(Pe,{message:"Registering patient..."}),e.jsxs("div",{className:"auth-container",children:[e.jsxs("div",{className:"auth-left",children:[e.jsx("img",{src:us,alt:"Kreative Dental Logo",className:"auth-logo"}),e.jsx("h2",{className:"auth-title",children:"Create Your Account"}),e.jsx("p",{className:"auth-description",children:"Join us today and manage your appointments, treatment history, and profile in one place."})]}),e.jsx("div",{className:"auth-right",children:e.jsxs("div",{className:"card shadow-sm p-4",children:[e.jsx("h3",{className:"text-center mb-4",children:"Patient Registration"}),e.jsxs("form",{onSubmit:C,children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label",children:[e.jsx("i",{className:"bi bi-person me-2"}),"Full Name"]}),e.jsx("input",{type:"text",className:`form-control ${a.name?"is-invalid":""}`,name:"name",value:s.name,onChange:b,required:!0}),a.name&&e.jsx("div",{className:"invalid-feedback",children:a.name})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label",children:[e.jsx("i",{className:"bi bi-envelope me-2"}),"Email"]}),e.jsx("input",{type:"email",className:`form-control ${a.email?"is-invalid":""}`,name:"email",value:s.email,onChange:b,required:!0,autoComplete:"email"}),a.email&&e.jsx("div",{className:"invalid-feedback",children:a.email})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label",children:[e.jsx("i",{className:"bi bi-telephone me-2"}),"Contact Number"]}),e.jsx("input",{type:"text",className:`form-control ${a.contact_number?"is-invalid":""}`,name:"contact_number",value:s.contact_number,onChange:b,required:!0}),a.contact_number&&e.jsx("div",{className:"invalid-feedback",children:a.contact_number})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label",children:[e.jsx("i",{className:"bi bi-lock me-2"}),"Password"]}),e.jsx("input",{type:"password",className:`form-control ${a.password?"is-invalid":""}`,name:"password",value:s.password,onChange:b,required:!0,autoComplete:"new-password"}),a.password&&e.jsx("div",{className:"invalid-feedback",children:a.password})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label",children:[e.jsx("i",{className:"bi bi-lock-fill me-2"}),"Confirm Password"]}),e.jsx("input",{type:"password",className:`form-control ${a.confirmPassword?"is-invalid":""}`,name:"confirmPassword",value:s.confirmPassword,onChange:b,required:!0,autoComplete:"new-password"}),a.confirmPassword&&e.jsx("div",{className:"invalid-feedback",children:a.confirmPassword})]}),e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:`form-check-input ${a.terms?"is-invalid":""}`,type:"checkbox",id:"acceptTerms",checked:o,onChange:f=>{x(f.target.checked),n({...a,terms:null})},required:!0}),e.jsxs("label",{className:"form-check-label",htmlFor:"acceptTerms",children:["I agree to the"," ",e.jsx("button",{type:"button",className:"btn btn-link p-0 text-decoration-none",onClick:f=>{f.preventDefault(),p(!0)},style:{verticalAlign:"baseline"},children:"Term, Privacy Policy"})]}),a.terms&&e.jsx("div",{className:"invalid-feedback d-block",children:a.terms})]})}),e.jsxs("button",{type:"submit",className:"btn btn-primary w-100",disabled:!o,children:[e.jsx("i",{className:"bi bi-person-plus me-2"}),"Register"]})]}),r&&e.jsx("div",{className:`alert text-center mt-3 ${r.includes("âœ…")||r.includes("âš ï¸")?"alert-info":"alert-danger"}`,children:r}),e.jsx("div",{className:"text-center mt-3",children:e.jsxs(je,{to:"/login",className:"d-block text-decoration-none text-primary mb-2",children:[e.jsx("i",{className:"bi bi-box-arrow-in-right me-2"}),"Already have an account? Login"]})})]})})]}),g&&e.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:e.jsx("div",{className:"modal-dialog modal-lg modal-dialog-scrollable",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title",children:"Terms, Privacy Policy"}),e.jsx("button",{type:"button",className:"btn-close",onClick:()=>p(!1)})]}),e.jsx("div",{className:"modal-body",children:N?e.jsx("div",{className:"text-center py-4",children:e.jsx("div",{className:"spinner-border",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})}):e.jsxs(e.Fragment,{children:[e.jsx("h6",{children:"Privacy Policy"}),e.jsx("div",{className:"policy-content",children:u(m.privacy_policy)}),e.jsx("hr",{}),e.jsx("h6",{children:"Terms and Conditions"}),e.jsx("div",{className:"policy-content",children:u(m.terms_conditions)}),e.jsx("hr",{}),e.jsx("p",{children:e.jsx("strong",{children:"Contact Information:"})}),e.jsx("p",{children:"If you have any questions about this Privacy Policy or Terms and Conditions, please contact us at:"}),e.jsxs("p",{children:["Kreative Dental Clinic",e.jsx("br",{}),"Email: ",m.contact_email,e.jsx("br",{}),"Phone: ",m.contact_phone]}),e.jsxs("p",{className:"text-muted small mt-4",children:[e.jsx("strong",{children:"Effective Date:"})," ",m.effective_date?new Date(m.effective_date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):new Date().toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})]})]})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>p(!1),children:"Close"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>{x(!0),p(!1)},children:"Accept and Close"})]})]})})})]})}function Gt(){var m,y;const s=es(),i=((m=s.state)==null?void 0:m.email)||"",a=((y=s.state)==null?void 0:y.fromProfile)||!1,[n,r]=t.useState(""),[d,l]=t.useState(""),[h,o]=t.useState(""),[x,g]=t.useState(!1);t.useEffect(()=>{r(i)},[i]);const p=async N=>{var R,v;N.preventDefault(),l(""),o("");try{g(!0),await z.get("/sanctum/csrf-cookie");const S=await Ts(),u=await z.post("/forgot-password",{email:n,device_id:S});l(u.data.message||"Reset link sent to your email.")}catch(S){const u=((v=(R=S.response)==null?void 0:R.data)==null?void 0:v.message)||"Something went wrong";o(u)}finally{g(!1)}};return e.jsxs(Zs,{children:[x&&e.jsx(Pe,{message:"Sending reset link..."}),e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",width:"1300px",height:"720px",margin:"0 auto",padding:"20px"},children:e.jsxs("div",{className:"card shadow-sm p-4",style:{width:"400px",padding:"30px",borderRadius:"12px",boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.1)"},children:[e.jsx("h3",{className:"text-center mb-4",children:a?"Send Password Reset Link":"Forgot Password"}),e.jsxs("form",{onSubmit:p,children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label",children:[e.jsx("i",{className:"bi bi-envelope me-2"}),"Email Address"]}),e.jsx("input",{type:"email",className:"form-control",value:n,readOnly:a,onChange:N=>r(N.target.value),required:!0,autoComplete:"email"})]}),e.jsxs("button",{type:"submit",className:"btn btn-primary w-100",children:[e.jsx("i",{className:"bi bi-send me-2"}),"Send Reset Link"]})]}),d&&e.jsx("div",{className:"alert alert-success text-center mt-3",children:d}),h&&e.jsx("div",{className:"alert alert-danger text-center mt-3",children:h}),e.jsx("div",{className:"text-center mt-3",children:e.jsxs(je,{to:"/login",className:"d-block text-decoration-none text-primary",children:[e.jsx("i",{className:"bi bi-arrow-left me-2"}),"Back to Login"]})})]})})]})}function Xt(){const{token:s}=Xs(),[i]=ut(),a=i.get("email")||"",n=we(),[r,d]=t.useState({email:a,password:"",password_confirmation:""}),[l,h]=t.useState({}),[o,x]=t.useState(""),[g,p]=t.useState(!1),m=N=>{d({...r,[N.target.name]:N.target.value}),h({...l,[N.target.name]:null})},y=async N=>{var R,v;if(N.preventDefault(),x(""),h({}),!/(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{8,}/.test(r.password)){h({password:"Password must have at least 1 uppercase, 1 lowercase, 1 number, and be 8+ characters."});return}if(r.password!==r.password_confirmation){h({password_confirmation:"Passwords do not match."});return}try{p(!0),await z.get("/sanctum/csrf-cookie");const S=await z.post("/reset-password",{token:s,email:r.email,password:r.password,password_confirmation:r.password_confirmation});x("Password has been reset! Redirecting to login..."),setTimeout(()=>{n("/login")},2e3)}catch(S){const u=((v=(R=S.response)==null?void 0:R.data)==null?void 0:v.message)||"Reset failed";x(u)}finally{p(!1)}};return e.jsxs(Zs,{children:[g&&e.jsx(Pe,{message:"Resetting password..."}),e.jsxs("div",{className:"card shadow-sm p-4",style:{width:"100%",maxWidth:"500px"},children:[e.jsx("h3",{className:"text-center mb-4",children:"Reset Password"}),e.jsxs("form",{onSubmit:y,children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label",children:[e.jsx("i",{className:"bi bi-envelope me-2"}),"Email"]}),e.jsx("input",{type:"email",name:"email",className:"form-control",value:r.email,onChange:m,required:!0,readOnly:!0})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label",children:[e.jsx("i",{className:"bi bi-lock me-2"}),"New Password"]}),e.jsx("input",{type:"password",name:"password",className:`form-control ${l.password?"is-invalid":""}`,value:r.password,onChange:m,required:!0,autoComplete:"new-password"}),l.password&&e.jsx("div",{className:"invalid-feedback",children:l.password})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label",children:[e.jsx("i",{className:"bi bi-lock-fill me-2"}),"Confirm Password"]}),e.jsx("input",{type:"password",name:"password_confirmation",className:`form-control ${l.password_confirmation?"is-invalid":""}`,value:r.password_confirmation,onChange:m,required:!0,autoComplete:"new-password"}),l.password_confirmation&&e.jsx("div",{className:"invalid-feedback",children:l.password_confirmation})]}),e.jsxs("button",{type:"submit",className:"btn btn-primary w-100",children:[e.jsx("i",{className:"bi bi-shield-lock me-2"}),"Reset Password"]})]}),o&&e.jsx("div",{className:"alert alert-info text-center mt-3",children:o}),e.jsx("div",{className:"text-center mt-3",children:e.jsxs(je,{to:"/login",className:"text-decoration-none text-primary",children:[e.jsx("i",{className:"bi bi-box-arrow-in-left me-2"}),"Back to Login"]})})]})]})}function Qt(){const[s,i]=t.useState(""),[a,n]=t.useState(!1),r=async()=>{try{n(!0);const d=await z.post("/email/verification-notification");i("Verification link resent to your email!")}catch{i("Failed to resend. Please try again later.")}finally{n(!1)}};return e.jsx("div",{className:"container d-flex justify-content-center align-items-center",style:{minHeight:"100vh"},children:e.jsxs("div",{className:"card shadow-sm p-4",style:{maxWidth:"500px",width:"100%"},children:[e.jsx("h3",{className:"text-center mb-3",children:"Verify Your Email"}),e.jsx("p",{className:"text-center",children:"A verification link has been sent to your email. Please check your inbox."}),s&&e.jsx("div",{className:"alert alert-info text-center",children:s}),e.jsx("div",{className:"text-center mt-3",children:e.jsx("button",{onClick:r,className:"btn btn-outline-primary",disabled:a,children:a?"Resending...":"Resend Verification Link"})})]})})}function Jt(){return e.jsx("div",{className:"container d-flex justify-content-center align-items-center",style:{minHeight:"100vh"},children:e.jsxs("div",{className:"card shadow-sm p-4",style:{maxWidth:"500px",width:"100%"},children:[e.jsxs("h2",{className:"text-center mb-3 text-success",children:[e.jsx("i",{className:"bi bi-check-circle-fill me-2"}),"Email Verified!"]}),e.jsx("p",{className:"text-center",children:"Your email has been successfully verified. You can now log in to your account."}),e.jsx("div",{className:"text-center mt-4",children:e.jsxs(je,{to:"/login",className:"btn btn-primary",children:[e.jsx("i",{className:"bi bi-box-arrow-in-right me-2"}),"Go to Login"]})})]})})}function Zt(){const{id:s,hash:i}=Xs(),a=es();return t.useEffect(()=>{if(!s||!i)return;const n=a.search||"";window.location.replace(`/verify-email/${s}/${i}${n}`)},[i,s,a.search]),e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"60vh"},children:e.jsx(Pe,{message:"Verifying your email..."})})}function ei(){return e.jsxs("div",{className:"landing-page",children:[e.jsx("header",{className:"site-header shadow-sm",children:e.jsxs("div",{className:"container d-flex justify-content-between align-items-center py-2 py-md-3",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("img",{src:us,alt:"Kreative Dental Logo",className:"site-logo me-2"}),e.jsx("span",{className:"logo-text",children:"Kreative Dental Clinic"})]}),e.jsx("nav",{className:"d-none d-md-block",children:e.jsxs("ul",{className:"nav-list d-flex gap-2 gap-lg-3 mb-0",children:[e.jsx("li",{children:e.jsx("a",{className:"nav-link",href:"/#home",children:"Home"})}),e.jsx("li",{children:e.jsx("a",{className:"nav-link",href:"/#services",children:"Services"})}),e.jsx("li",{children:e.jsx("a",{className:"nav-link",href:"/#about",children:"About"})}),e.jsx("li",{children:e.jsx("a",{className:"nav-link",href:"/#contact",children:"Contact"})})]})})]})}),e.jsx("section",{className:"hero-section d-flex align-items-center text-white",children:e.jsxs("div",{className:"container text-center px-3 px-md-4",children:[e.jsx("h1",{className:"hero-title mb-3 mb-md-4",children:"Oops! Page not found."}),e.jsx("p",{className:"hero-subtitle mb-4 mb-md-5",children:"The page you are looking for may have moved or no longer exists."}),e.jsxs("div",{className:"hero-buttons mt-4 d-flex flex-column flex-sm-row justify-content-center align-items-center gap-2 gap-md-3",children:[e.jsx(je,{to:"/",className:"btn btn-light btn-lg shadow w-100 w-sm-auto px-4",children:"Back to Home"}),e.jsx(je,{to:"/login",className:"btn btn-outline-light btn-lg w-100 w-sm-auto px-4",children:"Login"}),e.jsx(je,{to:"/register",className:"btn btn-outline-light btn-lg w-100 w-sm-auto px-4",children:"Register"})]})]})}),e.jsx("footer",{className:"text-center py-3 py-md-4 bg-primary text-white",children:e.jsx("div",{className:"container px-3 px-md-4",children:e.jsxs("p",{className:"mb-0 small",children:["Â© ",new Date().getFullYear()," Kreative Dental Clinic. All Rights Reserved."]})})})]})}function ea(){const{items:s,unread:i,loading:a,error:n,loadList:r,loadUnread:d,markAllRead:l}=Ga(),[h,o]=t.useState(!1),[x,g]=t.useState(null),p=t.useRef(!1),m=t.useRef(null),y=t.useRef(null),N=we(),[R,v]=t.useState({top:0,left:0}),S=340,u=()=>{if(!m.current)return;const f=m.current.getBoundingClientRect();let D=f.right-S;D=Math.max(8,D),D=Math.min(D,window.innerWidth-S-8);const L=Math.max(8,f.bottom+8);v({top:L,left:D})};t.useEffect(()=>{d()},[d]);const j=f=>{if(!f)return"";const D=new Date,L=new Date(f),I=Math.floor((D-L)/1e3);return I<60?"Just now":I<3600?`${Math.floor(I/60)}m ago`:I<86400?`${Math.floor(I/3600)}h ago`:I<604800?`${Math.floor(I/86400)}d ago`:`${Math.floor(I/86400)}d ago`},b=async()=>{const f=!h;o(f),f&&(setTimeout(()=>{u()},10),await r(),i>0&&(await l(),await d()))},C=f=>{var D;if(console.log("Notification clicked:",f),p.current){console.log("Already navigating, ignoring click");return}if(f.type==="visit_code"&&((D=f.data)!=null&&D.visit_code)){console.log("Navigating to visit code:",f.data.visit_code),p.current=!0,g(f.id),o(!1),setTimeout(()=>{N(`/dentist/visit/${f.data.visit_code}`),setTimeout(()=>{p.current=!1,g(null)},1500)},200);return}o(!1)};return t.useEffect(()=>{if(!h)return;const f=I=>I.key==="Escape"&&o(!1),D=()=>u(),L=I=>{if(!y.current||!m.current)return;const w=y.current.contains(I.target),A=m.current.contains(I.target);!w&&!A&&o(!1)};return document.addEventListener("keydown",f),window.addEventListener("resize",D),document.addEventListener("mousedown",L),()=>{document.removeEventListener("keydown",f),window.removeEventListener("resize",D),document.removeEventListener("mousedown",L)}},[h]),e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
          .notification-bell-btn:hover {
            background: rgba(255, 255, 255, 0.2) !important;
            transform: translateY(-1px) !important;
          }
        `}),e.jsxs("button",{ref:m,onClick:b,className:"btn d-inline-flex align-items-center notification-bell-btn",title:"Notifications","aria-label":"Notifications",style:{background:"rgba(255, 255, 255, 0.15)",border:"none",color:"white",borderRadius:"8px",padding:"0.5rem 0.75rem",transition:"all 0.2s ease"},children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"}),e.jsx("path",{d:"M13.73 21a2 2 0 0 1-3.46 0"})]}),i>0&&e.jsx("span",{className:"badge ms-2",style:{backgroundColor:"#dc3545",color:"white",fontSize:"0.7rem",fontWeight:"600"},children:i>99?"99+":i})]}),h&&e.jsx("div",{ref:y,role:"dialog","aria-modal":"true",className:"position-fixed",style:{top:R.top,left:R.left,width:S,zIndex:1050,maxWidth:"calc(100vw - 16px)"},children:e.jsxs("div",{className:"card shadow",style:{borderRadius:"12px",border:"none"},children:[e.jsxs("div",{className:"card-header py-3 d-flex align-items-center justify-content-between",style:{background:"linear-gradient(135deg, #00b4d8 0%, #0077b6 100%)",color:"white",borderRadius:"12px 12px 0 0"},children:[e.jsxs("div",{children:[e.jsx("strong",{style:{fontSize:"1.1rem"},children:"Notifications"}),e.jsx("div",{className:"small",style:{opacity:.9},children:"Clinic updates & alerts"})]}),e.jsx("button",{className:"btn btn-sm p-0 notification-close-btn",onClick:()=>o(!1),style:{color:"white",background:"rgba(255,255,255,0.2)",border:"none",borderRadius:"6px",padding:"0.25rem 0.5rem",fontSize:"0.8rem",fontWeight:"600"},children:"Close"})]}),e.jsxs("div",{className:"list-group list-group-flush",style:{maxHeight:340,overflow:"auto"},children:[a&&e.jsxs("div",{className:"list-group-item small text-muted p-3",style:{textAlign:"center"},children:[e.jsx("i",{className:"bi bi-hourglass-split me-2"}),"Loadingâ€¦"]}),n&&!a&&e.jsxs("div",{className:"list-group-item small text-danger p-3",style:{textAlign:"center"},children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),n]}),!a&&!n&&s.length===0&&e.jsxs("div",{className:"list-group-item small text-muted p-4",style:{textAlign:"center"},children:[e.jsx("i",{className:"bi bi-bell-slash display-6 d-block mb-2 text-muted"}),"No notifications."]}),!a&&!n&&s.map(f=>{var D,L;return e.jsx("div",{className:`list-group-item small p-3 ${x===f.id?"list-group-item-success":""}`,style:{borderLeft:"none",borderRight:"none",borderBottom:"1px solid #f1f3f4"},children:e.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[e.jsxs("div",{className:"me-3 flex-grow-1",children:[e.jsxs("div",{className:"fw-semibold mb-1",style:{color:"#1e293b",fontSize:"0.9rem"},children:[f.title||"Notification",f.severity==="danger"&&e.jsx("span",{className:"badge ms-2",style:{backgroundColor:"#dc3545",color:"white",fontSize:"0.65rem"},children:"Important"}),f.severity==="warning"&&e.jsx("span",{className:"badge ms-2",style:{backgroundColor:"#ffc107",color:"#000",fontSize:"0.65rem"},children:"Warning"}),f.severity==="info"&&e.jsx("span",{className:"badge ms-2",style:{backgroundColor:"#00b4d8",color:"white",fontSize:"0.65rem"},children:"Info"}),f.type==="visit_code"&&e.jsxs("span",{className:"badge ms-2",style:{backgroundColor:"#28a745",color:"white",fontSize:"0.65rem"},children:[e.jsx("i",{className:"bi bi-key me-1"}),"Visit Code"]})]}),f.body&&e.jsx("div",{className:"text-muted mt-1",style:{fontSize:"0.8rem",lineHeight:"1.4"},children:f.type==="visit_code"&&((D=f.data)!=null&&D.visit_code)?e.jsxs(e.Fragment,{children:[f.body.split(f.data.visit_code)[0],e.jsx("span",{className:"fw-bold text-primary",style:{cursor:"pointer",textDecoration:"underline",backgroundColor:x===f.id?"#d1ecf1":"transparent",padding:"1px 3px",borderRadius:"3px"},onClick:I=>{I.preventDefault(),I.stopPropagation(),C(f)},title:"Click to use visit code and continue",children:f.data.visit_code}),f.body.split(f.data.visit_code)[1]]}):f.body}),((L=f.data)==null?void 0:L.date)&&e.jsxs("div",{className:"text-muted mt-1",style:{fontSize:"0.75rem"},children:["Date: ",f.data.date]})]}),e.jsxs("div",{className:"d-flex flex-column align-items-end",children:[x===f.id&&e.jsxs("small",{className:"text-success mb-1",children:[e.jsx("i",{className:"bi bi-arrow-right-circle me-1"}),"Opening visit..."]}),e.jsx("small",{className:"text-muted",style:{fontSize:"0.7rem",whiteSpace:"nowrap"},children:j(f.created_at)})]})]})},f.id)})]}),e.jsxs("div",{className:"card-footer py-3 d-flex justify-content-between",style:{background:"#f8f9fa",borderRadius:"0 0 12px 12px",borderTop:"1px solid #e9ecef"},children:[e.jsx(je,{to:"/notifications",className:"btn btn-sm p-0 notification-see-all-btn",style:{color:"#00b4d8",background:"transparent",border:"none",fontWeight:"600",fontSize:"0.8rem"},children:"See all"}),e.jsx("button",{className:"btn btn-sm p-0 notification-bottom-close-btn",onClick:()=>o(!1),style:{color:"#6c757d",background:"transparent",border:"none",fontWeight:"600",fontSize:"0.8rem"},children:"Close"})]})]})})]})}function Ze({show:s,onConfirm:i,onCancel:a,title:n,message:r,confirmText:d="Confirm",cancelText:l="Cancel",variant:h="danger"}){if(!s)return null;const o=e.jsx("div",{className:"confirmation-modal-overlay",onClick:a,children:e.jsxs("div",{className:"confirmation-modal-content",onClick:x=>x.stopPropagation(),children:[e.jsxs("div",{className:"confirmation-modal-header",children:[e.jsx("i",{className:`bi bi-exclamation-triangle-fill text-${h} me-2`}),e.jsx("h5",{className:"confirmation-modal-title",children:n||"Confirm Action"})]}),e.jsx("div",{className:"confirmation-modal-body",children:e.jsx("p",{children:r})}),e.jsxs("div",{className:"confirmation-modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:a,children:l}),e.jsx("button",{type:"button",className:`btn btn-${h}`,onClick:i,children:d})]})]})});return ua.createPortal(o,document.body)}function si(){const s=we(),i=es(),{user:a,logout:n}=Ce(),[r,d]=t.useState(()=>window.innerWidth>=992),[l,h]=t.useState(!1);t.useEffect(()=>{if(a&&a.role!=="admin"){const p=a.role==="staff"?"/staff":a.role==="patient"?"/patient":a.role==="dentist"?"/dentist":"/";s(p,{replace:!0})}},[a,s]),t.useEffect(()=>{const p=()=>{window.innerWidth>=992?d(!0):d(!1)};return window.addEventListener("resize",p),()=>window.removeEventListener("resize",p)},[]);const o=()=>{h(!0)},x=async()=>{h(!1),await n(),s("/")},g=()=>{h(!1)};return e.jsxs("div",{className:`admin-shell ${r?"sidebar-open":"sidebar-closed"}`,children:[e.jsx(ss,{position:"top-center"}),e.jsxs("aside",{className:"sidebar  text-white",children:[e.jsxs("div",{className:"sidebar-header d-flex align-items-center justify-content-center position-relative",children:[e.jsx("h5",{className:"m-0 fw-bold text-center w-100",children:"Admin"}),e.jsx("div",{className:"d-flex align-items-center gap-2 position-absolute",style:{right:"0.9rem",zIndex:2},children:e.jsx("button",{className:"btn btn-sm btn-outline-light d-lg-none",onClick:()=>d(!1),"aria-label":"Close sidebar",children:e.jsx("i",{className:"bi bi-x"})})})]}),e.jsx("div",{className:"nav-scroller",children:e.jsxs("ul",{className:"nav flex-column",children:[e.jsx("li",{className:"nav-item",children:e.jsxs(he,{to:"/admin",end:!0,className:({isActive:p})=>"nav-link"+(p?" active":""),children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"})}),e.jsx("span",{className:"label",children:"Dashboard"})]})}),e.jsx("li",{className:"nav-item",children:e.jsxs(he,{to:"/admin/devices",className:({isActive:p})=>"nav-link"+(p?" active":""),children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zM12 17c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zM15.1 8H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"})}),e.jsx("span",{className:"label",children:"Device Management"})]})}),e.jsx("li",{className:"nav-item",children:e.jsxs(he,{to:"/admin/staff-register",className:({isActive:p})=>"nav-link"+(p?" active":""),children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M16 4c0-1.11.89-2 2-2s2 .89 2 2-.89 2-2 2-2-.89-2-2zM4 18v-4h3v-2.5c0-.83.67-1.5 1.5-1.5h2c.83 0 1.5.67 1.5 1.5V16h3v2H4zM12.5 11.5c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5-.67 1.5-1.5 1.5-1.5-.67-1.5-1.5zM24 16v2h-3v3h-2v-3h-3v-2h3v-3h2v3h3z"})}),e.jsx("span",{className:"label",children:"Manage Staff Account"})]})}),e.jsx("li",{className:"nav-item",children:e.jsxs(he,{to:"/admin/dentists",className:({isActive:p})=>"nav-link"+(p?" active":""),children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"})}),e.jsx("span",{className:"label",children:"Dentists"})]})}),e.jsx("li",{className:"nav-item",children:e.jsxs(he,{to:"/admin/dentist-performance",className:({isActive:p})=>"nav-link"+(p?" active":""),children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M3 17h2v-7H3v7zm4 0h2V7H7v10zm4 0h2v-4h-2v4zm4 0h2V4h-2v13zm4 0h2v-9h-2v9z"})}),e.jsx("span",{className:"label",children:"Dentist Performance"})]})}),e.jsx("li",{className:"nav-item",children:e.jsxs(he,{to:"/admin/schedule",className:({isActive:p})=>"nav-link"+(p?" active":""),children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"})}),e.jsx("span",{className:"label",children:"Clinic Schedule"})]})}),e.jsx("li",{className:"nav-item",children:e.jsxs(he,{to:"/admin/appointments",className:({isActive:p})=>"nav-link"+(p?" active":""),children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M17 12h-5v5h5v-5zM16 1v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-1V1h-2zm3 18H5V8h14v11z"})}),e.jsx("span",{className:"label",children:"Appointments"})]})}),e.jsx("li",{className:"nav-item",children:e.jsxs(he,{to:"/admin/time-blocks",className:({isActive:p})=>"nav-link"+(p?" active":""),children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"})}),e.jsx("span",{className:"label",children:"Time Block Utilization"})]})}),e.jsx("li",{className:"nav-item",children:e.jsxs(he,{to:"/admin/patient-manager",className:({isActive:p})=>"nav-link"+(p?" active":""),children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M16 4c0-1.11.89-2 2-2s2 .89 2 2-.89 2-2 2-2-.89-2-2zM4 18v-4h3v-2.5c0-.83.67-1.5 1.5-1.5h2c.83 0 1.5.67 1.5 1.5V16h3v2H4zM12.5 11.5c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5-.67 1.5-1.5 1.5-1.5-.67-1.5-1.5zM24 16v2h-3v3h-2v-3h-3v-2h3v-3h2v3h3z"})}),e.jsx("span",{className:"label",children:"Patient Manager"})]})}),e.jsx("li",{className:"nav-item",children:e.jsxs(he,{to:"/admin/archived-patients",className:({isActive:p})=>"nav-link"+(p?" active":""),children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M6 2a2 2 0 0 0-2 2v3H3a1 1 0 0 0-1 1v11c0 1.1.9 2 2 2h16a2 2 0 0 0 2-2V8a1 1 0 0 0-1-1h-1V4a2 2 0 0 0-2-2H6zm0 2h12v3H6V4zm-1 5h14v9H5V9zm4 2v5h6v-5H9z"})}),e.jsx("span",{className:"label",children:"Archived Patients"})]})}),e.jsx("li",{className:"nav-item",children:e.jsxs(he,{to:"/admin/patient-binding",className:({isActive:p})=>"nav-link"+(p?" active":""),children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M10.59 13.41c.41.39.41 1.03 0 1.42-.39.39-1.03.39-1.42 0a5.003 5.003 0 0 1 0-7.07l3.54-3.54a5.003 5.003 0 0 1 7.07 0 5.003 5.003 0 0 1 0 7.07l-1.49 1.49c.01-.82-.12-1.64-.4-2.42l.47-.48a2.982 2.982 0 0 0 0-4.24 2.982 2.982 0 0 0-4.24 0l-3.53 3.53a2.982 2.982 0 0 0 0 4.24zm2.82-4.24c.39-.39 1.03-.39 1.42 0a5.003 5.003 0 0 1 0 7.07l-3.54 3.54a5.003 5.003 0 0 1-7.07 0 5.003 5.003 0 0 1 0-7.07l1.49-1.49c-.01.82.12 1.64.4 2.43l-.47.47a2.982 2.982 0 0 0 0 4.24 2.982 2.982 0 0 0 4.24 0l3.53-3.53a2.982 2.982 0 0 0 0-4.24.973.973 0 0 1 0-1.42z"})}),e.jsx("span",{className:"label",children:"Patient-User Binding"})]})}),e.jsx("li",{className:"nav-item",children:e.jsxs(he,{to:"/admin/payment-records",className:({isActive:p})=>"nav-link"+(p?" active":""),children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M19 14V6c0-1.1-.9-2-2-2H3c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zm-9-1c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm13-6v11c0 1.1-.9 2-2 2H4v-2h17V7h2z"})}),e.jsx("span",{className:"label",children:"Payment Records"})]})}),e.jsx("li",{className:"nav-item",children:e.jsxs(he,{to:"/admin/refund-requests",className:({isActive:p})=>"nav-link"+(p?" active":""),children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-5 14H4v-4h11v4zm0-5H4V9h11v4zm5 5h-4V9h4v9z"})}),e.jsx("span",{className:"label",children:"Refund Requests"})]})}),e.jsx("li",{className:"nav-item",children:e.jsxs(he,{to:"/admin/policy-settings",className:({isActive:p})=>"nav-link"+(p?" active":""),children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"})}),e.jsx("span",{className:"label",children:"Policy Settings"})]})}),e.jsx("li",{className:"nav-item",children:e.jsxs(he,{to:"/admin/services",className:({isActive:p})=>"nav-link"+(p?" active":""),children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"})}),e.jsx("span",{className:"label",children:"Manage Services"})]})}),e.jsx("li",{className:"nav-item",children:e.jsxs(he,{to:"/admin/service-discounts",className:({isActive:p})=>"nav-link"+(p?" active":""),children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12.79 21L3 11.21v2c0 .45.54.67.85.35l.79-.79 1.41 1.41c.78.78 2.05.78 2.83 0l1.41-1.41 1.41 1.41c.78.78 2.05.78 2.83 0L16.94 12 18.36 13.42c.78.78 2.05.78 2.83 0l1.41-1.41.79.79c.31.32.85.1.85-.35v-2L14.21 21c-.78.78-2.05.78-2.83 0L12.79 21zM11.38 17.41c.78.78 2.05.78 2.83 0l1.41-1.41 1.41 1.41c.78.78 2.05.78 2.83 0l.71-.71L21 16.27V5c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v11.27l.43.43.71.71z"})}),e.jsx("span",{className:"label",children:"Service Promos"})]})}),e.jsx("li",{className:"nav-item",children:e.jsxs(he,{to:"/admin/promo-archive",className:({isActive:p})=>"nav-link"+(p?" active":""),children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M10 4H4c-1.11 0-2 .89-2 2v12c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2h-8l-2-2z"})}),e.jsx("span",{className:"label",children:"Promo Archive"})]})}),e.jsx("li",{className:"nav-item",children:e.jsxs(he,{to:"/admin/inventory",className:({isActive:p})=>"nav-link"+(p?" active":""),children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M19 7h-3V6a4 4 0 0 0-8 0v1H5a1 1 0 0 0-1 1v11a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V8a1 1 0 0 0-1-1zM10 6a2 2 0 0 1 4 0v1h-4V6zm8 13a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V9h2v1a1 1 0 0 0 2 0V9h4v1a1 1 0 0 0 2 0V9h2v10z"})}),e.jsx("span",{className:"label",children:"Inventory"})]})}),e.jsx("li",{className:"nav-item",children:e.jsxs(he,{to:"/admin/goals",className:({isActive:p})=>"nav-link"+(p?" active":""),children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm3.5-9c.83 0 1.5-.67 1.5-1.5S16.33 8 15.5 8 14 8.67 14 9.5s.67 1.5 1.5 1.5zm-7 0c.83 0 1.5-.67 1.5-1.5S9.33 8 8.5 8 7 8.67 7 9.5 7.67 11 8.5 11zm3.5 6.5c2.33 0 4.31-1.46 5.11-3.5H6.89c.8 2.04 2.78 3.5 5.11 3.5z"})}),e.jsx("span",{className:"label",children:"Goals"})]})}),e.jsx("li",{className:"nav-item",children:e.jsxs(he,{to:"/admin/monthly-report",className:({isActive:p})=>"nav-link"+(p?" active":""),children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M3.5 18.49l6-6.01 4 4L22 6.92l-1.41-1.41-7.09 7.97-4-4L2 16.99z"})}),e.jsx("span",{className:"label",children:"Monthly Visits"})]})}),e.jsx("li",{className:"nav-item",children:e.jsxs(he,{to:"/admin/analytics",className:({isActive:p})=>"nav-link"+(p?" active":""),children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"})}),e.jsx("span",{className:"label",children:"Analytics"})]})}),e.jsx("li",{className:"nav-item",children:e.jsxs(he,{to:"/admin/backup-restore",className:({isActive:p})=>"nav-link"+(p?" active":""),children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M19 12h-2v3h-3v2h5v-5zM7 9H4V7h5v5H7V9zm14-6H3c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM3 19V5h18v14H3z"})}),e.jsx("span",{className:"label",children:"Backup & Restore"})]})}),e.jsx("li",{className:"nav-item",children:e.jsxs(he,{to:"/admin/system-logs",className:({isActive:p})=>"nav-link"+(p?" active":""),children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"})}),e.jsx("span",{className:"label",children:"System Logs"})]})}),e.jsx("li",{className:"nav-item",children:e.jsxs(he,{to:"/admin/profile",className:({isActive:p})=>"nav-link"+(p?" active":""),children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 9V7L15 1H5C3.89 1 3 1.89 3 3V21C3 22.11 3.89 23 5 23H11V21H5V19H13V17H5V15H13V13H5V11H13V9H21M15 15V17H19V19H15V21H17V23H21V21H23V17H21V15H15Z"})}),e.jsx("span",{className:"label",children:"Account"})]})}),e.jsx("li",{className:"nav-item mt-4 px-3",children:e.jsxs("button",{className:"btn btn-outline-danger w-100 d-flex align-items-center justify-content-center icon-only-btn",onClick:o,title:"Logout","aria-label":"Logout",children:[e.jsx("i",{className:"bi-box-arrow-right fs-5"}),e.jsx("span",{className:"visually-hidden",children:"Logout"})]})})]})})]}),e.jsxs("div",{className:`content-area ${i.pathname==="/admin/device-approvals"?"device-approvals-content":""}`,children:[e.jsxs("div",{className:"topbar d-flex align-items-center pe-0",children:[e.jsx("button",{className:"btn btn-dark toggle-btn me-2",onClick:()=>d(p=>!p),"aria-label":"Toggle sidebar",children:e.jsx("i",{className:"bi bi-list"})}),e.jsx("div",{className:"notifications-bell",children:e.jsx(ea,{})})]}),e.jsx("main",{className:`flex-grow-1 ${i.pathname==="/admin/device-approvals"?"device-approvals-main":""}`,children:e.jsx(gs,{})})]}),e.jsx("div",{className:`sidebar-overlay ${r?"show":""}`,onClick:()=>d(!1)}),e.jsx(Ze,{show:l,onConfirm:x,onCancel:g,title:"Confirm Logout",message:"Are you sure you want to logout? You will need to login again to access your account.",confirmText:"Logout",cancelText:"Cancel",variant:"danger"})]})}/*!
 * chartjs-plugin-datalabels v2.2.0
 * https://chartjs-plugin-datalabels.netlify.app
 * (c) 2017-2022 chartjs-plugin-datalabels contributors
 * Released under the MIT license
 */var La=function(){if(typeof window<"u"){if(window.devicePixelRatio)return window.devicePixelRatio;var s=window.screen;if(s)return(s.deviceXDPI||1)/(s.logicalXDPI||1)}return 1}(),Ms={toTextLines:function(s){var i=[],a;for(s=[].concat(s);s.length;)a=s.pop(),typeof a=="string"?i.unshift.apply(i,a.split(`
`)):Array.isArray(a)?s.push.apply(s,a):As(s)||i.unshift(""+a);return i},textSize:function(s,i,a){var n=[].concat(i),r=n.length,d=s.font,l=0,h;for(s.font=a.string,h=0;h<r;++h)l=Math.max(s.measureText(n[h]).width,l);return s.font=d,{height:r*a.lineHeight,width:l}},bound:function(s,i,a){return Math.max(s,Math.min(i,a))},arrayDiff:function(s,i){var a=s.slice(),n=[],r,d,l,h;for(r=0,l=i.length;r<l;++r)h=i[r],d=a.indexOf(h),d===-1?n.push([h,1]):a.splice(d,1);for(r=0,l=a.length;r<l;++r)n.push([a[r],-1]);return n},rasterize:function(s){return Math.round(s*La)/La}};function ra(s,i){var a=i.x,n=i.y;if(a===null)return{x:0,y:-1};if(n===null)return{x:1,y:0};var r=s.x-a,d=s.y-n,l=Math.sqrt(r*r+d*d);return{x:l?r/l:0,y:l?d/l:-1}}function ai(s,i,a,n,r){switch(r){case"center":a=n=0;break;case"bottom":a=0,n=1;break;case"right":a=1,n=0;break;case"left":a=-1,n=0;break;case"top":a=0,n=-1;break;case"start":a=-a,n=-n;break;case"end":break;default:r*=Math.PI/180,a=Math.cos(r),n=Math.sin(r);break}return{x:s,y:i,vx:a,vy:n}}var ti=0,Ja=1,Za=2,et=4,st=8;function Vs(s,i,a){var n=ti;return s<a.left?n|=Ja:s>a.right&&(n|=Za),i<a.top?n|=st:i>a.bottom&&(n|=et),n}function ii(s,i){for(var a=s.x0,n=s.y0,r=s.x1,d=s.y1,l=Vs(a,n,i),h=Vs(r,d,i),o,x,g;!(!(l|h)||l&h);)o=l||h,o&st?(x=a+(r-a)*(i.top-n)/(d-n),g=i.top):o&et?(x=a+(r-a)*(i.bottom-n)/(d-n),g=i.bottom):o&Za?(g=n+(d-n)*(i.right-a)/(r-a),x=i.right):o&Ja&&(g=n+(d-n)*(i.left-a)/(r-a),x=i.left),o===l?(a=x,n=g,l=Vs(a,n,i)):(r=x,d=g,h=Vs(r,d,i));return{x0:a,x1:r,y0:n,y1:d}}function Os(s,i){var a=i.anchor,n=s,r,d;return i.clamp&&(n=ii(n,i.area)),a==="start"?(r=n.x0,d=n.y0):a==="end"?(r=n.x1,d=n.y1):(r=(n.x0+n.x1)/2,d=(n.y0+n.y1)/2),ai(r,d,s.vx,s.vy,i.align)}var Us={arc:function(s,i){var a=(s.startAngle+s.endAngle)/2,n=Math.cos(a),r=Math.sin(a),d=s.innerRadius,l=s.outerRadius;return Os({x0:s.x+n*d,y0:s.y+r*d,x1:s.x+n*l,y1:s.y+r*l,vx:n,vy:r},i)},point:function(s,i){var a=ra(s,i.origin),n=a.x*s.options.radius,r=a.y*s.options.radius;return Os({x0:s.x-n,y0:s.y-r,x1:s.x+n,y1:s.y+r,vx:a.x,vy:a.y},i)},bar:function(s,i){var a=ra(s,i.origin),n=s.x,r=s.y,d=0,l=0;return s.horizontal?(n=Math.min(s.x,s.base),d=Math.abs(s.base-s.x)):(r=Math.min(s.y,s.base),l=Math.abs(s.base-s.y)),Os({x0:n,y0:r+l,x1:n+d,y1:r,vx:a.x,vy:a.y},i)},fallback:function(s,i){var a=ra(s,i.origin);return Os({x0:s.x,y0:s.y,x1:s.x+(s.width||0),y1:s.y+(s.height||0),vx:a.x,vy:a.y},i)}},Je=Ms.rasterize;function li(s){var i=s.borderWidth||0,a=s.padding,n=s.size.height,r=s.size.width,d=-r/2,l=-n/2;return{frame:{x:d-a.left-i,y:l-a.top-i,w:r+a.width+i*2,h:n+a.height+i*2},text:{x:d,y:l,w:r,h:n}}}function ni(s,i){var a=i.chart.getDatasetMeta(i.datasetIndex).vScale;if(!a)return null;if(a.xCenter!==void 0&&a.yCenter!==void 0)return{x:a.xCenter,y:a.yCenter};var n=a.getBasePixel();return s.horizontal?{x:n,y:null}:{x:null,y:n}}function ri(s){return s instanceof Ua?Us.arc:s instanceof Qs?Us.point:s instanceof Js?Us.bar:Us.fallback}function ci(s,i,a,n,r,d){var l=Math.PI/2;if(d){var h=Math.min(d,r/2,n/2),o=i+h,x=a+h,g=i+n-h,p=a+r-h;s.moveTo(i,x),o<g&&x<p?(s.arc(o,x,h,-Math.PI,-l),s.arc(g,x,h,-l,0),s.arc(g,p,h,0,l),s.arc(o,p,h,l,Math.PI)):o<g?(s.moveTo(o,a),s.arc(g,x,h,-l,l),s.arc(o,x,h,l,Math.PI+l)):x<p?(s.arc(o,x,h,-Math.PI,0),s.arc(o,p,h,0,Math.PI)):s.arc(o,x,h,-Math.PI,Math.PI),s.closePath(),s.moveTo(i,a)}else s.rect(i,a,n,r)}function di(s,i,a){var n=a.backgroundColor,r=a.borderColor,d=a.borderWidth;!n&&(!r||!d)||(s.beginPath(),ci(s,Je(i.x)+d/2,Je(i.y)+d/2,Je(i.w)-d,Je(i.h)-d,a.borderRadius),s.closePath(),n&&(s.fillStyle=n,s.fill()),r&&d&&(s.strokeStyle=r,s.lineWidth=d,s.lineJoin="miter",s.stroke()))}function oi(s,i,a){var n=a.lineHeight,r=s.w,d=s.x,l=s.y+n/2;return i==="center"?d+=r/2:(i==="end"||i==="right")&&(d+=r),{h:n,w:r,x:d,y:l}}function mi(s,i,a){var n=s.shadowBlur,r=a.stroked,d=Je(a.x),l=Je(a.y),h=Je(a.w);r&&s.strokeText(i,d,l,h),a.filled&&(n&&r&&(s.shadowBlur=0),s.fillText(i,d,l,h),n&&r&&(s.shadowBlur=n))}function hi(s,i,a,n){var r=n.textAlign,d=n.color,l=!!d,h=n.font,o=i.length,x=n.textStrokeColor,g=n.textStrokeWidth,p=x&&g,m;if(!(!o||!l&&!p))for(a=oi(a,r,h),s.font=h.string,s.textAlign=r,s.textBaseline="middle",s.shadowBlur=n.textShadowBlur,s.shadowColor=n.textShadowColor,l&&(s.fillStyle=d),p&&(s.lineJoin="round",s.lineWidth=g,s.strokeStyle=x),m=0,o=i.length;m<o;++m)mi(s,i[m],{stroked:p,filled:l,w:a.w,x:a.x,y:a.y+a.h*m})}var at=function(s,i,a,n){var r=this;r._config=s,r._index=n,r._model=null,r._rects=null,r._ctx=i,r._el=a};zs(at.prototype,{_modelize:function(s,i,a,n){var r=this,d=r._index,l=St(Se([a.font,{}],n,d)),h=Se([a.color,kt.color],n,d);return{align:Se([a.align,"center"],n,d),anchor:Se([a.anchor,"center"],n,d),area:n.chart.chartArea,backgroundColor:Se([a.backgroundColor,null],n,d),borderColor:Se([a.borderColor,null],n,d),borderRadius:Se([a.borderRadius,0],n,d),borderWidth:Se([a.borderWidth,0],n,d),clamp:Se([a.clamp,!1],n,d),clip:Se([a.clip,!1],n,d),color:h,display:s,font:l,lines:i,offset:Se([a.offset,4],n,d),opacity:Se([a.opacity,1],n,d),origin:ni(r._el,n),padding:Ct(Se([a.padding,4],n,d)),positioner:ri(r._el),rotation:Se([a.rotation,0],n,d)*(Math.PI/180),size:Ms.textSize(r._ctx,i,l),textAlign:Se([a.textAlign,"start"],n,d),textShadowBlur:Se([a.textShadowBlur,0],n,d),textShadowColor:Se([a.textShadowColor,h],n,d),textStrokeColor:Se([a.textStrokeColor,h],n,d),textStrokeWidth:Se([a.textStrokeWidth,0],n,d)}},update:function(s){var i=this,a=null,n=null,r=i._index,d=i._config,l,h,o,x=Se([d.display,!0],s,r);x&&(l=s.dataset.data[r],h=_t(Oa(d.formatter,[l,s]),l),o=As(h)?[]:Ms.toTextLines(h),o.length&&(a=i._modelize(x,o,d,s),n=li(a))),i._model=a,i._rects=n},geometry:function(){return this._rects?this._rects.frame:{}},rotation:function(){return this._model?this._model.rotation:0},visible:function(){return this._model&&this._model.opacity},model:function(){return this._model},draw:function(s,i){var a=this,n=s.ctx,r=a._model,d=a._rects,l;this.visible()&&(n.save(),r.clip&&(l=r.area,n.beginPath(),n.rect(l.left,l.top,l.right-l.left,l.bottom-l.top),n.clip()),n.globalAlpha=Ms.bound(0,r.opacity,1),n.translate(Je(i.x),Je(i.y)),n.rotate(r.rotation),di(n,d.frame,r),hi(n,r.lines,d.text,r),n.restore())}});var xi=Number.MIN_SAFE_INTEGER||-9007199254740991,ui=Number.MAX_SAFE_INTEGER||9007199254740991;function Ps(s,i,a){var n=Math.cos(a),r=Math.sin(a),d=i.x,l=i.y;return{x:d+n*(s.x-d)-r*(s.y-l),y:l+r*(s.x-d)+n*(s.y-l)}}function Fa(s,i){var a=ui,n=xi,r=i.origin,d,l,h,o,x;for(d=0;d<s.length;++d)l=s[d],h=l.x-r.x,o=l.y-r.y,x=i.vx*h+i.vy*o,a=Math.min(a,x),n=Math.max(n,x);return{min:a,max:n}}function qs(s,i){var a=i.x-s.x,n=i.y-s.y,r=Math.sqrt(a*a+n*n);return{vx:(i.x-s.x)/r,vy:(i.y-s.y)/r,origin:s,ln:r}}var tt=function(){this._rotation=0,this._rect={x:0,y:0,w:0,h:0}};zs(tt.prototype,{center:function(){var s=this._rect;return{x:s.x+s.w/2,y:s.y+s.h/2}},update:function(s,i,a){this._rotation=a,this._rect={x:i.x+s.x,y:i.y+s.y,w:i.w,h:i.h}},contains:function(s){var i=this,a=1,n=i._rect;return s=Ps(s,i.center(),-i._rotation),!(s.x<n.x-a||s.y<n.y-a||s.x>n.x+n.w+a*2||s.y>n.y+n.h+a*2)},intersects:function(s){var i=this._points(),a=s._points(),n=[qs(i[0],i[1]),qs(i[0],i[3])],r,d,l;for(this._rotation!==s._rotation&&n.push(qs(a[0],a[1]),qs(a[0],a[3])),r=0;r<n.length;++r)if(d=Fa(i,n[r]),l=Fa(a,n[r]),d.max<l.min||l.max<d.min)return!1;return!0},_points:function(){var s=this,i=s._rect,a=s._rotation,n=s.center();return[Ps({x:i.x,y:i.y},n,a),Ps({x:i.x+i.w,y:i.y},n,a),Ps({x:i.x+i.w,y:i.y+i.h},n,a),Ps({x:i.x,y:i.y+i.h},n,a)]}});function it(s,i,a){var n=i.positioner(s,i),r=n.vx,d=n.vy;if(!r&&!d)return{x:n.x,y:n.y};var l=a.w,h=a.h,o=i.rotation,x=Math.abs(l/2*Math.cos(o))+Math.abs(h/2*Math.sin(o)),g=Math.abs(l/2*Math.sin(o))+Math.abs(h/2*Math.cos(o)),p=1/Math.max(Math.abs(r),Math.abs(d));return x*=r*p,g*=d*p,x+=i.offset*r,g+=i.offset*d,{x:n.x+x,y:n.y+g}}function pi(s,i){var a,n,r,d;for(a=s.length-1;a>=0;--a)for(r=s[a].$layout,n=a-1;n>=0&&r._visible;--n)d=s[n].$layout,d._visible&&r._box.intersects(d._box)&&i(r,d);return s}function bi(s){var i,a,n,r,d,l,h;for(i=0,a=s.length;i<a;++i)n=s[i],r=n.$layout,r._visible&&(h=new Proxy(n._el,{get:(o,x)=>o.getProps([x],!0)[x]}),d=n.geometry(),l=it(h,n.model(),d),r._box.update(l,d,n.rotation()));return pi(s,function(o,x){var g=o._hidable,p=x._hidable;g&&p||p?x._visible=!1:g&&(o._visible=!1)})}var Ls={prepare:function(s){var i=[],a,n,r,d,l;for(a=0,r=s.length;a<r;++a)for(n=0,d=s[a].length;n<d;++n)l=s[a][n],i.push(l),l.$layout={_box:new tt,_hidable:!1,_visible:!0,_set:a,_idx:l._index};return i.sort(function(h,o){var x=h.$layout,g=o.$layout;return x._idx===g._idx?g._set-x._set:g._idx-x._idx}),this.update(i),i},update:function(s){var i=!1,a,n,r,d,l;for(a=0,n=s.length;a<n;++a)r=s[a],d=r.model(),l=r.$layout,l._hidable=d&&d.display==="auto",l._visible=r.visible(),i|=l._hidable;i&&bi(s)},lookup:function(s,i){var a,n;for(a=s.length-1;a>=0;--a)if(n=s[a].$layout,n&&n._visible&&n._box.contains(i))return s[a];return null},draw:function(s,i){var a,n,r,d,l,h;for(a=0,n=i.length;a<n;++a)r=i[a],d=r.$layout,d._visible&&(l=r.geometry(),h=it(r._el,r.model(),l),d._box.update(h,l,r.rotation()),r.draw(s,h))}},fi=function(s){if(As(s))return null;var i=s,a,n,r;if(yt(s))if(!As(s.label))i=s.label;else if(!As(s.r))i=s.r;else for(i="",a=Object.keys(s),r=0,n=a.length;r<n;++r)i+=(r!==0?", ":"")+a[r]+": "+s[a[r]];return""+i},gi={align:"center",anchor:"center",backgroundColor:null,borderColor:null,borderRadius:0,borderWidth:0,clamp:!1,clip:!1,color:void 0,display:!0,font:{family:void 0,lineHeight:1.2,size:void 0,style:void 0,weight:null},formatter:fi,labels:void 0,listeners:{},offset:4,opacity:1,padding:{top:4,right:4,bottom:4,left:4},rotation:0,textAlign:"start",textStrokeColor:void 0,textStrokeWidth:0,textShadowBlur:0,textShadowColor:void 0},Te="$datalabels",lt="$default";function ji(s,i){var a=s.datalabels,n={},r=[],d,l;return a===!1?null:(a===!0&&(a={}),i=zs({},[i,a]),d=i.labels||{},l=Object.keys(d),delete i.labels,l.length?l.forEach(function(h){d[h]&&r.push(zs({},[i,d[h],{_key:h}]))}):r.push(i),n=r.reduce(function(h,o){return wt(o.listeners||{},function(x,g){h[g]=h[g]||{},h[g][o._key||lt]=x}),delete o.listeners,h},{}),{labels:r,listeners:n})}function ha(s,i,a,n){if(i){var r=a.$context,d=a.$groups,l;i[d._set]&&(l=i[d._set][d._key],l&&Oa(l,[r,n])===!0&&(s[Te]._dirty=!0,a.update(r)))}}function vi(s,i,a,n,r){var d,l;!a&&!n||(a?n?a!==n&&(l=d=!0):l=!0:d=!0,l&&ha(s,i.leave,a,r),d&&ha(s,i.enter,n,r))}function Ni(s,i){var a=s[Te],n=a._listeners,r,d;if(!(!n.enter&&!n.leave)){if(i.type==="mousemove")d=Ls.lookup(a._labels,i);else if(i.type!=="mouseout")return;r=a._hovered,a._hovered=d,vi(s,n,r,d,i)}}function yi(s,i){var a=s[Te],n=a._listeners.click,r=n&&Ls.lookup(a._labels,i);r&&ha(s,n,r,i)}var nt={id:"datalabels",defaults:gi,beforeInit:function(s){s[Te]={_actives:[]}},beforeUpdate:function(s){var i=s[Te];i._listened=!1,i._listeners={},i._datasets=[],i._labels=[]},afterDatasetUpdate:function(s,i,a){var n=i.index,r=s[Te],d=r._datasets[n]=[],l=s.isDatasetVisible(n),h=s.data.datasets[n],o=ji(h,a),x=i.meta.data||[],g=s.ctx,p,m,y,N,R,v,S,u;for(g.save(),p=0,y=x.length;p<y;++p)if(S=x[p],S[Te]=[],l&&S&&s.getDataVisibility(p)&&!S.skip)for(m=0,N=o.labels.length;m<N;++m)R=o.labels[m],v=R._key,u=new at(R,g,S,p),u.$groups={_set:n,_key:v||lt},u.$context={active:!1,chart:s,dataIndex:p,dataset:h,datasetIndex:n},u.update(u.$context),S[Te].push(u),d.push(u);g.restore(),zs(r._listeners,o.listeners,{merger:function(j,b,C){b[j]=b[j]||{},b[j][i.index]=C[j],r._listened=!0}})},afterUpdate:function(s){s[Te]._labels=Ls.prepare(s[Te]._datasets)},afterDatasetsDraw:function(s){Ls.draw(s,s[Te]._labels)},beforeEvent:function(s,i){if(s[Te]._listened){var a=i.event;switch(a.type){case"mousemove":case"mouseout":Ni(s,a);break;case"click":yi(s,a);break}}},afterEvent:function(s){var i=s[Te],a=i._actives,n=i._actives=s.getActiveElements(),r=Ms.arrayDiff(a,n),d,l,h,o,x,g,p;for(d=0,l=r.length;d<l;++d)if(x=r[d],x[1])for(p=x[0].element[Te]||[],h=0,o=p.length;h<o;++h)g=p[h],g.$context.active=x[1]===1,g.update(g.$context);(i._dirty||r.length)&&(Ls.update(i._labels),s.render()),delete i._dirty}};pa.register(ba,fa,Qs,ga,Js,ja,va,Na,nt);const wi=()=>{var _;const s=we(),{user:i}=Ce(),[a,n]=t.useState(0),[r,d]=t.useState(0),[l,h]=t.useState(0),[o,x]=t.useState(0),[g,p]=t.useState(!1),[m,y]=t.useState(!1),[N,R]=t.useState(""),[v,S]=t.useState({by_hour:[],by_service:[],by_visit_type:[]}),u=((_=i==null?void 0:i.name)==null?void 0:_.split(" ")[0])||(i==null?void 0:i.name)||"Admin",j=t.useCallback(async()=>{p(!0);try{const H=await z.get("/api/visits/stats");n(H.data.today_visits||0),h(H.data.pending_visits||0);const T=await z.get("/api/appointments?status=pending");d(T.data.length||0);const c=await z.get("/api/appointments/remindable");x(c.data.length||0)}catch(H){console.error("Failed to load statistics",H)}finally{p(!1)}},[]),b=t.useCallback(async()=>{var H,T;y(!0),R("");try{const c=new Date().toISOString().split("T")[0],F=await z.get("/api/reports/visits-daily",{params:{date:c}});S(F.data||{by_hour:[],by_service:[],by_visit_type:[]})}catch(c){console.error(c),R(((T=(H=c==null?void 0:c.response)==null?void 0:H.data)==null?void 0:T.message)||"Failed to load daily report.")}finally{y(!1)}},[]);t.useEffect(()=>{j(),b()},[j,b]);const C=t.useMemo(()=>{const H=new Map;for(let T=0;T<24;T++)H.set(T,0);return(v.by_hour||[]).forEach(T=>{const c=Number(T.hour)||0;H.set(c,(H.get(c)||0)+(Number(T.count)||0))}),Array.from(H.entries()).map(([T,c])=>({label:String(T).padStart(2,"0"),count:c}))},[v.by_hour]),f=t.useMemo(()=>(v.by_service||[]).map(T=>{var O,X;const c=Number(T.count)||0,F=Number(T.walkin||0),P=Number(T.appointment||0);let k=F,E=P;if(F===0&&P===0&&c>0){const ee=v.by_visit_type||[],ae=((O=ee.find(W=>W.visit_type==="walkin"))==null?void 0:O.count)||0,ne=((X=ee.find(W=>W.visit_type==="appointment"))==null?void 0:X.count)||0,re=ae+ne;if(re>0){const W=Number(ae)/re,$=Number(ne)/re;k=Math.round(c*W),E=Math.round(c*$),k+E!==c&&(E=c-k)}else k=Math.round(c*.6),E=c-k}return{label:T.service_name||"(Unspecified)",count:c,walkin:k,appointment:E}}),[v.by_service,v.by_visit_type]),D={color:"#fff",font:{weight:"bold"},formatter:H=>H>0?H:""},L=t.useMemo(()=>({labels:C.map(H=>H.label),datasets:[{label:"Visits (today)",data:C.map(H=>H.count),backgroundColor:"rgba(25,135,84,0.85)",borderColor:"#198754",borderWidth:1,type:"bar"}]}),[C]),I=t.useMemo(()=>({responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,labels:{font:{size:11}}},tooltip:{enabled:!0},datalabels:{anchor:"end",align:"end",offset:2,font:{size:9},...D}},scales:{x:{title:{display:!0,text:"Hour of Day",font:{size:12}},ticks:{font:{size:11}}},y:{title:{display:!0,text:"Visits",font:{size:12}},beginAtZero:!0,ticks:{precision:0,font:{size:11}}}}}),[]),w=t.useMemo(()=>({labels:f.map(H=>H.label),datasets:[{label:"Walk-in",data:f.map(H=>H.walkin),backgroundColor:"#0d6efd",borderColor:"#0d6efd",borderWidth:1},{label:"Appointment",data:f.map(H=>H.appointment),backgroundColor:"#6c757d",borderColor:"#6c757d",borderWidth:1}]}),[f]),A=t.useMemo(()=>({responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,labels:{font:{size:11}}},tooltip:{enabled:!0},datalabels:{anchor:"end",align:"end",offset:2,font:{size:9},...D}},scales:{x:{title:{display:!0,text:"Service",font:{size:12}},ticks:{autoSkip:!1,maxRotation:60,minRotation:30,font:{size:10}}},y:{title:{display:!0,text:"Visits",font:{size:12}},beginAtZero:!0,ticks:{precision:0,font:{size:11}}}}}),[]);return e.jsxs("div",{children:[e.jsxs("h2",{className:"mb-4",children:["Welcome, ",u,"!"]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"mb-3",children:"Daily Stats"}),e.jsxs("div",{className:"row g-3 mb-4",children:[e.jsx("div",{className:"col-12 col-md-6 col-lg-3",children:e.jsx("div",{className:"card border-0 shadow-sm h-100",style:{borderRadius:"16px",cursor:"pointer"},onClick:()=>s("/admin/appointments"),children:e.jsx("div",{className:"card-body p-4",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"bg-primary rounded-circle me-3 d-flex align-items-center justify-content-center flex-shrink-0",style:{width:"50px",height:"50px",fontSize:"1.5rem"},children:e.jsx("i",{className:"bi bi-calendar-day text-white"})}),e.jsxs("div",{className:"flex-grow-1 min-width-0",children:[e.jsx("div",{className:"text-muted small fw-semibold",children:"Today's Visits"}),e.jsx("div",{className:"fs-3 fw-bold text-primary",children:g?"...":a}),e.jsx("small",{className:"text-muted",children:"Running & Finished"})]})]})})})}),e.jsx("div",{className:"col-12 col-md-6 col-lg-3",children:e.jsx("div",{className:"card border-0 shadow-sm h-100",style:{borderRadius:"16px",cursor:"pointer"},onClick:()=>s("/admin/appointments"),children:e.jsx("div",{className:"card-body p-4",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"bg-warning rounded-circle me-3 d-flex align-items-center justify-content-center flex-shrink-0",style:{width:"50px",height:"50px",fontSize:"1.5rem"},children:e.jsx("i",{className:"bi bi-clock-history text-white"})}),e.jsxs("div",{className:"flex-grow-1 min-width-0",children:[e.jsx("div",{className:"text-muted small fw-semibold",children:"Pending Appointments"}),e.jsx("div",{className:"fs-3 fw-bold text-warning",children:g?"...":r}),e.jsx("small",{className:"text-muted",children:"Needs approval"})]})]})})})}),e.jsx("div",{className:"col-12 col-md-6 col-lg-3",children:e.jsx("div",{className:"card border-0 shadow-sm h-100",style:{borderRadius:"16px",cursor:"pointer"},onClick:()=>s("/admin/appointments"),children:e.jsx("div",{className:"card-body p-4",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"bg-info rounded-circle me-3 d-flex align-items-center justify-content-center flex-shrink-0",style:{width:"50px",height:"50px",fontSize:"1.5rem"},children:e.jsx("i",{className:"bi bi-hourglass-split text-white"})}),e.jsxs("div",{className:"flex-grow-1 min-width-0",children:[e.jsx("div",{className:"text-muted small fw-semibold",children:"Pending Visits"}),e.jsx("div",{className:"fs-3 fw-bold text-info",children:g?"...":l}),e.jsx("small",{className:"text-muted",children:"Awaiting completion"})]})]})})})}),e.jsx("div",{className:"col-12 col-md-6 col-lg-3",children:e.jsx("div",{className:"card border-0 shadow-sm h-100",style:{borderRadius:"16px",cursor:"pointer"},onClick:()=>s("/admin/appointments"),children:e.jsx("div",{className:"card-body p-4",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"bg-success rounded-circle me-3 d-flex align-items-center justify-content-center flex-shrink-0",style:{width:"50px",height:"50px",fontSize:"1.5rem"},children:e.jsx("i",{className:"bi bi-bell text-white"})}),e.jsxs("div",{className:"flex-grow-1 min-width-0",children:[e.jsx("div",{className:"text-muted small fw-semibold",children:"Appointment Reminders"}),e.jsx("div",{className:"fs-3 fw-bold text-success",children:g?"...":o}),e.jsx("small",{className:"text-muted",children:"Needs to be sent"})]})]})})})})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"mb-3",children:"Today's Report"}),N&&e.jsxs("div",{className:"alert alert-danger border-0 shadow-sm mb-4",style:{borderRadius:"12px"},role:"alert",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),N]}),m?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"400px"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"spinner-border text-primary mb-3",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"text-muted",children:"Loading today's report..."})]})}):e.jsxs("div",{className:"row g-4",children:[e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card border-0 shadow-sm",style:{borderRadius:"16px"},children:[e.jsx("div",{className:"card-header bg-primary text-white border-0",style:{borderRadius:"16px 16px 0 0"},children:e.jsxs("h5",{className:"mb-0 fw-semibold",children:[e.jsx("i",{className:"bi bi-clock me-2"}),"Visits by Hour"]})}),e.jsx("div",{className:"card-body p-4",children:e.jsx("div",{style:{height:"350px",position:"relative",width:"100%"},children:e.jsx(Fs,{data:L,options:I})})})]})}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card border-0 shadow-sm",style:{borderRadius:"16px"},children:[e.jsx("div",{className:"card-header bg-success text-white border-0",style:{borderRadius:"16px 16px 0 0"},children:e.jsxs("h5",{className:"mb-0 fw-semibold",children:[e.jsx("i",{className:"bi bi-bar-chart me-2"}),"Visits by Service & Type"]})}),e.jsx("div",{className:"card-body p-4",children:e.jsx("div",{style:{height:"350px",position:"relative",width:"100%"},children:e.jsx(Fs,{data:w,options:A})})})]})})]})]})]})},_i=()=>{const[s,i]=t.useState([]),[a,n]=t.useState(!0),[r,d]=t.useState({}),l=async()=>{try{const x=await z.get("/api/admin/pending-devices");console.log("Pending devices:",x.data),i(x.data)}catch(x){console.error("Failed to load pending devices:",x)}finally{n(!1)}};t.useEffect(()=>{l()},[]);const h=async x=>{try{await z.post("/api/admin/approve-device",{device_id:x,device_name:r[x]||""}),l()}catch(g){console.error("Failed to approve:",g)}},o=async x=>{try{await z.post("/api/admin/reject-device",{device_id:x}),l()}catch(g){console.error("Failed to reject:",g)}};return e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex flex-column flex-lg-row justify-content-between align-items-start align-items-lg-center mb-4 gap-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"m-0 fw-bold",style:{color:"#1e293b"},children:"ðŸ“± Pending Device Approvals"}),e.jsx("p",{className:"text-muted mb-0 mt-1",children:"Review and approve staff device registrations"})]}),e.jsx("div",{className:"d-flex align-items-center",children:e.jsxs("span",{className:"badge bg-warning fs-6",children:[s.length," pending approval",s.length!==1?"s":""]})})]}),e.jsx("div",{className:"card border-0 shadow-sm",style:{borderRadius:"16px"},children:e.jsx("div",{className:"card-body p-0",children:a?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"400px"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"spinner-border text-primary mb-3",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"text-muted",children:"Loading pending devices..."})]})}):s.length===0?e.jsx("div",{className:"text-center text-muted",style:{height:"400px"},children:e.jsxs("div",{className:"d-flex flex-column align-items-center justify-content-center py-5",children:[e.jsx("div",{className:"bg-light rounded-circle mb-4 d-flex align-items-center justify-content-center",style:{width:"120px",height:"120px",fontSize:"3rem"},children:"ðŸ“±"}),e.jsx("h4",{className:"text-muted mb-3",children:"No devices pending approval"}),e.jsx("p",{className:"text-muted mb-4 fs-5",children:"All staff devices have been reviewed and approved."})]})}):e.jsx("div",{className:"table-responsive",style:{width:"100%"},children:e.jsxs("table",{className:"table table-hover mb-0",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 border-0 fw-semibold",style:{fontSize:"0.9rem",color:"#64748b"},children:"Staff Member"}),e.jsx("th",{className:"px-4 py-3 border-0 fw-semibold",style:{fontSize:"0.9rem",color:"#64748b"},children:"Device Info"}),e.jsx("th",{className:"px-4 py-3 border-0 fw-semibold",style:{fontSize:"0.9rem",color:"#64748b"},children:"Request Date"}),e.jsx("th",{className:"px-4 py-3 border-0 fw-semibold",style:{fontSize:"0.9rem",color:"#64748b"},children:"Device Name"}),e.jsx("th",{className:"px-4 py-3 border-0 fw-semibold text-center",style:{fontSize:"0.9rem",color:"#64748b"},children:"Actions"})]})}),e.jsx("tbody",{children:s.map(x=>{var g;return e.jsxs("tr",{className:"border-bottom",children:[e.jsx("td",{className:"px-4 py-3 border-0",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"bg-primary rounded-circle d-flex align-items-center justify-content-center me-3",style:{width:"40px",height:"40px",fontSize:"1.2rem"},children:e.jsx("i",{className:"bi bi-person text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-semibold",style:{fontSize:"1rem",color:"#1e293b"},children:x.staff_name}),e.jsx("div",{className:"text-muted small",children:x.staff_role})]})]})}),e.jsx("td",{className:"px-4 py-3 border-0",children:e.jsxs("div",{children:[e.jsx("div",{className:"fw-medium",style:{fontSize:"0.9rem",color:"#374151"},children:x.device_type||"Unknown Device"}),e.jsxs("div",{className:"text-muted small font-monospace",children:[(g=x.device_fingerprint)==null?void 0:g.substring(0,20),"..."]})]})}),e.jsx("td",{className:"px-4 py-3 border-0",style:{fontSize:"0.9rem",color:"#6b7280"},children:new Date(x.created_at).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 border-0",style:{fontSize:"1rem"},children:e.jsx("input",{type:"text",className:"form-control border-0 shadow-sm",style:{borderRadius:"8px",padding:"8px 12px",fontSize:"0.9rem"},placeholder:"e.g. Front Desk PC",value:r[x.id]||"",onChange:p=>d(m=>({...m,[x.id]:p.target.value}))})}),e.jsx("td",{className:"px-4 py-3 border-0 text-center",style:{fontSize:"1rem"},children:e.jsxs("div",{className:"btn-group",role:"group",children:[e.jsx("button",{className:"btn btn-sm btn-success me-1",onClick:()=>h(x.id),style:{borderRadius:"8px"},title:"Approve device",children:e.jsx("i",{className:"bi bi-check-circle"})}),e.jsx("button",{className:"btn btn-sm btn-danger",onClick:()=>o(x.id),style:{borderRadius:"8px"},title:"Reject device",children:e.jsx("i",{className:"bi bi-x-circle"})})]})})]},x.id)})})]})})})})]})},Si=()=>{const[s,i]=t.useState([]),[a,n]=t.useState(!0),[r,d]=t.useState(null),[l,h]=t.useState(""),o=async()=>{try{const p=await z.get("/api/approved-devices");i(p.data)}catch(p){console.error("Failed to load approved devices:",p)}finally{n(!1)}},x=async p=>{try{await z.put("/api/rename-device",{device_id:p,device_name:l}),d(null),h(""),o()}catch(m){console.error("Rename failed:",m)}},g=async p=>{try{await z.post("/api/revoke-device",{device_id:p}),o()}catch(m){console.error("Revoke failed:",m)}};return t.useEffect(()=>{o()},[]),e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex flex-column flex-lg-row justify-content-between align-items-start align-items-lg-center mb-4 gap-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"m-0 fw-bold",style:{color:"#1e293b"},children:"âœ… Approved Staff Devices"}),e.jsx("p",{className:"text-muted mb-0 mt-1",children:"Manage and monitor approved staff devices"})]}),e.jsx("div",{className:"d-flex align-items-center",children:e.jsxs("span",{className:"badge bg-success fs-6",children:[s.length," approved device",s.length!==1?"s":""]})})]}),e.jsx("div",{className:"card border-0 shadow-sm",style:{borderRadius:"16px"},children:e.jsx("div",{className:"card-body p-0",children:a?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"400px"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"spinner-border text-success mb-3",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"text-muted",children:"Loading approved devices..."})]})}):s.length===0?e.jsx("div",{className:"text-center text-muted",style:{height:"400px"},children:e.jsxs("div",{className:"d-flex flex-column align-items-center justify-content-center py-5",children:[e.jsx("div",{className:"bg-light rounded-circle mb-4 d-flex align-items-center justify-content-center",style:{width:"120px",height:"120px",fontSize:"3rem"},children:"âœ…"}),e.jsx("h4",{className:"text-muted mb-3",children:"No approved devices"}),e.jsx("p",{className:"text-muted mb-4 fs-5",children:"No devices have been approved yet."})]})}):e.jsx("div",{className:"table-responsive",style:{width:"100%"},children:e.jsxs("table",{className:"table table-hover mb-0",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 border-0 fw-semibold",style:{fontSize:"0.9rem",color:"#64748b"},children:"Staff Member"}),e.jsx("th",{className:"px-4 py-3 border-0 fw-semibold",style:{fontSize:"0.9rem",color:"#64748b"},children:"Device Name"}),e.jsx("th",{className:"px-4 py-3 border-0 fw-semibold",style:{fontSize:"0.9rem",color:"#64748b"},children:"Device Fingerprint"}),e.jsx("th",{className:"px-4 py-3 border-0 fw-semibold",style:{fontSize:"0.9rem",color:"#64748b"},children:"Last Updated"}),e.jsx("th",{className:"px-4 py-3 border-0 fw-semibold text-center",style:{fontSize:"0.9rem",color:"#64748b"},children:"Actions"})]})}),e.jsx("tbody",{children:s.map(p=>{var m;return e.jsxs("tr",{className:"border-bottom",children:[e.jsx("td",{className:"px-4 py-3 border-0",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"bg-success rounded-circle d-flex align-items-center justify-content-center me-3",style:{width:"40px",height:"40px",fontSize:"1.2rem"},children:e.jsx("i",{className:"bi bi-person text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-semibold",style:{fontSize:"1rem",color:"#1e293b"},children:p.staff_name}),e.jsx("div",{className:"text-muted small",children:p.staff_role||"Staff"})]})]})}),e.jsx("td",{className:"px-4 py-3 border-0",children:r===p.id?e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("input",{type:"text",className:"form-control form-control-sm",value:l,onChange:y=>h(y.target.value),placeholder:"New device name",style:{maxWidth:"200px"}}),e.jsx("button",{className:"btn btn-success btn-sm",onClick:()=>x(p.id),children:e.jsx("i",{className:"bi bi-check"})}),e.jsx("button",{className:"btn btn-secondary btn-sm",onClick:()=>d(null),children:e.jsx("i",{className:"bi bi-x"})})]}):e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("span",{className:"fw-medium",style:{fontSize:"1rem",color:"#374151"},children:p.device_name||"(Unnamed)"}),e.jsx("button",{className:"btn btn-link btn-sm p-0",onClick:()=>{d(p.id),h(p.device_name||"")},title:"Edit device name",children:e.jsx("i",{className:"bi bi-pencil text-primary"})})]})}),e.jsx("td",{className:"px-4 py-3 border-0",children:e.jsxs("div",{className:"font-monospace small text-muted",children:[(m=p.device_fingerprint)==null?void 0:m.substring(0,30),"..."]})}),e.jsx("td",{className:"px-4 py-3 border-0",style:{fontSize:"0.9rem",color:"#6b7280"},children:new Date(p.updated_at).toLocaleString()}),e.jsx("td",{className:"px-4 py-3 border-0 text-center",children:e.jsxs("button",{className:"btn btn-danger btn-sm",onClick:()=>g(p.id),title:"Revoke device access",children:[e.jsx("i",{className:"bi bi-x-circle me-1"}),"Revoke"]})})]},p.id)})})]})})})})]})};function ki(){const[s,i]=t.useState("approvals"),a=({id:n,icon:r,label:d})=>e.jsxs("button",{className:`btn flex-fill flex-sm-grow-0 border-0 shadow-sm ${s===n?"":"btn-outline-primary"}`,onClick:()=>i(n),type:"button",style:{background:s===n?"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)":"transparent",color:s===n?"#1e293b":"#6b7280",border:s===n?"1px solid #e2e8f0":"1px solid #d1d5db",borderRadius:"8px",padding:"12px 16px",fontWeight:"600",transition:"all 0.3s ease",minWidth:"140px"},children:[e.jsx("i",{className:`bi bi-${r==="ðŸ“±"?"phone":"check-circle"} me-2`}),e.jsx("span",{className:"d-none d-sm-inline",children:d}),e.jsx("span",{className:"d-sm-none",children:d.split(" ")[0]})]});return e.jsx("div",{className:"admin-device-manager-page",style:{background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",minHeight:"100vh",width:"100%",maxWidth:"100%",padding:"1.5rem",boxSizing:"border-box",overflow:"hidden"},children:e.jsx("div",{className:"row g-2 g-md-3 g-lg-4 m-0",children:e.jsx("div",{className:"col-12 p-0",children:e.jsxs("div",{className:"card border-0 shadow-sm",style:{background:"linear-gradient(135deg, #ffffff 0%, #f8fafc 100%)",borderRadius:"16px",width:"100%",maxWidth:"100%"},children:[e.jsxs("div",{className:"card-header border-0",style:{borderRadius:"16px 16px 0 0",background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",color:"#1e293b"},children:[e.jsxs("h2",{className:"card-title mb-0 fw-bold",style:{color:"#1e293b"},children:[e.jsx("i",{className:"bi bi-phone me-2"}),"Admin Device Management"]}),e.jsx("p",{className:"mb-0 mt-2",style:{color:"#6b7280"},children:"Comprehensive device approval and management system"})]}),e.jsxs("div",{className:"card-body p-4",style:{width:"100%",maxWidth:"100%"},children:[e.jsxs("div",{className:"d-flex flex-column flex-sm-row gap-2 mb-4",role:"group","aria-label":"Device tabs",children:[e.jsx(a,{id:"approvals",icon:"ðŸ“±",label:"Device Approvals"}),e.jsx(a,{id:"approved",icon:"âœ…",label:"Approved Devices"})]}),e.jsxs("div",{className:"tab-content",style:{width:"100%",maxWidth:"100%"},children:[s==="approvals"&&e.jsx("div",{className:"tab-pane fade show active",style:{width:"100%",maxWidth:"100%"},children:e.jsx(_i,{})}),s==="approved"&&e.jsx("div",{className:"tab-pane fade show active",style:{width:"100%",maxWidth:"100%"},children:e.jsx(Si,{})})]})]})]})})})})}const Ci=()=>{const[s,i]=t.useState("create"),[a,n]=t.useState([]),[r,d]=t.useState(!1),[l,h]=t.useState(""),[o,x]=t.useState(1),[g,p]=t.useState(1),[m,y]=t.useState({}),[N,R]=t.useState(null),[v,S]=t.useState({name:"",email:"",password:"",password_confirmation:""}),[u,j]=t.useState({}),b=async(A=1,_="")=>{d(!0);try{const H=await z.get("/api/admin/staff",{params:{page:A,search:_||void 0}});n(H.data.data),y({current_page:H.data.current_page,last_page:H.data.last_page,per_page:H.data.per_page,total:H.data.total}),p(H.data.last_page)}catch(H){console.error("Failed to fetch staff accounts:",H)}finally{d(!1)}};t.useEffect(()=>{if(s==="manage"){if(N&&clearTimeout(N),l&&l.length>=2){const A=setTimeout(()=>{b(o,l)},300);R(A)}else l.length===0&&b(o,l);return()=>{N&&clearTimeout(N)}}},[s,o,l]);const C=A=>{S({...v,[A.target.name]:A.target.value})},f=async A=>{var _,H;A.preventDefault(),j({});try{const T=await z.post("/api/admin/staff",v);K.success("Staff account created successfully!",{duration:4e3,position:"top-center",style:{background:"#28a745",color:"#ffffff",borderRadius:"8px",padding:"14px 20px",fontSize:"15px",fontWeight:"500"},iconTheme:{primary:"#ffffff",secondary:"#28a745"}}),S({name:"",email:"",password:"",password_confirmation:""}),s==="manage"&&b(o,l)}catch(T){if((H=(_=T.response)==null?void 0:_.data)!=null&&H.errors){j(T.response.data.errors);const c=Object.values(T.response.data.errors)[0];c&&c[0]&&K.error(c[0],{duration:4e3,position:"top-center",style:{background:"#dc3545",color:"#ffffff",borderRadius:"8px",padding:"14px 20px",fontSize:"15px",fontWeight:"500"},iconTheme:{primary:"#ffffff",secondary:"#dc3545"}})}else K.error("Something went wrong. Please try again.",{duration:4e3,position:"top-center",style:{background:"#dc3545",color:"#ffffff",borderRadius:"8px",padding:"14px 20px",fontSize:"15px",fontWeight:"500"},iconTheme:{primary:"#ffffff",secondary:"#dc3545"}})}},D=async(A,_)=>{if(confirm(`Are you sure you want to ${_==="activated"?"deactivate":"activate"} this staff account?`))try{await z.post(`/api/admin/staff/${A}/toggle-status`),K.success(`Staff account ${_==="activated"?"deactivated":"activated"} successfully!`,{duration:4e3,position:"top-center",style:{background:"#28a745",color:"#ffffff",borderRadius:"8px",padding:"14px 20px",fontSize:"15px",fontWeight:"500"},iconTheme:{primary:"#ffffff",secondary:"#28a745"}}),b(o,l)}catch{K.error("Failed to update staff account status. Please try again.",{duration:4e3,position:"top-center",style:{background:"#dc3545",color:"#ffffff",borderRadius:"8px",padding:"14px 20px",fontSize:"15px",fontWeight:"500"},iconTheme:{primary:"#ffffff",secondary:"#dc3545"}})}},L=A=>{h(A.target.value),x(1)},I=A=>{x(A)},w=()=>{if(g<=1)return null;const A=[];for(let _=1;_<=g;_++)A.push(e.jsx("button",{className:`btn btn-sm ${_===o?"btn-primary":"btn-outline-primary"}`,onClick:()=>I(_),children:_},_));return e.jsx("div",{className:"d-flex justify-content-center gap-2 mt-3",children:A})};return e.jsxs("div",{className:"manage-staff-page",children:[e.jsx("div",{className:"d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4 gap-3",children:e.jsxs("div",{children:[e.jsxs("h2",{className:"m-0 fw-bold",style:{color:"#1e293b"},children:[e.jsx("i",{className:"bi bi-people me-2"}),"Manage Staff Accounts"]}),e.jsx("p",{className:"text-muted mb-0 mt-1",children:"Create new staff accounts and manage existing ones"})]})}),e.jsx("div",{className:"card border-0 shadow-sm mb-4",style:{borderRadius:"16px"},children:e.jsx("div",{className:"card-body p-0",children:e.jsxs("ul",{className:"nav nav-tabs border-0",id:"staffTabs",role:"tablist",children:[e.jsx("li",{className:"nav-item",role:"presentation",children:e.jsxs("button",{className:`nav-link ${s==="create"?"active":""}`,onClick:()=>i("create"),style:{border:"none",borderRadius:"16px 16px 0 0",fontWeight:"600",padding:"1rem 1.5rem",color:s==="create"?"#3b82f6":"#6b7280",backgroundColor:s==="create"?"white":"transparent"},children:[e.jsx("i",{className:"bi bi-person-plus me-2"}),"Create Staff Account"]})}),e.jsx("li",{className:"nav-item",role:"presentation",children:e.jsxs("button",{className:`nav-link ${s==="manage"?"active":""}`,onClick:()=>i("manage"),style:{border:"none",borderRadius:"16px 16px 0 0",fontWeight:"600",padding:"1rem 1.5rem",color:s==="manage"?"#3b82f6":"#6b7280",backgroundColor:s==="manage"?"white":"transparent"},children:[e.jsx("i",{className:"bi bi-gear me-2"}),"Manage Staff Accounts"]})})]})})}),e.jsxs("div",{className:"tab-content",children:[s==="create"&&e.jsx("div",{className:"row g-2 g-md-3 g-lg-4",children:e.jsx("div",{className:"col-12 col-lg-8 col-xl-6",children:e.jsx("div",{className:"card border-0 shadow-sm",style:{background:"linear-gradient(135deg, #ffffff 0%, #f8fafc 100%)",borderRadius:"16px"},children:e.jsxs("div",{className:"card-body p-4",children:[e.jsxs("h5",{className:"card-title mb-4 fw-bold",style:{color:"#1e293b"},children:[e.jsx("i",{className:"bi bi-person-plus me-2"}),"Staff Account Details"]}),e.jsx("form",{onSubmit:f,children:e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-12",children:[e.jsx("label",{className:"form-label fw-medium",children:"Full Name"}),e.jsx("input",{name:"name",className:"form-control border-0 shadow-sm",style:{borderRadius:"8px",padding:"12px 16px"},value:v.name,onChange:C,placeholder:"e.g. Jane Dela Cruz",required:!0}),u.name&&e.jsx("div",{className:"text-danger mt-1 small",children:u.name[0]})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("label",{className:"form-label fw-medium",children:"Email Address"}),e.jsx("input",{name:"email",type:"email",className:"form-control border-0 shadow-sm",style:{borderRadius:"8px",padding:"12px 16px"},value:v.email,onChange:C,placeholder:"e.g. jane.staff@clinic.com",required:!0}),u.email&&e.jsx("div",{className:"text-danger mt-1 small",children:u.email[0]})]}),e.jsxs("div",{className:"col-12 col-md-6",children:[e.jsx("label",{className:"form-label fw-medium",children:"Password"}),e.jsx("input",{name:"password",type:"password",className:"form-control border-0 shadow-sm",style:{borderRadius:"8px",padding:"12px 16px"},value:v.password,onChange:C,placeholder:"Enter password",required:!0}),u.password&&e.jsx("div",{className:"text-danger mt-1 small",children:u.password[0]})]}),e.jsxs("div",{className:"col-12 col-md-6",children:[e.jsx("label",{className:"form-label fw-medium",children:"Confirm Password"}),e.jsx("input",{name:"password_confirmation",type:"password",className:"form-control border-0 shadow-sm",style:{borderRadius:"8px",padding:"12px 16px"},value:v.password_confirmation,onChange:C,placeholder:"Re-enter password",required:!0})]}),e.jsx("div",{className:"col-12",children:e.jsxs("button",{className:"btn w-100 border-0 shadow-sm",type:"submit",style:{background:"linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)",color:"white",borderRadius:"8px",padding:"12px 24px",fontWeight:"600",transition:"all 0.3s ease"},children:[e.jsx("i",{className:"bi bi-person-plus me-2"}),"Register Staff Member"]})})]})})]})})})}),s==="manage"&&e.jsx("div",{className:"card border-0 shadow-sm",style:{background:"linear-gradient(135deg, #ffffff 0%, #f8fafc 100%)",borderRadius:"16px"},children:e.jsxs("div",{className:"card-body p-4",children:[e.jsxs("div",{className:"d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4 gap-3",children:[e.jsxs("h5",{className:"card-title mb-0 fw-bold",style:{color:"#1e293b"},children:[e.jsx("i",{className:"bi bi-gear me-2"}),"Staff Accounts (",m.total||0,")"]}),e.jsx("div",{className:"d-flex gap-2 w-100",style:{maxWidth:"100%"},children:e.jsxs("div",{className:"input-group flex-grow-1",style:{minWidth:"200px",maxWidth:"100%"},children:[e.jsx("span",{className:"input-group-text border-0 bg-light",children:e.jsx("i",{className:"bi bi-search"})}),e.jsx("input",{type:"text",className:"form-control border-0 bg-light",placeholder:"Search by name or email... (min 2 characters)",value:l,onChange:L,style:{borderRadius:"8px"}}),l.length>0&&l.length<2&&e.jsxs("div",{className:"form-text text-warning mt-1",children:[e.jsx("i",{className:"bi bi-info-circle me-1"}),"Please enter at least 2 characters to search"]})]})})]}),r?e.jsxs("div",{className:"text-center py-5",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"mt-2 text-muted",children:"Loading staff accounts..."})]}):a.length===0?e.jsxs("div",{className:"text-center py-5",children:[e.jsx("i",{className:"bi bi-people text-muted",style:{fontSize:"3rem"}}),e.jsx("p",{className:"text-muted mt-3",children:"No staff accounts found"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Created"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:a.map(A=>e.jsxs("tr",{children:[e.jsx("td",{className:"fw-medium",children:A.name}),e.jsx("td",{children:A.email}),e.jsx("td",{children:e.jsx("span",{className:`badge ${A.status==="activated"?"bg-success":"bg-danger"}`,children:A.status})}),e.jsx("td",{children:new Date(A.created_at).toLocaleDateString()}),e.jsx("td",{children:e.jsxs("button",{className:`btn btn-sm ${A.status==="activated"?"btn-outline-danger":"btn-outline-success"}`,onClick:()=>D(A.id,A.status),title:A.status==="activated"?"Deactivate Account":"Activate Account",children:[e.jsx("i",{className:`bi ${A.status==="activated"?"bi-person-x":"bi-person-check"}`}),A.status==="activated"?"Deactivate":"Activate"]})})]},A.id))})]})}),w()]})]})})]})]})},Ri=()=>{const[s,i]=t.useState(null),[a,n]=t.useState(""),[r,d]=t.useState(""),[l,h]=t.useState(!1);we(),t.useEffect(()=>{(async()=>{try{const g=await z.get("/api/user");i(g.data)}catch(g){console.error("Failed to fetch user info",g)}})()},[]);const o=async()=>{var x,g;n(""),d(""),h(!0);try{const p=await z.post("/api/send-password-reset");n(p.data.message||"Password reset link sent to your email!")}catch(p){const m=((g=(x=p.response)==null?void 0:x.data)==null?void 0:g.message)||"Failed to send reset link";d(m)}finally{h(!1)}};return s?e.jsx("div",{className:"admin-profile-page",style:{background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",minHeight:"100vh",width:"100vw",position:"relative",left:0,right:0,padding:"1.5rem 2rem",boxSizing:"border-box"},children:e.jsx("div",{className:"container-fluid",children:e.jsx("div",{className:"row justify-content-center",children:e.jsxs("div",{className:"col-12 col-md-8 col-lg-6 col-xl-5",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("h2",{className:"fw-bold mb-2",style:{color:"#1e293b"},children:"ðŸ‘¤ Admin Account"}),e.jsx("p",{className:"text-muted",children:"Manage your account settings and security"})]}),e.jsxs("div",{className:"card border-0 shadow-sm mb-4",style:{borderRadius:"16px"},children:[e.jsx("div",{className:"card-header border-0",style:{borderRadius:"16px 16px 0 0",background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",color:"#1e293b"},children:e.jsxs("h5",{className:"mb-0 fw-semibold",children:[e.jsx("i",{className:"bi bi-person-circle me-2"}),"Profile Information"]})}),e.jsx("div",{className:"card-body p-4",children:e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"d-flex align-items-center p-3 bg-light rounded",style:{borderRadius:"12px"},children:[e.jsx("div",{className:"rounded-circle me-3 d-flex align-items-center justify-content-center",style:{width:"50px",height:"50px",fontSize:"1.5rem",background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",border:"2px solid #e2e8f0"},children:e.jsx("i",{className:"bi bi-person",style:{color:"#1e293b"}})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted small fw-semibold",children:"Full Name"}),e.jsx("div",{className:"fw-bold text-dark",children:s.name})]})]})}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"d-flex align-items-center p-3 bg-light rounded",style:{borderRadius:"12px"},children:[e.jsx("div",{className:"bg-info rounded-circle me-3 d-flex align-items-center justify-content-center",style:{width:"50px",height:"50px",fontSize:"1.5rem"},children:e.jsx("i",{className:"bi bi-envelope text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted small fw-semibold",children:"Email Address"}),e.jsx("div",{className:"fw-bold text-dark",children:s.email})]})]})}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"d-flex align-items-center p-3 bg-light rounded",style:{borderRadius:"12px"},children:[e.jsx("div",{className:"bg-success rounded-circle me-3 d-flex align-items-center justify-content-center",style:{width:"50px",height:"50px",fontSize:"1.5rem"},children:e.jsx("i",{className:"bi bi-shield-check text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted small fw-semibold",children:"Role"}),e.jsx("div",{className:"fw-bold text-dark",children:e.jsx("span",{className:"badge bg-success",children:s.role})})]})]})})]})})]}),a&&e.jsxs("div",{className:"alert alert-success border-0 shadow-sm mb-4",style:{borderRadius:"12px"},role:"alert",children:[e.jsx("i",{className:"bi bi-check-circle me-2"}),a]}),r&&e.jsxs("div",{className:"alert alert-danger border-0 shadow-sm mb-4",style:{borderRadius:"12px"},role:"alert",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),r]}),e.jsxs("div",{className:"card border-0 shadow-sm",style:{borderRadius:"16px"},children:[e.jsx("div",{className:"card-header bg-warning text-dark border-0",style:{borderRadius:"16px 16px 0 0"},children:e.jsxs("h5",{className:"mb-0 fw-semibold",children:[e.jsx("i",{className:"bi bi-key me-2"}),"Security Settings"]})}),e.jsxs("div",{className:"card-body p-4",children:[e.jsx("p",{className:"text-muted mb-4",children:"Need to change your password? We'll send you a secure reset link to your email address."}),e.jsx("button",{className:"btn border-0 shadow-sm w-100",onClick:o,disabled:l,style:{background:"linear-gradient(135deg, #0d6efd 0%, #0b5ed7 100%)",color:"white",borderRadius:"12px",padding:"12px 24px",fontWeight:"600",transition:"all 0.3s ease"},children:l?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-envelope me-2"}),"Send Password Reset Link"]})})]})]})]})})})}):e.jsx("p",{children:"Loading..."})};function Pi({show:s,onClose:i,onCategoryAdded:a}){const[n,r]=t.useState({name:"",description:""}),[d,l]=t.useState(!1),[h,o]=t.useState({}),x=m=>{const{name:y,value:N}=m.target;r(R=>({...R,[y]:N})),h[y]&&o(R=>({...R,[y]:null}))},g=async m=>{var y,N;m.preventDefault(),l(!0),o({});try{const R=await z.post("/api/service-categories",n);a&&a(R.data),r({name:"",description:""}),i()}catch(R){(N=(y=R.response)==null?void 0:y.data)!=null&&N.errors?o(R.response.data.errors):(console.error("Failed to create category:",R),o({general:"Failed to create category. Please try again."}))}finally{l(!1)}},p=()=>{r({name:"",description:""}),o({}),i()};return s?e.jsx("div",{className:"modal fade show",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:1050,overflowY:"auto",display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem"},tabIndex:"-1",children:e.jsx("div",{className:"modal-dialog",style:{margin:"0 auto",maxHeight:"calc(100vh - 2rem)",width:"100%"},children:e.jsxs("div",{className:"modal-content",style:{display:"flex",flexDirection:"column",maxHeight:"calc(100vh - 2rem)",overflow:"hidden"},children:[e.jsxs("div",{className:"modal-header flex-shrink-0",style:{position:"sticky",top:0,zIndex:1,backgroundColor:"#fff",borderBottom:"1px solid #dee2e6"},children:[e.jsx("h5",{className:"modal-title",children:"Add New Service Category"}),e.jsx("button",{type:"button",className:"btn-close",onClick:p,disabled:d})]}),e.jsxs("form",{onSubmit:g,style:{display:"flex",flexDirection:"column",flex:"1 1 auto",minHeight:0,overflow:"hidden"},children:[e.jsxs("div",{className:"modal-body flex-grow-1",style:{overflowY:"auto",overflowX:"hidden",flex:"1 1 auto",minHeight:0},children:[h.general&&e.jsx("div",{className:"alert alert-danger",role:"alert",children:h.general}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{htmlFor:"name",className:"form-label",children:["Category Name ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"text",className:`form-control ${h.name?"is-invalid":""}`,id:"name",name:"name",value:n.name,onChange:x,placeholder:"Enter category name",required:!0}),h.name&&e.jsx("div",{className:"invalid-feedback",children:h.name[0]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"description",className:"form-label",children:"Description"}),e.jsx("textarea",{className:`form-control ${h.description?"is-invalid":""}`,id:"description",name:"description",value:n.description,onChange:x,placeholder:"Enter category description (optional)",rows:"3"}),h.description&&e.jsx("div",{className:"invalid-feedback",children:h.description[0]})]})]}),e.jsxs("div",{className:"modal-footer flex-shrink-0",style:{position:"sticky",bottom:0,zIndex:1,backgroundColor:"#fff",borderTop:"1px solid #dee2e6"},children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:p,disabled:d,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:d,children:d?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Adding..."]}):"Add Category"})]})]})]})})}):null}function Di(){var re;const[s,i]=t.useState([]),[a,n]=t.useState([]),[r,d]=t.useState(!0),[l,h]=t.useState(!1),[o,x]=t.useState(!1),[g,p]=t.useState(!1),[m,y]=t.useState(null),[N,R]=t.useState(""),[v,S]=t.useState({name:"",description:"",price:"",service_category_id:"",is_excluded_from_analytics:!1,estimated_minutes:"",is_special:!1,per_teeth_service:!1,per_tooth_minutes:"",special_start_date:"",special_end_date:"",bundled_service_ids:[],is_follow_up:!1,follow_up_parent_service_id:"",follow_up_max_gap_weeks:""}),[u,j]=t.useState(!1),[b,C]=t.useState(null),[f,D]=t.useState({});t.useRef(null);const[L,I]=t.useState(!1),[w,A]=t.useState(null);t.useEffect(()=>{_(),H()},[]);const _=async()=>{try{const W=await z.get("/api/services");i(W.data)}catch(W){console.error("Failed to fetch services",W)}finally{d(!1)}},H=async()=>{try{const W=await z.get("/api/service-categories");n(W.data)}catch(W){console.error("Failed to fetch categories",W)}},T=W=>{n($=>[...$,W]),S($=>({...$,service_category_id:W.id.toString()}))},c=N?s.filter(W=>{var $,q,J;return((q=($=W.category)==null?void 0:$.id)==null?void 0:q.toString())===N||((J=W.service_category_id)==null?void 0:J.toString())===N}):s,F=W=>{R(W.target.value)},P=()=>{R("")},k=W=>{const{name:$,type:q,checked:J,value:ie}=W.target;S($==="is_special"&&J?{...v,[$]:J,per_teeth_service:!1}:$==="is_follow_up"?B=>({...B,is_follow_up:J,follow_up_parent_service_id:J?B.follow_up_parent_service_id:"",follow_up_max_gap_weeks:J?B.follow_up_max_gap_weeks:""}):{...v,[$]:q==="checkbox"?J:ie})},E=W=>{y(W),x(!0)},O=async()=>{try{await z.delete(`/api/services/${m.id}`),x(!1),y(null),_()}catch(W){console.error("Failed to delete service",W)}},X=async()=>{const W=v.is_special,$=!v.special_start_date&&!v.special_end_date;if(W&&$){I(!0),A(()=>()=>ee());return}ee()},ee=async()=>{try{const W={...v,follow_up_parent_service_id:v.is_follow_up&&v.follow_up_parent_service_id?Number(v.follow_up_parent_service_id):null,follow_up_max_gap_weeks:v.follow_up_max_gap_weeks===""?null:Number(v.follow_up_max_gap_weeks)};u?await z.put(`/api/services/${b}`,W):await z.post("/api/services",W),h(!1),_(),ae(),D({})}catch(W){W.response&&W.response.status===422?D(W.response.data.errors||{}):console.error("Failed to save service",W)}},ae=()=>{S({name:"",description:"",price:"",category:"",is_excluded_from_analytics:!1,estimated_minutes:"",is_special:!1,per_teeth_service:!1,per_tooth_minutes:"",special_start_date:"",special_end_date:"",bundled_service_ids:[],is_follow_up:!1,follow_up_parent_service_id:"",follow_up_max_gap_weeks:""}),j(!1),C(null)},ne=W=>{var $,q,J,ie;S({name:W.name,description:W.description,price:W.price,service_category_id:((q=($=W.category)==null?void 0:$.id)==null?void 0:q.toString())||((J=W.service_category_id)==null?void 0:J.toString())||"",is_excluded_from_analytics:W.is_excluded_from_analytics||!1,estimated_minutes:W.estimated_minutes||"",is_special:W.is_special||!1,per_teeth_service:W.per_teeth_service||!1,per_tooth_minutes:W.per_tooth_minutes||"",special_start_date:W.special_start_date||"",special_end_date:W.special_end_date||"",bundled_service_ids:((ie=W.bundled_services)==null?void 0:ie.map(B=>B.id))||[],is_follow_up:W.is_follow_up||!1,follow_up_parent_service_id:W.follow_up_parent_service_id?W.follow_up_parent_service_id.toString():"",follow_up_max_gap_weeks:W.follow_up_max_gap_weeks!==null&&W.follow_up_max_gap_weeks!==void 0?W.follow_up_max_gap_weeks.toString():""}),C(W.id),j(!0),h(!0)};return e.jsxs("div",{className:"service-manager-page",style:{background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",minHeight:"100vh",width:"100%",padding:"1.5rem 1rem",boxSizing:"border-box"},children:[e.jsxs("div",{className:"d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4 gap-3",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"m-0 fw-bold",style:{color:"#1e293b"},children:[e.jsx("i",{className:"bi bi-gear me-2"}),"Service Management"]}),e.jsx("p",{className:"text-muted mb-0 mt-1",children:"Manage your clinic's services and packages"})]}),e.jsx("div",{className:"d-flex gap-2 flex-wrap",children:e.jsxs("button",{className:"btn border-0 shadow-sm",onClick:()=>h(!0),style:{background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",color:"#1e293b",border:"1px solid #e2e8f0",borderRadius:"12px",padding:"12px 24px",fontWeight:"600",transition:"all 0.3s ease"},children:[e.jsx("i",{className:"bi bi-plus-circle me-2"}),"Add New Service"]})})]}),e.jsx("div",{className:"card border-0 shadow-sm mb-4",style:{borderRadius:"16px"},children:e.jsxs("div",{className:"card-body p-4",children:[e.jsxs("div",{className:"row align-items-center",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsxs("h6",{className:"mb-0 fw-semibold",style:{color:"#1e293b"},children:[e.jsx("i",{className:"bi bi-funnel me-2"}),"Filter Services by Category"]}),e.jsx("small",{className:"text-muted",children:"Show services from a specific category"})]}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"d-flex gap-2 align-items-center",children:[e.jsxs("select",{className:"form-select border-0 shadow-sm",style:{borderRadius:"12px",padding:"12px 16px"},value:N,onChange:F,children:[e.jsx("option",{value:"",children:"All Categories"}),a.map(W=>e.jsx("option",{value:W.id,children:W.name},W.id))]}),N&&e.jsx("button",{className:"btn btn-outline-secondary border-0 shadow-sm",style:{borderRadius:"12px",padding:"12px 16px"},onClick:P,title:"Clear filter",children:e.jsx("i",{className:"bi bi-x-lg"})})]})})]}),N&&e.jsx("div",{className:"mt-3",children:e.jsxs("div",{className:"alert alert-info mb-0",style:{borderRadius:"12px"},children:[e.jsx("i",{className:"bi bi-info-circle me-2"}),"Showing ",c.length," service",c.length!==1?"s":""," from category: ",e.jsx("strong",{children:(re=a.find(W=>W.id.toString()===N))==null?void 0:re.name})]})})]})}),e.jsx("div",{className:"card border-0 shadow-sm",style:{borderRadius:"16px"},children:e.jsx("div",{className:"card-body p-4",children:r?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"400px"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"spinner-border text-primary mb-3",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"text-muted",children:"Fetching services..."})]})}):e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover mb-0 w-100",children:[e.jsx("thead",{className:"table-primary",children:e.jsxs("tr",{children:[e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-tag me-2"}),"Service Name"]}),e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-file-text me-2"}),"Description"]}),e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-currency-dollar me-2"}),"Price"]}),e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-grid me-2"}),"Category"]}),e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-clock me-2"}),"Time"]}),e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-star me-2"}),"Special"]}),e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-graph-up me-2"}),"Analytics"]}),e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-tooth me-2"}),"Per Teeth"]}),e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-arrow-return-right me-2"}),"Follow-up"]}),e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0 text-center",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-gear me-2"}),"Actions"]})]})}),e.jsx("tbody",{children:c.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"10",className:"text-center py-5",children:e.jsxs("div",{className:"text-muted",children:[e.jsx("i",{className:"bi bi-inbox display-4 d-block mb-3"}),e.jsx("h5",{children:"No services found"}),e.jsx("p",{className:"mb-0",children:N?"No services found in the selected category.":"No services available. Add your first service to get started."})]})})}):c.map(W=>{var $,q,J;return e.jsxs("tr",{className:"align-middle",style:{height:"60px"},children:[e.jsx("td",{className:"px-4 py-3 fw-medium border-0",style:{fontSize:"1rem"},children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"bg-primary rounded-circle me-3 d-flex align-items-center justify-content-center",style:{width:"40px",height:"40px",fontSize:"1.2rem"},children:"ðŸ¦·"}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-bold text-dark",children:W.name}),(($=W.bundled_services)==null?void 0:$.length)>0&&e.jsxs("small",{className:"text-muted",children:["(",W.bundled_services.map(ie=>ie.name).join(", "),")"]})]})]})}),e.jsx("td",{className:"px-4 py-3 border-0",style:{fontSize:"1rem"},children:e.jsx("div",{className:"text-truncate",style:{maxWidth:"200px"},title:W.description,children:W.description||"-"})}),e.jsx("td",{className:"px-4 py-3 border-0",style:{fontSize:"1rem"},children:e.jsx("div",{className:"fw-bold text-success fs-5",children:W.per_teeth_service?`â‚±${Number(W.price).toFixed(2)} per tooth`:`â‚±${Number(W.price).toFixed(2)}`})}),e.jsx("td",{className:"px-4 py-3 border-0",style:{fontSize:"1rem"},children:e.jsx("span",{className:"badge bg-light text-dark",children:((q=W.category)==null?void 0:q.name)||"-"})}),e.jsx("td",{className:"px-4 py-3 border-0",style:{fontSize:"1rem"},children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsxs("span",{className:"fw-semibold text-dark",children:[W.estimated_minutes," mins"]}),e.jsx("small",{className:"text-muted",children:"Estimated"})]})}),e.jsx("td",{className:"px-4 py-3 border-0",style:{fontSize:"1rem"},children:e.jsx("div",{className:"d-flex flex-column align-items-start",children:W.is_special?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"badge bg-warning text-dark mb-1",children:"Special"}),e.jsx("small",{className:"text-muted",children:W.special_start_date&&W.special_end_date?`${W.special_start_date} â†’ ${W.special_end_date}`:"(Permanent)"})]}):e.jsx("span",{className:"text-muted",children:"-"})})}),e.jsx("td",{className:"px-4 py-3 border-0",style:{fontSize:"1rem"},children:e.jsx("span",{className:`badge ${W.is_excluded_from_analytics?"bg-danger":"bg-success"}`,children:W.is_excluded_from_analytics?"Excluded":"Included"})}),e.jsx("td",{className:"px-4 py-3 border-0",style:{fontSize:"1rem"},children:e.jsx("span",{className:`badge ${W.per_teeth_service?"bg-info":"bg-secondary"}`,children:W.per_teeth_service?"Yes":"No"})}),e.jsx("td",{className:"px-4 py-3 border-0",style:{fontSize:"1rem"},children:W.is_follow_up?e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("span",{className:"badge bg-primary text-white align-self-start mb-1",children:"Follow-up"}),e.jsxs("small",{className:"text-muted",children:["Parent: ",((J=W.follow_up_parent)==null?void 0:J.name)||"â€”"]}),e.jsxs("small",{className:"text-muted",children:["Gap: ",W.follow_up_max_gap_weeks??"No limit",W.follow_up_max_gap_weeks!==null&&W.follow_up_max_gap_weeks!==void 0&&` wk${W.follow_up_max_gap_weeks===1?"":"s"}`]})]}):e.jsx("span",{className:"text-muted",children:"-"})}),e.jsx("td",{className:"px-4 py-3 text-center border-0",children:e.jsxs("div",{className:"btn-group",role:"group",children:[e.jsx("button",{className:"btn btn-sm btn-success",onClick:()=>ne(W),title:"Edit service",children:e.jsx("i",{className:"bi bi-pencil"})}),e.jsx("button",{className:"btn btn-sm btn-danger",onClick:()=>E(W),title:"Delete service",children:e.jsx("i",{className:"bi bi-trash"})})]})})]},W.id)})})]})})})}),l&&e.jsx("div",{className:"modal d-block",tabIndex:"-1",role:"dialog",style:{backgroundColor:"rgba(0,0,0,0.5)",position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:1050,overflowY:"auto",display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem"},children:e.jsx("div",{className:"modal-dialog",style:{margin:"0 auto",maxHeight:"calc(100vh - 2rem)",width:"100%"},children:e.jsxs("div",{className:"modal-content",style:{display:"flex",flexDirection:"column",maxHeight:"calc(100vh - 2rem)",overflow:"hidden"},children:[e.jsxs("div",{className:"modal-header flex-shrink-0",style:{position:"sticky",top:0,zIndex:1,backgroundColor:"#fff",borderBottom:"1px solid #dee2e6"},children:[e.jsx("h5",{className:"modal-title",children:u?"Edit Service":"Add Service"}),e.jsx("button",{type:"button",className:"btn-close",onClick:()=>{h(!1),ae()}})]}),e.jsxs("div",{className:"modal-body flex-grow-1",style:{overflowY:"auto",overflowX:"hidden",flex:"1 1 auto",minHeight:0},children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label",children:["Service Name ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"text",name:"name",className:`form-control ${f.name?"is-invalid":""}`,value:v.name,onChange:k,required:!0}),f.name&&e.jsx("div",{className:"invalid-feedback",children:f.name[0]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Description"}),e.jsx("textarea",{name:"description",className:`form-control ${f.description?"is-invalid":""}`,value:v.description,onChange:k}),f.description&&e.jsx("div",{className:"invalid-feedback",children:f.description[0]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label",children:["Price (â‚±) ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"number",name:"price",className:`form-control ${f.price?"is-invalid":""}`,value:v.price,onChange:k,required:!0}),v.per_teeth_service&&e.jsxs("small",{className:"text-info",children:[e.jsx("i",{className:"bi bi-info-circle me-1"}),"This will be the price per tooth. Total cost will be calculated based on number of teeth treated."]}),f.price&&e.jsx("div",{className:"invalid-feedback",children:f.price[0]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label",children:["Category ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("div",{className:"input-group",children:[e.jsxs("select",{name:"service_category_id",className:`form-select ${f.service_category_id?"is-invalid":""}`,value:v.service_category_id,onChange:k,required:!0,children:[e.jsx("option",{value:"",children:"-- Select Category --"}),a.map(W=>e.jsx("option",{value:W.id,children:W.name},W.id))]}),e.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>p(!0),title:"Add new category",children:e.jsx("i",{className:"bi bi-plus"})})]}),f.service_category_id&&e.jsx("div",{className:"invalid-feedback",children:f.service_category_id[0]})]}),e.jsxs("div",{className:"form-check mb-3",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"excludeAnalytics",name:"is_excluded_from_analytics",checked:v.is_excluded_from_analytics,onChange:k}),e.jsxs("label",{className:"form-check-label",htmlFor:"excludeAnalytics",children:["Exclude from analytics",e.jsx("br",{}),e.jsx("small",{className:"text-muted",children:"Used to hide situational services like dentures from charts and usage-based reports."})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label",children:["Estimated Procedure Time (minutes)"," ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"number",name:"estimated_minutes",className:`form-control ${f.estimated_minutes?"is-invalid":""}`,value:v.estimated_minutes,onChange:k,required:!0}),e.jsx("small",{className:"text-muted",children:"This will be automatically rounded up to the nearest 30 minutes."}),f.estimated_minutes&&e.jsx("div",{className:"invalid-feedback",children:f.estimated_minutes[0]})]}),e.jsxs("div",{className:"form-check mb-3",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"isSpecial",name:"is_special",checked:v.is_special,onChange:k}),e.jsxs("label",{className:"form-check-label",htmlFor:"isSpecial",children:["Mark as Special / Package",e.jsx("br",{}),e.jsx("small",{className:"text-muted",children:"Special services require a start and end date and cannot be used with promo discounts."})]})]}),e.jsxs("div",{className:"form-check mb-3",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"perTeethService",name:"per_teeth_service",checked:v.per_teeth_service,onChange:k,disabled:v.is_special}),e.jsxs("label",{className:"form-check-label",htmlFor:"perTeethService",children:["Per Teeth Service",e.jsx("br",{}),e.jsx("small",{className:"text-muted",children:"Track which specific tooth was serviced and what procedure was done. Examples: Tooth Extraction, Tooth Filling, Root Canal Treatment."})]})]}),v.per_teeth_service&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label",children:["Minutes per Tooth ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"number",name:"per_tooth_minutes",className:`form-control ${f.per_tooth_minutes?"is-invalid":""}`,value:v.per_tooth_minutes,onChange:k,min:"1",max:"60",required:!0}),e.jsxs("small",{className:"text-info",children:[e.jsx("i",{className:"bi bi-info-circle me-1"}),"Time per tooth. Total appointment time will be calculated as: (minutes per tooth Ã— number of teeth) rounded up to 30-minute blocks."]}),f.per_tooth_minutes&&e.jsx("div",{className:"invalid-feedback",children:f.per_tooth_minutes[0]})]}),v.is_special&&v.per_teeth_service&&e.jsxs("div",{className:"alert alert-warning mb-3",role:"alert",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),e.jsx("strong",{children:"Warning:"})," Per Teeth Service is only available for solo services. Since this service is marked as Special/Package, the Per Teeth option has been turned off."]}),e.jsxs("div",{className:"form-check mb-3",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"isFollowUp",name:"is_follow_up",checked:v.is_follow_up,onChange:k}),e.jsxs("label",{className:"form-check-label",htmlFor:"isFollowUp",children:["Mark as Follow-up Service",e.jsx("br",{}),e.jsx("small",{className:"text-muted",children:"Limits availability to patients who recently completed a chosen parent service."})]})]}),v.is_follow_up&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label",children:["Parent Service ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("select",{name:"follow_up_parent_service_id",className:`form-select ${f.follow_up_parent_service_id?"is-invalid":""}`,value:v.follow_up_parent_service_id,onChange:k,children:[e.jsx("option",{value:"",children:"-- Select Parent Service --"}),s.filter(W=>{const $=u&&W.id===b,q=W.is_active!==!1;return!$&&q}).map(W=>e.jsx("option",{value:W.id,children:W.name},W.id))]}),f.follow_up_parent_service_id&&e.jsx("div",{className:"invalid-feedback",children:f.follow_up_parent_service_id[0]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label",children:["Maximum Allowable Gap (weeks)"," ",e.jsx("small",{className:"text-muted",children:"(optional)"})]}),e.jsx("input",{type:"number",name:"follow_up_max_gap_weeks",className:`form-control ${f.follow_up_max_gap_weeks?"is-invalid":""}`,value:v.follow_up_max_gap_weeks,onChange:k,min:"0"}),e.jsx("div",{className:"form-text",children:"Leave blank to allow follow-ups regardless of elapsed time."}),f.follow_up_max_gap_weeks&&e.jsx("div",{className:"invalid-feedback d-block",children:f.follow_up_max_gap_weeks[0]})]}),e.jsxs("div",{className:"alert alert-info",role:"alert",children:[e.jsx("i",{className:"bi bi-info-circle me-2"}),"Patients must complete the parent service before they can see or book this follow-up online. Staff can always override this requirement for walk-ins."]})]}),v.is_special&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label",children:["Start Date"," ",e.jsx("small",{className:"text-muted",children:"(optional)"})]}),e.jsx("input",{type:"date",name:"special_start_date",className:`form-control ${f.special_start_date?"is-invalid":""}`,value:v.special_start_date,onChange:k}),f.special_start_date&&e.jsx("div",{className:"invalid-feedback",children:f.special_start_date[0]}),e.jsxs("label",{className:"form-label mt-2",children:["End Date ",e.jsx("small",{className:"text-muted",children:"(optional)"})]}),e.jsx("input",{type:"date",name:"special_end_date",className:`form-control ${f.special_end_date?"is-invalid":""}`,value:v.special_end_date,onChange:k}),f.special_end_date&&e.jsx("div",{className:"invalid-feedback",children:f.special_end_date[0]}),e.jsx("label",{className:"form-label",children:"Bundled Services"}),e.jsx("div",{className:"border rounded p-2",style:{maxHeight:200,overflowY:"auto"},children:s.filter(W=>W.id!==b).map(W=>e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:`bundle-${W.id}`,checked:v.bundled_service_ids.includes(W.id),onChange:$=>{const q=$.target.checked;S(J=>{const ie=q?[...J.bundled_service_ids,W.id]:J.bundled_service_ids.filter(B=>B!==W.id);return{...J,bundled_service_ids:ie}})}}),e.jsx("label",{className:"form-check-label",htmlFor:`bundle-${W.id}`,children:W.name})]},W.id))}),e.jsx("small",{className:"text-muted",children:"Tick services to include in this package."})]})]}),e.jsxs("div",{className:"modal-footer flex-shrink-0",style:{position:"sticky",bottom:0,zIndex:1,backgroundColor:"#fff",borderTop:"1px solid #dee2e6"},children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>{h(!1),ae()},children:"Cancel"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:X,children:"Save"})]})]})})}),o&&e.jsx("div",{className:"modal d-block",tabIndex:"-1",role:"dialog",style:{backgroundColor:"rgba(0,0,0,0.5)",position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:1050,overflowY:"auto",display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem"},children:e.jsx("div",{className:"modal-dialog",style:{margin:"0 auto",maxHeight:"calc(100vh - 2rem)",width:"100%"},children:e.jsxs("div",{className:"modal-content",style:{display:"flex",flexDirection:"column",maxHeight:"calc(100vh - 2rem)",overflow:"hidden"},children:[e.jsxs("div",{className:"modal-header bg-danger text-white flex-shrink-0",style:{position:"sticky",top:0,zIndex:1,borderBottom:"1px solid #dee2e6"},children:[e.jsx("h5",{className:"modal-title",children:"âš ï¸ Confirm Deletion"}),e.jsx("button",{type:"button",className:"btn-close",onClick:()=>x(!1)})]}),e.jsx("div",{className:"modal-body flex-grow-1",style:{overflowY:"auto",overflowX:"hidden",flex:"1 1 auto",minHeight:0},children:e.jsxs("p",{children:["Are you sure you want to delete"," ",e.jsx("strong",{children:m==null?void 0:m.name}),"?",e.jsx("br",{}),e.jsx("span",{className:"text-danger",children:"This action cannot be undone."})]})}),e.jsxs("div",{className:"modal-footer flex-shrink-0",style:{position:"sticky",bottom:0,zIndex:1,backgroundColor:"#fff",borderTop:"1px solid #dee2e6"},children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>x(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-danger",onClick:O,children:"Yes, Delete"})]})]})})}),L&&e.jsx("div",{className:"modal d-block",tabIndex:"-1",role:"dialog",style:{backgroundColor:"rgba(0,0,0,0.5)",position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:1050,overflowY:"auto",display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem"},children:e.jsx("div",{className:"modal-dialog",style:{margin:"0 auto",maxHeight:"calc(100vh - 2rem)",width:"100%"},children:e.jsxs("div",{className:"modal-content",style:{display:"flex",flexDirection:"column",maxHeight:"calc(100vh - 2rem)",overflow:"hidden"},children:[e.jsxs("div",{className:"modal-header flex-shrink-0",style:{position:"sticky",top:0,zIndex:1,backgroundColor:"#fff",borderBottom:"1px solid #dee2e6"},children:[e.jsx("h5",{className:"modal-title",children:"Confirm Permanent Special"}),e.jsx("button",{type:"button",className:"btn-close",onClick:()=>I(!1)})]}),e.jsx("div",{className:"modal-body flex-grow-1",style:{overflowY:"auto",overflowX:"hidden",flex:"1 1 auto",minHeight:0},children:e.jsxs("p",{children:["This special service has no start or end date.",e.jsx("br",{}),"Do you want to save it as a ",e.jsx("strong",{children:"permanent package"}),"?"]})}),e.jsxs("div",{className:"modal-footer flex-shrink-0",style:{position:"sticky",bottom:0,zIndex:1,backgroundColor:"#fff",borderTop:"1px solid #dee2e6"},children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>I(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:()=>{I(!1),w&&w()},children:"Yes, Save as Permanent"})]})]})})}),e.jsx(Pi,{show:g,onClose:()=>p(!1),onCategoryAdded:T})]})}function Ai({show:s,services:i,onSelect:a,onClose:n}){const[r,d]=t.useState(null);Va.useEffect(()=>{s||d(null)},[s]),t.useEffect(()=>{if(s){const o=document.body.style.overflow;return document.body.style.overflow="auto",()=>{document.body.style.overflow=o}}},[s]);const l=o=>{d(o)},h=()=>{r&&(a(r),d(null))};return s?e.jsx("div",{className:"modal fade show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:1055,position:"fixed",top:0,left:0,right:0,bottom:0,overflowY:"auto",padding:"1.75rem 0",pointerEvents:"auto"},children:e.jsx("div",{className:"modal-dialog modal-dialog-scrollable modal-dialog-centered",style:{maxHeight:"calc(100vh - 3.5rem)",margin:"0 auto",display:"flex",alignItems:"center",minHeight:"calc(100vh - 3.5rem)"},children:e.jsxs("div",{className:"modal-content",style:{maxHeight:"100%",display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsxs("div",{className:"modal-header flex-shrink-0",style:{position:"sticky",top:0,zIndex:1,backgroundColor:"#fff",borderBottom:"1px solid #dee2e6"},children:[e.jsx("h5",{className:"modal-title",children:"ðŸ¦· Select Service"}),e.jsx("button",{type:"button",className:"btn-close",onClick:n})]}),e.jsxs("div",{className:"modal-body flex-grow-1",style:{overflowY:"auto",minHeight:0,padding:"1rem",maxHeight:"calc(100vh - 200px)"},children:[e.jsxs("div",{className:"alert alert-info border-0 mb-3",style:{borderRadius:"12px"},children:[e.jsx("i",{className:"bi bi-info-circle me-2"}),'Click on a service to select it, then click "Select Service" to confirm.']}),e.jsx("ul",{className:"list-group",children:i.map(o=>e.jsxs("li",{className:`list-group-item list-group-item-action d-flex justify-content-between align-items-center ${r===o.id?"active":""}`,onClick:()=>l(o.id),role:"button",style:{cursor:"pointer",transition:"all 0.2s ease",borderRadius:r===o.id?"8px":"0"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:o.name}),e.jsx("br",{}),e.jsx("small",{className:"text-muted",children:o.description})]}),e.jsxs("span",{className:"badge bg-primary",children:["â‚±",o.price]})]},o.id))})]}),e.jsxs("div",{className:"modal-footer flex-shrink-0",style:{position:"sticky",bottom:0,zIndex:1,borderTop:"1px solid #dee2e6",padding:"1rem",backgroundColor:"#f8f9fa"},children:[e.jsx("button",{className:"btn btn-secondary",onClick:n,children:"Cancel"}),e.jsxs("button",{className:"btn btn-primary",onClick:h,disabled:!r,children:[e.jsx("i",{className:"bi bi-check-circle me-2"}),"Select Service"]})]})]})})}):null}function Mi({show:s,promo:i,service:a,onSave:n,onCancel:r,loading:d,isCreatingNew:l=!1}){const[h,o]=t.useState({start_date:"",end_date:"",discounted_price:""}),[x,g]=t.useState({});Va.useEffect(()=>{o(i?{start_date:i.start_date,end_date:i.end_date,discounted_price:i.discounted_price}:{start_date:"",end_date:"",discounted_price:""}),g({})},[i]),t.useEffect(()=>{if(s){const y=document.body.style.overflow;return document.body.style.overflow="auto",()=>{document.body.style.overflow=y}}},[s]);const p=y=>{o({...h,[y.target.name]:y.target.value}),x[y.target.name]&&g({...x,[y.target.name]:null})},m=async y=>{var N;y.preventDefault(),g({});try{await n(h)}catch(R){if(((N=R.response)==null?void 0:N.status)===422){const v=R.response.data.errors;g(v||{})}}};return s?e.jsx("div",{className:"modal fade show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:1055,position:"fixed",top:0,left:0,right:0,bottom:0,overflowY:"auto",padding:"3rem 0",pointerEvents:"auto"},children:e.jsx("div",{className:"modal-dialog modal-dialog-scrollable modal-dialog-centered",style:{maxHeight:"calc(100vh - 6rem)",margin:"0 auto",display:"flex",alignItems:"center",minHeight:"calc(100vh - 6rem)"},children:e.jsxs("div",{className:"modal-content",style:{maxHeight:"100%",display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsxs("div",{className:`modal-header ${l?"bg-success":"bg-info"} text-white flex-shrink-0`,style:{position:"sticky",top:0,zIndex:1,borderBottom:"1px solid #dee2e6"},children:[e.jsxs("h5",{className:"modal-title",children:[e.jsx("i",{className:`bi ${l?"bi-plus-circle":"bi-pencil"} me-2`}),l?"Create New Promo":"Edit Promo"]}),e.jsx("button",{type:"button",className:"btn-close",onClick:r})]}),e.jsxs("form",{onSubmit:m,className:"d-flex flex-column h-100",children:[e.jsxs("div",{className:"modal-body flex-grow-1",style:{overflowY:"auto",minHeight:0,padding:"1rem",maxHeight:"calc(100vh - 280px)"},children:[e.jsxs("div",{className:"alert alert-info",children:[e.jsx("strong",{children:"Service:"})," ",a==null?void 0:a.name,e.jsx("br",{}),e.jsx("strong",{children:"Original Price:"})," â‚±",a==null?void 0:a.price]}),e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-12",children:[e.jsx("label",{className:"form-label",children:"Start Date"}),e.jsx("input",{name:"start_date",type:"date",className:`form-control ${x.start_date?"is-invalid":""}`,value:h.start_date,onChange:p,required:!0}),x.start_date&&e.jsx("div",{className:"invalid-feedback",children:x.start_date[0]})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("label",{className:"form-label",children:"End Date"}),e.jsx("input",{name:"end_date",type:"date",className:`form-control ${x.end_date?"is-invalid":""}`,value:h.end_date,onChange:p,required:!0}),x.end_date&&e.jsx("div",{className:"invalid-feedback",children:x.end_date[0]})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("label",{className:"form-label",children:"Discounted Price (â‚±)"}),e.jsx("input",{name:"discounted_price",type:"number",step:"0.01",min:"0",max:a==null?void 0:a.price,className:`form-control ${x.discounted_price?"is-invalid":""}`,value:h.discounted_price,onChange:p,required:!0}),x.discounted_price&&e.jsx("div",{className:"invalid-feedback",children:x.discounted_price[0]}),e.jsxs("div",{className:"form-text",children:["Maximum: â‚±",a==null?void 0:a.price]})]})]}),x.message&&e.jsxs("div",{className:"alert alert-danger mt-3",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-1"}),x.message]})]}),e.jsxs("div",{className:"modal-footer flex-shrink-0",style:{position:"sticky",bottom:0,borderTop:"1px solid #dee2e6",padding:"1rem",backgroundColor:"#f8f9fa",zIndex:1},children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:r,disabled:d,children:"Cancel"}),e.jsx("button",{type:"submit",className:`btn ${l?"btn-success":"btn-primary"}`,disabled:d,children:d?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),l?"Creating...":"Updating..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:`bi ${l?"bi-plus-circle":"bi-check-circle"} me-1`}),l?"Create Promo":"Update Promo"]})})]})]})]})})}):null}function Li(){var U,G;const[s,i]=t.useState([]),[a,n]=t.useState(null),[r,d]=t.useState({start_date:"",end_date:"",discounted_price:""}),[l,h]=t.useState({}),[o,x]=t.useState(!1),[g,p]=t.useState(!1),[m,y]=t.useState(null),[N,R]=t.useState(!1),[v,S]=t.useState(null),[u,j]=t.useState(!1),[b,C]=t.useState(null),[f,D]=t.useState(!1),[L,I]=t.useState([]),[w,A]=t.useState(!1),[_,H]=t.useState(!1),[T,c]=t.useState(!1),[F,P]=t.useState(null);t.useEffect(()=>{(async()=>{try{const[se,oe]=await Promise.all([z.get("/api/services"),z.get("/api/discounts-overview")]);i(se.data),I(oe.data)}catch(se){console.error("Failed to load initial data",se)}})()},[]),t.useEffect(()=>()=>{document.body.style.overflow=""},[]);const k=async()=>{A(!0);try{const{data:Y}=await z.get("/api/discounts-overview");I(Y||[])}catch(Y){console.error("Failed to load overview promos",Y),I([])}finally{A(!1)}},E=async(Y=null)=>{var oe;const se=Y||r;x(!0),h({});try{if(f){const pe=await z.post(`/api/services/${a}/discounts`,se);pe.data.warning&&K(`âš  Promo saved, but some dates are clinic closed:
${pe.data.warning}`,{icon:"âš ï¸"}),j(!1),D(!1)}else v&&(await z.put(`/api/discounts/${v}`,se),j(!1),C(null),S(null));d({start_date:"",end_date:"",discounted_price:""}),R(!1),n(null),await k()}catch(pe){if(((oe=pe.response)==null?void 0:oe.status)===422){const ce=pe.response.data.message,be=pe.response.data.errors;if(ce!=null&&ce.includes("clinic closed")){K.error(`âŒ Cannot save promo: ${ce}`);return}throw h(be||{message:ce}),pe}else throw console.error("Unknown error",pe),pe}finally{x(!1)}},O=t.useMemo(()=>s.find(Y=>Y.id===Number(a)),[s,a]),X=t.useCallback(()=>{p(!0),document.body.style.overflow="hidden"},[]),ee=t.useCallback(async Y=>{p(!1),n(Y),D(!0),C(null),S(null),j(!0)},[]);t.useCallback(Y=>{C(Y),S(Y.id),D(!1),j(!0),document.body.style.overflow="hidden"},[]);const ae=t.useCallback(()=>{j(!1),C(null),S(null),D(!1),n(null),document.body.style.overflow=""},[]),ne=Y=>{P(Y),H(!0),document.body.style.overflow="hidden"},re=async()=>{var Y,se;if(F)try{await z.post(`/api/discounts/${F.id}/launch`),await k(),H(!1),P(null)}catch(oe){console.error("Failed to launch promo",oe),K.error("Failed to launch promo: "+(((se=(Y=oe.response)==null?void 0:Y.data)==null?void 0:se.message)||"Unknown error"))}finally{document.body.style.overflow=""}},W=()=>{H(!1),P(null),document.body.style.overflow=""},$=Y=>{P(Y),c(!0),document.body.style.overflow="hidden"},q=async()=>{var Y,se;if(F)try{await z.post(`/api/discounts/${F.id}/cancel`),await k(),c(!1),P(null)}catch(oe){console.error("Failed to cancel promo",oe),K.error("Failed to cancel promo: "+(((se=(Y=oe.response)==null?void 0:Y.data)==null?void 0:se.message)||"Unknown error"))}finally{document.body.style.overflow=""}},J=()=>{c(!1),P(null),document.body.style.overflow=""},ie=Y=>{const se=s.find(oe=>oe.id===Y.service_id);se&&(n(se.id),C(Y),S(Y.id),D(!1),j(!0))},B=Y=>{if(Y.status!=="launched"||!Y.activated_at)return!1;const se=new Date(Y.activated_at);return(new Date-se)/(1e3*60*60*24)<=1},le=t.useCallback(Y=>{switch(Y){case"planned":return e.jsx("span",{className:"badge bg-secondary",children:"Planned"});case"launched":return e.jsx("span",{className:"badge bg-success",children:"Launched"});case"canceled":return e.jsx("span",{className:"badge bg-warning text-dark",children:"Canceled"});default:return e.jsx("span",{className:"badge bg-light text-dark",children:"Unknown"})}},[]),M=t.useMemo(()=>s.filter(Y=>!Y.is_special),[s]);return e.jsxs("div",{className:"service-discounts-page",style:{background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",minHeight:"100vh",width:"100vw",position:"relative",left:0,right:0,padding:"1.5rem 2rem",boxSizing:"border-box"},children:[e.jsxs("div",{className:"d-flex flex-column flex-lg-row justify-content-between align-items-start align-items-lg-center mb-4 gap-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"m-0 fw-bold",style:{color:"#1e293b"},children:"Service Promo Discounts"}),e.jsx("p",{className:"text-muted mb-0 mt-1",children:"Create and manage promotional discounts for services"})]}),e.jsxs("button",{className:"btn border-0 shadow-sm",onClick:X,style:{background:"linear-gradient(135deg, #0d6efd 0%, #0b5ed7 100%)",color:"white",borderRadius:"12px",padding:"12px 24px",fontWeight:"600",transition:"all 0.3s ease"},children:[e.jsx("i",{className:"bi bi-plus-circle me-2"}),"Create New Promo"]})]}),e.jsx("div",{className:"card border-0 shadow-sm",style:{borderRadius:"16px"},children:e.jsxs("div",{className:"card-body p-4",children:[m&&e.jsxs("div",{className:"alert alert-success border-0 shadow-sm mb-4",style:{borderRadius:"12px"},children:[e.jsx("i",{className:"bi bi-check-circle me-2"}),m]}),e.jsxs("div",{className:"row mb-4",children:[e.jsx("div",{className:"col-12 col-md-6",children:e.jsxs("div",{className:"d-flex align-items-center p-3 bg-light rounded",style:{borderRadius:"12px"},children:[e.jsx("div",{className:"bg-info rounded-circle me-3 d-flex align-items-center justify-content-center",style:{width:"50px",height:"50px",fontSize:"1.5rem"},children:e.jsx("i",{className:"bi bi-info-circle text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-semibold text-dark",children:"Promo Management"}),e.jsx("small",{className:"text-muted",children:"Create and manage service discounts"})]})]})}),e.jsx("div",{className:"col-12 col-md-6 mt-3 mt-md-0",children:e.jsxs("div",{className:"d-flex align-items-center p-3 bg-light rounded",style:{borderRadius:"12px"},children:[e.jsx("div",{className:"bg-warning rounded-circle me-3 d-flex align-items-center justify-content-center",style:{width:"50px",height:"50px",fontSize:"1.5rem"},children:e.jsx("i",{className:"bi bi-exclamation-triangle text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-semibold text-dark",children:"Restrictions"}),e.jsx("small",{className:"text-muted",children:"Specials/Packages cannot be discounted"})]})]})})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"d-flex flex-column flex-md-row align-items-start align-items-md-center mb-4 gap-3",children:[e.jsxs("h5",{className:"mb-0",children:[e.jsx("i",{className:"bi bi-list-ul me-2 text-primary"}),"Active and Planned Promos"]}),e.jsx("div",{className:"flex-grow-1"}),e.jsxs("span",{className:"badge bg-primary fs-6",children:[L.length," promo",L.length!==1?"s":""]})]}),w?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"400px"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"spinner-border text-primary mb-3",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"text-muted",children:"Loading promos..."})]})}):L.length>0?e.jsx("div",{className:"table-responsive",style:{width:"100%"},children:e.jsxs("table",{className:"table table-hover mb-0",style:{width:"100%"},children:[e.jsx("thead",{className:"table-primary",children:e.jsxs("tr",{children:[e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-tag me-2"}),"Service Name"]}),e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-calendar-event me-2"}),"Start Date"]}),e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-calendar-x me-2"}),"End Date"]}),e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi  me-2"}),"Discounted Price"]}),e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-activity me-2"}),"Status"]}),e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-clock-history me-2"}),"Activated Date"]}),e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0 text-center",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-gear me-2"}),"Actions"]})]})}),e.jsx("tbody",{children:L.map(Y=>{var se,oe;return e.jsxs("tr",{className:"align-middle",style:{height:"60px"},children:[e.jsx("td",{className:"px-4 py-3 fw-medium border-0",style:{fontSize:"1rem"},children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"bg-primary rounded-circle me-3 d-flex align-items-center justify-content-center",style:{width:"40px",height:"40px",fontSize:"1.2rem"},children:"ðŸ¦·"}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-bold text-dark",children:((se=Y.service)==null?void 0:se.name)||"-"}),e.jsx("small",{className:"text-muted",children:"Dental Service"})]})]})}),e.jsx("td",{className:"px-4 py-3 border-0",style:{fontSize:"1rem"},children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("span",{className:"fw-semibold text-dark",children:Y.start_date}),e.jsx("small",{className:"text-muted",children:"Campaign Start"})]})}),e.jsx("td",{className:"px-4 py-3 border-0",style:{fontSize:"1rem"},children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("span",{className:"fw-semibold text-dark",children:Y.end_date}),e.jsx("small",{className:"text-muted",children:"Campaign End"})]})}),e.jsx("td",{className:"px-4 py-3 border-0",style:{fontSize:"1rem"},children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsxs("span",{className:"fw-bold text-success fs-5",children:["â‚±",Number(Y.discounted_price).toFixed(2)]}),e.jsx("small",{className:"text-muted",children:"Promotional Price"})]})}),e.jsx("td",{className:"px-4 py-3 border-0",style:{fontSize:"1rem"},children:e.jsxs("div",{className:"d-flex flex-column align-items-start",children:[le(Y.status),e.jsx("small",{className:"text-muted mt-1",children:"Current State"})]})}),e.jsx("td",{className:"px-4 py-3 text-muted border-0",style:{fontSize:"1rem"},children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("span",{className:"fw-semibold text-dark",children:((oe=Y.activated_at)==null?void 0:oe.split("T")[0])||"-"}),e.jsx("small",{className:"text-muted",children:Y.activated_at?"Launch Date":"Not Activated"})]})}),e.jsxs("td",{className:"px-4 py-3 border-0 text-center",style:{fontSize:"1rem"},children:[Y.status==="planned"&&e.jsxs("div",{className:"btn-group",role:"group",children:[e.jsx("button",{className:"btn btn-sm btn-success me-1",onClick:()=>ne(Y),title:"Launch this promo",style:{borderRadius:"8px"},children:e.jsx("i",{className:"bi bi-play-fill"})}),e.jsx("button",{className:"btn btn-sm btn-warning me-1",onClick:()=>$(Y),title:"Cancel this promo",style:{borderRadius:"8px"},children:e.jsx("i",{className:"bi bi-x-circle"})}),e.jsx("button",{className:"btn btn-sm btn-info",onClick:()=>ie(Y),title:"Edit this promo",style:{borderRadius:"8px"},children:e.jsx("i",{className:"bi bi-pencil"})})]}),Y.status==="launched"&&B(Y)&&e.jsxs("button",{className:"btn btn-sm btn-warning",onClick:()=>$(Y),title:"Cancel this promo",style:{borderRadius:"8px"},children:[e.jsx("i",{className:"bi bi-x-circle me-1"}),"Cancel"]}),Y.status==="launched"&&!B(Y)&&e.jsxs("span",{className:"text-muted small",children:[e.jsx("i",{className:"bi bi-check-circle text-success"})," Active"]}),Y.status==="canceled"&&e.jsxs("span",{className:"text-muted small",children:[e.jsx("i",{className:"bi bi-x-circle text-warning"})," Canceled"]})]})]},Y.id)})})]})}):e.jsx("div",{className:"text-center text-muted",style:{height:"400px"},children:e.jsxs("div",{className:"d-flex flex-column align-items-center justify-content-center py-5",children:[e.jsx("div",{className:"bg-light rounded-circle mb-4 d-flex align-items-center justify-content-center",style:{width:"120px",height:"120px",fontSize:"3rem"},children:"ðŸ’°"}),e.jsx("h3",{className:"text-muted mb-3",children:"No active or planned promos"}),e.jsx("p",{className:"text-muted mb-4 fs-5",children:"Create your first promotional discount to get started."}),e.jsxs("button",{className:"btn border-0 shadow-sm",onClick:X,style:{background:"linear-gradient(135deg, #0d6efd 0%, #0b5ed7 100%)",color:"white",borderRadius:"12px",padding:"12px 24px",fontWeight:"600",transition:"all 0.3s ease"},children:[e.jsx("i",{className:"bi bi-plus-circle me-2"}),"Create First Promo"]})]})})]}),e.jsx(Ai,{show:g,services:M,onSelect:ee,onClose:()=>{p(!1),document.body.style.overflow=""}}),e.jsx(Mi,{show:u,promo:b,service:O,onSave:E,onCancel:ae,loading:o,isCreatingNew:f}),_&&F&&e.jsx("div",{className:"modal fade show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:1055,position:"fixed",top:0,left:0,right:0,bottom:0,overflowY:"auto",display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem"},children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",style:{margin:"0 auto",maxHeight:"calc(100vh - 2rem)",width:"100%"},children:e.jsxs("div",{className:"modal-content",style:{display:"flex",flexDirection:"column",maxHeight:"calc(100vh - 2rem)",overflow:"hidden"},children:[e.jsxs("div",{className:"modal-header bg-success text-white flex-shrink-0",style:{position:"sticky",top:0,zIndex:1,borderBottom:"1px solid #dee2e6"},children:[e.jsxs("h5",{className:"modal-title",children:[e.jsx("i",{className:"bi bi-play-circle me-2"}),"Launch Promo"]}),e.jsx("button",{type:"button",className:"btn-close",onClick:W})]}),e.jsxs("div",{className:"modal-body flex-grow-1",style:{overflowY:"auto",overflowX:"hidden",flex:"1 1 auto",minHeight:0},children:[e.jsxs("div",{className:"alert alert-warning",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),e.jsx("strong",{children:"Warning:"})," This action cannot be undone easily."]}),e.jsx("p",{children:"Are you sure you want to launch this promo?"}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h6",{className:"card-title",children:(U=F.service)==null?void 0:U.name}),e.jsxs("p",{className:"card-text mb-1",children:[e.jsx("strong",{children:"Start Date:"})," ",F.start_date,e.jsx("br",{}),e.jsx("strong",{children:"End Date:"})," ",F.end_date,e.jsx("br",{}),e.jsx("strong",{children:"Discounted Price:"})," â‚±",Number(F.discounted_price).toFixed(2)]})]})})]}),e.jsxs("div",{className:"modal-footer flex-shrink-0",style:{position:"sticky",bottom:0,zIndex:1,backgroundColor:"#fff",borderTop:"1px solid #dee2e6"},children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:W,children:"Cancel"}),e.jsxs("button",{type:"button",className:"btn btn-success",onClick:re,children:[e.jsx("i",{className:"bi bi-play-fill me-1"}),"Launch Promo"]})]})]})})}),T&&F&&e.jsx("div",{className:"modal fade show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:1055,position:"fixed",top:0,left:0,right:0,bottom:0,overflowY:"auto",display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem"},children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",style:{margin:"0 auto",maxHeight:"calc(100vh - 2rem)",width:"100%"},children:e.jsxs("div",{className:"modal-content",style:{display:"flex",flexDirection:"column",maxHeight:"calc(100vh - 2rem)",overflow:"hidden"},children:[e.jsxs("div",{className:"modal-header bg-warning text-dark flex-shrink-0",style:{position:"sticky",top:0,zIndex:1,borderBottom:"1px solid #dee2e6"},children:[e.jsxs("h5",{className:"modal-title",children:[e.jsx("i",{className:"bi bi-x-circle me-2"}),"Cancel Promo"]}),e.jsx("button",{type:"button",className:"btn-close",onClick:J})]}),e.jsxs("div",{className:"modal-body flex-grow-1",style:{overflowY:"auto",overflowX:"hidden",flex:"1 1 auto",minHeight:0},children:[e.jsxs("div",{className:"alert alert-danger",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),e.jsx("strong",{children:"Warning:"})," This action cannot be undone."]}),e.jsx("p",{children:"Are you sure you want to cancel this promo?"}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h6",{className:"card-title",children:(G=F.service)==null?void 0:G.name}),e.jsxs("p",{className:"card-text mb-1",children:[e.jsx("strong",{children:"Start Date:"})," ",F.start_date,e.jsx("br",{}),e.jsx("strong",{children:"End Date:"})," ",F.end_date,e.jsx("br",{}),e.jsx("strong",{children:"Discounted Price:"})," â‚±",Number(F.discounted_price).toFixed(2),e.jsx("br",{}),e.jsx("strong",{children:"Status:"})," ",le(F.status)]})]})})]}),e.jsxs("div",{className:"modal-footer flex-shrink-0",style:{position:"sticky",bottom:0,zIndex:1,backgroundColor:"#fff",borderTop:"1px solid #dee2e6"},children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:J,children:"Cancel"}),e.jsxs("button",{type:"button",className:"btn btn-warning",onClick:q,children:[e.jsx("i",{className:"bi bi-x-circle me-1"}),"Cancel Promo"]})]})]})})}),o&&e.jsx(Pe,{message:"Saving promo..."})]})})]})}const ya=async(s,i=20)=>{try{const a=await Fi(us),n=s.internal.pageSize.getWidth(),r=40,d=(n-r-200)/2;s.addImage(a,"PNG",d,i,r,r),s.setFontSize(18),s.setFont("helvetica","bold"),s.setTextColor(60,60,60);const l=d+r+10,h=i+r/2+6;return s.text("Kreative Dental & Orthodontics",l,h),s.setDrawColor(200,200,200),s.setLineWidth(.5),s.line(20,i+r+15,n-20,i+r+15),i+r+30}catch(a){console.error("Error adding clinic header to PDF:",a);const n=s.internal.pageSize.getWidth();s.setFontSize(18),s.setFont("helvetica","bold"),s.setTextColor(60,60,60);const r=s.getTextWidth("Kreative Dental & Orthodontics");return s.text("Kreative Dental & Orthodontics",(n-r)/2,i+20),s.setDrawColor(200,200,200),s.setLineWidth(.5),s.line(20,i+40,n-20,i+40),i+50}},Fi=s=>new Promise((i,a)=>{const n=new Image;n.crossOrigin="anonymous",n.onload=()=>{const r=document.createElement("canvas"),d=r.getContext("2d");r.width=n.width,r.height=n.height,d.drawImage(n,0,0);const l=r.toDataURL("image/png");i(l)},n.onerror=()=>a(new Error("Failed to load image")),n.src=s});function zi(){const s=new Date().getFullYear(),[i,a]=t.useState(s),[n,r]=t.useState([]),[d,l]=t.useState(!0);t.useEffect(()=>{h()},[i]);const h=async()=>{l(!0);try{const{data:g}=await z.get(`/api/discounts-archive?year=${i}`);r(g)}catch(g){console.error("Failed to load archive",g)}finally{l(!1)}},o=async()=>{const{default:g}=await Ae(async()=>{const{default:u}=await import("./pdf-vendor-BZobkf7J.js").then(j=>j.j);return{default:u}},[]),{default:p}=await Ae(async()=>{const{default:u}=await import("./pdf-vendor-BZobkf7J.js").then(j=>j.b);return{default:u}},[]),m=new g({orientation:"p",unit:"pt",format:"a4"}),y=m.internal.pageSize.width,N=m.internal.pageSize.height;m.setDrawColor(0,119,182),m.setLineWidth(2),m.rect(20,20,y-40,N-40),m.setDrawColor(200,200,200),m.setLineWidth(1),m.rect(30,30,y-60,N-60);let R=await ya(m,60);m.setFontSize(16),m.setFont("helvetica","bold"),m.setTextColor(0,119,182),m.text(`Promo Archive â€” ${i}`,y/2,R,{align:"center"}),R+=20,p(m,{startY:R,head:[["Service","Start","End","Price","Status","Activated"]],body:n.map(u=>{var j,b;return[((j=u.service)==null?void 0:j.name)||"-",u.start_date,u.end_date,`PHP ${Number(u.discounted_price).toFixed(2)}`,u.status.charAt(0).toUpperCase()+u.status.slice(1),((b=u.activated_at)==null?void 0:b.split("T")[0])||"-"]}),theme:"striped",margin:{left:40,right:40},styles:{fontSize:10,cellPadding:8},headStyles:{fillColor:[0,119,182],textColor:[255,255,255],fontStyle:"bold",fontSize:11}});const v=N-50;m.setDrawColor(200,200,200),m.setLineWidth(1),m.line(30,v,y-30,v),m.setFontSize(8),m.setFont("helvetica","normal"),m.setTextColor(150,150,150);const S=new Date().toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});m.text(`Generated on ${S}`,y/2,v+15,{align:"center"}),m.save(`promo-archive-${i}.pdf`)},x=g=>{switch(g){case"planned":return e.jsx("span",{className:"badge bg-secondary",children:"Planned"});case"launched":return e.jsx("span",{className:"badge bg-success",children:"Launched"});case"canceled":return e.jsx("span",{className:"badge bg-warning text-dark",children:"Canceled"});case"done":return e.jsx("span",{className:"badge bg-dark",children:"Done"});default:return e.jsx("span",{className:"badge bg-light text-dark",children:"Unknown"})}};return e.jsxs("div",{className:"promo-archive-page",style:{background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",minHeight:"100vh",width:"100vw",position:"relative",left:0,right:0,padding:"1.5rem 2rem",boxSizing:"border-box"},children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"m-0 fw-bold",style:{color:"#1e293b"},children:"ðŸ“ Promo Archive"}),e.jsx("p",{className:"text-muted mb-0 mt-1",children:"View and manage archived promotional campaigns"})]}),e.jsxs("div",{className:"d-flex gap-3 align-items-center",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label fw-semibold mb-1",children:"Filter by Year"}),e.jsx("select",{className:"form-control border-0 shadow-sm",style:{width:120,borderRadius:"12px",padding:"12px 16px",fontSize:"14px",fontWeight:"500"},value:i,onChange:g=>a(g.target.value),children:[...Array(s-2022)].map((g,p)=>{const m=s-p;return e.jsx("option",{value:m,children:m},m)})})]}),e.jsxs("button",{className:"btn border-0 shadow-sm",onClick:o,style:{background:"linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)",color:"white",borderRadius:"12px",padding:"12px 24px",fontWeight:"600",transition:"all 0.3s ease",marginTop:"24px"},children:[e.jsx("i",{className:"bi bi-download me-2"}),"Export PDF"]})]})]}),e.jsx("div",{className:"card border-0 shadow-sm",style:{borderRadius:"16px"},children:e.jsx("div",{className:"card-body p-0",children:d?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"400px"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"spinner-border text-primary mb-3",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"text-muted",children:"Loading archived promos..."})]})}):e.jsx("div",{className:"table-responsive",style:{width:"100%"},children:e.jsxs("table",{className:"table table-hover mb-0",style:{width:"100%",tableLayout:"fixed"},children:[e.jsxs("colgroup",{children:[e.jsx("col",{style:{width:"25%"}}),e.jsx("col",{style:{width:"12%"}}),e.jsx("col",{style:{width:"12%"}}),e.jsx("col",{style:{width:"15%"}}),e.jsx("col",{style:{width:"12%"}}),e.jsx("col",{style:{width:"24%"}})]}),e.jsx("thead",{className:"table-primary",children:e.jsxs("tr",{children:[e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-tag me-2"}),"Service Name"]}),e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-calendar-event me-2"}),"Start Date"]}),e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-calendar-x me-2"}),"End Date"]}),e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-currency-dollar me-2"}),"Discounted Price"]}),e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-activity me-2"}),"Status"]}),e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-clock-history me-2"}),"Date Activated"]})]})}),e.jsx("tbody",{children:n.length>0?n.map(g=>{var p,m;return e.jsxs("tr",{className:"align-middle",style:{height:"60px"},children:[e.jsx("td",{className:"px-4 py-3 fw-medium border-0",style:{fontSize:"1rem"},children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"bg-primary rounded-circle me-3 d-flex align-items-center justify-content-center",style:{width:"40px",height:"40px",fontSize:"1.2rem"},children:"ðŸ¦·"}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-bold text-dark",children:((p=g.service)==null?void 0:p.name)||"-"}),e.jsx("small",{className:"text-muted",children:"Dental Service"})]})]})}),e.jsx("td",{className:"px-4 py-3 border-0",style:{fontSize:"1rem"},children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("span",{className:"fw-semibold text-dark",children:g.start_date}),e.jsx("small",{className:"text-muted",children:"Campaign Start"})]})}),e.jsx("td",{className:"px-4 py-3 border-0",style:{fontSize:"1rem"},children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("span",{className:"fw-semibold text-dark",children:g.end_date}),e.jsx("small",{className:"text-muted",children:"Campaign End"})]})}),e.jsx("td",{className:"px-4 py-3 border-0",style:{fontSize:"1rem"},children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsxs("span",{className:"fw-bold text-success fs-5",children:["â‚±",Number(g.discounted_price).toFixed(2)]}),e.jsx("small",{className:"text-muted",children:"Promotional Price"})]})}),e.jsx("td",{className:"px-4 py-3 border-0",style:{fontSize:"1rem"},children:e.jsxs("div",{className:"d-flex flex-column align-items-start",children:[x(g.status),e.jsx("small",{className:"text-muted mt-1",children:"Current State"})]})}),e.jsx("td",{className:"px-4 py-3 text-muted border-0",style:{fontSize:"1rem"},children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("span",{className:"fw-semibold text-dark",children:((m=g.activated_at)==null?void 0:m.split("T")[0])||"-"}),e.jsx("small",{className:"text-muted",children:g.activated_at?"Launch Date":"Not Activated"})]})})]},g.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center text-muted border-0",style:{height:"400px"},children:e.jsxs("div",{className:"d-flex flex-column align-items-center justify-content-center py-5",children:[e.jsx("div",{className:"bg-light rounded-circle mb-4 d-flex align-items-center justify-content-center",style:{width:"120px",height:"120px",fontSize:"3rem"},children:"ðŸ“"}),e.jsxs("h3",{className:"text-muted mb-3",children:["No promos found for ",i]}),e.jsx("p",{className:"text-muted mb-4 fs-5",children:"This year doesn't have any promotional campaigns yet."}),e.jsxs("button",{className:"btn btn-outline-secondary",children:[e.jsx("i",{className:"bi bi-calendar me-2"}),"Try Different Year"]})]})})})})]})})})})]})}function wa(){const[s,i]=t.useState([]),[a,n]=t.useState(!0),[r,d]=t.useState(!1),[l,h]=t.useState(""),[o,x]=t.useState(!0),[g,p]=t.useState(""),[m,y]=t.useState(""),[N,R]=t.useState(""),[v,S]=t.useState(null),[u,j]=t.useState(!1),[b,C]=t.useState(null),[f,D]=t.useState(!1),[L,I]=t.useState(null);t.useEffect(()=>{w()},[]);const w=async()=>{try{const P=await z.get("/api/clinic-calendar");i(P.data)}catch(P){console.error("Failed to fetch clinic calendar",P)}finally{n(!1)}};t.useEffect(()=>{(async()=>{if(l)try{const k=await z.get("/api/clinic-calendar/resolve",{params:{date:l}}),{source:E,data:O}=k.data;E==="override"?(S(O),x(!!O.is_open),p(O.open_time??""),y(O.close_time??""),R(O.note??""),K("âš ï¸ This date already has an override. You are editing it.",{icon:"âš ï¸"})):(S(null),x(!!O.is_open),p(O.open_time??""),y(O.close_time??""),R(O.note??""))}catch{console.warn("Resolve not available; continuing without it.")}})()},[l]);const A=async P=>{P.preventDefault();try{const k={date:l,is_open:o,open_time:o?F(g):null,close_time:o?F(m):null,note:N||null};v?await z.put(`/api/clinic-calendar/${v.id}`,k):await z.post("/api/clinic-calendar",k),d(!1),h(""),x(!0),p(""),y(""),R(""),S(null),w()}catch(k){console.error("Failed to add/update entry",k),K.error("Failed to save entry. Maybe the date already exists?")}},_=P=>{C({...P,open_time:P.open_time??"",close_time:P.close_time??""}),j(!0)},H=async P=>{P.preventDefault();try{await z.put(`/api/clinic-calendar/${b.id}`,{is_open:!!b.is_open,open_time:b.is_open?F(b.open_time):null,close_time:b.is_open?F(b.close_time):null,note:b.note||null}),j(!1),C(null),w()}catch(k){console.error("Failed to update entry",k),K.error("Update failed.")}},T=P=>{I(P),D(!0)},c=async()=>{try{await z.delete(`/api/clinic-calendar/${L.id}`),D(!1),I(null),w()}catch(P){console.error("Failed to delete entry",P),K.error("Deletion failed.")}},F=P=>P?String(P).slice(0,5):null;return e.jsxs("div",{className:"clinic-calendar-manager-page",style:{width:"100%",maxWidth:"100%",padding:"0",boxSizing:"border-box"},children:[e.jsxs("div",{className:"d-flex flex-column flex-lg-row justify-content-between align-items-start align-items-lg-center mb-4 gap-3",style:{width:"100%",maxWidth:"100%"},children:[e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("h2",{className:"m-0 fw-bold",style:{color:"#1e293b"},children:"ðŸ“… Clinic Calendar Manager"}),e.jsx("p",{className:"text-muted mb-0 mt-1",children:"Manage clinic operating hours and special dates"})]}),e.jsxs("button",{className:"btn border-0 shadow-sm flex-shrink-0",onClick:()=>d(!0),style:{background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",color:"#1e293b",border:"1px solid #e2e8f0",borderRadius:"12px",padding:"12px 24px",fontWeight:"600",transition:"all 0.3s ease"},children:[e.jsx("i",{className:"bi bi-plus-circle me-2"}),"Add Entry"]})]}),e.jsx("div",{className:"card border-0 shadow-sm",style:{borderRadius:"16px",width:"100%",maxWidth:"100%"},children:e.jsx("div",{className:"card-body p-0",style:{width:"100%",maxWidth:"100%"},children:a?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"400px"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"spinner-border text-primary mb-3",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"text-muted",children:"Loading calendar entries..."})]})}):e.jsx("div",{className:"table-responsive",style:{width:"100%",maxWidth:"100%",margin:0},children:e.jsxs("table",{className:"table table-hover mb-0",style:{width:"100%",maxWidth:"100%",margin:0,tableLayout:"fixed"},children:[e.jsx("thead",{className:"table-primary",children:e.jsxs("tr",{children:[e.jsxs("th",{className:"fw-semibold px-3 py-3 border-0",style:{fontSize:"1.1rem",width:"18%"},children:[e.jsx("i",{className:"bi bi-calendar-date me-2"}),"Date"]}),e.jsxs("th",{className:"fw-semibold px-3 py-3 border-0",style:{fontSize:"1.1rem",width:"12%"},children:[e.jsx("i",{className:"bi bi-toggle-on me-2"}),"Status"]}),e.jsxs("th",{className:"fw-semibold px-3 py-3 border-0",style:{fontSize:"1.1rem",width:"15%"},children:[e.jsx("i",{className:"bi bi-clock me-2"}),"Opening"]}),e.jsxs("th",{className:"fw-semibold px-3 py-3 border-0",style:{fontSize:"1.1rem",width:"15%"},children:[e.jsx("i",{className:"bi bi-clock-history me-2"}),"Closing"]}),e.jsxs("th",{className:"fw-semibold px-3 py-3 border-0",style:{fontSize:"1.1rem",width:"25%"},children:[e.jsx("i",{className:"bi bi-chat-text me-2"}),"Note"]}),e.jsxs("th",{className:"fw-semibold px-3 py-3 border-0 text-center",style:{fontSize:"1.1rem",width:"15%"},children:[e.jsx("i",{className:"bi bi-gear me-2"}),"Actions"]})]})}),e.jsx("tbody",{children:s.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center text-muted border-0",style:{height:"400px"},children:e.jsxs("div",{className:"d-flex flex-column align-items-center justify-content-center py-5",children:[e.jsx("div",{className:"bg-light rounded-circle mb-4 d-flex align-items-center justify-content-center",style:{width:"120px",height:"120px",fontSize:"3rem"},children:"ðŸ“…"}),e.jsx("h3",{className:"text-muted mb-3",children:"No calendar entries"}),e.jsx("p",{className:"text-muted mb-4 fs-5",children:"Start by adding your first calendar entry."}),e.jsxs("button",{className:"btn border-0 shadow-sm",onClick:()=>d(!0),style:{background:"linear-gradient(135deg, #0d6efd 0%, #0b5ed7 100%)",color:"white",borderRadius:"12px",padding:"12px 24px",fontWeight:"600",transition:"all 0.3s ease"},children:[e.jsx("i",{className:"bi bi-plus-circle me-2"}),"Add First Entry"]})]})})}):s.map(P=>{var k,E;return e.jsxs("tr",{className:"align-middle",style:{height:"60px"},children:[e.jsx("td",{className:"px-3 py-3 fw-medium border-0",style:{fontSize:"1rem"},children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"bg-primary rounded-circle me-2 d-flex align-items-center justify-content-center",style:{width:"32px",height:"32px",fontSize:"1rem"},children:"ðŸ“…"}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-bold text-dark",children:new Date(P.date).toLocaleDateString()}),e.jsx("small",{className:"text-muted",children:"Calendar Date"})]})]})}),e.jsx("td",{className:"px-3 py-3 border-0",style:{fontSize:"1rem"},children:e.jsxs("div",{className:"d-flex flex-column align-items-start",children:[P.is_open?e.jsx("span",{className:"badge bg-success",children:"âœ… Open"}):e.jsx("span",{className:"badge bg-danger",children:"âŒ Closed"}),e.jsx("small",{className:"text-muted mt-1",children:"Operating Status"})]})}),e.jsx("td",{className:"px-3 py-3 border-0",style:{fontSize:"1rem"},children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("span",{className:"fw-semibold text-dark",children:((k=P.open_time)==null?void 0:k.slice(0,5))||"â€”"}),e.jsx("small",{className:"text-muted",children:"Opening Time"})]})}),e.jsx("td",{className:"px-3 py-3 border-0",style:{fontSize:"1rem"},children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("span",{className:"fw-semibold text-dark",children:((E=P.close_time)==null?void 0:E.slice(0,5))||"â€”"}),e.jsx("small",{className:"text-muted",children:"Closing Time"})]})}),e.jsx("td",{className:"px-3 py-3 border-0",style:{fontSize:"1rem"},children:e.jsx("div",{className:"text-truncate",title:P.note||"â€”",children:P.note||"â€”"})}),e.jsx("td",{className:"px-3 py-3 border-0 text-center",style:{fontSize:"1rem"},children:e.jsxs("div",{className:"btn-group",role:"group",children:[e.jsx("button",{className:"btn btn-sm btn-warning me-1",onClick:()=>_(P),style:{borderRadius:"8px"},title:"Edit entry",children:e.jsx("i",{className:"bi bi-pencil"})}),e.jsx("button",{className:"btn btn-sm btn-danger",onClick:()=>T(P),style:{borderRadius:"8px"},title:"Delete entry",children:e.jsx("i",{className:"bi bi-trash"})})]})})]},P.id)})})]})})})}),r&&e.jsx("div",{className:"modal fade show d-block",tabIndex:"-1",style:{background:"rgba(0,0,0,0.5)",zIndex:1055},children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",children:e.jsxs("div",{className:"modal-content border-0 shadow",style:{borderRadius:"16px"},children:[e.jsxs("div",{className:"modal-header bg-primary text-white border-0",style:{borderRadius:"16px 16px 0 0"},children:[e.jsxs("h5",{className:"modal-title fw-semibold",children:[e.jsx("i",{className:"bi bi-plus-circle me-2"}),"Add Clinic Calendar Entry"]}),e.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>d(!1)})]}),e.jsx("div",{className:"modal-body p-4",children:e.jsxs("form",{onSubmit:A,children:[e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-12",children:[e.jsxs("label",{className:"form-label fw-semibold",children:[e.jsx("i",{className:"bi bi-calendar-date me-1"}),"Date"]}),e.jsx("input",{type:"date",className:"form-control border-0 shadow-sm",style:{borderRadius:"12px",padding:"12px 16px"},required:!0,value:l,onChange:P=>h(P.target.value),disabled:!!v})]}),e.jsxs("div",{className:"col-12",children:[e.jsxs("label",{className:"form-label fw-semibold",children:[e.jsx("i",{className:"bi bi-toggle-on me-1"}),"Open Status"]}),e.jsxs("select",{className:"form-select border-0 shadow-sm",style:{borderRadius:"12px",padding:"12px 16px"},value:o?"true":"false",onChange:P=>x(P.target.value==="true"),children:[e.jsx("option",{value:"true",children:"Open"}),e.jsx("option",{value:"false",children:"Closed"})]})]}),e.jsxs("div",{className:"col-12 col-md-6",children:[e.jsxs("label",{className:"form-label fw-semibold",children:[e.jsx("i",{className:"bi bi-clock me-1"}),"Opening Time"]}),e.jsx("input",{type:"time",className:"form-control border-0 shadow-sm",style:{borderRadius:"12px",padding:"12px 16px"},value:g,onChange:P=>p(P.target.value),required:o})]}),e.jsxs("div",{className:"col-12 col-md-6",children:[e.jsxs("label",{className:"form-label fw-semibold",children:[e.jsx("i",{className:"bi bi-clock-history me-1"}),"Closing Time"]}),e.jsx("input",{type:"time",className:"form-control border-0 shadow-sm",style:{borderRadius:"12px",padding:"12px 16px"},value:m,onChange:P=>y(P.target.value),required:o})]}),e.jsxs("div",{className:"col-12",children:[e.jsxs("label",{className:"form-label fw-semibold",children:[e.jsx("i",{className:"bi bi-chat-text me-1"}),"Note"]}),e.jsx("input",{type:"text",className:"form-control border-0 shadow-sm",style:{borderRadius:"12px",padding:"12px 16px"},value:N,onChange:P=>R(P.target.value),placeholder:"Optional note about this date"})]})]}),e.jsxs("div",{className:"d-flex justify-content-end gap-2 mt-4",children:[e.jsx("button",{type:"button",className:"btn border-0 shadow-sm",style:{background:"linear-gradient(135deg, #6c757d 0%, #495057 100%)",color:"white",borderRadius:"12px",padding:"12px 24px",fontWeight:"600",transition:"all 0.3s ease"},onClick:()=>{d(!1),h(""),x(!0),p(""),y(""),R(""),S(null)},children:"Cancel"}),e.jsxs("button",{type:"submit",className:"btn border-0 shadow-sm",style:{background:"linear-gradient(135deg, #0d6efd 0%, #0b5ed7 100%)",color:"white",borderRadius:"12px",padding:"12px 24px",fontWeight:"600",transition:"all 0.3s ease"},children:[e.jsx("i",{className:"bi bi-check-circle me-2"}),"Save Entry"]})]})]})})]})})}),u&&b&&e.jsx("div",{className:"modal fade show d-block",tabIndex:"-1",style:{background:"rgba(0,0,0,0.5)",zIndex:1055},children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",children:e.jsxs("div",{className:"modal-content border-0 shadow",style:{borderRadius:"16px"},children:[e.jsxs("div",{className:"modal-header bg-warning text-dark border-0",style:{borderRadius:"16px 16px 0 0"},children:[e.jsxs("h5",{className:"modal-title fw-semibold",children:[e.jsx("i",{className:"bi bi-pencil-square me-2"}),"Edit Clinic Calendar Entry"]}),e.jsx("button",{type:"button",className:"btn-close",onClick:()=>j(!1)})]}),e.jsx("div",{className:"modal-body p-4",children:e.jsxs("form",{onSubmit:H,children:[e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-12",children:[e.jsxs("label",{className:"form-label fw-semibold",children:[e.jsx("i",{className:"bi bi-calendar-date me-1"}),"Date"]}),e.jsx("input",{type:"date",className:"form-control border-0 shadow-sm",style:{borderRadius:"12px",padding:"12px 16px"},value:b.date.slice(0,10),disabled:!0})]}),e.jsxs("div",{className:"col-12",children:[e.jsxs("label",{className:"form-label fw-semibold",children:[e.jsx("i",{className:"bi bi-toggle-on me-1"}),"Open Status"]}),e.jsxs("select",{className:"form-select border-0 shadow-sm",style:{borderRadius:"12px",padding:"12px 16px"},value:b.is_open?"true":"false",onChange:P=>C({...b,is_open:P.target.value==="true"}),children:[e.jsx("option",{value:"true",children:"Open"}),e.jsx("option",{value:"false",children:"Closed"})]})]}),e.jsxs("div",{className:"col-12 col-md-6",children:[e.jsxs("label",{className:"form-label fw-semibold",children:[e.jsx("i",{className:"bi bi-clock me-1"}),"Opening Time"]}),e.jsx("input",{type:"time",className:"form-control border-0 shadow-sm",style:{borderRadius:"12px",padding:"12px 16px"},value:b.open_time||"",onChange:P=>C({...b,open_time:P.target.value}),disabled:!b.is_open})]}),e.jsxs("div",{className:"col-12 col-md-6",children:[e.jsxs("label",{className:"form-label fw-semibold",children:[e.jsx("i",{className:"bi bi-clock-history me-1"}),"Closing Time"]}),e.jsx("input",{type:"time",className:"form-control border-0 shadow-sm",style:{borderRadius:"12px",padding:"12px 16px"},value:b.close_time||"",onChange:P=>C({...b,close_time:P.target.value}),disabled:!b.is_open})]}),e.jsxs("div",{className:"col-12",children:[e.jsxs("label",{className:"form-label fw-semibold",children:[e.jsx("i",{className:"bi bi-chat-text me-1"}),"Note"]}),e.jsx("input",{type:"text",className:"form-control border-0 shadow-sm",style:{borderRadius:"12px",padding:"12px 16px"},value:b.note||"",onChange:P=>C({...b,note:P.target.value}),placeholder:"Optional note about this date"})]})]}),e.jsxs("div",{className:"d-flex justify-content-end gap-2 mt-4",children:[e.jsx("button",{type:"button",className:"btn border-0 shadow-sm",style:{background:"linear-gradient(135deg, #6c757d 0%, #495057 100%)",color:"white",borderRadius:"12px",padding:"12px 24px",fontWeight:"600",transition:"all 0.3s ease"},onClick:()=>j(!1),children:"Cancel"}),e.jsxs("button",{type:"submit",className:"btn border-0 shadow-sm",style:{background:"linear-gradient(135deg, #ffc107 0%, #e0a800 100%)",color:"white",borderRadius:"12px",padding:"12px 24px",fontWeight:"600",transition:"all 0.3s ease"},children:[e.jsx("i",{className:"bi bi-check-circle me-2"}),"Update Entry"]})]})]})})]})})}),f&&L&&e.jsx("div",{className:"modal fade show d-block",tabIndex:"-1",style:{background:"rgba(0,0,0,0.5)",zIndex:1055},children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",children:e.jsxs("div",{className:"modal-content border-0 shadow",style:{borderRadius:"16px"},children:[e.jsxs("div",{className:"modal-header bg-danger text-white border-0",style:{borderRadius:"16px 16px 0 0"},children:[e.jsxs("h5",{className:"modal-title fw-semibold",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),"Confirm Deletion"]}),e.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>D(!1)})]}),e.jsxs("div",{className:"modal-body p-4",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("div",{className:"bg-danger rounded-circle mx-auto mb-3 d-flex align-items-center justify-content-center",style:{width:"80px",height:"80px",fontSize:"2rem"},children:e.jsx("i",{className:"bi bi-trash text-white"})}),e.jsx("h5",{className:"fw-bold",children:"Are you sure?"}),e.jsxs("p",{className:"text-muted",children:["You are about to delete the calendar entry for ",e.jsx("strong",{children:L.date.slice(0,10)}),"."]}),e.jsx("p",{className:"text-danger fw-semibold",children:"This action cannot be undone."})]}),e.jsxs("div",{className:"d-flex justify-content-center gap-2",children:[e.jsx("button",{className:"btn border-0 shadow-sm",style:{background:"linear-gradient(135deg, #6c757d 0%, #495057 100%)",color:"white",borderRadius:"12px",padding:"12px 24px",fontWeight:"600",transition:"all 0.3s ease"},onClick:()=>D(!1),children:"Cancel"}),e.jsxs("button",{className:"btn border-0 shadow-sm",style:{background:"linear-gradient(135deg, #dc3545 0%, #b02a37 100%)",color:"white",borderRadius:"12px",padding:"12px 24px",fontWeight:"600",transition:"all 0.3s ease"},onClick:c,children:[e.jsx("i",{className:"bi bi-trash me-2"}),"Delete Entry"]})]})]})]})})})]})}const za=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];function rt(){const[s,i]=t.useState([]),[a,n]=t.useState(null),[r,d]=t.useState([]);t.useEffect(()=>{l()},[]);const l=async()=>{try{const m=await z.get("/api/weekly-schedule");i(m.data),d(m.data)}catch(m){console.error("Failed to load weekly schedule",m)}},h=m=>({id:m.id,is_open:!!m.is_open,open_time:m.is_open&&m.open_time||"",close_time:m.is_open&&m.close_time||"",note:(m.note||"").trim()}),o=(m,y)=>{if(!y)return!0;const N=h(m),R=h(y);return N.is_open!==R.is_open||N.open_time!==R.open_time||N.close_time!==R.close_time||N.note!==R.note},x=t.useMemo(()=>{const m={};for(const y of r)m[y.id]=y;return m},[r]),g=(m,y,N)=>{i(R=>R.map(v=>{if(v.id!==m)return v;if(y==="is_open"){const S=N;return{...v,is_open:S,open_time:S?v.open_time||"08:00":"",close_time:S?v.close_time||"17:00":""}}return{...v,[y]:N}}))},p=async m=>{var N,R;const y=s.find(v=>v.id===m);n(m);try{await z.patch(`/api/weekly-schedule/${m}`,{is_open:!!y.is_open,open_time:y.is_open?y.open_time:null,close_time:y.is_open?y.close_time:null,note:y.note??null}),K.success(`${za[y.weekday]} saved.`,{style:{background:"#28a745",color:"#fff",borderRadius:"8px",padding:"16px",fontSize:"16px",fontWeight:"500",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)"},iconTheme:{primary:"#fff",secondary:"#28a745"}}),d(v=>v.map(S=>S.id===m?h(y):S))}catch(v){console.error("Failed to save",v);const S=((R=(N=v.response)==null?void 0:N.data)==null?void 0:R.message)||"Save failed. See console.";K.error(S,{style:{background:"#dc3545",color:"#fff",borderRadius:"8px",padding:"16px",fontSize:"16px",fontWeight:"500",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)"},iconTheme:{primary:"#fff",secondary:"#dc3545"}})}finally{n(null)}};return e.jsxs(e.Fragment,{children:[e.jsx(ss,{position:"top-center",toastOptions:{duration:4e3,style:{borderRadius:"8px",padding:"16px",fontSize:"16px",fontWeight:"500",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)"},error:{style:{background:"#dc3545",color:"#fff"},iconTheme:{primary:"#fff",secondary:"#dc3545"}},success:{style:{background:"#28a745",color:"#fff"},iconTheme:{primary:"#fff",secondary:"#28a745"}}}}),e.jsxs("div",{className:"weekly-schedule-page",style:{width:"100%",maxWidth:"100%",padding:"0",boxSizing:"border-box"},children:[e.jsx("div",{className:"d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4 gap-3",children:e.jsxs("div",{children:[e.jsxs("h2",{className:"m-0 fw-bold",style:{color:"#1e293b"},children:[e.jsx("i",{className:"bi bi-calendar-week me-2"}),"Weekly Default Schedule"]}),e.jsx("p",{className:"text-muted mb-0 mt-1",children:"Configure clinic operating hours and availability for each day of the week"})]})}),e.jsx("div",{className:"row g-2 g-md-3 g-lg-4 m-0",children:e.jsx("div",{className:"col-12 p-0",children:e.jsxs("div",{className:"card border-0 shadow-sm",style:{background:"linear-gradient(135deg, #ffffff 0%, #f8fafc 100%)",borderRadius:"16px",width:"100%",maxWidth:"100%"},children:[e.jsx("div",{className:"card-header bg-transparent border-0 p-4 pb-0",children:e.jsxs("h5",{className:"card-title mb-0 fw-bold",style:{color:"#1e293b"},children:[e.jsx("i",{className:"bi bi-clock me-2"}),"Operating Hours Configuration"]})}),e.jsxs("div",{className:"card-body p-4",style:{width:"100%",maxWidth:"100%"},children:[e.jsx("div",{className:"table-responsive",style:{width:"100%",maxWidth:"100%"},children:e.jsxs("table",{className:"table table-hover align-middle mb-0",children:[e.jsx("thead",{className:"table-primary",children:e.jsxs("tr",{children:[e.jsxs("th",{className:"fw-semibold px-3 px-md-4 py-3 border-0",style:{fontSize:"1.1rem",minWidth:"140px"},children:[e.jsx("i",{className:"bi bi-calendar-day me-2"}),"Day"]}),e.jsxs("th",{className:"fw-semibold px-3 px-md-4 py-3 border-0",style:{fontSize:"1.1rem",minWidth:"120px"},children:[e.jsx("i",{className:"bi bi-power me-2"}),"Status"]}),e.jsxs("th",{className:"fw-semibold px-3 px-md-4 py-3 border-0",style:{fontSize:"1.1rem",minWidth:"120px"},children:[e.jsx("i",{className:"bi bi-sunrise me-2"}),"Opening"]}),e.jsxs("th",{className:"fw-semibold px-3 px-md-4 py-3 border-0",style:{fontSize:"1.1rem",minWidth:"120px"},children:[e.jsx("i",{className:"bi bi-sunset me-2"}),"Closing"]}),e.jsxs("th",{className:"fw-semibold px-3 px-md-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-chat-text me-2"}),"Note"]}),e.jsxs("th",{className:"fw-semibold px-3 px-md-4 py-3 border-0",style:{fontSize:"1.1rem",minWidth:"110px"},children:[e.jsx("i",{className:"bi bi-gear me-2"}),"Action"]})]})}),e.jsx("tbody",{children:s.map(m=>e.jsxs("tr",{className:"align-middle",style:{height:"60px"},children:[e.jsx("td",{className:"px-3 px-md-4 py-3 fw-medium border-0",style:{fontSize:"1rem"},children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"bg-primary rounded-circle me-3 d-flex align-items-center justify-content-center",style:{width:"40px",height:"40px",fontSize:"1.2rem"},children:"ðŸ“…"}),e.jsx("div",{children:e.jsx("div",{className:"fw-bold text-dark",children:za[m.weekday]})})]})}),e.jsx("td",{className:"px-3 px-md-4 py-3 border-0",style:{fontSize:"1rem"},children:e.jsxs("select",{className:"form-select border-0 shadow-sm",style:{borderRadius:"8px",padding:"8px 12px"},value:m.is_open?"true":"false",onChange:y=>g(m.id,"is_open",y.target.value==="true"),children:[e.jsx("option",{value:"true",children:"Open"}),e.jsx("option",{value:"false",children:"Closed"})]})}),e.jsx("td",{className:"px-3 px-md-4 py-3 border-0",style:{fontSize:"1rem"},children:m.is_open?e.jsx("input",{type:"time",className:"form-control border-0 shadow-sm",style:{borderRadius:"8px",padding:"8px 12px"},value:m.open_time||"",onChange:y=>g(m.id,"open_time",y.target.value)}):e.jsx("input",{className:"form-control border-0 shadow-sm",disabled:!0,placeholder:"â€”",style:{borderRadius:"8px",padding:"8px 12px"}})}),e.jsx("td",{className:"px-3 px-md-4 py-3 border-0",style:{fontSize:"1rem"},children:m.is_open?e.jsx("input",{type:"time",className:"form-control border-0 shadow-sm",style:{borderRadius:"8px",padding:"8px 12px"},value:m.close_time||"",onChange:y=>g(m.id,"close_time",y.target.value)}):e.jsx("input",{className:"form-control border-0 shadow-sm",disabled:!0,placeholder:"â€”",style:{borderRadius:"8px",padding:"8px 12px"}})}),e.jsx("td",{className:"px-3 px-md-4 py-3 border-0",style:{fontSize:"1rem"},children:e.jsx("input",{type:"text",className:"form-control border-0 shadow-sm",style:{borderRadius:"8px",padding:"8px 12px"},value:m.note||"",onChange:y=>g(m.id,"note",y.target.value),placeholder:"Optional note"})}),e.jsx("td",{className:"px-3 px-md-4 py-3 border-0",children:e.jsx("button",{className:"btn btn-sm border-0 shadow-sm",onClick:()=>p(m.id),disabled:a===m.id||!o(m,x[m.id]),style:{background:a===m.id?"linear-gradient(135deg, #6b7280 0%, #4b5563 100%)":"linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)",color:"white",borderRadius:"8px",padding:"8px 16px",fontWeight:"600",transition:"all 0.3s ease"},children:a===m.id?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-check-lg me-1"}),"Save"]})})})]},m.id))})]})}),e.jsx("div",{className:"mt-4 p-3 bg-light rounded-3",children:e.jsxs("div",{className:"d-flex align-items-start",children:[e.jsx("div",{className:"me-3",children:e.jsx("i",{className:"bi bi-info-circle text-primary",style:{fontSize:"1.2rem"}})}),e.jsxs("div",{children:[e.jsx("h6",{className:"fw-semibold mb-2 text-dark",children:"Important Notes"}),e.jsxs("p",{className:"text-muted mb-0 small",children:[e.jsx("strong",{children:"Dentist headcount and per-slot capacity"})," are managed separately in the"," ",e.jsx("strong",{children:"ðŸ“Š Capacity (14 days)"})," section and by individual dentist schedulesâ€”not in this weekly configuration."]})]})]})})]})]})})})]})]})}const Ti=()=>new Date().toISOString().slice(0,10),Ei=s=>{if(!s)return"";const i=String(s);return i.includes("T")?i.split("T")[0]:i.slice(0,10)};function ct(){const[s,i]=t.useState([]),[a,n]=t.useState([]),[r,d]=t.useState(!0),[l,h]=t.useState(!1),[o,x]=t.useState(""),g=t.useMemo(()=>Ti(),[]),p=14;t.useEffect(()=>{(async()=>{var j,b;d(!0),x("");try{const C=await z.get("/api/clinic-calendar/daily",{params:{from:g,days:p}}),D=(Array.isArray(C.data)?C.data:[]).map(L=>({date:Ei(L.date),active_dentists:Number.isFinite(+L.active_dentists)?+L.active_dentists:0,max_parallel:L.max_parallel===null||L.max_parallel===void 0?"":String(L.max_parallel),is_closed:!!L.is_closed,note:L.note??""}));i(D),n(D)}catch(C){console.error(C),x(((b=(j=C==null?void 0:C.response)==null?void 0:j.data)==null?void 0:b.message)||"Failed to load capacity.")}finally{d(!1)}})()},[g]);const m=(u,j)=>i(b=>b.map((C,f)=>f===u?{...C,...j}:C)),y=(u,j)=>j?u.is_closed!==j.is_closed||(u.max_parallel??"")!==(j.max_parallel??"")||(u.note??"")!==(j.note??""):!0,N=async(u,j)=>{var C,f;if(!y(u,j))return;u.is_closed!==j.is_closed&&await z.put(`/api/clinic-calendar/${u.date}/closure`,{closed:u.is_closed,message:((C=u.note)==null?void 0:C.trim())||null}),u.is_closed||await z.put(`/api/clinic-calendar/day/${u.date}`,{max_parallel:u.max_parallel===""||u.max_parallel===null?null:Number(u.max_parallel),note:((f=u.note)==null?void 0:f.trim())||null})},R=async()=>{var u,j;h(!0),x("");try{const b=Object.fromEntries(a.map(C=>[C.date,C]));await Promise.all(s.map(C=>N(C,b[C.date]))),K.success("Changes saved."),n(s)}catch(b){console.error(b),x(((j=(u=b==null?void 0:b.response)==null?void 0:u.data)==null?void 0:j.message)||"Save failed.")}finally{h(!1)}},v=t.useMemo(()=>{if(!s.length)return!1;const u=Object.fromEntries(a.map(j=>[j.date,j]));return s.some(j=>y(j,u[j.date]))},[s,a]),S=t.useMemo(()=>s.some(u=>!u.is_closed&&u.max_parallel!==""&&Number(u.max_parallel)>Number(u.active_dentists)),[s]);return e.jsxs("div",{className:"p-2",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("h3",{className:"m-0",children:"ðŸ“Š Capacity (next 14 days)"}),e.jsx("button",{className:"btn btn-dark",disabled:l||r||!v||S,onClick:R,title:S?"Fix rows where max sameâ€‘time appts exceeds active dentists.":v?void 0:"No changes to save.",children:l?"Savingâ€¦":"Save All"})]}),o&&e.jsx("div",{className:"alert alert-danger py-2",role:"alert",children:o}),r?e.jsx("div",{children:"Loadingâ€¦"}):e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-sm table-bordered align-middle",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{style:{minWidth:115},children:"Date"}),e.jsx("th",{children:"Weekday"}),e.jsx("th",{className:"text-center",children:"Active Dentists"}),e.jsx("th",{style:{minWidth:180},children:"Max sameâ€‘time appts"}),e.jsx("th",{className:"text-center",style:{minWidth:120},children:"Status"}),e.jsx("th",{children:"Note / Reason"}),e.jsx("th",{className:"text-center",children:"Effective capacity"})]})}),e.jsxs("tbody",{children:[s.map((u,j)=>{const b=new Date(u.date).toLocaleDateString(void 0,{weekday:"short"}),C=Number.isFinite(+u.active_dentists)?+u.active_dentists:0,f=u.max_parallel===""||u.max_parallel===null?1/0:Math.max(0,Number(u.max_parallel)),D=u.is_closed?0:Math.min(C,f);return e.jsxs("tr",{children:[e.jsx("td",{className:"fw-medium",children:u.date}),e.jsx("td",{children:b}),e.jsx("td",{className:"text-center",children:C}),e.jsxs("td",{children:[e.jsx("input",{type:"number",min:0,className:"form-control form-control-sm",value:u.max_parallel,placeholder:`${C} (default)`,onChange:L=>m(j,{max_parallel:L.target.value}),disabled:u.is_closed,"aria-label":`Max same-time appts for ${u.date}`}),e.jsxs("div",{className:"form-text",children:["Leave blank to default to dayâ€™s active dentists (",C,")."]}),u.max_parallel!==""&&Number(u.max_parallel)>C&&!u.is_closed&&e.jsxs("small",{className:"text-danger",children:["Cap exceeds available dentists â€” effective capacity wonâ€™t exceed ",C,"."]})]}),e.jsx("td",{className:"text-center",children:e.jsxs("select",{className:"form-select form-select-sm",value:u.is_closed?"closed":"open",onChange:L=>m(j,{is_closed:L.target.value==="closed"}),"aria-label":`Status for ${u.date}`,children:[e.jsx("option",{value:"open",children:"Open"}),e.jsx("option",{value:"closed",children:"Closed"})]})}),e.jsx("td",{children:e.jsx("input",{className:"form-control form-control-sm",value:u.note,onChange:L=>m(j,{note:L.target.value}),placeholder:u.is_closed?"Reason for closure (shown to users)":"Optional note"})}),e.jsx("td",{className:"text-center",children:f===1/0?u.is_closed?0:C:D})]},u.date)}),s.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"text-center text-muted py-3",children:"No days found."})})]})]})})]})}function $i(){const[s,i]=t.useState("calendar"),a=({id:n,icon:r,label:d})=>e.jsxs("button",{className:`btn flex-fill flex-sm-grow-0 border-0 shadow-sm ${s===n?"":"btn-outline-primary"}`,onClick:()=>i(n),type:"button",style:{background:s===n?"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)":"transparent",color:s===n?"#1e293b":"#6b7280",border:s===n?"1px solid #e2e8f0":"1px solid #d1d5db",borderRadius:"8px",padding:"12px 16px",fontWeight:"600",transition:"all 0.3s ease",minWidth:"140px"},children:[e.jsx("i",{className:`bi bi-${r==="ðŸ“…"?"calendar":r==="ðŸ”"?"arrow-repeat":"bar-chart"} me-2`}),e.jsx("span",{className:"d-none d-sm-inline",children:d}),e.jsx("span",{className:"d-sm-none",children:d.split(" ")[0]})]});return e.jsx("div",{className:"schedule-manager-page",style:{background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",minHeight:"100vh",width:"100%",maxWidth:"100%",padding:"1.5rem",boxSizing:"border-box",overflow:"hidden"},children:e.jsx("div",{className:"row g-2 g-md-3 g-lg-4 m-0",children:e.jsx("div",{className:"col-12 p-0",children:e.jsxs("div",{className:"card border-0 shadow-sm",style:{background:"linear-gradient(135deg, #ffffff 0%, #f8fafc 100%)",borderRadius:"16px",width:"100%",maxWidth:"100%"},children:[e.jsxs("div",{className:"card-header border-0",style:{borderRadius:"16px 16px 0 0",background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",color:"#1e293b"},children:[e.jsxs("h2",{className:"card-title mb-0 fw-bold",style:{color:"#1e293b"},children:[e.jsx("i",{className:"bi bi-calendar3 me-2"}),"Clinic Schedule Management"]}),e.jsx("p",{className:"mb-0 mt-2",style:{color:"#6b7280"},children:"Comprehensive scheduling and capacity management system"})]}),e.jsxs("div",{className:"card-body p-4",style:{width:"100%",maxWidth:"100%"},children:[e.jsxs("div",{className:"d-flex flex-column flex-sm-row gap-2 mb-4",role:"group","aria-label":"Schedule tabs",children:[e.jsx(a,{id:"calendar",icon:"ðŸ“…",label:"Calendar Overrides"}),e.jsx(a,{id:"weekly",icon:"ðŸ”",label:"Weekly Defaults"}),e.jsx(a,{id:"capacity",icon:"ðŸ“Š",label:"Capacity (14 days)"})]}),e.jsxs("div",{className:"tab-content",style:{width:"100%",maxWidth:"100%"},children:[s==="calendar"&&e.jsx("div",{className:"tab-pane fade show active",style:{width:"100%",maxWidth:"100%"},children:e.jsx(wa,{})}),s==="weekly"&&e.jsx("div",{className:"tab-pane fade show active",style:{width:"100%",maxWidth:"100%"},children:e.jsx(rt,{})}),s==="capacity"&&e.jsx("div",{className:"tab-pane fade show active",style:{width:"100%",maxWidth:"100%"},children:e.jsx(ct,{})})]})]})]})})})})}pa.register(ba,fa,Qs,ga,Js,ja,va,Na,nt);function Ii(){var C,f;const[s,i]=t.useState(()=>new Date().toISOString().slice(0,7)),[a,n]=t.useState(!1),[r,d]=t.useState(""),[l,h]=t.useState({totals:{visits:0,inquiries:0},by_hour:[],by_service:[],by_visit_type:[]}),o=async()=>{var D,L;n(!0),d("");try{const I=await z.get("/api/reports/visits-monthly",{params:{month:s}});console.log("Monthly report API response:",I.data),h(I.data||{})}catch(I){console.error(I),d(((L=(D=I==null?void 0:I.response)==null?void 0:D.data)==null?void 0:L.message)||"Failed to load report.")}finally{n(!1)}};t.useEffect(()=>{o()},[s]);const x=t.useMemo(()=>{const D=new Map;for(let L=0;L<24;L++)D.set(L,0);return(l.by_hour||[]).forEach(L=>{const I=Number(L.hour)||0;D.set(I,(D.get(I)||0)+(Number(L.count)||0))}),Array.from(D.entries()).map(([L,I])=>({label:String(L).padStart(2,"0"),count:I}))},[l.by_hour]),g=t.useMemo(()=>{const D=(l.by_service||[]).map(L=>{var T,c,F;const I=Number(L.count)||0,w=Number(L.walkin||0),A=Number(L.appointment||0);let _=w,H=A;if(w===0&&A===0&&I>0){const P=((T=l==null?void 0:l.totals)==null?void 0:T.visits)||0,k=l.by_visit_type||[],E=((c=k.find(X=>X.visit_type==="walkin"))==null?void 0:c.count)||0,O=((F=k.find(X=>X.visit_type==="appointment"))==null?void 0:F.count)||0;if(P>0){const X=Number(E)/P,ee=Number(O)/P;_=Math.round(I*X),H=Math.round(I*ee),_+H!==I&&(H=I-_)}else _=Math.round(I*.6),H=I-_}return{label:L.service_name||"(Unspecified)",count:I,walkin:_,appointment:H}});return console.log("Processed byService data:",D),D},[l.by_service,l.by_visit_type,l.totals]),p=t.useMemo(()=>{const D=new Map;for(let L=0;L<24;L++)D.set(L,0);return(l.by_hour_avg_per_day||[]).forEach(L=>{const I=Number(L.hour)||0;D.set(I,Number(L.avg_per_day)||0)}),D},[l.by_hour_avg_per_day]),m=t.useMemo(()=>({labels:x.map(D=>D.label),datasets:[{label:"Total (month)",data:x.map(D=>D.count),backgroundColor:"rgba(25,135,84,0.85)",borderColor:"#198754",borderWidth:1,type:"bar",yAxisID:"y"},{label:"Avg per day",data:x.map(D=>Number(p.get(Number(D.label))||0)),borderColor:"#0d6efd",backgroundColor:"rgba(13,110,253,0.25)",borderWidth:2,pointRadius:2,tension:.3,type:"line",yAxisID:"y"}]}),[x,p]),y={color:"#fff",font:{weight:"bold"},formatter:D=>D>0?D:""},N=t.useMemo(()=>({responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,labels:{font:{size:11}}},tooltip:{enabled:!0},datalabels:{anchor:"end",align:"end",offset:2,font:{size:9},...y}},scales:{x:{title:{display:!0,text:"Hour of Day",font:{size:12}},ticks:{font:{size:11}}},y:{title:{display:!0,text:"Visits (total) / Avg per day",font:{size:12}},beginAtZero:!0,ticks:{precision:0,font:{size:11}}}}}),[]),R=t.useMemo(()=>({labels:g.map(D=>D.label),datasets:[{label:"Walk-in",data:g.map(D=>D.walkin),backgroundColor:"#0d6efd",borderColor:"#0d6efd",borderWidth:1},{label:"Appointment",data:g.map(D=>D.appointment),backgroundColor:"#6c757d",borderColor:"#6c757d",borderWidth:1}]}),[g]),v=t.useMemo(()=>({responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,labels:{font:{size:11}}},tooltip:{enabled:!0},datalabels:{anchor:"end",align:"end",offset:2,font:{size:9},...y}},scales:{x:{title:{display:!0,text:"Service",font:{size:12}},ticks:{autoSkip:!1,maxRotation:60,minRotation:30,font:{size:10}}},y:{title:{display:!0,text:"Visits",font:{size:12}},beginAtZero:!0,ticks:{precision:0,font:{size:11}}}}}),[]),S=t.useMemo(()=>{if(!x.length)return null;const D=x.reduce((I,w)=>I.count>w.count?I:w),L=x.reduce((I,w)=>I+w.count,0)/x.length;return{peakHour:Number(D.label),peakCount:D.count,avgPerHour:L}},[x]),u=t.useMemo(()=>{if(!g.length)return null;const D=g.reduce((A,_)=>A+_.count,0),L=g.reduce((A,_)=>A.count>_.count?A:_),I=D?L.count/D*100:null,w=L.walkin>L.appointment;return{topService:L.label,topCount:L.count,topShare:I,total:D,topWalkin:w}},[g]),j=async()=>{var D,L,I,w,A,_;try{const{default:H}=await Ae(async()=>{const{default:k}=await import("./pdf-vendor-BZobkf7J.js").then(E=>E.j);return{default:k}},[]),{default:T}=await Ae(async()=>{const{default:k}=await import("./pdf-vendor-BZobkf7J.js").then(E=>E.b);return{default:k}},[]),c=new H({orientation:"p",unit:"pt",format:"a4"}),F=(k,E,O)=>(k.setFontSize(12),k.setFont("helvetica","bold"),k.setTextColor(0,119,182),k.text(E,40,O),k.setTextColor(0,0,0),O+15);let P=await ya(c,20);if(c.setFontSize(14),c.text(`Monthly Visits Report â€” ${s}`,40,P),P+=30,P=F(c,"Overview",P),T(c,{startY:P,head:[["Metric","Value"]],body:[["Total Visits",String(((D=l==null?void 0:l.totals)==null?void 0:D.visits)??0)],["Inquiries This Month",String(((L=l==null?void 0:l.totals)==null?void 0:L.inquiries)??0)]],theme:"striped"}),P=F(c,"Hourly Visit Analysis",(((I=c.lastAutoTable)==null?void 0:I.finalY)||100)+20),T(c,{startY:P,head:[["Hour","Total (month)","Avg/day"]],body:(x||[]).map(k=>[k.label,String(k.count),String(Number(p.get(Number(k.label))||0).toFixed(2))]),theme:"grid",styles:{fontSize:9},headStyles:{fillColor:[25,135,84]}}),S&&T(c,{startY:(((w=c.lastAutoTable)==null?void 0:w.finalY)||100)+8,head:[["Insight"]],body:[[`On average, about ${S.avgPerHour.toFixed(1)} patients come per hour. The busiest time is ${S.peakHour}:00 (${S.peakCount} visits). More staff should be available at this time.`]],theme:"plain",styles:{fontSize:8,textColor:100,cellPadding:2},headStyles:{fontStyle:"bold",textColor:120},columnStyles:{0:{cellWidth:515}},margin:{left:40,right:40}}),P=F(c,"Service Usage Analysis",(((A=c.lastAutoTable)==null?void 0:A.finalY)||100)+20),T(c,{startY:P,head:[["Service","Walk-in","Appointment","Total"]],body:(g||[]).map(k=>[k.label,String(k.walkin),String(k.appointment),String(k.count)]),theme:"grid",styles:{fontSize:9},headStyles:{fillColor:[220,53,69]}}),u){const k=u.topShare!=null?`, ${u.topShare.toFixed(0)}% of total`:"";T(c,{startY:(((_=c.lastAutoTable)==null?void 0:_.finalY)||100)+8,head:[["Insight"]],body:[[`Most patients came for ${u.topService} (${u.topCount} visits${k}). Most were booked by ${u.topWalkin?"walk-in":"appointment"}.`]],theme:"plain",styles:{fontSize:8,textColor:100,cellPadding:2},headStyles:{fontStyle:"bold",textColor:120},columnStyles:{0:{cellWidth:515}},margin:{left:40,right:40}})}c.save(`visits-report-${s}.pdf`)}catch(H){console.error(H),K.error("Failed to generate PDF.")}},b=async()=>{var D,L,I;try{const{styleHeaderRow:w,styleDataRow:A,addWorksheetHeader:_,styleTotalRow:H,formatPercentage:T}=await Ae(async()=>{const{styleHeaderRow:ne,styleDataRow:re,addWorksheetHeader:W,styleTotalRow:$,formatPercentage:q}=await import("./excelStyling-eUgbKu7T.js");return{styleHeaderRow:ne,styleDataRow:re,addWorksheetHeader:W,styleTotalRow:$,formatPercentage:q}},[]),c=new qa.Workbook,F=c.addWorksheet("Overview");let P=_(F,"Monthly Visits Report",`Month: ${s}`);const k=F.addRow(["Metric","Value"]);if(w(k),[["Total Visits",((D=l==null?void 0:l.totals)==null?void 0:D.visits)??0],["Inquiries This Month",((L=l==null?void 0:l.totals)==null?void 0:L.inquiries)??0]].forEach((ne,re)=>{const W=F.addRow(ne);A(W,re)}),F.columns=[{width:20},{width:15}],(x==null?void 0:x.length)>0){const ne=c.addWorksheet("Hourly Analysis");P=_(ne,"Hourly Visit Analysis",`Month: ${s}`);const re=ne.addRow(["Hour","Visits","Walk-ins","Appointments"]);w(re),x.forEach((W,$)=>{const q=ne.addRow([W.label,W.count,W.walkin,W.appointment]);A(q,$)}),ne.columns=[{width:10},{width:12},{width:12},{width:15}]}if((g==null?void 0:g.length)>0){const ne=c.addWorksheet("Service Analysis");P=_(ne,"Service Analysis",`Month: ${s}`);const re=ne.addRow(["Service","Total Visits","Walk-ins","Appointments","Walk-in %","Appointment %"]);w(re),g.forEach((W,$)=>{const q=W.count||0,J=W.walkin||0,ie=W.appointment||0,B=q>0?Number((J/q*100).toFixed(1))/100:null,le=q>0?Number((ie/q*100).toFixed(1))/100:null,M=ne.addRow([W.label,q,J,ie,B,le]);A(M,$),B!==null&&T(M.getCell(5)),le!==null&&T(M.getCell(6))}),ne.columns=[{width:25},{width:15},{width:12},{width:15},{width:12},{width:15}]}if(((I=l==null?void 0:l.visits)==null?void 0:I.length)>0){const ne=c.addWorksheet("Visit Details");P=_(ne,"Detailed Visit Data",`Month: ${s}`);const re=ne.addRow(["Date","Time","Service","Type","Patient ID","Status"]);w(re),l.visits.forEach((W,$)=>{const q=ne.addRow([W.date,W.time,W.service,W.type,W.patient_id,W.status]);A(q,$)}),ne.columns=[{width:12},{width:10},{width:20},{width:12},{width:15},{width:12}]}const O=await c.xlsx.writeBuffer(),X=new Blob([O],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),ee=window.URL.createObjectURL(X),ae=document.createElement("a");ae.href=ee,ae.download=`visits-report-${s}.xlsx`,ae.click(),window.URL.revokeObjectURL(ee)}catch(w){console.error(w),K.error("Failed to generate Excel file.")}};return e.jsxs("div",{className:"admin-monthly-report-page",style:{background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",minHeight:"100vh",width:"100%",position:"relative",padding:"1.5rem",boxSizing:"border-box",overflow:"hidden"},children:[e.jsxs("div",{className:"d-flex flex-column flex-lg-row justify-content-between align-items-start align-items-lg-center mb-4 gap-3",children:[e.jsxs("div",{className:"flex-grow-1",children:[e.jsx("h2",{className:"m-0 fw-bold",style:{color:"#1e293b"},children:"ðŸ“ˆ Monthly Visits Report"}),e.jsx("p",{className:"text-muted mb-0 mt-1",children:"Analyze patient visits and service usage patterns"})]}),e.jsxs("div",{className:"d-flex flex-column flex-sm-row gap-3 align-items-stretch align-items-sm-center",children:[e.jsxs("div",{className:"flex-shrink-0",children:[e.jsx("label",{className:"form-label fw-semibold mb-1",children:"Select Month"}),e.jsx("input",{type:"month",className:"form-control border-0 shadow-sm",style:{minWidth:150,maxWidth:170,borderRadius:"12px",padding:"12px 16px",fontSize:"14px",fontWeight:"500"},value:s,onChange:D=>i(D.target.value),"aria-label":"Select month"})]}),e.jsxs("div",{className:"d-flex flex-column flex-sm-row gap-2 align-items-stretch align-items-sm-center flex-shrink-0",children:[e.jsxs("button",{className:"btn border-0 shadow-sm",onClick:o,disabled:a,style:{background:"linear-gradient(135deg, #6c757d 0%, #495057 100%)",color:"white",borderRadius:"12px",padding:"12px 20px",fontWeight:"600",transition:"all 0.3s ease",minWidth:"100px"},children:[e.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"Refresh"]}),e.jsxs("button",{className:"btn border-0 shadow-sm",onClick:j,disabled:a,style:{background:"linear-gradient(135deg, #343a40 0%, #212529 100%)",color:"white",borderRadius:"12px",padding:"12px 20px",fontWeight:"600",transition:"all 0.3s ease",minWidth:"100px"},children:[e.jsx("i",{className:"bi bi-file-earmark-pdf me-2"}),"PDF"]}),e.jsxs("button",{className:"btn border-0 shadow-sm",onClick:b,disabled:a,style:{background:"linear-gradient(135deg, #198754 0%, #146c43 100%)",color:"white",borderRadius:"12px",padding:"12px 20px",fontWeight:"600",transition:"all 0.3s ease",minWidth:"100px"},children:[e.jsx("i",{className:"bi bi-file-earmark-excel me-2"}),"Excel"]})]})]})]}),r&&e.jsxs("div",{className:"alert alert-danger border-0 shadow-sm mb-4",style:{borderRadius:"12px"},role:"alert",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),r]}),a?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"400px"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"spinner-border text-primary mb-3",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"text-muted",children:"Loading monthly report..."})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"row g-3 mb-4",children:[e.jsx("div",{className:"col-12 col-sm-6 col-lg-3",children:e.jsx("div",{className:"card border-0 shadow-sm h-100",style:{borderRadius:"16px"},children:e.jsx("div",{className:"card-body p-4",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"bg-primary rounded-circle me-3 d-flex align-items-center justify-content-center flex-shrink-0",style:{width:"50px",height:"50px",fontSize:"1.5rem"},children:e.jsx("i",{className:"bi bi-people text-white"})}),e.jsxs("div",{className:"flex-grow-1 min-width-0",children:[e.jsx("div",{className:"text-muted small fw-semibold",children:"Total Visits"}),e.jsx("div",{className:"fs-3 fw-bold text-primary",children:((C=l==null?void 0:l.totals)==null?void 0:C.visits)??0})]})]})})})}),e.jsx("div",{className:"col-12 col-sm-6 col-lg-3",children:e.jsx("div",{className:"card border-0 shadow-sm h-100",style:{borderRadius:"16px"},children:e.jsx("div",{className:"card-body p-4",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"bg-info rounded-circle me-3 d-flex align-items-center justify-content-center flex-shrink-0",style:{width:"50px",height:"50px",fontSize:"1.5rem"},children:e.jsx("i",{className:"bi bi-chat-dots text-white"})}),e.jsxs("div",{className:"flex-grow-1 min-width-0",children:[e.jsx("div",{className:"text-muted small fw-semibold",children:"Inquiries"}),e.jsx("div",{className:"fs-3 fw-bold text-info",children:((f=l==null?void 0:l.totals)==null?void 0:f.inquiries)??0})]})]})})})})]}),e.jsxs("div",{className:"row g-4",children:[e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card border-0 shadow-sm",style:{borderRadius:"16px"},children:[e.jsx("div",{className:"card-header bg-primary text-white border-0",style:{borderRadius:"16px 16px 0 0"},children:e.jsxs("h5",{className:"mb-0 fw-semibold",children:[e.jsx("i",{className:"bi bi-clock me-2"}),"Visits by Hour"]})}),e.jsxs("div",{className:"card-body p-4",children:[e.jsx("div",{style:{height:"350px",position:"relative",width:"100%"},children:e.jsx(Fs,{data:m,options:N})}),S&&e.jsx("div",{className:"mt-3 p-3 bg-light rounded",style:{borderRadius:"12px"},children:e.jsxs("small",{className:"text-muted",children:[e.jsx("i",{className:"bi bi-info-circle me-1"}),"On average, about ",S.avgPerHour.toFixed(1)," patients come per hour. The busiest time is ",S.peakHour,":00 (",S.peakCount," visits). More staff should be available at this time."]})})]})]})}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card border-0 shadow-sm",style:{borderRadius:"16px"},children:[e.jsx("div",{className:"card-header bg-success text-white border-0",style:{borderRadius:"16px 16px 0 0"},children:e.jsxs("h5",{className:"mb-0 fw-semibold",children:[e.jsx("i",{className:"bi bi-bar-chart me-2"}),"Visits by Service & Type"]})}),e.jsxs("div",{className:"card-body p-4",children:[e.jsx("div",{style:{height:"350px",position:"relative",width:"100%"},children:e.jsx(Fs,{data:R,options:v})}),u&&e.jsx("div",{className:"mt-3 p-3 bg-light rounded",style:{borderRadius:"12px"},children:e.jsxs("small",{className:"text-muted",children:[e.jsx("i",{className:"bi bi-info-circle me-1"}),"Most patients came for ",u.topService," (",u.topCount," visits",u.topShare!=null?`, ${u.topShare.toFixed(0)}% of total`:"","). Most were booked by ",u.topWalkin?"walk-in":"appointment","."]})})]})]})})]})]})]})}function Wi(){const[s,i]=t.useState(()=>new Date().toISOString().slice(0,7)),[a,n]=t.useState("visits"),[r,d]=t.useState(100),[l,h]=t.useState(""),[o,x]=t.useState(""),[g,p]=t.useState(!1),[m,y]=t.useState(""),[N,R]=t.useState([]),[v,S]=t.useState([]),[u,j]=t.useState([]);t.useEffect(()=>{(async()=>{var A;try{const _=await z.get("/api/services");S(_.data||[]);const H=((A=_.data)==null?void 0:A.filter(T=>T.is_special||T.bundleItems&&T.bundleItems.length>0))||[];j(H)}catch(_){console.error("Failed to load data:",_)}})()},[]);const b=async()=>{var w,A;p(!0),y("");try{const _=await z.get("/api/goals",{params:{period:s}});R(Array.isArray(_.data)?_.data:[])}catch(_){console.error(_),y(((A=(w=_==null?void 0:_.response)==null?void 0:w.data)==null?void 0:A.message)||"Failed to load goals.")}finally{p(!1)}};t.useEffect(()=>{b()},[s]);const C=async w=>{var A,_;w.preventDefault(),p(!0),y("");try{const H={period_type:"month",metric:a==="visits"?"total_visits":a,target_value:r,period_start:s,period_end:null,service_id:a==="service_availment"?l:null,package_id:a==="package_promo_availment"?o:null};await z.post("/api/goals",H),await b(),d(100),h(""),x("")}catch(H){console.error(H),y(((_=(A=H==null?void 0:H.response)==null?void 0:A.data)==null?void 0:_.message)||"Failed to create goal.")}finally{p(!1)}},f=w=>{const A=Number(w.latest_actual||0),_=Number(w.target_value||1),H=new Date,T=new Date(w.period_start),c=w.period_end?new Date(w.period_end):new Date(T.getFullYear(),T.getMonth()+1,0),F=Math.ceil((c-T)/(1e3*60*60*24)),P=Math.min(Math.ceil((H-T)/(1e3*60*60*24)),F),k=Math.round(_*P/F);return w.status==="missed"?{label:"Missed",color:"danger"}:w.status==="done"?{label:"Completed",color:"success"}:A>=k?{label:"On track",color:"success"}:A>=k*.8?{label:"At risk",color:"warning"}:{label:"Behind",color:"danger"}},D=w=>{const A=Number(w.latest_actual||0),_=Number(w.target_value||1);return Math.min(100,Math.round(A/_*100))},L=w=>{switch(w){case"total_visits":return"Visits";case"service_availment":return"Service Availment";case"package_promo_availment":return"Package/Promo Availment";default:return w}},I=w=>{switch(w.metric){case"total_visits":return"Total number of visits";case"service_availment":const A=v.find(H=>H.id===w.service_id);return A?`${A.name}`:"Unknown Service";case"package_promo_availment":const _=u.find(H=>H.id===w.package_id);return _?`${_.name}`:"Unknown Package/Promo";default:return""}};return e.jsxs("div",{className:"admin-goals-page",style:{background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",minHeight:"100vh",width:"100%",padding:"1.5rem 1rem",boxSizing:"border-box"},children:[e.jsxs("div",{className:"d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4 gap-3",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"m-0 fw-bold",style:{color:"#1e293b"},children:[e.jsx("i",{className:"bi bi-bullseye me-2"}),"Performance Goals"]}),e.jsx("p",{className:"text-muted mb-0 mt-1",children:"Set and track your clinic's performance targets"})]}),e.jsx("div",{className:"d-flex gap-2 flex-wrap align-items-center",children:e.jsx("input",{type:"month",className:"form-control border-0 shadow-sm",style:{width:180,borderRadius:"12px",padding:"12px 16px",fontSize:"14px",fontWeight:"500"},value:s,onChange:w=>i(w.target.value),"aria-label":"Select month"})})]}),m&&e.jsx("div",{className:"alert alert-danger border-0 shadow-sm mb-4",role:"alert",style:{borderRadius:"12px"},children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("span",{className:"me-2",children:"âš ï¸"}),m]})}),e.jsxs("div",{className:"row g-2 g-md-3 g-lg-4",children:[e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"card border-0 shadow-sm",style:{background:"linear-gradient(135deg, #ffffff 0%, #f8fafc 100%)",borderRadius:"16px"},children:e.jsxs("div",{className:"card-body p-4",children:[e.jsxs("h5",{className:"card-title mb-4 fw-bold",style:{color:"#1e293b"},children:[e.jsx("i",{className:"bi bi-plus-circle me-2"}),"Create New Goal"]}),e.jsxs("form",{className:"row g-3",onSubmit:C,children:[e.jsxs("div",{className:"col-12 col-md-6 col-lg-3",children:[e.jsx("label",{className:"form-label fw-medium",children:"Metric"}),e.jsxs("select",{className:"form-select border-0 shadow-sm",style:{borderRadius:"8px",padding:"12px 16px"},value:a,onChange:w=>n(w.target.value),children:[e.jsx("option",{value:"visits",children:"Visits"}),e.jsx("option",{value:"service_availment",children:"Service Availment"}),e.jsx("option",{value:"package_promo_availment",children:"Package/Promo Availment"})]})]}),e.jsxs("div",{className:"col-12 col-md-6 col-lg-3",children:[e.jsx("label",{className:"form-label fw-medium",children:"Period"}),e.jsx("input",{type:"month",className:"form-control border-0 shadow-sm",style:{borderRadius:"8px",padding:"12px 16px"},value:s,onChange:w=>i(w.target.value)})]}),a==="service_availment"&&e.jsxs("div",{className:"col-12 col-md-6 col-lg-3",children:[e.jsx("label",{className:"form-label fw-medium",children:"Service"}),e.jsxs("select",{className:"form-select border-0 shadow-sm",style:{borderRadius:"8px",padding:"12px 16px"},value:l,onChange:w=>h(w.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Select a regular service..."}),v.filter(w=>!w.is_special).map(w=>e.jsx("option",{value:w.id,children:w.name},w.id))]})]}),a==="package_promo_availment"&&e.jsxs("div",{className:"col-12 col-md-6 col-lg-3",children:[e.jsx("label",{className:"form-label fw-medium",children:"Package/Promo"}),e.jsxs("select",{className:"form-select border-0 shadow-sm",style:{borderRadius:"8px",padding:"12px 16px"},value:o,onChange:w=>x(w.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Select a package/promo..."}),u.map(w=>e.jsx("option",{value:w.id,children:w.name},w.id))]})]}),e.jsxs("div",{className:"col-12 col-md-6 col-lg-3",children:[e.jsx("label",{className:"form-label fw-medium",children:"Target Value"}),e.jsx("input",{type:"number",min:"1",className:"form-control border-0 shadow-sm",style:{borderRadius:"8px",padding:"12px 16px"},value:r,onChange:w=>d(w.target.value),placeholder:a==="visits"?"Number of visits":"Target number",required:!0})]}),a==="service_availment"&&e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"alert alert-info border-0 shadow-sm",style:{borderRadius:"8px"},children:[e.jsx("i",{className:"bi bi-info-circle me-2"}),"Only regular services (non-special) are shown. Patients who availed promos for these services will be excluded from the count."]})}),e.jsx("div",{className:"col-12 col-md-6 col-lg-3 d-flex align-items-end",children:e.jsxs("button",{className:"btn w-100 border-0 shadow-sm",disabled:g,style:{background:"linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)",color:"white",borderRadius:"8px",padding:"12px 24px",fontWeight:"600",transition:"all 0.3s ease"},children:[g?"âŸ³":"âœ“"," Create Goal"]})})]})]})})}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card border-0 shadow-sm",style:{background:"linear-gradient(135deg, #ffffff 0%, #f8fafc 100%)",borderRadius:"16px"},children:[e.jsx("div",{className:"card-header bg-transparent border-0 p-4 pb-0",children:e.jsxs("h5",{className:"card-title mb-0 fw-bold",style:{color:"#1e293b"},children:[e.jsx("i",{className:"bi bi-list-check me-2"}),"Goals for ",s]})}),e.jsx("div",{className:"card-body p-4",children:g?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"200px"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"spinner-border text-primary mb-3",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"text-muted",children:"Loading goals..."})]})}):N.length===0?e.jsxs("div",{className:"text-center text-muted py-5",children:[e.jsx("div",{className:"fs-1 mb-3",style:{color:"#e2e8f0"},children:e.jsx("i",{className:"bi bi-inbox"})}),e.jsx("h6",{className:"fw-medium mb-1",children:"No goals found for this period"}),e.jsx("p",{className:"small mb-0",children:"Create your first goal using the form above"})]}):e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover mb-0 w-100",children:[e.jsxs("colgroup",{children:[e.jsx("col",{style:{width:"20%"}}),e.jsx("col",{style:{width:"18%"}}),e.jsx("col",{style:{width:"15%"}}),e.jsx("col",{style:{width:"10%"}}),e.jsx("col",{style:{width:"10%"}}),e.jsx("col",{style:{width:"12%"}}),e.jsx("col",{style:{width:"15%"}})]}),e.jsx("thead",{className:"table-primary",children:e.jsxs("tr",{children:[e.jsxs("th",{className:"fw-semibold px-3 px-md-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-bullseye me-2"}),"Metric"]}),e.jsxs("th",{className:"fw-semibold px-3 px-md-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-file-text me-2"}),"Description"]}),e.jsxs("th",{className:"fw-semibold px-3 px-md-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-calendar me-2"}),"Period"]}),e.jsxs("th",{className:"fw-semibold px-3 px-md-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-target me-2"}),"Target"]}),e.jsxs("th",{className:"fw-semibold px-3 px-md-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-check-circle me-2"}),"Actual"]}),e.jsxs("th",{className:"fw-semibold px-3 px-md-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-activity me-2"}),"Status"]}),e.jsxs("th",{className:"fw-semibold px-3 px-md-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-graph-up me-2"}),"Progress"]})]})}),e.jsx("tbody",{children:N.map(w=>e.jsxs("tr",{className:"align-middle",style:{height:"60px"},children:[e.jsx("td",{className:"px-3 px-md-4 py-3 fw-medium border-0",style:{fontSize:"1rem"},children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"bg-primary rounded-circle me-3 d-flex align-items-center justify-content-center",style:{width:"40px",height:"40px",fontSize:"1.2rem"},children:"ðŸŽ¯"}),e.jsx("div",{children:e.jsx("div",{className:"fw-bold text-dark",children:L(w.metric)})})]})}),e.jsx("td",{className:"px-3 px-md-4 py-3 border-0",style:{fontSize:"1rem"},children:e.jsx("div",{className:"text-truncate",style:{maxWidth:"180px"},title:I(w),children:I(w)})}),e.jsx("td",{className:"px-3 px-md-4 py-3 border-0",style:{fontSize:"1rem"},children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("span",{className:"fw-semibold text-dark",children:w.period_type==="month"?new Date(w.period_start).toLocaleDateString("en-US",{year:"numeric",month:"short"}):`${new Date(w.period_start).toLocaleDateString("en-US",{month:"short",day:"numeric"})} - ${new Date(w.period_end).toLocaleDateString("en-US",{month:"short",day:"numeric"})}`}),e.jsx("small",{className:"text-muted",children:"Period"})]})}),e.jsx("td",{className:"px-3 px-md-4 py-3 border-0",style:{fontSize:"1rem"},children:e.jsx("span",{className:"badge bg-light text-dark fs-6",children:w.target_value})}),e.jsx("td",{className:"px-3 px-md-4 py-3 border-0",style:{fontSize:"1rem"},children:e.jsx("div",{className:"fw-bold text-success fs-5",children:w.latest_actual||0})}),e.jsx("td",{className:"px-3 px-md-4 py-3 border-0",style:{fontSize:"1rem"},children:e.jsxs("div",{className:"d-flex flex-column align-items-start",children:[(()=>{const A=f(w);return e.jsx("span",{className:`badge bg-${A.color} mb-1`,children:A.label})})(),e.jsx("small",{className:"text-muted",children:"Current"})]})}),e.jsx("td",{className:"px-3 px-md-4 py-3 border-0",children:e.jsx("div",{className:"d-flex align-items-center",children:e.jsx("div",{className:"progress flex-grow-1 me-2",style:{height:24},children:e.jsx("div",{className:`progress-bar ${D(w)>=100?"bg-success":D(w)>=70?"bg-info":"bg-warning"}`,role:"progressbar",style:{width:`${D(w)}%`},"aria-valuenow":D(w),"aria-valuemin":"0","aria-valuemax":"100",children:e.jsxs("span",{className:"text-white fw-medium small",children:[D(w),"%"]})})})})})]},w.id))})]})})})]})})]})]})}const Bi=()=>{const[s,i]=t.useState([]),[a,n]=t.useState(!0),[r,d]=t.useState(!1),[l,h]=t.useState({categories:[],actions:[],users:[]}),[o,x]=t.useState({user_id:"",category:"",action:"",subject_id:"",date_from:"",date_to:"",search:""}),[g,p]=t.useState({current_page:1,last_page:1,per_page:20,total:0}),[m,y]=t.useState(!1),[N,R]=t.useState(!1),[v,S]=t.useState(null),[u,j]=t.useState(null),[b,C]=t.useState(!1),[f,D]=t.useState(null),[L,I]=t.useState({top:0,left:0}),[w,A]=t.useState(null);t.useEffect(()=>{_(),H(!0)},[]),t.useEffect(()=>{if(!a){if(w&&clearTimeout(w),o.search&&o.search.length>=2){const $=setTimeout(()=>{H(!1)},300);A($)}else(!o.search||o.search.length===0)&&H(!1);return()=>{w&&clearTimeout(w)}}},[o,g.current_page,g.per_page]),t.useEffect(()=>{if(N){document.body.classList.add("modal-open");const $=()=>{f&&ee(f)};return window.addEventListener("scroll",$,!0),window.addEventListener("resize",$),()=>{window.removeEventListener("scroll",$,!0),window.removeEventListener("resize",$)}}else document.body.classList.remove("modal-open");return()=>{document.body.classList.remove("modal-open")}},[N,f]);const _=async()=>{try{const $=await z.get("/api/system-logs/filter-options");h($.data)}catch($){console.error("Failed to fetch filter options:",$)}},H=async($=!1)=>{try{$?n(!0):d(!0);const q=new URLSearchParams;Object.entries(o).forEach(([ie,B])=>{if(B){if(ie==="search"&&B.length<2)return;q.append(ie,B)}}),q.append("page",g.current_page),q.append("per_page",g.per_page);const J=await z.get(`/api/system-logs?${q.toString()}`);i(J.data.data),p({current_page:J.data.current_page,last_page:J.data.last_page,per_page:J.data.per_page,total:J.data.total})}catch(q){console.error("Failed to fetch system logs:",q)}finally{$?n(!1):d(!1)}},T=($,q)=>{x(J=>({...J,[$]:q})),p(J=>({...J,current_page:1}))},c=()=>{x({user_id:"",category:"",action:"",subject_id:"",date_from:"",date_to:"",search:""}),p($=>({...$,current_page:1}))},F=$=>{x(q=>({...q,[$]:""})),p(q=>({...q,current_page:1}))},P=()=>Object.values(o).filter($=>$!=="").length,k=()=>Object.entries(o).filter(([$,q])=>q!=="").map(([$,q])=>{let J=q,ie=$.replace(/_/g," ").replace(/\b\w/g,B=>B.toUpperCase());if($==="user_id"){const B=l.users.find(le=>le.id.toString()===q.toString());J=B?B.name:q}else $==="category"?J=O(q).label:$==="action"?J=X(q).label:($==="date_from"||$==="date_to")&&(J=new Date(q).toLocaleDateString(),ie=$==="date_from"?"From":"To");return{key:$,label:ie,value:J}}),E=$=>new Date($).toLocaleString(),O=$=>({appointment:{label:"Appointment",icon:"bi-calendar-check",color:"bg-primary",description:"Appointment-related activities"},dentist:{label:"Dentist",icon:"bi-person-badge",color:"bg-info",description:"Dentist profile and schedule management"},device:{label:"Device",icon:"bi-laptop",color:"bg-warning",description:"Device registration and approval"},user:{label:"User",icon:"bi-person",color:"bg-success",description:"User account management"},inventory:{label:"Inventory",icon:"bi-box-seam",color:"bg-secondary",description:"Inventory and stock management"},payment:{label:"Payment",icon:"bi-credit-card",color:"bg-dark",description:"Payment processing and transactions"},system:{label:"System",icon:"bi-gear",color:"bg-danger",description:"System-level operations and maintenance"}})[$]||{label:$.charAt(0).toUpperCase()+$.slice(1),icon:"bi-question-circle",color:"bg-light text-dark",description:"System activity"},X=$=>{const q={created:{label:"Created",icon:"bi-plus-circle",color:"bg-success",description:"New item was created"},approved:{label:"Approved",icon:"bi-check-circle",color:"bg-success",description:"Item was approved"},rejected:{label:"Rejected",icon:"bi-x-circle",color:"bg-danger",description:"Item was rejected"},updated:{label:"Updated",icon:"bi-pencil-square",color:"bg-warning text-dark",description:"Item was modified"},deleted:{label:"Deleted",icon:"bi-trash",color:"bg-danger",description:"Item was removed"},marked_no_show:{label:"No Show",icon:"bi-person-x",color:"bg-warning text-dark",description:"Appointment marked as no show"},cancelled:{label:"Cancelled",icon:"bi-x-octagon",color:"bg-danger",description:"Item was cancelled"},scheduled:{label:"Scheduled",icon:"bi-calendar-plus",color:"bg-info",description:"Item was scheduled"},completed:{label:"Completed",icon:"bi-check2-all",color:"bg-success",description:"Item was completed"},logged_in:{label:"Login",icon:"bi-box-arrow-in-right",color:"bg-info",description:"User logged in"},logged_out:{label:"Logout",icon:"bi-box-arrow-right",color:"bg-secondary",description:"User logged out"}};return q[$]?q[$]:$.includes("create")||$.includes("add")?q.created:$.includes("update")||$.includes("edit")?q.updated:$.includes("delete")||$.includes("remove")?q.deleted:$.includes("approve")||$.includes("accept")?q.approved:$.includes("reject")||$.includes("cancel")?q.rejected:{label:$.replace(/_/g," ").replace(/\b\w/g,J=>J.toUpperCase()),icon:"bi-arrow-right-circle",color:"bg-secondary",description:"System activity"}},ee=$=>{const q=$.getBoundingClientRect(),J=400,ie=Math.min(window.innerHeight*.8,600),B=8,le=20;let M=q.bottom+B,U=q.left;M+ie>window.innerHeight-le&&(M=q.top-ie-B);const G=window.innerWidth-J-le;U=Math.max(le,Math.min(U,G)),M=Math.max(le,M),(q.bottom<0||q.top>window.innerHeight)&&(M=(window.innerHeight-ie)/2,U=(window.innerWidth-J)/2),I({top:M,left:U})},ae=($,q)=>{j($),S($.context),D(q),ee(q),R(!0),setTimeout(()=>{const J=document.querySelector(".context-popup-card");J&&J.focus()},100)},ne=()=>{f&&f.focus(),R(!1),S(null),j(null),C(!1),D(null)},re=async()=>{try{const $={id:u==null?void 0:u.id,user:u==null?void 0:u.user,category:u==null?void 0:u.category,action:u==null?void 0:u.action,subject_id:u==null?void 0:u.subject_id,message:u==null?void 0:u.message,context:v,created_at:u==null?void 0:u.created_at};await navigator.clipboard.writeText(JSON.stringify($,null,2)),C(!0),setTimeout(()=>C(!1),2e3)}catch($){console.error("Failed to copy to clipboard:",$)}},W=($,q)=>{if(!q||Object.keys(q).length===0)return e.jsx("div",{className:"context-popup-section",children:e.jsxs("div",{className:"text-center text-muted py-3",children:[e.jsx("i",{className:"bi bi-info-circle me-2",style:{fontSize:"2rem"}}),e.jsx("p",{className:"mt-2 mb-0",children:"No additional context data available for this log entry."})]})});const J=(U,G)=>G==null?e.jsx("span",{className:"text-muted fst-italic",children:"Not specified"}):typeof G=="boolean"?e.jsx("span",{className:G?"text-success fw-bold":"text-danger fw-bold",children:G?"Yes":"No"}):typeof G=="object"?e.jsx("div",{className:"context-json-viewer",children:JSON.stringify(G,null,2)}):G.toString(),ie=U=>({id:"ID",name:"Name",email:"Email Address",phone:"Phone Number",status:"Status",type:"Type",amount:"Amount",date:"Date",time:"Time",description:"Description",notes:"Notes",user_id:"User ID",patient_id:"Patient ID",appointment_id:"Appointment ID",service_id:"Service ID",dentist_id:"Dentist ID",device_id:"Device ID",payment_id:"Payment ID",inventory_id:"Inventory Item ID",created_at:"Created At",updated_at:"Updated At",deleted_at:"Deleted At",ip_address:"IP Address",user_agent:"Browser Information",device_name:"Device Name",device_type:"Device Type",device_status:"Device Status",appointment_date:"Appointment Date",appointment_time:"Appointment Time",patient_name:"Patient Name",dentist_name:"Dentist Name",service_name:"Service Name",payment_amount:"Payment Amount",payment_method:"Payment Method",payment_status:"Payment Status",quantity:"Quantity",unit_price:"Unit Price",total_amount:"Total Amount",reason:"Reason",comment:"Comment",old_values:"Previous Values",new_values:"New Values",changes:"Changes Made",reference_code:"Reference Code",time_slot:"Time Slot",rejection_note:"Rejection Note",warning_message:"Warning Message",warning_count:"Warning Count",no_show_count:"No-Show Count",block_reason:"Block Reason",block_type:"Block Type",blocked_ip:"Blocked IP",unblock_reason:"Unblock Reason",old_count:"Old Count",new_count:"New Count",admin_id:"Admin ID",custom_message:"Custom Message",added_by:"Added By",linked_by:"Linked By",flagged_by:"Flagged By",created_by:"Created By",updated_by:"Updated By",deleted_by:"Deleted By",performed_by:"Performed By",old_name:"Old Name",new_name:"New Name",old_status:"Old Status",new_status:"New Status",old_date:"Old Date",new_date:"New Date",old_time_slot:"Old Time Slot",new_time_slot:"New Time Slot",contact_number:"Contact Number",category_id:"Category ID",estimated_minutes:"Estimated Minutes",price:"Price",role:"Role",action_required:"Action Required"})[U]||U.replace(/_/g," ").replace(/\b\w/g,Y=>Y.toUpperCase()),B=U=>({id:"bi-hash",name:"bi-person",email:"bi-envelope",phone:"bi-telephone",status:"bi-circle-fill",type:"bi-tag",amount:"bi-currency-dollar",date:"bi-calendar",time:"bi-clock",description:"bi-text-paragraph",notes:"bi-sticky",user_id:"bi-person-badge",patient_id:"bi-person-heart",appointment_id:"bi-calendar-check",service_id:"bi-gear",device_id:"bi-laptop",payment_id:"bi-credit-card",ip_address:"bi-globe",user_agent:"bi-browser-chrome",reason:"bi-chat-quote",comment:"bi-chat-text",old_values:"bi-arrow-left",new_values:"bi-arrow-right",reference_code:"bi-code-square",time_slot:"bi-clock-history",warning_message:"bi-exclamation-triangle",no_show_count:"bi-x-octagon",block_reason:"bi-shield-x",contact_number:"bi-telephone",price:"bi-currency-dollar"})[U]||"bi-info-circle",le=U=>["reason","block_reason","rejection_note","warning_message","unblock_reason","action_required"].includes(U),M=U=>["reference_code","device_fingerprint","ip_address","blocked_ip"].includes(U);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"context-popup-section",children:[e.jsxs("div",{className:"context-popup-section-title",children:[e.jsx("i",{className:"bi bi-info-circle-fill"}),e.jsx("span",{children:"Log Summary"})]}),e.jsxs("div",{className:"context-field",children:[e.jsxs("div",{className:"context-field-label",children:[e.jsx("i",{className:"bi bi-hash"}),"Log ID"]}),e.jsxs("div",{className:"context-field-value code",children:["#",$.id]})]}),$.user&&e.jsxs("div",{className:"context-field",children:[e.jsxs("div",{className:"context-field-label",children:[e.jsx("i",{className:"bi bi-person-badge"}),"Performed By"]}),e.jsxs("div",{className:"context-field-value",children:[e.jsx("strong",{children:$.user.name})," (",$.user.email,")"]})]}),e.jsxs("div",{className:"context-field",children:[e.jsxs("div",{className:"context-field-label",children:[e.jsx("i",{className:"bi bi-chat-text"}),"Message"]}),e.jsx("div",{className:"context-field-value",children:$.message})]}),e.jsxs("div",{className:"context-field",children:[e.jsxs("div",{className:"context-field-label",children:[e.jsx("i",{className:"bi bi-calendar"}),"Timestamp"]}),e.jsx("div",{className:"context-field-value",children:new Date($.created_at).toLocaleString("en-US",{dateStyle:"full",timeStyle:"medium"})})]})]}),e.jsxs("div",{className:"context-popup-section",children:[e.jsxs("div",{className:"context-popup-section-title",children:[e.jsx("i",{className:"bi bi-list-ul"}),e.jsxs("span",{children:["Context Details (",Object.keys(q).length," field",Object.keys(q).length!==1?"s":"",")"]})]}),Object.entries(q).map(([U,G])=>e.jsxs("div",{className:"context-field",children:[e.jsxs("div",{className:"context-field-label",children:[e.jsx("i",{className:`bi ${B(U)}`}),ie(U)]}),e.jsx("div",{className:`context-field-value ${le(U)?"highlight":""} ${M(U)?"code":""}`,children:J(U,G)})]},U))]})]})};return e.jsxs("div",{className:"system-logs-page",style:{background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",padding:"1rem 1.5rem",boxSizing:"border-box"},children:[e.jsx("div",{className:"mb-3",children:e.jsx("div",{className:"card border-0 shadow-sm",style:{borderRadius:"12px"},children:e.jsx("div",{className:"card-body p-3",children:e.jsxs("div",{className:"row g-3 align-items-center",children:[e.jsx("div",{className:"col-12 col-md-6",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"bg-primary bg-opacity-10 rounded-circle p-3 me-3",children:e.jsx("i",{className:"bi bi-list-ul text-primary",style:{fontSize:"1.5rem"}})}),e.jsxs("div",{children:[e.jsx("h6",{className:"mb-0 text-muted small",children:"Total Logs"}),e.jsx("h4",{className:"mb-0 fw-bold",children:g.total.toLocaleString()})]})]})}),e.jsx("div",{className:"col-12 col-md-6",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-md-end",children:[e.jsx("div",{className:"bg-info bg-opacity-10 rounded-circle p-3 me-3",children:e.jsx("i",{className:"bi bi-eye text-info",style:{fontSize:"1.5rem"}})}),e.jsxs("div",{children:[e.jsx("h6",{className:"mb-0 text-muted small",children:"Showing"}),e.jsxs("h4",{className:"mb-0 fw-bold",children:[s.length,g.total>0&&e.jsxs("span",{className:"text-muted small ms-2",children:["(Page ",g.current_page,"/",g.last_page,")"]})]})]})]})})]})})})}),e.jsx("div",{className:"mb-3",children:e.jsx("div",{className:"card border-0 shadow-sm",style:{borderRadius:"16px",background:"linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%)"},children:e.jsxs("div",{className:"card-body p-3",children:[e.jsxs("div",{className:"row g-3 align-items-center",children:[e.jsxs("div",{className:"col-12 col-lg-4",children:[e.jsxs("div",{className:"position-relative",children:[e.jsx("i",{className:"bi bi-search position-absolute",style:{left:"16px",top:"50%",transform:"translateY(-50%)",color:"#6c757d"}}),e.jsx("input",{type:"text",className:"form-control border-0 shadow-sm",style:{borderRadius:"12px",padding:"12px 16px 12px 42px",background:"white",borderColor:o.search&&o.search.length===1?"#ffc107":""},placeholder:"Search logs... (min 2 characters)",value:o.search,onChange:$=>T("search",$.target.value)})]}),o.search&&o.search.length>0&&o.search.length<2&&e.jsxs("small",{className:"text-warning mt-1 d-block fw-semibold",children:[e.jsx("i",{className:"bi bi-info-circle-fill me-1"}),"Enter at least 2 characters to search"]})]}),e.jsx("div",{className:"col-12 col-md-6 col-lg-3",children:e.jsxs("select",{className:"form-select border-0 shadow-sm",style:{borderRadius:"12px",padding:"12px 16px",background:"white"},value:o.category,onChange:$=>T("category",$.target.value),children:[e.jsx("option",{value:"",children:"All Categories"}),l.categories.map($=>{const q=O($);return e.jsx("option",{value:$,children:q.label},$)})]})}),e.jsx("div",{className:"col-12 col-md-6 col-lg-3",children:e.jsxs("select",{className:"form-select border-0 shadow-sm",style:{borderRadius:"12px",padding:"12px 16px",background:"white"},value:o.action,onChange:$=>T("action",$.target.value),children:[e.jsx("option",{value:"",children:"All Actions"}),l.actions.map($=>{const q=X($);return e.jsx("option",{value:$,children:q.label},$)})]})}),e.jsx("div",{className:"col-12 col-lg-2",children:e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx("button",{className:`btn flex-grow-1 border-0 shadow-sm ${m?"btn-primary":"btn-outline-primary"}`,onClick:()=>y(!m),style:{borderRadius:"12px",padding:"12px 16px",fontWeight:"600",background:m?"linear-gradient(135deg, #0d6efd 0%, #0b5ed7 100%)":"white",color:m?"white":"#0d6efd",border:m?"none":"2px solid #0d6efd"},children:e.jsx("i",{className:"bi bi-sliders"})}),P()>0&&e.jsx("button",{className:"btn btn-outline-danger border-0 shadow-sm",onClick:c,style:{borderRadius:"12px",padding:"12px 16px",fontWeight:"600"},title:"Clear all filters",children:e.jsx("i",{className:"bi bi-x-circle"})})]})})]}),m&&e.jsx("div",{className:"mt-3 pt-3 border-top",children:e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-12 col-md-6 col-lg-3",children:[e.jsxs("label",{className:"form-label fw-semibold text-muted small",children:[e.jsx("i",{className:"bi bi-person me-1"}),"User"]}),e.jsxs("select",{className:"form-select border-0 shadow-sm",style:{borderRadius:"12px",padding:"12px 16px",background:"white"},value:o.user_id,onChange:$=>T("user_id",$.target.value),children:[e.jsx("option",{value:"",children:"All Users"}),l.users.map($=>e.jsx("option",{value:$.id,children:$.name},$.id))]})]}),e.jsxs("div",{className:"col-12 col-md-6 col-lg-3",children:[e.jsxs("label",{className:"form-label fw-semibold text-muted small",children:[e.jsx("i",{className:"bi bi-hash me-1"}),"Subject ID"]}),e.jsx("input",{type:"number",className:"form-control border-0 shadow-sm",style:{borderRadius:"12px",padding:"12px 16px",background:"white"},placeholder:"Enter ID",value:o.subject_id,onChange:$=>T("subject_id",$.target.value)})]}),e.jsxs("div",{className:"col-12 col-md-6 col-lg-3",children:[e.jsxs("label",{className:"form-label fw-semibold text-muted small",children:[e.jsx("i",{className:"bi bi-calendar-event me-1"}),"Date From"]}),e.jsx("input",{type:"date",className:"form-control border-0 shadow-sm",style:{borderRadius:"12px",padding:"12px 16px",background:"white"},value:o.date_from,onChange:$=>T("date_from",$.target.value)})]}),e.jsxs("div",{className:"col-12 col-md-6 col-lg-3",children:[e.jsxs("label",{className:"form-label fw-semibold text-muted small",children:[e.jsx("i",{className:"bi bi-calendar-event me-1"}),"Date To"]}),e.jsx("input",{type:"date",className:"form-control border-0 shadow-sm",style:{borderRadius:"12px",padding:"12px 16px",background:"white"},value:o.date_to,onChange:$=>T("date_to",$.target.value)})]})]})})]})})}),k().length>0&&e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"d-flex flex-wrap gap-2 align-items-center",children:[e.jsxs("span",{className:"text-muted small fw-semibold",children:[e.jsx("i",{className:"bi bi-funnel-fill me-1"}),"Active Filters:"]}),k().map($=>e.jsxs("span",{className:"badge d-inline-flex align-items-center gap-2",style:{background:"linear-gradient(135deg, #0d6efd 0%, #0b5ed7 100%)",padding:"8px 12px",borderRadius:"8px",fontSize:"0.875rem",fontWeight:"500"},children:[e.jsxs("span",{children:[$.label,": ",e.jsx("strong",{children:$.value})]}),e.jsx("button",{onClick:()=>F($.key),className:"btn-close btn-close-white",style:{fontSize:"0.65rem",opacity:.8},"aria-label":`Remove ${$.label} filter`})]},$.key)),e.jsxs("button",{onClick:c,className:"btn btn-sm btn-outline-danger",style:{borderRadius:"8px",padding:"6px 12px"},children:[e.jsx("i",{className:"bi bi-x-circle me-1"}),"Clear All"]})]})}),a?e.jsx("div",{className:"d-flex justify-content-center align-items-center py-5",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"spinner-border text-primary mb-3",role:"status",style:{width:"3rem",height:"3rem"},children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"text-muted fs-5",children:"Loading system logs..."})]})}):s.length===0?e.jsx("div",{className:"text-center text-muted py-5",children:e.jsxs("div",{className:"d-flex flex-column align-items-center justify-content-center",children:[e.jsx("div",{className:"bg-light rounded-circle mb-4 d-flex align-items-center justify-content-center",style:{width:"100px",height:"100px",fontSize:"2.5rem"},children:"ðŸ“‹"}),e.jsx("h3",{className:"text-muted mb-3",children:"No system logs found"}),e.jsx("p",{className:"text-muted mb-0",children:"Try adjusting your filters or check back later for new activity."})]})}):e.jsxs("div",{className:"table-responsive position-relative",style:{width:"100%"},children:[r&&e.jsx("div",{className:"position-absolute top-0 start-0 w-100 h-100 d-flex justify-content-center align-items-center",style:{background:"rgba(255, 255, 255, 0.9)",zIndex:10,backdropFilter:"blur(2px)"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"spinner-border text-primary mb-2",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"text-muted small mb-0",children:"Updating results..."})]})}),e.jsxs("table",{className:"table table-hover mb-0",style:{width:"100%"},children:[e.jsx("thead",{className:"table-primary sticky-top",children:e.jsxs("tr",{children:[e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0",style:{fontSize:"1.1rem",width:"5%"},children:[e.jsx("i",{className:"bi bi-hash me-2"}),"ID"]}),e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0",style:{fontSize:"1.1rem",width:"15%"},children:[e.jsx("i",{className:"bi bi-person me-2"}),"User"]}),e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0",style:{fontSize:"1.1rem",width:"12%"},children:[e.jsx("i",{className:"bi bi-tags me-2"}),"Category"]}),e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0",style:{fontSize:"1.1rem",width:"12%"},children:[e.jsx("i",{className:"bi bi-lightning me-2"}),"Action"]}),e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0",style:{fontSize:"1.1rem",width:"10%"},children:[e.jsx("i",{className:"bi bi-link-45deg me-2"}),"Subject ID"]}),e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0",style:{fontSize:"1.1rem",width:"25%"},children:[e.jsx("i",{className:"bi bi-chat-text me-2"}),"Message"]}),e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0 text-center",style:{fontSize:"1.1rem",width:"10%"},children:[e.jsx("i",{className:"bi bi-info-circle me-2"}),"Details"]}),e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0",style:{fontSize:"1.1rem",width:"11%"},children:[e.jsx("i",{className:"bi bi-calendar me-2"}),"Date"]})]})}),e.jsx("tbody",{style:{opacity:r?.5:1,transition:"opacity 0.2s ease"},children:s.map($=>e.jsxs("tr",{className:"align-middle",style:{height:"60px"},children:[e.jsx("td",{className:"px-4 py-3 border-0 text-center",style:{fontSize:"1rem"},children:e.jsx("span",{className:"badge bg-secondary",children:$.id})}),e.jsx("td",{className:"px-4 py-3 border-0",style:{fontSize:"1rem"},children:$.user?e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"bg-primary rounded-circle me-3 d-flex align-items-center justify-content-center",style:{width:"40px",height:"40px",fontSize:"1.2rem"},children:e.jsx("i",{className:"bi bi-person text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-bold text-dark text-truncate",style:{maxWidth:"150px"},title:$.user.name,children:$.user.name}),e.jsx("small",{className:"text-muted text-truncate d-block",style:{maxWidth:"150px"},title:$.user.email,children:$.user.email})]})]}):e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"bg-secondary rounded-circle me-3 d-flex align-items-center justify-content-center",style:{width:"40px",height:"40px",fontSize:"1.2rem"},children:e.jsx("i",{className:"bi bi-gear text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-bold text-dark",children:"System"}),e.jsx("small",{className:"text-muted",children:"Automated"})]})]})}),e.jsx("td",{className:"px-4 py-3 border-0",style:{fontSize:"1rem"},children:(()=>{const q=O($.category);return e.jsxs("span",{className:`badge ${q.color} d-flex align-items-center text-truncate`,title:q.description,children:[e.jsx("i",{className:`bi ${q.icon} me-1 flex-shrink-0`}),e.jsx("span",{className:"text-truncate",children:q.label})]})})()}),e.jsx("td",{className:"px-4 py-3 border-0",style:{fontSize:"1rem"},children:(()=>{const q=X($.action);return e.jsxs("span",{className:`badge ${q.color} d-flex align-items-center text-truncate`,title:q.description,children:[e.jsx("i",{className:`bi ${q.icon} me-1 flex-shrink-0`}),e.jsx("span",{className:"text-truncate",children:q.label})]})})()}),e.jsx("td",{className:"px-4 py-3 border-0 text-center",style:{fontSize:"1rem"},children:$.subject_id?e.jsx("span",{className:"badge bg-light text-dark",children:$.subject_id}):e.jsx("span",{className:"text-muted",children:"-"})}),e.jsx("td",{className:"px-4 py-3 border-0",style:{fontSize:"1rem"},children:e.jsx("div",{className:"text-truncate",style:{maxWidth:"300px"},title:$.message,children:$.message})}),e.jsx("td",{className:"px-4 py-3 border-0 text-center",style:{fontSize:"1rem"},children:e.jsxs("button",{className:"btn btn-sm btn-outline-info",onClick:q=>ae($,q.currentTarget),title:"View detailed information",style:{borderRadius:"8px"},children:[e.jsx("i",{className:"bi bi-eye me-1"}),"Details"]})}),e.jsx("td",{className:"px-4 py-3 border-0",style:{fontSize:"1rem"},children:e.jsx("small",{className:"text-truncate d-block",style:{maxWidth:"120px"},title:E($.created_at),children:E($.created_at)})})]},$.id))})]})]}),g.last_page>1&&e.jsx("div",{className:"d-flex justify-content-center mt-3",children:e.jsx("nav",{"aria-label":"System logs pagination",children:e.jsxs("ul",{className:"pagination mb-0",children:[e.jsx("li",{className:`page-item ${g.current_page===1?"disabled":""}`,children:e.jsx("button",{className:"page-link border-0 shadow-sm",style:{borderRadius:"8px",margin:"0 2px"},onClick:()=>p($=>({...$,current_page:$.current_page-1})),disabled:g.current_page===1,children:e.jsx("i",{className:"bi bi-chevron-left"})})}),Array.from({length:Math.min(g.last_page,5)},($,q)=>{const J=q+1;return e.jsx("li",{className:`page-item ${J===g.current_page?"active":""}`,children:e.jsx("button",{className:"page-link border-0 shadow-sm",style:{borderRadius:"8px",margin:"0 2px"},onClick:()=>p(ie=>({...ie,current_page:J})),children:J})},J)}),e.jsx("li",{className:`page-item ${g.current_page===g.last_page?"disabled":""}`,children:e.jsx("button",{className:"page-link border-0 shadow-sm",style:{borderRadius:"8px",margin:"0 2px"},onClick:()=>p($=>({...$,current_page:$.current_page+1})),disabled:g.current_page===g.last_page,children:e.jsx("i",{className:"bi bi-chevron-right"})})})]})})}),N&&ua.createPortal(e.jsxs("div",{className:"context-popup-card",role:"dialog","aria-modal":"true","aria-label":"Details",tabIndex:-1,style:{top:L.top,left:L.left,right:"auto"},children:[e.jsxs("div",{className:"context-popup-header",children:[e.jsxs("div",{className:"context-popup-title",children:[e.jsx("i",{className:"bi bi-file-text-fill me-2"}),e.jsx("span",{children:"System Log Details"})]}),e.jsx("div",{className:"context-popup-controls",children:e.jsx("button",{type:"button",className:"context-popup-close",onClick:ne,title:"Close",children:e.jsx("i",{className:"bi bi-x-lg"})})})]}),e.jsxs("div",{className:"context-popup-body",children:[b&&e.jsxs("div",{className:"alert alert-success d-flex align-items-center mb-3",role:"alert",children:[e.jsx("i",{className:"bi bi-check-circle-fill me-2"}),e.jsx("div",{children:"Full log data copied to clipboard successfully!"})]}),e.jsx("div",{className:"context-popup-content",children:e.jsx("div",{className:"context-popup-data",children:u&&W(u,v)})})]}),e.jsxs("div",{className:"context-popup-footer",children:[e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("i",{className:"bi bi-clock-history text-muted"}),e.jsxs("small",{className:"text-muted",children:["ID #",u==null?void 0:u.id," â€¢ ",u==null?void 0:u.category,"/",u==null?void 0:u.action]})]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs("button",{type:"button",className:"context-popup-btn context-popup-btn-secondary",onClick:ne,children:[e.jsx("i",{className:"bi bi-x-circle me-1"}),"Close"]}),e.jsxs("button",{type:"button",className:"context-popup-btn context-popup-btn-primary",onClick:re,children:[e.jsx("i",{className:"bi bi-clipboard me-1"}),"Copy All Data"]})]})]})]}),document.body),e.jsx("div",{className:"mt-4 pt-3 border-top",children:e.jsx("div",{className:"d-flex justify-content-center align-items-center",children:e.jsx("div",{className:"card border-0 shadow-sm",children:e.jsx("div",{className:"card-body p-3",children:e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("i",{className:"bi bi-list-ul text-muted"}),e.jsx("label",{className:"form-label mb-0 fw-semibold text-muted",children:"Logs per page:"}),e.jsxs("select",{className:"form-select border-0 shadow-sm",style:{borderRadius:"8px",padding:"8px 16px",width:"auto"},value:g.per_page,onChange:$=>p(q=>({...q,per_page:parseInt($.target.value),current_page:1})),children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"}),e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"})]})]})})})})})]})},Hi=()=>{const[s,i]=t.useState([]),[a,n]=t.useState(!0),[r,d]=t.useState(!1),[l,h]=t.useState(null),[o,x]=t.useState(!1),[g,p]=t.useState(!1),[m,y]=t.useState(null),[N,R]=t.useState(null),[v,S]=t.useState(!1),[u,j]=t.useState(null),[b,C]=t.useState(null),[f,D]=t.useState(null),[L,I]=t.useState(null);t.useEffect(()=>{w()},[]);const w=async()=>{var P,k;try{n(!0);const E=await z.get("/api/admin/backup-restore");i(E.data.backups||[])}catch(E){console.error("Failed to fetch backups:",E),K.error(((k=(P=E==null?void 0:E.response)==null?void 0:P.data)==null?void 0:k.message)||"Failed to load backups")}finally{n(!1)}},A=async()=>{var P,k;try{d(!0);const E=await z.post("/api/admin/backup-restore/create");K.success("Backup created successfully"),await w()}catch(E){console.error("Failed to create backup:",E),K.error(((k=(P=E==null?void 0:E.response)==null?void 0:P.data)==null?void 0:k.message)||"Failed to create backup")}finally{d(!1)}},_=async P=>{var k,E;try{const O=await z.get(`/api/admin/backup-restore/download/${P}`,{responseType:"blob"}),X=window.URL.createObjectURL(new Blob([O.data])),ee=document.createElement("a");ee.href=X,ee.setAttribute("download",P),document.body.appendChild(ee),ee.click(),ee.remove(),window.URL.revokeObjectURL(X),K.success("Backup downloaded")}catch(O){console.error("Failed to download backup:",O),K.error(((E=(k=O==null?void 0:O.response)==null?void 0:k.data)==null?void 0:E.message)||"Failed to download backup")}},H=async P=>{var k,E;if(window.confirm(`Are you sure you want to delete backup "${P}"?`))try{await z.delete(`/api/admin/backup-restore/${P}`),K.success("Backup deleted successfully"),await w()}catch(O){console.error("Failed to delete backup:",O),K.error(((E=(k=O==null?void 0:O.response)==null?void 0:k.data)==null?void 0:E.message)||"Failed to delete backup")}},T=async()=>{var P,k;if(!b&&!f){K.error("Please select a backup or upload a file");return}try{x(!0),h(null);const E=new FormData;u==="upload"&&f?E.append("file",f):u==="server"&&b&&E.append("filename",b);const O=await z.post("/api/admin/backup-restore/check-integrity",E,{headers:{"Content-Type":"multipart/form-data"}});h(O.data),O.data.missing_tables.length===0&&O.data.table_differences.length===0&&O.data.extra_tables.length===0?K.success("Integrity check passed - backup matches current database"):K("Integrity check found differences - see results below",{icon:"âš ï¸",duration:5e3})}catch(E){console.error("Failed to check integrity:",E),K.error(((k=(P=E==null?void 0:E.response)==null?void 0:P.data)==null?void 0:k.message)||"Failed to check integrity")}finally{x(!1)}},c=async()=>{var P,k;try{S(!0),p(!1);const E=new FormData;N==="upload"&&L?E.append("file",L):N==="server"&&m&&E.append("filename",m),await z.post("/api/admin/backup-restore/restore",E,{headers:{"Content-Type":"multipart/form-data"}}),K.success("Database restored successfully"),y(null),R(null),I(null)}catch(E){console.error("Failed to restore database:",E),K.error(((k=(P=E==null?void 0:E.response)==null?void 0:P.data)==null?void 0:k.message)||"Failed to restore database")}finally{S(!1)}},F=(P,k=null)=>{P==="server"&&k?(y(k),R("server"),p(!0)):P==="upload"&&L?(R("upload"),p(!0)):K.error("Please select a backup file first")};return a?e.jsx("div",{className:"container-fluid py-4",children:e.jsx(Pe,{})}):e.jsxs("div",{className:"container-fluid py-4 backup-restore-page",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsx("h2",{className:"mb-0",children:"Database Backup & Restore"}),e.jsx("button",{className:"btn btn-primary",onClick:A,disabled:r,children:r?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2"}),"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-plus-circle me-2"}),"Create Backup"]})})]}),e.jsxs("div",{className:"card mb-4",children:[e.jsx("div",{className:"card-header",children:e.jsx("h5",{className:"mb-0",children:"Server Backups"})}),e.jsx("div",{className:"card-body",children:s.length===0?e.jsx("p",{className:"text-muted mb-0",children:"No backups found. Create your first backup above."}):e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Filename"}),e.jsx("th",{children:"Created"}),e.jsx("th",{children:"Size"}),e.jsx("th",{children:"Age"}),e.jsx("th",{className:"text-end",children:"Actions"})]})}),e.jsx("tbody",{children:s.map(P=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{className:"text-primary",children:P.filename})}),e.jsx("td",{children:P.created_at_formatted}),e.jsx("td",{children:P.size_formatted}),e.jsx("td",{children:P.age}),e.jsx("td",{className:"text-end",children:e.jsxs("div",{className:"btn-group btn-group-sm",children:[e.jsx("button",{className:"btn btn-outline-primary",onClick:()=>_(P.filename),title:"Download",children:e.jsx("i",{className:"bi bi-download"})}),e.jsx("button",{className:"btn btn-outline-danger",onClick:()=>H(P.filename),title:"Delete",children:e.jsx("i",{className:"bi bi-trash"})})]})})]},P.filename))})]})})})]}),e.jsxs("div",{className:"card mb-4",children:[e.jsx("div",{className:"card-header",children:e.jsx("h5",{className:"mb-0",children:"Check Data Integrity"})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Select from server backups:"}),e.jsxs("select",{className:"form-select",value:b||"",onChange:P=>{C(P.target.value),j(P.target.value?"server":null),D(null)},children:[e.jsx("option",{value:"",children:"-- Select backup --"}),s.map(P=>e.jsxs("option",{value:P.filename,children:[P.filename," (",P.age,")"]},P.filename))]})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Or upload backup file:"}),e.jsx("input",{type:"file",className:"form-control",accept:".encrypted",onChange:P=>{const k=P.target.files[0];k&&(D(k),j("upload"),C(null))}})]})]}),e.jsx("button",{className:"btn btn-info",onClick:T,disabled:o||!b&&!f,children:o?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2"}),"Checking..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-shield-check me-2"}),"Check Integrity"]})}),l&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h6",{children:"Integrity Check Results"}),e.jsxs("div",{className:"alert alert-info",children:[e.jsx("strong",{children:"Backup Age:"})," ",l.backup_age||"Unknown",e.jsx("br",{}),e.jsx("strong",{children:"Backup Timestamp:"})," ",l.backup_timestamp||"Unknown"]}),e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-md-6",children:e.jsx("div",{className:"card bg-light",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h6",{className:"card-title",children:"Summary"}),e.jsxs("ul",{className:"list-unstyled mb-0",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Backup Tables:"})," ",l.summary.backup_tables_count]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Current Tables:"})," ",l.summary.current_tables_count]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Missing Tables:"})," ",l.summary.missing_tables_count]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Extra Tables:"})," ",l.summary.extra_tables_count]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Tables with Differences:"})," ",l.summary.tables_with_differences]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Total Backup Records:"})," ",l.summary.total_backup_records.toLocaleString()]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Total Current Records:"})," ",l.summary.total_current_records.toLocaleString()]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Records Difference:"}),e.jsxs("span",{className:l.summary.records_difference>0?"text-success":l.summary.records_difference<0?"text-danger":"",children:[" ",l.summary.records_difference>0?"+":"",l.summary.records_difference.toLocaleString()]})]})]})]})})})}),l.missing_tables.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("h6",{className:"text-danger",children:"Missing Tables (in backup but not in current database)"}),e.jsx("ul",{children:l.missing_tables.map((P,k)=>e.jsxs("li",{children:[e.jsx("strong",{children:P.table}),": ",P.backup_records," records in backup"]},k))})]}),l.extra_tables.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("h6",{className:"text-warning",children:"Extra Tables (in current database but not in backup)"}),e.jsx("ul",{children:l.extra_tables.map((P,k)=>e.jsxs("li",{children:[e.jsx("strong",{children:P.table}),": ",P.current_records," records"]},k))})]}),l.table_differences.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("h6",{className:"text-warning",children:"Tables with Record Count Differences"}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Table"}),e.jsx("th",{children:"Backup Records"}),e.jsx("th",{children:"Current Records"}),e.jsx("th",{children:"Difference"})]})}),e.jsx("tbody",{children:l.table_differences.map((P,k)=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:P.table})}),e.jsx("td",{children:P.backup_records.toLocaleString()}),e.jsx("td",{children:P.current_records.toLocaleString()}),e.jsxs("td",{className:P.difference>0?"text-success":"text-danger",children:[P.difference>0?"+":"",P.difference.toLocaleString()]})]},k))})]})})]})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-danger text-white",children:e.jsx("h5",{className:"mb-0",children:"Restore Database"})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"alert alert-danger",children:[e.jsx("strong",{children:"Warning:"})," Restoring will replace ALL current database data with the selected backup. This action is IRREVERSIBLE."]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Select from server backups:"}),e.jsxs("select",{className:"form-select",value:m||"",onChange:P=>{y(P.target.value),R(P.target.value?"server":null),I(null)},children:[e.jsx("option",{value:"",children:"-- Select backup --"}),s.map(P=>e.jsxs("option",{value:P.filename,children:[P.filename," (",P.age,")"]},P.filename))]})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Or upload backup file:"}),e.jsx("input",{type:"file",className:"form-control",accept:".encrypted",onChange:P=>{const k=P.target.files[0];k&&(I(k),R("upload"),y(null))}})]})]}),e.jsx("button",{className:"btn btn-danger",onClick:()=>F(N,m),disabled:v||!m&&!L,children:v?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2"}),"Restoring..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-arrow-counterclockwise me-2"}),"Restore Database"]})})]})]}),e.jsx(Ze,{show:g,onConfirm:c,onCancel:()=>{p(!1),y(null)},title:"Confirm Database Restore",message:"This action is IRREVERSIBLE and will replace all current database data with the selected backup. Current data will be permanently lost. Are you sure you want to proceed?",confirmText:"Yes, Restore Database",cancelText:"Cancel",variant:"danger"})]})},ca=({value:s,label:i})=>{if(s==null)return e.jsxs("span",{className:"badge bg-secondary",children:[i,": â€”"]});const a=s>=0,n=a?"bg-success":"bg-danger",r=a?"+":"";return e.jsxs("span",{className:`badge ${n}`,children:[i,": ",r,s," pts"]})},da=(s,i="")=>s==null?"â€”":`${Number(s).toFixed(2)}${i}`,Ta=s=>s==null?"â€”":`${Number(s).toFixed(2)}%`;function Vi({insights:s}){if(!s)return null;const i=s.responses_count>0;return e.jsxs("div",{className:"card border-0 shadow-sm",style:{background:"linear-gradient(135deg, #ffffff 0%, #f8fafc 100%)",borderRadius:"16px"},children:[e.jsxs("div",{className:"card-header border-0 bg-transparent py-4",children:[e.jsxs("h5",{className:"mb-1 fw-bold d-flex align-items-center",style:{color:"#1e293b"},children:[e.jsx("span",{className:"me-2",children:"ðŸ¦·"}),"Patient Retention Feedback"]}),e.jsxs("p",{className:"text-muted small mb-0",children:["Aggregated survey insights from the Patient Retention card (period ",s.period.start," to ",s.period.end,")"]})]}),e.jsx("div",{className:"card-body pt-0",children:i?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-md-4",children:e.jsxs("div",{className:"p-3 border rounded h-100",children:[e.jsx("div",{className:"text-muted text-uppercase small fw-semibold mb-1",children:"Overall experience"}),e.jsx("div",{className:"display-6 fw-bold text-primary",children:da(s.overall_score)}),e.jsx(ca,{value:s.overall_score_change,label:"Î” vs prev"}),e.jsxs("div",{className:"mt-2 text-muted small",children:["Previous: ",da(s.overall_score_prev)]})]})}),e.jsx("div",{className:"col-md-4",children:e.jsxs("div",{className:"p-3 border rounded h-100",children:[e.jsx("div",{className:"text-muted text-uppercase small fw-semibold mb-1",children:"Completion rate"}),e.jsx("div",{className:"display-6 fw-bold text-success",children:Ta(s.completion_rate)}),e.jsx(ca,{value:s.completion_rate_change,label:"Î” vs prev"}),e.jsxs("div",{className:"mt-2 text-muted small",children:["Previous: ",Ta(s.completion_rate_prev)]})]})}),e.jsx("div",{className:"col-md-4",children:e.jsxs("div",{className:"p-3 border rounded h-100",children:[e.jsx("div",{className:"text-muted text-uppercase small fw-semibold mb-1",children:"Responses captured"}),e.jsx("div",{className:"display-6 fw-bold text-info",children:s.responses_count}),e.jsxs("div",{className:"mt-2 text-muted small",children:["Previous period: ",s.responses_count_prev]})]})})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h6",{className:"fw-semibold mb-3",style:{color:"#374151"},children:"Question-level sentiment"}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-sm table-borderless align-middle",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-muted small text-uppercase",children:[e.jsx("th",{children:"Question"}),e.jsx("th",{className:"text-center",children:"Avg score"}),e.jsx("th",{className:"text-center",children:"Trend"}),e.jsx("th",{className:"text-center",children:"Responses"})]})}),e.jsx("tbody",{children:(s.questions||[]).map(a=>e.jsxs("tr",{className:"bg-white",children:[e.jsx("td",{style:{maxWidth:"360px"},children:e.jsx("div",{className:"fw-semibold",children:a.label})}),e.jsx("td",{className:"text-center fw-bold",children:da(a.avg_score)}),e.jsx("td",{className:"text-center",children:e.jsx(ca,{value:a.change,label:"Î”"})}),e.jsx("td",{className:"text-center text-muted",children:a.responses})]},a.key))})]})})]})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"fs-1 mb-2",children:"ðŸ“­"}),e.jsx("p",{className:"text-muted mb-0",children:"No feedback submissions for this period."}),e.jsx("small",{className:"text-muted",children:"Encourage patients to submit ratings within 7 days of their visits to populate this card."})]})})]})}pa.register(ba,fa,Qs,ga,Js,Ua,ja,va,Na,Rt);const Ys=s=>{const[i,a]=String(s||"").split("-").map(Number);return!i||!a?"":new Date(i,a-1,1).toLocaleString("en-US",{month:"short",year:"numeric"})},Ds=s=>{const[i,a]=String(s||"").split("-").map(Number);if(!i||!a)return s;const n=new Date(i,a-1,1);return n.setMonth(n.getMonth()-1),`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}`};function Oi(s,i){if(s==null||i===-100&&s===0)return 0;const a=1+(i??0)/100;return a===0?0:Number((s/a).toFixed(2))}const Ui=(s,i,a=0)=>{const n=Number(s??0),r=Number(i??0);return r===0?n===0?0:typeof a=="number"?a:0:Number(((n-r)/r*100).toFixed(2))},qi=s=>{if(!s)return null;const i={...s};return i.insights&&!Array.isArray(i.insights)&&(console.warn("Insights data is not an array, converting..."),i.insights=[]),i},Yi=(s,i)=>{const a=(s==null?void 0:s.kpis)||{},n=(i==null?void 0:i.kpis)||{},r={};if(Object.entries(a).forEach(([d,l])=>{if(l&&typeof l=="object"&&"value"in l){const h=n[d],o=(h&&typeof h.value=="number"?h.value:(l==null?void 0:l.prev)??Oi(l==null?void 0:l.value,l==null?void 0:l.pct_change))??0;r[d]={...l,prev:o,pct_change:Ui(l==null?void 0:l.value,o,l==null?void 0:l.pct_change)}}else r[d]=l}),a.payment_method_share){const d={};["cash","hmo","maya"].forEach(l=>{var p;const h=a.payment_method_share[l]||{},o=((p=n.payment_method_share)==null?void 0:p[l])||{},x=typeof o.share_pct=="number"?o.share_pct:null;let g=h.pct_point_change??0;typeof h.share_pct=="number"&&typeof x=="number"&&(g=Number((h.share_pct-x).toFixed(2))),d[l]={...h,pct_point_change:g,compare_share_pct:x}}),r.payment_method_share=d}return r};function Ki(){var J,ie,B,le,M,U,G,Y,se,oe,pe,ce,be,ve,Ie,js,Ye,Es,as,vs,$s;const[s,i]=t.useState(()=>new Date().toISOString().slice(0,7)),[a,n]=t.useState(()=>Ds(new Date().toISOString().slice(0,7))),[r,d]=t.useState(6),[l,h]=t.useState("visits"),[o,x]=t.useState(!1),[g,p]=t.useState({}),[m,y]=t.useState(null),[N,R]=t.useState("monthly"),[v,S]=t.useState(""),[u,j]=t.useState(""),b=t.useCallback(async(V,{force:Q=!1}={})=>{var de,me,xe,Ne;if(!V)return null;const te=g[V];if(!Q&&(te!=null&&te.data)&&!(te!=null&&te.error))return te.data;p(fe=>({...fe,[V]:{data:(te==null?void 0:te.data)??null,loading:!0,error:""}}));try{const fe=await z.get("/api/analytics/summary",{params:{period:V}}),ye=qi(fe.data||null);return console.log("Analytics API Response:",ye),console.log("Has insights:",ye!=null&&ye.insights?"Yes":"No"),console.log("Insights count:",((de=ye==null?void 0:ye.insights)==null?void 0:de.length)||0),p(Me=>({...Me,[V]:{data:ye,loading:!1,error:""}})),ye}catch(fe){console.error("Analytics loading error:",fe),console.error("Error response:",(me=fe==null?void 0:fe.response)==null?void 0:me.data);const Me=`${((Ne=(xe=fe==null?void 0:fe.response)==null?void 0:xe.data)==null?void 0:Ne.message)||(fe==null?void 0:fe.message)||"Failed to load analytics."} (${V})`;return p(ze=>({...ze,[V]:{...ze[V]||{},loading:!1,error:Me}})),null}},[g]),C=(a||"").trim()||Ds(s);t.useEffect(()=>{const V=[s].filter(Boolean);C&&C!==s&&V.push(C),V.forEach(Q=>b(Q))},[s,C,b]);const f=((J=g[s])==null?void 0:J.data)||null,D=C&&((ie=g[C])==null?void 0:ie.data)||null,L=!!((B=g[s])!=null&&B.loading)||!!(C&&C!==s&&((le=g[C])!=null&&le.loading)),I=((M=g[s])==null?void 0:M.error)||(C&&C!==s?(U=g[C])==null?void 0:U.error:"")||"",w=()=>{Array.from(new Set([s,C].filter(Q=>!!Q&&Q.length))).forEach(Q=>b(Q,{force:!0}))},A=async()=>{var V;x(!0);try{const Q={months:r};l==="revenue"&&(N==="yearly"&&(Q.yearly=!0),v&&u&&(Q.start_date=v,Q.end_date=u));const de=(await z.get("/api/analytics/trend",{params:Q})).data||null;console.log("Trend API Parameters:",Q),console.log("Selected Metric:",l),console.log("Revenue Timeframe:",N),console.log("Revenue Start Date:",v),console.log("Revenue End Date:",u),console.log("Revenue Controls Should Show:",l==="revenue"),y(de)}catch(Q){console.error("Trend loading error:",Q),console.error("Error response:",(V=Q==null?void 0:Q.response)==null?void 0:V.data)}finally{x(!1)}};t.useEffect(()=>{l!=="revenue"&&(console.log("Clearing revenue controls for metric:",l),R("monthly"),S(""),j(""))},[l]),t.useEffect(()=>{A()},[r,l,N,v,u]);const _=async()=>{var V,Q,te,de,me,xe,Ne,fe,ye,Me,ze,We,Be,He,Ve,Oe,Ue,qe,ts,is,ls,ns,rs,cs,ds,Ee,Ns,ys,ws,_s,Ss,ks,Cs,Xe,hs,xs;try{const{default:Ke}=await Ae(async()=>{const{default:Re}=await import("./pdf-vendor-BZobkf7J.js").then(_e=>_e.j);return{default:Re}},[]),{default:Qe}=await Ae(async()=>{const{default:Re}=await import("./pdf-vendor-BZobkf7J.js").then(_e=>_e.b);return{default:Re}},[]),ge=new Ke({orientation:"p",unit:"pt",format:"a4"}),Ge=(Re,_e,$e)=>(Re.setFontSize(12),Re.setFont("helvetica","bold"),Re.setTextColor(0,119,182),Re.text(_e,40,$e),Re.setTextColor(0,0,0),$e+15);let ue=await ya(ge,20);if(ge.setFontSize(14),ge.setFont("helvetica","bold"),ge.text("Analytics Dashboard Report",40,ue),ue+=20,ge.setFontSize(10),ge.setFont("helvetica","normal"),ge.text(`Report Period: ${s}`,40,ue),ue+=15,m&&m.labels&&m.labels.length>0){const Re=`Trend Analysis: ${l.charAt(0).toUpperCase()+l.slice(1)} over ${m.labels.length} periods`;if(ge.text(Re,40,ue),ue+=15,l==="revenue"&&v&&u){const _e=`Custom Date Range: ${v} to ${u}`;ge.text(_e,40,ue),ue+=15}if(l==="revenue"&&N){const _e=`Time Period: ${N.charAt(0).toUpperCase()+N.slice(1)}`;ge.text(_e,40,ue),ue+=15}}ue+=15,ue=Ge(ge,"Key Performance Indicators",ue);const ps=[["Metric","Current","Previous","Change","Trend"],["Total Visits",String(((V=c==null?void 0:c.total_visits)==null?void 0:V.value)??0),String(((Q=c==null?void 0:c.total_visits)==null?void 0:Q.prev)??0),`${((te=c==null?void 0:c.total_visits)==null?void 0:te.pct_change)??0}%`,(((de=c==null?void 0:c.total_visits)==null?void 0:de.pct_change)??0)>=0?"+ Positive":"- Negative"],["Approved Appts",String(((me=c==null?void 0:c.approved_appointments)==null?void 0:me.value)??0),String(((xe=c==null?void 0:c.approved_appointments)==null?void 0:xe.prev)??0),`${((Ne=c==null?void 0:c.approved_appointments)==null?void 0:Ne.pct_change)??0}%`,(((fe=c==null?void 0:c.approved_appointments)==null?void 0:fe.pct_change)??0)>=0?"+ Positive":"- Negative"],["No-shows",String(((ye=c==null?void 0:c.no_shows)==null?void 0:ye.value)??0),String(((Me=c==null?void 0:c.no_shows)==null?void 0:Me.prev)??0),`${((ze=c==null?void 0:c.no_shows)==null?void 0:ze.pct_change)??0}%`,(((We=c==null?void 0:c.no_shows)==null?void 0:We.pct_change)??0)>=0?"+ Concern":"- Better"],["Avg Duration (min)",String(((Be=c==null?void 0:c.avg_visit_duration_min)==null?void 0:Be.value)??0),String(((He=c==null?void 0:c.avg_visit_duration_min)==null?void 0:He.prev)??0),`${((Ve=c==null?void 0:c.avg_visit_duration_min)==null?void 0:Ve.pct_change)??0}%`,(((Oe=c==null?void 0:c.avg_visit_duration_min)==null?void 0:Oe.pct_change)??0)>=0?"+ Longer":"- Shorter"],["Revenue",`PHP ${(((Ue=c==null?void 0:c.total_revenue)==null?void 0:Ue.value)??0).toLocaleString()}`,`PHP ${(((qe=c==null?void 0:c.total_revenue)==null?void 0:qe.prev)??0).toLocaleString()}`,`${((ts=c==null?void 0:c.total_revenue)==null?void 0:ts.pct_change)??0}%`,(((is=c==null?void 0:c.total_revenue)==null?void 0:is.pct_change)??0)>=0?"+ Growth":"- Decline"]];Qe(ge,{startY:ue,head:[ps[0]],body:ps.slice(1),theme:"striped",styles:{fontSize:9,cellPadding:4,overflow:"linebreak"},headStyles:{fillColor:[59,130,246],textColor:255,fontStyle:"bold",fontSize:9},columnStyles:{0:{cellWidth:100},1:{cellWidth:80},2:{cellWidth:80},3:{cellWidth:60},4:{cellWidth:70}}}),ue=Ge(ge,"Payment Method Distribution",(((ls=ge.lastAutoTable)==null?void 0:ls.finalY)||100)+20);const Is=[["Payment Method","Count","Percentage"],["Cash",String(((rs=(ns=c==null?void 0:c.payment_method_share)==null?void 0:ns.cash)==null?void 0:rs.count)??0),`${((ds=(cs=c==null?void 0:c.payment_method_share)==null?void 0:cs.cash)==null?void 0:ds.share_pct)??0}%`],["HMO",String(((Ns=(Ee=c==null?void 0:c.payment_method_share)==null?void 0:Ee.hmo)==null?void 0:Ns.count)??0),`${((ws=(ys=c==null?void 0:c.payment_method_share)==null?void 0:ys.hmo)==null?void 0:ws.share_pct)??0}%`],["Maya",String(((Ss=(_s=c==null?void 0:c.payment_method_share)==null?void 0:_s.maya)==null?void 0:Ss.count)??0),`${((Cs=(ks=c==null?void 0:c.payment_method_share)==null?void 0:ks.maya)==null?void 0:Cs.share_pct)??0}%`]];if(Qe(ge,{startY:ue,head:[Is[0]],body:Is.slice(1),theme:"striped"}),((Xe=T==null?void 0:T.top_revenue_services)==null?void 0:Xe.length)>0){ue=Ge(ge,"Revenue by Service",(((hs=ge.lastAutoTable)==null?void 0:hs.finalY)||100)+20);const Re=[["Service","Current Revenue","Previous Revenue","Change (%)"],...T.top_revenue_services.map(_e=>[_e.service_name,`PHP ${_e.revenue.toLocaleString()}`,`PHP ${(_e.prev_revenue||0).toLocaleString()}`,`${_e.pct_change||0}%`])];Qe(ge,{startY:ue,head:[Re[0]],body:Re.slice(1),theme:"striped"})}if(m&&m.labels&&m.labels.length>0){ue=Ge(ge,"Monthly Trends Analysis",(((xs=ge.lastAutoTable)==null?void 0:xs.finalY)||100)+20),ge.setFontSize(9),ge.setFont("helvetica","normal"),ge.text(`Metric: ${l.charAt(0).toUpperCase()+l.slice(1)}`,40,ue),ue+=12,l==="revenue"&&(ge.text(`Time Period: ${N.charAt(0).toUpperCase()+N.slice(1)}`,40,ue),ue+=12,v&&u&&(ge.text(`Custom Range: ${v} to ${u}`,40,ue),ue+=12)),ue+=5;const Re=[["Period","Visits","Appointments","Revenue","Loss"],...m.labels.map((_e,$e)=>{var Ws,sa,Bs,Hs;return[_e,String(((Ws=m.visits)==null?void 0:Ws[$e])??0),String(((sa=m.appointments)==null?void 0:sa[$e])??0),`PHP ${(((Bs=m.revenue)==null?void 0:Bs[$e])??0).toLocaleString()}`,`PHP ${(((Hs=m.loss)==null?void 0:Hs[$e])??0).toLocaleString()}`]})];Qe(ge,{startY:ue,head:[Re[0]],body:Re.slice(1),theme:"striped",styles:{fontSize:8},headStyles:{fillColor:[59,130,246],textColor:255,fontStyle:"bold"}})}ge.save(`analytics-report-${s}.pdf`)}catch(Ke){console.error(Ke),K.error("Failed to generate PDF.")}},H=async()=>{var V,Q,te,de,me,xe,Ne,fe,ye,Me,ze,We,Be,He,Ve,Oe,Ue,qe,ts,is,ls,ns,rs,cs,ds,Ee,Ns,ys,ws,_s,Ss,ks,Cs;try{const{styleHeaderRow:Xe,styleDataRow:hs,addWorksheetHeader:xs,formatCurrency:Ke,formatPercentage:Qe,styleTotalRow:ge}=await Ae(async()=>{const{styleHeaderRow:ke,styleDataRow:Le,addWorksheetHeader:De,formatCurrency:os,formatPercentage:Fe,styleTotalRow:ms}=await import("./excelStyling-eUgbKu7T.js");return{styleHeaderRow:ke,styleDataRow:Le,addWorksheetHeader:De,formatCurrency:os,formatPercentage:Fe,styleTotalRow:ms}},[]),Ge=new qa.Workbook,ue=Ge.addWorksheet("KPI Overview");let ps=xs(ue,"Analytics Dashboard Report",`Report Period: ${s}`);const Is=ue.addRow(["Metric","Current Value","Previous Value","Change (%)","Trend Status"]);Xe(Is),[["Total Visits",((V=c==null?void 0:c.total_visits)==null?void 0:V.value)??0,((Q=c==null?void 0:c.total_visits)==null?void 0:Q.prev)??0,(((te=c==null?void 0:c.total_visits)==null?void 0:te.pct_change)??0)/100,(((de=c==null?void 0:c.total_visits)==null?void 0:de.pct_change)??0)>=0?"Positive":"Negative"],["Approved Appointments",((me=c==null?void 0:c.approved_appointments)==null?void 0:me.value)??0,((xe=c==null?void 0:c.approved_appointments)==null?void 0:xe.prev)??0,(((Ne=c==null?void 0:c.approved_appointments)==null?void 0:Ne.pct_change)??0)/100,(((fe=c==null?void 0:c.approved_appointments)==null?void 0:fe.pct_change)??0)>=0?"Positive":"Negative"],["No-shows",((ye=c==null?void 0:c.no_shows)==null?void 0:ye.value)??0,((Me=c==null?void 0:c.no_shows)==null?void 0:Me.prev)??0,(((ze=c==null?void 0:c.no_shows)==null?void 0:ze.pct_change)??0)/100,(()=>{var os,Fe,ms;const ke=((os=c==null?void 0:c.no_shows)==null?void 0:os.value)??0,Le=((Fe=c==null?void 0:c.no_shows)==null?void 0:Fe.prev)??0,De=((ms=c==null?void 0:c.no_shows)==null?void 0:ms.pct_change)??0;return ke===0&&Le===0||ke===0&&Le>0?"Excellent":Le===0&&ke>0||De>=0?"Concerning":"Improving"})()],["Avg Visit Duration (min)",((We=c==null?void 0:c.avg_visit_duration_min)==null?void 0:We.value)??0,((Be=c==null?void 0:c.avg_visit_duration_min)==null?void 0:Be.prev)??0,(((He=c==null?void 0:c.avg_visit_duration_min)==null?void 0:He.pct_change)??0)/100,(((Ve=c==null?void 0:c.avg_visit_duration_min)==null?void 0:Ve.pct_change)??0)>=0?"Longer":"Shorter"]].forEach((ke,Le)=>{const De=ue.addRow(ke);hs(De,Le),Qe(De.getCell(4))});const _e=ue.addRow(["Total Revenue",((Oe=c==null?void 0:c.total_revenue)==null?void 0:Oe.value)??0,((Ue=c==null?void 0:c.total_revenue)==null?void 0:Ue.prev)??0,(((qe=c==null?void 0:c.total_revenue)==null?void 0:qe.pct_change)??0)/100,(((ts=c==null?void 0:c.total_revenue)==null?void 0:ts.pct_change)??0)>=0?"Growth":"Decline"]);ge(_e),Ke(_e.getCell(2)),Ke(_e.getCell(3)),Qe(_e.getCell(4)),ue.columns=[{width:25},{width:20},{width:20},{width:12},{width:15}];const $e=Ge.addWorksheet("Payment Methods");ps=xs($e,"Payment Method Analysis",`Report Period: ${s}`);const Ws=$e.addRow(["Payment Method","Count","Percentage"]);if(Xe(Ws),[["Cash",((ls=(is=c==null?void 0:c.payment_method_share)==null?void 0:is.cash)==null?void 0:ls.count)??0,(((rs=(ns=c==null?void 0:c.payment_method_share)==null?void 0:ns.cash)==null?void 0:rs.share_pct)??0)/100],["HMO",((ds=(cs=c==null?void 0:c.payment_method_share)==null?void 0:cs.hmo)==null?void 0:ds.count)??0,(((Ns=(Ee=c==null?void 0:c.payment_method_share)==null?void 0:Ee.hmo)==null?void 0:Ns.share_pct)??0)/100],["Maya",((ws=(ys=c==null?void 0:c.payment_method_share)==null?void 0:ys.maya)==null?void 0:ws.count)??0,(((Ss=(_s=c==null?void 0:c.payment_method_share)==null?void 0:_s.maya)==null?void 0:Ss.share_pct)??0)/100]].forEach((ke,Le)=>{const De=$e.addRow(ke);hs(De,Le),Qe(De.getCell(3))}),$e.columns=[{width:20},{width:12},{width:12}],((ks=T==null?void 0:T.top_revenue_services)==null?void 0:ks.length)>0){const ke=Ge.addWorksheet("Revenue by Service");ps=xs(ke,"Revenue by Service",`Report Period: ${s}`);const Le=ke.addRow(["Service","Current Revenue","Previous Revenue","Change (%)"]);Xe(Le),T.top_revenue_services.forEach((De,os)=>{const Fe=ke.addRow([De.service_name,De.revenue||0,De.prev_revenue||0,(De.pct_change||0)/100]);hs(Fe,os),Ke(Fe.getCell(2)),Ke(Fe.getCell(3)),Qe(Fe.getCell(4))}),ke.columns=[{width:30},{width:20},{width:20},{width:12}]}if(((Cs=m==null?void 0:m.labels)==null?void 0:Cs.length)>0){const ke=Ge.addWorksheet("Trend Analysis");let Le=`Metric: ${l.charAt(0).toUpperCase()+l.slice(1)} | Time Range: ${m.labels.length} periods`;l==="revenue"&&N&&(Le+=` | Period: ${N.charAt(0).toUpperCase()+N.slice(1)}`),l==="revenue"&&v&&u&&(Le+=` | Custom Range: ${v} to ${u}`),ps=xs(ke,"Trend Analysis",Le);const De=ke.addRow(["Period","Visits","Appointments","Revenue","Loss"]);Xe(De),m.labels.forEach((os,Fe)=>{var ka,Ca,Ra,Pa;const ms=ke.addRow([os,((ka=m.visits)==null?void 0:ka[Fe])??0,((Ca=m.appointments)==null?void 0:Ca[Fe])??0,((Ra=m.revenue)==null?void 0:Ra[Fe])??0,((Pa=m.loss)==null?void 0:Pa[Fe])??0]);hs(ms,Fe),Ke(ms.getCell(4)),Ke(ms.getCell(5))}),ke.columns=[{width:20},{width:12},{width:15},{width:18},{width:18}]}const Bs=await Ge.xlsx.writeBuffer(),Hs=new Blob([Bs],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),Sa=window.URL.createObjectURL(Hs),aa=document.createElement("a");aa.href=Sa,aa.download=`analytics-report-${s}.xlsx`,aa.click(),window.URL.revokeObjectURL(Sa)}catch(Xe){console.error(Xe),K.error("Failed to generate Excel file.")}},T=f,c=t.useMemo(()=>Yi(f,D),[f,D]),F=t.useMemo(()=>{var de,me,xe;const V=((de=c==null?void 0:c.payment_method_share)==null?void 0:de.cash)??{},Q=((me=c==null?void 0:c.payment_method_share)==null?void 0:me.hmo)??{},te=((xe=c==null?void 0:c.payment_method_share)==null?void 0:xe.maya)??{};return{labels:["Cash","HMO","Maya"],datasets:[{label:"This Month",backgroundColor:["rgba(34, 197, 94, 0.8)","rgba(139, 92, 246, 0.8)","rgba(59, 130, 246, 0.8)"],borderColor:["rgba(34, 197, 94, 1)","rgba(139, 92, 246, 1)","rgba(59, 130, 246, 1)"],borderWidth:2,borderRadius:8,borderSkipped:!1,data:[Number(V.share_pct||0),Number(Q.share_pct||0),Number(te.share_pct||0)]}]}},[c]),P=t.useMemo(()=>({responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{enabled:!0,backgroundColor:"rgba(0, 0, 0, 0.8)",titleColor:"white",bodyColor:"white",borderColor:"rgba(255, 255, 255, 0.1)",borderWidth:1,cornerRadius:8,displayColors:!1,callbacks:{label:function(V){return`${V.label}: ${V.parsed.y}%`}}}},scales:{x:{grid:{display:!1},ticks:{color:"#6b7280",font:{size:12,weight:"500"}}},y:{beginAtZero:!0,max:100,grid:{color:"rgba(107, 114, 128, 0.1)",drawBorder:!1},ticks:{callback:V=>`${V}%`,color:"#6b7280",font:{size:12,weight:"500"}}}}}),[]),k=t.useMemo(()=>{var fe,ye,Me,ze,We,Be,He,Ve,Oe,Ue,qe,ts,is,ls,ns,rs,cs,ds;const te=[ne||"Primary Month",re||"Compare Month"],de=((fe=c==null?void 0:c.total_visits)==null?void 0:fe.value)||0,me=((ye=c==null?void 0:c.approved_appointments)==null?void 0:ye.value)||0,xe=((Me=c==null?void 0:c.no_shows)==null?void 0:Me.value)||0,Ne=((ze=c==null?void 0:c.avg_visit_duration_min)==null?void 0:ze.value)||0;return(We=c==null?void 0:c.total_revenue)!=null&&We.value,(Be=c==null?void 0:c.total_revenue)!=null&&Be.prev,[{id:"visits",title:"Total Visits",icon:"ðŸ‘¥",value:de,prevValue:((He=c==null?void 0:c.total_visits)==null?void 0:He.prev)||0,change:((Ve=c==null?void 0:c.total_visits)==null?void 0:Ve.pct_change)||0,color:"#8B5CF6",glowColor:"rgba(139, 92, 246, 0.4)",data:{labels:te,datasets:[{data:[de,((Oe=c==null?void 0:c.total_visits)==null?void 0:Oe.prev)||0],backgroundColor:["#8B5CF6","rgba(139, 92, 246, 0.3)"],borderColor:["#8B5CF6","rgba(139, 92, 246, 0.5)"],borderWidth:3,hoverBackgroundColor:["#7C3AED","rgba(139, 92, 246, 0.4)"]}]},formatter:Ee=>Ee.toString()},{id:"approved",title:"Approved Appointments",icon:"âœ…",value:me,prevValue:((Ue=c==null?void 0:c.approved_appointments)==null?void 0:Ue.prev)||0,change:((qe=c==null?void 0:c.approved_appointments)==null?void 0:qe.pct_change)||0,color:"#0EA5E9",glowColor:"rgba(14, 165, 233, 0.4)",data:{labels:te,datasets:[{data:[me,((ts=c==null?void 0:c.approved_appointments)==null?void 0:ts.prev)||0],backgroundColor:["#0EA5E9","rgba(14, 165, 233, 0.3)"],borderColor:["#0EA5E9","rgba(14, 165, 233, 0.5)"],borderWidth:3,hoverBackgroundColor:["#0284C7","rgba(14, 165, 233, 0.4)"]}]},formatter:Ee=>Ee.toString()},{id:"noshows",title:"No-shows",icon:"âŒ",value:xe,prevValue:((is=c==null?void 0:c.no_shows)==null?void 0:is.prev)||0,change:((ls=c==null?void 0:c.no_shows)==null?void 0:ls.pct_change)||0,color:"#FF6B6B",glowColor:"rgba(255, 107, 107, 0.4)",data:{labels:te,datasets:[{data:[xe,((ns=c==null?void 0:c.no_shows)==null?void 0:ns.prev)||0],backgroundColor:["#FF6B6B","rgba(255, 107, 107, 0.3)"],borderColor:["#FF6B6B","rgba(255, 107, 107, 0.5)"],borderWidth:3,hoverBackgroundColor:["#EF4444","rgba(255, 107, 107, 0.4)"]}]},formatter:Ee=>Ee.toString()},{id:"avgtime",title:"Average Visit Time",icon:"â±ï¸",value:Ne,prevValue:((rs=c==null?void 0:c.avg_visit_duration_min)==null?void 0:rs.prev)||0,change:((cs=c==null?void 0:c.avg_visit_duration_min)==null?void 0:cs.pct_change)||0,color:"#84CC16",glowColor:"rgba(132, 204, 22, 0.4)",data:{labels:te,datasets:[{data:[Ne,((ds=c==null?void 0:c.avg_visit_duration_min)==null?void 0:ds.prev)||0],backgroundColor:["#84CC16","rgba(132, 204, 22, 0.3)"],borderColor:["#84CC16","rgba(132, 204, 22, 0.5)"],borderWidth:3,hoverBackgroundColor:["#65A30D","rgba(132, 204, 22, 0.4)"]}]},formatter:Ee=>`${Ee} min`}]},[c,ne,re]),E=V=>({responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"bottom",align:"center",labels:{usePointStyle:!0,pointStyle:"circle",padding:15,font:{size:12,weight:"600",family:"'Inter', 'Segoe UI', sans-serif"},color:"#374151",boxWidth:12,boxHeight:12,generateLabels:function(Q){const te=Q.data;return te.labels.length&&te.datasets.length?te.labels.map((de,me)=>{const xe=te.datasets[0];xe.data[me];const Ne=xe.backgroundColor[me];return{text:de,fillStyle:Ne,strokeStyle:Ne,lineWidth:0,pointStyle:"circle",hidden:!1,index:me}}):[]}}},tooltip:{enabled:!0,backgroundColor:"rgba(0, 0, 0, 0.9)",titleColor:"white",bodyColor:"white",borderColor:V.color,borderWidth:2,cornerRadius:12,displayColors:!0,titleFont:{size:14,weight:"bold"},bodyFont:{size:13,weight:"500"},padding:12,callbacks:{label:function(Q){const te=Q.parsed,de=Q.dataset.data.reduce((xe,Ne)=>xe+Ne,0),me=(te/de*100).toFixed(1);return`${Q.label}: ${V.formatter(te)} (${me}%)`}}}},elements:{arc:{borderWidth:0}},interaction:{intersect:!1,mode:"nearest"},animation:{animateRotate:!0,animateScale:!0,duration:1200,easing:"easeOutQuart"}});t.useMemo(()=>{var Q,te,de,me;if(!T)return null;const V=xe=>xe>0?`â–² ${xe}%`:xe<0?`â–¼ ${Math.abs(xe)}%`:"â€”";return{visits:`Change vs ${W}: ${V(((Q=c==null?void 0:c.total_visits)==null?void 0:Q.pct_change)||0)}`,approved:`Change vs ${W}: ${V(((te=c==null?void 0:c.approved_appointments)==null?void 0:te.pct_change)||0)}`,noShows:`Change vs ${W}: ${V(((de=c==null?void 0:c.no_shows)==null?void 0:de.pct_change)||0)}`,avgDuration:`Change vs ${W}: ${V(((me=c==null?void 0:c.avg_visit_duration_min)==null?void 0:me.pct_change)||0)}`}},[T,c]);const O=t.useMemo(()=>{var Ne,fe,ye,Me,ze,We,Be,He,Ve,Oe,Ue,qe;const V=((fe=(Ne=c==null?void 0:c.payment_method_share)==null?void 0:Ne.cash)==null?void 0:fe.share_pct)??0,Q=((Me=(ye=c==null?void 0:c.payment_method_share)==null?void 0:ye.hmo)==null?void 0:Me.share_pct)??0,te=((We=(ze=c==null?void 0:c.payment_method_share)==null?void 0:ze.maya)==null?void 0:We.share_pct)??0,de=((He=(Be=c==null?void 0:c.payment_method_share)==null?void 0:Be.cash)==null?void 0:He.pct_point_change)??0,me=((Oe=(Ve=c==null?void 0:c.payment_method_share)==null?void 0:Ve.hmo)==null?void 0:Oe.pct_point_change)??0,xe=((qe=(Ue=c==null?void 0:c.payment_method_share)==null?void 0:Ue.maya)==null?void 0:qe.pct_point_change)??0;return V===0&&Q===0&&te===0?null:`Cash: ${V}% (${de>=0?"â–²":"â–¼"}${Math.abs(de)}), HMO: ${Q}% (${me>=0?"â–²":"â–¼"}${Math.abs(me)}), Maya: ${te}% (${xe>=0?"â–²":"â–¼"}${Math.abs(xe)}). `+(te>40?"Tip: Strong digital payment adoption. Monitor Maya transaction fees.":Q>50?"Tip: Monitor insurer approval times and patient satisfaction with HMO processes.":"Tip: Payment preferences vary by patient demographics and insurance coverage.")},[c]),X=t.useMemo(()=>{var me,xe,Ne,fe;const V=((me=c==null?void 0:c.patient_follow_up_rate)==null?void 0:me.value)??0,Q=((xe=c==null?void 0:c.patient_follow_up_rate)==null?void 0:xe.pct_change)??0,te=((Ne=c==null?void 0:c.patient_follow_up_rate)==null?void 0:Ne.total_first_time_patients)??0,de=((fe=c==null?void 0:c.patient_follow_up_rate)==null?void 0:fe.returned_patients)??0;return te===0?null:`Follow-up rate: ${V}% (${de}/${te} patients returned within 3-4 months). Change: ${Q>=0?"â–²":"â–¼"}${Math.abs(Q)}%. `+(V>=50?"Excellent retention! This indicates strong patient satisfaction.":V>=30?"Good retention. Consider strategies to improve further.":"Consider implementing follow-up calls, appointment reminders, or patient satisfaction surveys.")},[c]);t.useMemo(()=>{const V=((T==null?void 0:T.top_services)||[])[0];if(!V)return null;const Q=V.pct_change??0;return`Top service: ${V.service_name} (Î” ${Q>=0?"â–²":"â–¼"}${Math.abs(Q)}% vs ${W}). Tip: Align stock/staffing; promote under-performers.`},[T]);const ee=t.useMemo(()=>{if(!(T!=null&&T.insights))return[];const V={high:0,medium:1,low:2},Q=3,te=de=>V[String(de).toLowerCase()]??Q;return T.insights.map((de,me)=>({insight:de,index:me})).sort((de,me)=>{const xe=te(de.insight.priority)-te(me.insight.priority);return xe!==0?xe:de.index-me.index}).map(({insight:de})=>de)},[T==null?void 0:T.insights]),ae=V=>typeof V=="number"?`${V>0?"+":""}${V.toFixed(2)}%`:"0%",ne=Ys(s),re=Ys(C),W=re||"previous month",$=t.useMemo(()=>{if(!m)return null;const Q={visits:{label:"Visits",data:m.visits,borderColor:"#3b82f6",backgroundColor:"rgba(59, 130, 246, 0.1)",yAxisID:"y"},appointments:{label:"Appointments",data:m.appointments,borderColor:"#10b981",backgroundColor:"rgba(16, 185, 129, 0.1)",yAxisID:"y"},revenue:{label:"Revenue",data:m.revenue,borderColor:"#f59e0b",backgroundColor:"rgba(245, 158, 11, 0.1)",yAxisID:"y1"},loss:{label:"Loss",data:m.loss||[],borderColor:"#ef4444",backgroundColor:"rgba(239, 68, 68, 0.1)",yAxisID:"y1"}}[l];return Q?{labels:m.labels,datasets:[{label:Q.label,data:Q.data,borderColor:Q.borderColor,backgroundColor:Q.backgroundColor,tension:.4,pointRadius:4,pointHoverRadius:6,borderWidth:3,fill:!1,yAxisID:Q.yAxisID}]}:null},[m,l]),q=t.useMemo(()=>({responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"top",labels:{usePointStyle:!0,padding:20,font:{size:12,weight:"500"}}},tooltip:{enabled:!0,backgroundColor:"rgba(0, 0, 0, 0.8)",titleColor:"white",bodyColor:"white",borderColor:"rgba(255, 255, 255, 0.1)",borderWidth:1,cornerRadius:8,displayColors:!0,callbacks:{label:function(V){const Q=V.dataset.label,te=V.parsed.y;return Q==="Revenue"?`${Q}: â‚±${te.toLocaleString()}`:Q==="Loss"?`${Q}: â‚±${te.toLocaleString()}`:`${Q}: ${te}`}}}},scales:{x:{grid:{display:!1},ticks:{color:"#6b7280",font:{size:12,weight:"500"}}},y:{type:"linear",display:!0,position:"left",beginAtZero:!0,grid:{color:"rgba(107, 114, 128, 0.1)",drawBorder:!1},ticks:{color:"#6b7280",font:{size:12,weight:"500"}}},y1:{type:"linear",display:!0,position:"right",beginAtZero:!0,grid:{drawOnChartArea:!1},ticks:{color:"#6b7280",font:{size:12,weight:"500"},callback:function(V){return`â‚±${V.toLocaleString()}`}}}}}),[]);return e.jsx(e.Fragment,{children:e.jsx("div",{className:"analytics-dashboard-page",style:{minHeight:"100vh",width:"100vw",position:"relative",left:0,right:0,padding:"1.5rem 2rem",boxSizing:"border-box",background:"linear-gradient(135deg, #F8FAFC 0%, #E2E8F0 50%, #CBD5E1 100%)",color:"#1E293B"},children:e.jsxs("div",{className:"container-xl",children:[e.jsxs("div",{className:"d-flex flex-column flex-lg-row justify-content-between align-items-start align-items-lg-center mb-5 gap-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"m-0 fw-bold",style:{color:"#1E293B",fontSize:"2.5rem",textShadow:"0 2px 4px rgba(0, 0, 0, 0.1)"},children:"ðŸ“Š Analytics Dashboard"}),e.jsx("p",{className:"mb-0 mt-2",style:{color:"#64748B",fontSize:"1.1rem"},children:"Real-time insights and performance metrics for your clinic"})]}),e.jsxs("div",{className:"d-flex gap-3 align-items-stretch flex-wrap",children:[e.jsxs("div",{className:"d-flex flex-column",style:{minWidth:180},children:[e.jsx("label",{className:"text-muted small fw-semibold mb-1",children:"Primary Month"}),e.jsx("input",{type:"month",className:"form-control form-control-sm border-0",style:{borderRadius:"16px",padding:"14px 18px",fontSize:"14px",fontWeight:"600",background:"rgba(255, 255, 255, 0.9)",color:"#1E293B",border:"1px solid rgba(59, 130, 246, 0.2)",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.1), inset 0 1px 0 rgba(255, 255, 255, 0.8)"},value:s,onChange:V=>i(V.target.value),"aria-label":"Select primary month"})]}),e.jsxs("div",{className:"d-flex flex-column",style:{minWidth:220},children:[e.jsx("label",{className:"text-muted small fw-semibold mb-1",children:"Compare Month"}),e.jsx("input",{type:"month",className:"form-control form-control-sm border-0",style:{borderRadius:"16px",padding:"14px 18px",fontSize:"14px",fontWeight:"600",background:"rgba(255, 255, 255, 0.9)",color:"#1E293B",border:"1px solid rgba(139, 92, 246, 0.2)",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.1), inset 0 1px 0 rgba(255, 255, 255, 0.8)"},value:a,onChange:V=>n(V.target.value),"aria-label":"Select compare month",placeholder:Ds(s)}),e.jsxs("small",{className:"text-muted mt-2",children:["Leave blank to auto-compare with ",Ys(Ds(s))||"the previous month","."]})]}),e.jsxs("button",{className:"btn border-0",onClick:w,disabled:L,style:{background:"linear-gradient(135deg, #3B82F6 0%, #1D4ED8 100%)",color:"white",borderRadius:"16px",padding:"14px 28px",fontWeight:"700",fontSize:"14px",boxShadow:"0 8px 25px rgba(59, 130, 246, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.2)",transition:"all 0.3s ease",transform:L?"scale(0.95)":"scale(1)"},children:[L?"âŸ³":"ðŸ”„"," ",L?"Loading...":"Refresh Data"]}),e.jsxs("div",{className:"dropdown",children:[e.jsx("button",{className:"btn dropdown-toggle border-0",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false",style:{background:"linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%)",color:"white",borderRadius:"16px",padding:"14px 20px",fontWeight:"700",fontSize:"14px",boxShadow:"0 8px 25px rgba(139, 92, 246, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.2)"},children:"ðŸ“Š Export Data"}),e.jsxs("ul",{className:"dropdown-menu",style:{background:"rgba(255, 255, 255, 0.95)",border:"1px solid rgba(59, 130, 246, 0.2)",borderRadius:"12px",boxShadow:"0 10px 40px rgba(0, 0, 0, 0.15)"},children:[e.jsx("li",{children:e.jsx("button",{className:"dropdown-item",onClick:_,disabled:L,style:{color:"#1E293B",padding:"12px 20px",borderRadius:"8px",transition:"all 0.2s ease"},onMouseEnter:V=>V.target.style.background="rgba(59, 130, 246, 0.1)",onMouseLeave:V=>V.target.style.background="transparent",children:"ðŸ“„ Download PDF Report"})}),e.jsx("li",{children:e.jsx("button",{className:"dropdown-item",onClick:H,disabled:L,style:{color:"#1E293B",padding:"12px 20px",borderRadius:"8px",transition:"all 0.2s ease"},onMouseEnter:V=>V.target.style.background="rgba(16, 185, 129, 0.1)",onMouseLeave:V=>V.target.style.background="transparent",children:"ðŸ“Š Export Excel Data"})})]})]})]})]}),I&&e.jsx("div",{className:"alert border-0 mb-4",role:"alert",style:{borderRadius:"20px",background:"linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(254, 226, 226, 0.8) 100%)",border:"2px solid rgba(239, 68, 68, 0.2)",boxShadow:"0 10px 30px rgba(239, 68, 68, 0.15), inset 0 1px 0 rgba(255, 255, 255, 0.8)",backdropFilter:"blur(10px)",color:"#DC2626"},children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"me-3 d-flex align-items-center justify-content-center",style:{width:"40px",height:"40px",borderRadius:"12px",background:"linear-gradient(135deg, #EF4444 0%, #DC2626 100%)",boxShadow:"0 6px 15px rgba(239, 68, 68, 0.3)",fontSize:"18px"},children:"âš ï¸"}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-bold mb-1",style:{color:"#B91C1C"},children:"System Alert"}),e.jsx("div",{style:{color:"#DC2626"},children:I})]})]})}),L?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"500px"},children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"position-relative mb-4",children:[e.jsx("div",{className:"spinner-border",role:"status",style:{width:"4rem",height:"4rem",borderWidth:"4px",borderColor:"transparent",borderTopColor:"#3B82F6",borderRightColor:"#8B5CF6",borderBottomColor:"#14B8A6",borderLeftColor:"#F97316",animation:"spin 1.5s linear infinite",filter:"drop-shadow(0 4px 8px rgba(59, 130, 246, 0.3))"},children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("div",{className:"position-absolute top-50 start-50 translate-middle",style:{fontSize:"1.5rem",animation:"pulse 2s ease-in-out infinite"},children:"ðŸ“Š"})]}),e.jsx("h5",{className:"fw-bold mb-2",style:{color:"#1E293B",textShadow:"0 2px 4px rgba(0, 0, 0, 0.1)"},children:"Analyzing Data..."}),e.jsx("p",{style:{color:"#64748B",fontSize:"1rem"},children:"Processing clinic analytics and generating insights"}),e.jsxs("div",{className:"d-flex justify-content-center gap-2 mt-3",children:[e.jsx("div",{className:"bg-primary rounded-circle",style:{width:"8px",height:"8px",animation:"bounce 1.4s ease-in-out infinite"}}),e.jsx("div",{className:"bg-info rounded-circle",style:{width:"8px",height:"8px",animation:"bounce 1.4s ease-in-out 0.2s infinite"}}),e.jsx("div",{className:"bg-success rounded-circle",style:{width:"8px",height:"8px",animation:"bounce 1.4s ease-in-out 0.4s infinite"}})]})]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-3",children:e.jsxs("small",{className:"text-muted fw-semibold",children:["Comparing ",ne||s||"selected month"," vs ",re||`previous month (${Ys(Ds(s))})`]})}),e.jsx("div",{className:"row g-4 mb-5",children:k.map((V,Q)=>e.jsx("div",{className:"col-12 col-sm-6 col-lg-3 col-xl-3",children:e.jsxs("div",{className:"card h-100 border-0",style:{background:"linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(248, 250, 252, 0.9) 100%)",borderRadius:"24px",border:`2px solid ${V.color}20`,boxShadow:`
                        0 20px 40px rgba(0, 0, 0, 0.1),
                        0 0 0 1px rgba(255, 255, 255, 0.8),
                        inset 0 1px 0 rgba(255, 255, 255, 0.9),
                        0 0 30px ${V.color}15
                      `,backdropFilter:"blur(20px)",transition:"all 0.4s cubic-bezier(0.4, 0, 0.2, 1)",transform:"translateY(0px)"},onMouseEnter:te=>{te.currentTarget.style.transform="translateY(-8px)",te.currentTarget.style.boxShadow=`
                        0 30px 60px rgba(0, 0, 0, 0.15),
                        0 0 0 1px rgba(255, 255, 255, 0.9),
                        inset 0 1px 0 rgba(255, 255, 255, 1),
                        0 0 40px ${V.color}25
                      `},onMouseLeave:te=>{te.currentTarget.style.transform="translateY(0px)",te.currentTarget.style.boxShadow=`
                        0 20px 40px rgba(0, 0, 0, 0.1),
                        0 0 0 1px rgba(255, 255, 255, 0.8),
                        inset 0 1px 0 rgba(255, 255, 255, 0.9),
                        0 0 30px ${V.color}15
                      `},children:[e.jsx("div",{className:"card-header border-0 bg-transparent pt-4 pb-2",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"me-3 d-flex align-items-center justify-content-center",style:{width:"48px",height:"48px",borderRadius:"16px",background:`linear-gradient(135deg, ${V.color} 0%, ${V.color}CC 100%)`,boxShadow:`0 8px 20px ${V.color}30, inset 0 1px 0 rgba(255, 255, 255, 0.3)`,fontSize:"20px"},children:V.icon}),e.jsxs("div",{children:[e.jsx("h6",{className:"mb-0 fw-bold",style:{color:"#1E293B",fontSize:"1rem",textShadow:"0 1px 2px rgba(0, 0, 0, 0.1)"},children:V.title}),e.jsx("small",{style:{color:"#64748B",fontSize:"0.8rem"},children:ne||s})]})]}),e.jsxs("div",{className:"px-3 py-1 rounded-pill",style:{background:V.change>=0?"linear-gradient(135deg, #10B981 0%, #059669 100%)":"linear-gradient(135deg, #EF4444 0%, #DC2626 100%)",fontSize:"0.75rem",fontWeight:"700",color:"white",boxShadow:V.change>=0?"0 4px 12px rgba(16, 185, 129, 0.3)":"0 4px 12px rgba(239, 68, 68, 0.3)"},children:[V.change>=0?"â†—":"â†˜"," ",Math.abs(V.change).toFixed(1),"%"]})]})}),e.jsxs("div",{className:"card-body pt-2 pb-4",children:[e.jsxs("div",{className:"text-center mb-3",children:[e.jsx("div",{className:"fw-bold mb-1",style:{fontSize:"2.2rem",color:V.color,textShadow:`0 2px 4px ${V.color}30`,lineHeight:"1.1"},children:V.formatter(V.value)}),e.jsxs("div",{style:{color:"#64748B",fontSize:"0.85rem"},children:[re||"Compare Month",": ",V.formatter(V.prevValue)]})]}),e.jsx("div",{style:{height:"250px",position:"relative"},children:e.jsx(pt,{data:V.data,options:E(V)})})]})]})},V.id))}),e.jsxs("div",{className:"row g-4",children:[e.jsx("div",{className:"col-12 col-lg-6",children:e.jsxs("div",{className:"card h-100 border-0",style:{background:"linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(248, 250, 252, 0.9) 100%)",borderRadius:"24px",border:"2px solid rgba(14, 165, 233, 0.2)",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.1), 0 0 0 1px rgba(255, 255, 255, 0.8), inset 0 1px 0 rgba(255, 255, 255, 0.9), 0 0 30px rgba(14, 165, 233, 0.15)",backdropFilter:"blur(20px)"},children:[e.jsx("div",{className:"card-header border-0 bg-transparent py-4",children:e.jsxs("h5",{className:"mb-0 fw-bold d-flex align-items-center",style:{color:"#1E293B",textShadow:"0 1px 2px rgba(0, 0, 0, 0.1)"},children:[e.jsx("span",{className:"me-3",style:{fontSize:"1.5rem"},children:"ðŸ’³"}),"Payment Method Share"]})}),e.jsxs("div",{className:"card-body pt-0",children:[e.jsx("div",{className:"px-1 px-md-2",style:{height:"300px"},children:e.jsx(Fs,{data:F,options:P})}),e.jsxs("div",{className:"mt-3 p-3 rounded-3",style:{backgroundColor:"rgba(59, 130, 246, 0.05)"},children:[e.jsxs("div",{className:"small text-muted mb-2 fw-medium",children:["Monthly Changes vs ",W,":"]}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("span",{className:"small",children:[e.jsx("span",{className:"fw-medium",children:"Cash:"}),e.jsx("span",{className:(((Y=(G=c==null?void 0:c.payment_method_share)==null?void 0:G.cash)==null?void 0:Y.pct_point_change)??0)>=0?"text-success":"text-danger",children:ae(((oe=(se=c==null?void 0:c.payment_method_share)==null?void 0:se.cash)==null?void 0:oe.pct_point_change)||0)})]}),e.jsxs("span",{className:"small",children:[e.jsx("span",{className:"fw-medium",children:"HMO:"}),e.jsx("span",{className:(((ce=(pe=c==null?void 0:c.payment_method_share)==null?void 0:pe.hmo)==null?void 0:ce.pct_point_change)??0)>=0?"text-success":"text-danger",children:ae(((ve=(be=c==null?void 0:c.payment_method_share)==null?void 0:be.hmo)==null?void 0:ve.pct_point_change)||0)})]}),e.jsxs("span",{className:"small",children:[e.jsx("span",{className:"fw-medium",children:"Maya:"}),e.jsx("span",{className:(((js=(Ie=c==null?void 0:c.payment_method_share)==null?void 0:Ie.maya)==null?void 0:js.pct_point_change)??0)>=0?"text-success":"text-danger",children:ae(((Es=(Ye=c==null?void 0:c.payment_method_share)==null?void 0:Ye.maya)==null?void 0:Es.pct_point_change)||0)})]})]})]}),O&&e.jsx("div",{className:"mt-3 p-3 rounded-3",style:{backgroundColor:"rgba(16, 185, 129, 0.05)"},children:e.jsx("small",{className:"text-muted",children:O})}),X&&e.jsx("div",{className:"mt-3 p-3 rounded-3",style:{backgroundColor:"rgba(139, 92, 246, 0.05)"},children:e.jsx("small",{className:"text-muted",children:X})})]})]})}),e.jsx("div",{className:"col-12 col-lg-6",children:e.jsxs("div",{className:"card h-100 border-0 shadow-sm",style:{background:"linear-gradient(135deg, #ffffff 0%, #f8fafc 100%)",borderRadius:"16px"},children:[e.jsx("div",{className:"card-header border-0 bg-transparent py-4",children:e.jsxs("h5",{className:"mb-0 fw-bold d-flex align-items-center",style:{color:"#1e293b"},children:[e.jsx("span",{className:"me-2",children:"ðŸ’°"}),"Revenue by Service"]})}),e.jsxs("div",{className:"card-body pt-0",children:[e.jsxs("div",{className:"list-group list-group-flush",children:[((T==null?void 0:T.top_revenue_services)||[]).map((V,Q)=>e.jsxs("div",{className:"list-group-item border-0 px-0 py-3 d-flex justify-content-between align-items-center",style:{borderBottom:Q<((T==null?void 0:T.top_revenue_services)||[]).length-1?"1px solid rgba(0,0,0,0.05)":"none"},children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"me-3 d-flex align-items-center justify-content-center rounded-circle",style:{width:"32px",height:"32px",backgroundColor:Q===0?"#fbbf24":Q===1?"#9ca3af":Q===2?"#f59e0b":"#e5e7eb",color:"white",fontSize:"14px",fontWeight:"bold"},children:Q+1}),e.jsx("span",{className:"fw-medium",style:{color:"#374151"},children:V.service_name})]}),e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsxs("strong",{className:"me-3 fs-6",style:{color:"#1f2937"},children:["â‚±",V.revenue.toLocaleString()]}),e.jsxs("span",{className:`badge ${(V.pct_change??0)>=0?"bg-success":"bg-danger"} px-2 py-1`,style:{fontSize:"0.75rem"},children:[(V.pct_change??0)>=0?"â†—":"â†˜"," ",Math.abs(V.pct_change??0).toFixed(1),"%"]})]})]},`${V.service_id}-${V.service_name}`)),((T==null?void 0:T.top_revenue_services)||[]).length===0&&e.jsxs("div",{className:"text-center py-4 text-muted",children:[e.jsx("span",{className:"fs-4",children:"ðŸ’°"}),e.jsx("p",{className:"mt-2 mb-0",children:"No revenue data available"})]})]}),e.jsxs("div",{className:"mt-3 p-3 rounded-3",style:{backgroundColor:"rgba(16, 185, 129, 0.05)"},children:[e.jsx("div",{className:"small text-muted mb-2 fw-medium",children:"Total Revenue This Month:"}),e.jsxs("div",{className:"fs-4 fw-bold text-success",children:["â‚±",(((as=c==null?void 0:c.total_revenue)==null?void 0:as.value)??0).toLocaleString()]}),e.jsxs("div",{className:"small text-muted",children:[((vs=c==null?void 0:c.total_revenue)==null?void 0:vs.pct_change)>=0?"â†—":"â†˜"," ",Math.abs((($s=c==null?void 0:c.total_revenue)==null?void 0:$s.pct_change)??0).toFixed(1),"% vs ",W]})]})]})]})})]}),$&&e.jsx("div",{className:"row g-2 g-md-3 g-lg-4 mb-4",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card h-100 border-0 shadow-sm",style:{background:"linear-gradient(135deg, #ffffff 0%, #f8fafc 100%)",borderRadius:"16px"},children:[e.jsx("div",{className:"card-header border-0 bg-transparent py-4",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("h5",{className:"mb-0 fw-bold d-flex align-items-center",style:{color:"#1e293b"},children:[e.jsx("span",{className:"me-2",children:"ðŸ“ˆ"}),l==="revenue"&&v&&u?"Revenue Trends":"Monthly Trends",o&&e.jsx("span",{className:"ms-2 spinner-border spinner-border-sm text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})]}),e.jsxs("div",{className:"d-flex gap-2 flex-wrap",children:[e.jsxs("select",{value:l,onChange:V=>h(V.target.value),className:"form-select form-select-sm",style:{width:140},children:[e.jsx("option",{value:"visits",children:"Visits"}),e.jsx("option",{value:"appointments",children:"Appointments"}),e.jsx("option",{value:"revenue",children:"Revenue"}),e.jsx("option",{value:"loss",children:"Loss"})]}),e.jsxs("select",{value:r,onChange:V=>d(Number(V.target.value)),className:"form-select form-select-sm",style:{width:140},children:[e.jsx("option",{value:6,children:"Last 6 months"}),e.jsx("option",{value:12,children:"Last 1 year"}),e.jsx("option",{value:24,children:"Last 2 years"})]})]})]})}),l==="revenue"&&e.jsx("div",{className:"card-body pt-0 pb-3 border-top",children:e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label small fw-medium text-muted",children:"Time Period:"}),e.jsxs("div",{className:"d-flex gap-3",children:[e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"radio",name:"revenueTimeframe",id:"revenueMonthly",value:"monthly",checked:N==="monthly",onChange:V=>R(V.target.value)}),e.jsx("label",{className:"form-check-label small",htmlFor:"revenueMonthly",children:"Monthly"})]}),e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"radio",name:"revenueTimeframe",id:"revenueYearly",value:"yearly",checked:N==="yearly",onChange:V=>R(V.target.value)}),e.jsx("label",{className:"form-check-label small",htmlFor:"revenueYearly",children:"Yearly"})]})]})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label small fw-medium text-muted",children:"Custom Date Range (Optional):"}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx("input",{type:"date",className:"form-control form-control-sm",value:v,onChange:V=>S(V.target.value),placeholder:"Start Date",style:{fontSize:"0.8rem"}}),e.jsx("input",{type:"date",className:"form-control form-control-sm",value:u,onChange:V=>j(V.target.value),placeholder:"End Date",style:{fontSize:"0.8rem"}})]}),v&&u?e.jsxs("small",{className:"text-muted",children:["Showing data from ",v," to ",u]}):e.jsx("small",{className:"text-muted",children:"Leave empty to use default time range"})]})]})}),e.jsx("div",{className:"card-body pt-0",children:o?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"300px"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"spinner-border text-primary mb-3",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading trend data..."})}),e.jsx("p",{className:"text-muted mb-0",children:"Loading trend data..."})]})}):e.jsx("div",{className:"px-1 px-md-2",style:{height:"300px"},children:e.jsx(bt,{data:$,options:q})})})]})})}),T&&T.clinic_closure_info&&T.clinic_closure_info.has_significant_closures&&e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"card border-0 shadow-sm",style:{background:"linear-gradient(135deg, rgba(239, 68, 68, 0.05) 0%, rgba(254, 226, 226, 0.1) 100%)",borderRadius:"16px",border:"2px solid rgba(239, 68, 68, 0.2)",boxShadow:"0 10px 30px rgba(239, 68, 68, 0.15), inset 0 1px 0 rgba(255, 255, 255, 0.8)"},children:[e.jsxs("div",{className:"card-header border-0 bg-transparent py-4",children:[e.jsxs("h5",{className:"mb-0 fw-bold d-flex align-items-center",style:{color:"#DC2626"},children:[e.jsx("span",{className:"me-2",children:"ðŸš¨"}),"Clinic Closure Alert"]}),e.jsx("p",{className:"mb-0 mt-2 text-muted small",children:"Unexpected clinic closures detected this month"})]}),e.jsx("div",{className:"card-body pt-0",children:e.jsx("div",{className:"alert alert-warning border-0 mb-0",style:{background:"rgba(245, 158, 11, 0.1)",border:"1px solid rgba(245, 158, 11, 0.3)",borderRadius:"12px"},children:e.jsxs("div",{className:"d-flex align-items-start",children:[e.jsx("div",{className:"me-3",children:e.jsx("div",{className:"d-flex align-items-center justify-content-center rounded-circle",style:{width:"40px",height:"40px",background:"linear-gradient(135deg, #F59E0B 0%, #D97706 100%)",color:"white",fontSize:"18px"},children:"âš ï¸"})}),e.jsxs("div",{className:"flex-grow-1",children:[e.jsx("h6",{className:"fw-bold mb-2",style:{color:"#92400E"},children:T.clinic_closure_info.summary}),e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("span",{className:"text-muted",children:"Expected Open Days:"}),e.jsx("span",{className:"fw-semibold",children:T.clinic_closure_info.total_expected_open_days})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("span",{className:"text-muted",children:"Days with Activity:"}),e.jsx("span",{className:"fw-semibold",children:T.clinic_closure_info.total_actual_open_days})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("span",{className:"text-muted",children:"Unexpected Closures:"}),e.jsx("span",{className:"fw-semibold text-danger",children:T.clinic_closure_info.closure_count})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("span",{className:"text-muted",children:"Closure Rate:"}),e.jsxs("span",{className:"fw-semibold text-danger",children:[T.clinic_closure_info.closure_rate_percentage,"%"]})]})})]}),T.clinic_closure_info.unexpected_closures&&T.clinic_closure_info.unexpected_closures.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("h6",{className:"fw-semibold mb-2",style:{color:"#92400E",fontSize:"0.9rem"},children:"Closed Days:"}),e.jsxs("div",{className:"d-flex flex-wrap gap-2",children:[T.clinic_closure_info.unexpected_closures.slice(0,10).map((V,Q)=>e.jsxs("span",{className:"badge",style:{background:"rgba(239, 68, 68, 0.1)",color:"#DC2626",border:"1px solid rgba(239, 68, 68, 0.3)",fontSize:"0.75rem"},children:[V.day_name," ",V.date.split("-")[2]]},Q)),T.clinic_closure_info.unexpected_closures.length>10&&e.jsxs("span",{className:"badge bg-secondary",style:{fontSize:"0.75rem"},children:["+",T.clinic_closure_info.unexpected_closures.length-10," more"]})]})]})]})]})})})]})}),T&&T.has_last_month_data&&e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"card border-0 shadow-sm",style:{background:"linear-gradient(135deg, #ffffff 0%, #f8fafc 100%)",borderRadius:"16px"},children:[e.jsxs("div",{className:"card-header border-0 bg-transparent py-4",children:[e.jsxs("h5",{className:"mb-0 fw-bold d-flex align-items-center",style:{color:"#1e293b"},children:[e.jsx("span",{className:"me-2",children:"ðŸ’¡"}),"Actionable Insights & Recommendations"]}),e.jsx("p",{className:"mb-0 mt-2 text-muted small",children:"Data-driven recommendations to improve your clinic's performance"})]}),e.jsx("div",{className:"card-body pt-0",children:e.jsx("div",{className:"row g-3",children:ee.length>0?ee.map((V,Q)=>e.jsx("div",{className:"col-12 col-lg-6",children:e.jsx("div",{className:"card h-100 border-0",style:{background:V.priority==="high"?"linear-gradient(135deg, rgba(239, 68, 68, 0.05) 0%, rgba(254, 226, 226, 0.1) 100%)":V.priority==="medium"?"linear-gradient(135deg, rgba(245, 158, 11, 0.05) 0%, rgba(254, 243, 199, 0.1) 100%)":"linear-gradient(135deg, rgba(16, 185, 129, 0.05) 0%, rgba(209, 250, 229, 0.1) 100%)",borderRadius:"12px",border:V.priority==="high"?"1px solid rgba(239, 68, 68, 0.2)":V.priority==="medium"?"1px solid rgba(245, 158, 11, 0.2)":"1px solid rgba(16, 185, 129, 0.2)"},children:e.jsxs("div",{className:"card-body p-4",children:[e.jsxs("div",{className:"d-flex align-items-start justify-content-between mb-3",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"me-3 d-flex align-items-center justify-content-center rounded-circle",style:{width:"40px",height:"40px",background:V.priority==="high"?"linear-gradient(135deg, #EF4444 0%, #DC2626 100%)":V.priority==="medium"?"linear-gradient(135deg, #F59E0B 0%, #D97706 100%)":"linear-gradient(135deg, #10B981 0%, #059669 100%)",color:"white",fontSize:"18px"},children:V.priority==="high"?"ðŸš¨":V.priority==="medium"?"âš ï¸":"âœ…"}),e.jsxs("div",{children:[e.jsx("h6",{className:"mb-1 fw-bold",style:{color:"#1e293b"},children:V.title}),e.jsxs("span",{className:`badge px-2 py-1 ${V.priority==="high"?"bg-danger":V.priority==="medium"?"bg-warning":"bg-success"}`,style:{fontSize:"0.7rem"},children:[V.priority.toUpperCase()," PRIORITY"]})]})]}),e.jsx("div",{className:"text-end",children:e.jsx("small",{className:"text-muted d-block",style:{fontSize:"0.7rem"},children:V.category.replace("_"," ").toUpperCase()})})]}),e.jsx("p",{className:"text-muted mb-3",style:{fontSize:"0.9rem",lineHeight:"1.5"},children:V.description}),e.jsxs("div",{className:"mb-3",children:[e.jsx("h6",{className:"fw-semibold mb-2",style:{color:"#374151",fontSize:"0.85rem"},children:"Recommended Actions:"}),e.jsxs("ul",{className:"list-unstyled mb-0",children:[V.actions.slice(0,3).map((te,de)=>e.jsxs("li",{className:"d-flex align-items-start mb-1",children:[e.jsx("span",{className:"me-2 text-primary",style:{fontSize:"0.8rem"},children:"â€¢"}),e.jsx("span",{style:{fontSize:"0.8rem",color:"#6b7280"},children:te})]},de)),V.actions.length>3&&e.jsxs("li",{className:"text-muted",style:{fontSize:"0.75rem"},children:["+",V.actions.length-3," more recommendations"]})]})]}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("small",{className:"text-muted",style:{fontSize:"0.75rem"},children:["Impact: ",V.impact]}),e.jsx("button",{className:"btn btn-sm border-0",style:{background:"linear-gradient(135deg, #3B82F6 0%, #1D4ED8 100%)",color:"white",borderRadius:"8px",fontSize:"0.75rem",padding:"4px 12px"},onClick:()=>{const te=V.actions.join(`
â€¢ `);navigator.clipboard.writeText(`Actions for ${V.title}:
â€¢ ${te}`),K.success("Actions copied to clipboard!")},children:"Copy Actions"})]})]})})},Q)):e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"fs-1 mb-3",children:"ðŸ”"}),e.jsx("p",{className:"text-muted mb-0 fw-medium",children:"No actionable insights available"}),e.jsx("small",{className:"text-muted",children:"Insights will appear here when data patterns are detected"})]})})})})]})}),(T==null?void 0:T.patient_retention_insights)&&e.jsx("div",{className:"mt-4",children:e.jsx(Vi,{insights:T.patient_retention_insights})}),T&&!T.has_last_month_data&&e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"card border-0 shadow-sm",style:{background:"linear-gradient(135deg, #ffffff 0%, #f8fafc 100%)",borderRadius:"16px"},children:[e.jsxs("div",{className:"card-header border-0 bg-transparent py-4",children:[e.jsxs("h5",{className:"mb-0 fw-bold d-flex align-items-center",style:{color:"#1e293b"},children:[e.jsx("span",{className:"me-2",children:"ðŸ“Š"}),"Analytics Status"]}),e.jsx("p",{className:"mb-0 mt-2 text-muted small",children:"Current month analytics overview"})]}),e.jsx("div",{className:"card-body pt-0",children:e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"fs-1 mb-3",children:"ðŸ“ˆ"}),e.jsx("h6",{className:"fw-bold mb-2",style:{color:"#374151"},children:"Insufficient Historical Data"}),e.jsx("p",{className:"text-muted mb-3",children:"Actionable insights require comparison with previous month data. Current month shows activity, but we need more historical data to generate meaningful recommendations."}),e.jsx("div",{className:"alert alert-info border-0",style:{background:"rgba(59, 130, 246, 0.1)",border:"1px solid rgba(59, 130, 246, 0.3)",borderRadius:"12px"},children:e.jsxs("small",{className:"text-muted",children:[e.jsx("strong",{children:"Tip:"})," Once you have at least one month of historical data, the system will automatically generate actionable insights and recommendations to help optimize your clinic's performance."]})})]})})]})}),e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"card border-0 shadow-sm",style:{background:"linear-gradient(135deg, #ffffff 0%, #f8fafc 100%)",borderRadius:"16px"},children:[e.jsx("div",{className:"card-header border-0 bg-transparent py-4",children:e.jsxs("h5",{className:"mb-0 fw-bold d-flex align-items-center",style:{color:"#1e293b"},children:[e.jsx("span",{className:"me-2",children:"ðŸ””"}),"System Alerts"]})}),e.jsx("div",{className:"card-body pt-0",children:((T==null?void 0:T.alerts)||[]).length===0?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"fs-1 mb-3",children:"âœ…"}),e.jsx("p",{className:"text-muted mb-0 fw-medium",children:"All systems running smoothly"}),e.jsx("small",{className:"text-muted",children:"No alerts to display"})]}):e.jsx("div",{className:"list-group list-group-flush",children:((T==null?void 0:T.alerts)||[]).map((V,Q)=>e.jsxs("div",{className:`list-group-item border-0 px-0 py-3 d-flex align-items-start ${V.type==="warning"?"text-warning":"text-info"}`,children:[e.jsx("span",{className:"me-3 mt-1",children:V.type==="warning"?"âš ï¸":"â„¹ï¸"}),e.jsx("span",{className:"fw-medium",children:V.message})]},Q))})})]})})]})]})})})}function Ks({label:s,value:i,helper:a,variant:n="primary"}){return e.jsx("div",{className:"col-md-3",children:e.jsx("div",{className:"card border-0 shadow-sm h-100",children:e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"text-muted text-uppercase small fw-semibold mb-1",children:s}),e.jsx("div",{className:`display-6 fw-bold text-${n}`,children:i}),a&&e.jsx("div",{className:"text-muted small mt-2",children:a})]})})})}function Gi(){var P;const[s,i]=t.useState(()=>new Date().toISOString().slice(0,7)),[a,n]=t.useState(null),[r,d]=t.useState(!1),[l,h]=t.useState(!1),[o,x]=t.useState(null),[g,p]=t.useState([]),[m,y]=t.useState(null),[N,R]=t.useState(!1),[v,S]=t.useState(null),[u,j]=t.useState("all"),[b,C]=t.useState("all"),f=a==null?void 0:a.dentist_performance_insights,D=async(k=s)=>{var E,O;try{d(!0);const X=await z.get("/api/analytics/summary",{params:{period:k}});n(X.data)}catch(X){const ee=((O=(E=X.response)==null?void 0:E.data)==null?void 0:O.message)||"Unable to load dentist performance data right now.";K.error(ee)}finally{d(!1)}};t.useEffect(()=>{D(s)},[s]);const L=t.useMemo(()=>(f==null?void 0:f.dentists)||[],[f==null?void 0:f.dentists]),I=k=>{switch(k){case"positive":return"bg-success";case"negative":return"bg-danger";default:return"bg-secondary"}},w=k=>{switch(k){case"positive":return"Good";case"negative":return"Needs Attention";default:return"Neutral"}},A=async(k,E=1,O={})=>{var ee,ae;if(!k)return;const X=k.dentist_schedule_id??"unassigned";try{R(!0);const ne={page:E,has_comment:O.commentFilter??u,rating:O.ratingFilter&&O.ratingFilter!=="all"?O.ratingFilter:void 0},re=await z.get(`/api/admin/dentists/${X}/feedback`,{params:ne});p(re.data.data),y(re.data.meta)}catch(ne){const re=((ae=(ee=ne.response)==null?void 0:ee.data)==null?void 0:ae.message)||"Unable to load feedback for this dentist right now.";K.error(re),p([]),y(null)}finally{R(!1)}},_=k=>{!k||k.responses===0||(x(k),h(!0),S(null),A(k,1,{commentFilter:u,ratingFilter:b}))},H=()=>{h(!1),x(null),p([]),y(null),S(null)},T=k=>{if(!m||!o)return;const E=m.current_page+k;E<1||E>m.last_page||A(o,E)},c=(k,E)=>{k==="comment"?j(E):k==="rating"&&C(E),o&&A(o,1,{commentFilter:k==="comment"?E:u,ratingFilter:k==="rating"?E:b})},F=k=>{S(E=>E===k?null:k)};return e.jsxs("div",{className:"container-fluid py-4",children:[e.jsxs("div",{className:"d-flex flex-column flex-md-row align-items-start align-items-md-center justify-content-between gap-3 mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"h4 mb-1",children:"Dentist Performance"}),e.jsx("p",{className:"text-muted mb-0",children:"Track satisfaction scores, feedback volume, and dentist-level follow-ups."})]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx("input",{type:"month",className:"form-control",value:s,onChange:k=>i(k.target.value)}),e.jsx("button",{className:"btn btn-outline-secondary",onClick:()=>D(s),disabled:r,children:r?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-1",role:"status"}),"Refreshing"]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-arrow-clockwise me-1"}),"Refresh"]})})]})]}),f?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"row g-3 mb-4",children:[e.jsx(Ks,{label:"Average rating",value:f.overall_avg_rating!==null?f.overall_avg_rating.toFixed(2):"â€”",helper:"Across all submitted dentist ratings.",variant:"warning"}),e.jsx(Ks,{label:"Feedback received",value:f.responses_count,helper:"Number of completed ratings in this period."}),e.jsx(Ks,{label:"Issue reports",value:f.issue_count,helper:`Issue rate: ${((P=f.issue_rate)==null?void 0:P.toFixed(2))??"0"}%`,variant:"danger"}),e.jsx(Ks,{label:"Dentists rated",value:L.length,helper:"Includes dentists with at least one rating.",variant:"info"})]}),e.jsxs("div",{className:"card border-0 shadow-sm",children:[e.jsx("div",{className:"card-header bg-transparent border-0 py-3",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("h5",{className:"mb-0 fw-bold",children:"Ratings by dentist"}),e.jsx("span",{className:"badge bg-light text-dark",children:"Sorted by average rating"})]})}),e.jsx("div",{className:"card-body p-0",children:e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover mb-0",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Dentist"}),e.jsx("th",{className:"text-center",children:"Avg rating"}),e.jsx("th",{className:"text-center",children:"Responses"}),e.jsx("th",{className:"text-center",children:"Issues"}),e.jsx("th",{className:"text-center",children:"Low scores (1-2)"}),e.jsx("th",{className:"text-center",children:"Last feedback"})]})}),e.jsx("tbody",{children:L.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center py-4 text-muted",children:"No ratings found for this period."})}):L.map(k=>e.jsxs("tr",{className:k.responses>0?"table-row-clickable":"",style:{cursor:k.responses>0?"pointer":"default"},onClick:()=>_(k),children:[e.jsxs("td",{children:[e.jsx("div",{className:"fw-semibold",children:k.dentist_name}),k.dentist_schedule_id&&e.jsxs("small",{className:"text-muted",children:["ID: ",k.dentist_schedule_id]})]}),e.jsx("td",{className:"text-center fw-bold",children:k.avg_rating!==null?k.avg_rating.toFixed(2):"â€”"}),e.jsx("td",{className:"text-center",children:k.responses}),e.jsx("td",{className:"text-center",children:e.jsx("span",{className:`badge ${k.issue_count>0?"bg-danger":"bg-success"}`,children:k.issue_count})}),e.jsx("td",{className:"text-center",children:k.low_rating_count}),e.jsx("td",{className:"text-center text-muted",children:k.last_feedback_at?new Date(k.last_feedback_at).toLocaleString():"â€”"})]},k.dentist_schedule_id??`dentist-${k.dentist_name}`))})]})})})]}),l&&e.jsx("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.35)",zIndex:1060},tabIndex:"-1",children:e.jsx("div",{className:"modal-dialog modal-lg modal-dialog-scrollable",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("div",{children:[e.jsxs("h5",{className:"modal-title",children:["Feedback for ",o==null?void 0:o.dentist_name]}),e.jsxs("small",{className:"text-muted",children:[o==null?void 0:o.responses," review",(o==null?void 0:o.responses)===1?"":"s"," captured this period"]})]}),e.jsx("button",{type:"button",className:"btn-close",onClick:H,disabled:N})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"d-flex flex-wrap gap-2 align-items-end mb-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label small text-muted mb-1",children:"Comment filter"}),e.jsxs("select",{className:"form-select form-select-sm",value:u,onChange:k=>c("comment",k.target.value),disabled:N,children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"with",children:"With comments"}),e.jsx("option",{value:"without",children:"Without comments"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label small text-muted mb-1",children:"Rating"}),e.jsxs("select",{className:"form-select form-select-sm",value:b,onChange:k=>c("rating",k.target.value),disabled:N,children:[e.jsx("option",{value:"all",children:"All ratings"}),[5,4,3,2,1].map(k=>e.jsxs("option",{value:k,children:[k," â˜…"]},k))]})]})]}),N?e.jsxs("div",{className:"text-center py-5",children:[e.jsx("div",{className:"spinner-border text-primary mb-2",role:"status"}),e.jsx("p",{className:"text-muted mb-0",children:"Loading reviews..."})]}):g.length===0?e.jsx("div",{className:"text-center py-5 text-muted",children:"No reviews recorded yet."}):g.map(k=>{var X;const E=v===k.id,O=w(k.sentiment);return e.jsxs("div",{className:"card border mb-3 shadow-sm",children:[e.jsxs("button",{className:"btn btn-link text-start text-decoration-none text-reset p-3 w-100",onClick:()=>F(k.id),children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"fw-semibold",children:k.patient_name}),e.jsx("small",{className:"text-muted",children:k.submitted_at?new Date(k.submitted_at).toLocaleString():"â€”"})]}),e.jsxs("div",{className:"text-end",children:[e.jsx("span",{className:`badge ${I(k.sentiment)} me-2`,children:O}),e.jsxs("span",{className:"badge bg-light text-dark",children:["Rating: ",k.dentist_rating??"â€”"]})]})]}),e.jsxs("div",{className:"mt-2 text-muted small",children:["Service: ",k.service_name||"â€”"]})]}),E&&e.jsxs("div",{className:"px-3 pb-3",children:[e.jsx("p",{className:"mb-1 fw-semibold",children:"Comment"}),e.jsx("p",{className:"mb-3",children:(X=k.dentist_issue_note)!=null&&X.trim()?k.dentist_issue_note:"No additional comments provided."}),e.jsx("div",{className:"d-flex flex-wrap gap-2 small",children:e.jsxs("span",{className:"badge bg-light text-dark",children:["Retention score:"," ",k.retention_score_avg?Number(k.retention_score_avg).toFixed(2):"â€”"]})})]})]},k.id)})]}),e.jsxs("div",{className:"modal-footer d-flex justify-content-between",children:[e.jsx("div",{children:m&&e.jsxs("small",{className:"text-muted",children:["Page ",m.current_page," of ",m.last_page]})}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx("button",{className:"btn btn-outline-secondary btn-sm",disabled:N||!m||m.current_page===1,onClick:()=>T(-1),children:"Previous"}),e.jsx("button",{className:"btn btn-outline-secondary btn-sm",disabled:N||!m||m.current_page===m.last_page,onClick:()=>T(1),children:"Next"})]})]})]})})})]}):e.jsx("div",{className:"card border-0 shadow-sm",children:e.jsx("div",{className:"card-body text-center py-5",children:r?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"spinner-border text-primary mb-3",role:"status"}),e.jsx("p",{className:"text-muted mb-0",children:"Loading dentist performance..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fs-1 mb-2",children:"ðŸ¦·"}),e.jsx("p",{className:"text-muted mb-0",children:"No dentist feedback recorded for this period."}),e.jsx("small",{className:"text-muted",children:"Encourage patients to rate visits to populate this page."})]})})})]})}const Xi=()=>{const[s,i]=t.useState([]),[a,n]=t.useState({total_patients_with_no_shows:0,patients_under_warning:0,blocked_patients:0,total_no_shows:0,average_no_shows_per_patient:0}),[r,d]=t.useState(!0),[l,h]=t.useState(!0),[o,x]=t.useState(null),[g,p]=t.useState(null),[m,y]=t.useState(!1),[N,R]=t.useState(""),[v,S]=t.useState({}),[u,j]=t.useState(!1),[b,C]=t.useState({status:"",min_no_shows:"",search:""}),[f,D]=t.useState(null);t.useEffect(()=>{if(f&&clearTimeout(f),b.search&&b.search.length>=2){const F=setTimeout(()=>{L(),I()},300);D(F)}else(b.search.length===0||b.status||b.min_no_shows)&&(L(),I());return()=>{f&&clearTimeout(f)}},[b]);const L=async()=>{try{d(!0),x(null);const F=new URLSearchParams;b.status&&F.append("status",b.status),b.min_no_shows&&F.append("min_no_shows",b.min_no_shows),b.search&&F.append("search",b.search);const P=await z.get(`/api/admin/patient-manager?${F.toString()}`);if(P.data&&P.data.data){const k=P.data.data.data||P.data.data||[];i(k)}else Array.isArray(P.data)?i(P.data):i([])}catch(F){x("Failed to fetch patients"),i([]),console.error("Error fetching patients:",F)}finally{d(!1)}},I=async()=>{try{h(!0);const F=await z.get("/api/admin/patient-manager/statistics");n(F.data.data||F.data||{})}catch(F){console.error("Error fetching statistics:",F),n({})}finally{h(!1)}},w=F=>{F==="warning"?C({...b,status:b.status==="warning"?"":"warning"}):F==="blocked"&&C({...b,status:b.status==="blocked"?"":"blocked"})},A=async(F,P,k={})=>{var E,O,X,ee;try{console.log("handleAction called:",{action:F,patientId:P,data:k});let ae;switch(F){case"send-warning":ae=await z.post(`/api/admin/patient-manager/${P}/send-warning`,k);break;case"block":console.log("Blocking patient with data:",k),ae=await z.post(`/api/admin/patient-manager/${P}/block`,k);break;case"unblock":ae=await z.post(`/api/admin/patient-manager/${P}/unblock`,k);break;case"add-note":ae=await z.post(`/api/admin/patient-manager/${P}/add-note`,k);break;case"reset-no-shows":ae=await z.post(`/api/admin/patient-manager/${P}/reset-no-shows`,k);break;default:throw new Error("Unknown action")}ae.data.success?(K.success(ae.data.message),L(),I(),y(!1)):K.error(ae.data.message||"Action failed")}catch(ae){if((O=(E=ae.response)==null?void 0:E.data)!=null&&O.errors){const ne=Object.values(ae.response.data.errors).flat().join(`
`);K.error(`Validation failed:
${ne}`)}else K.error(((ee=(X=ae.response)==null?void 0:X.data)==null?void 0:ee.message)||"Action failed");console.error("Error performing action:",ae)}},_=async(F,P)=>{var E;R(F),p(P);const k={};if(F==="block"&&(k.block_type="account"),S(k),y(!0),F==="block"&&P.id){j(!0);try{const O=await z.get(`/api/admin/patient-manager/${P.id}`);if(O.data.success){p(O.data.data),console.log("Loaded detailed patient data:",O.data.data);const X=(E=O.data.data.patient)==null?void 0:E.last_login_ip;X&&S(ee=>({...ee,block_type:ee.block_type||"account",ip:X})),console.log("Form data after loading patient details:",v)}}catch(O){console.error("Error fetching detailed patient data:",O)}finally{j(!1)}}},H=()=>{y(!1),p(null),S({}),R("")},T=F=>({active:{class:"badge bg-success",text:"Active"},warning:{class:"badge bg-warning",text:"Under Warning"},blocked:{class:"badge bg-danger",text:"Blocked"}})[F]||{class:"badge bg-secondary",text:"Unknown"},c=()=>{var F,P,k,E;return!m||!g?null:e.jsx("div",{className:"modal fade show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)",position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:1050,overflowY:"auto",display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem"},children:e.jsx("div",{className:"modal-dialog modal-lg",style:{margin:"0 auto",maxHeight:"calc(100vh - 2rem)",width:"100%"},children:e.jsxs("div",{className:"modal-content",style:{display:"flex",flexDirection:"column",maxHeight:"calc(100vh - 2rem)",overflow:"hidden"},children:[e.jsxs("div",{className:"modal-header flex-shrink-0",style:{position:"sticky",top:0,zIndex:1,backgroundColor:"#fff",borderBottom:"1px solid #dee2e6"},children:[e.jsxs("h5",{className:"modal-title",children:[N==="send-warning"&&"Send Warning",N==="block"&&"Block Patient",N==="unblock"&&"Unblock Patient",N==="add-note"&&"Add Admin Note",N==="reset-no-shows"&&"Reset No-Show Count"]}),e.jsx("button",{type:"button",className:"btn-close",onClick:H})]}),e.jsxs("div",{className:"modal-body flex-grow-1",style:{overflowY:"auto",overflowX:"hidden",flex:"1 1 auto",minHeight:0},children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Patient:"})," ",(F=g.patient)==null?void 0:F.first_name," ",(P=g.patient)==null?void 0:P.last_name,e.jsx("br",{}),e.jsx("strong",{children:"No-show Count:"})," ",g.no_show_count,e.jsx("br",{}),e.jsx("strong",{children:"Current Status:"})," ",e.jsx("span",{className:T(g.block_status).class,children:T(g.block_status).text})]}),N==="send-warning"&&e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Warning Message"}),e.jsx("textarea",{className:"form-control",rows:"4",value:v.message||"",onChange:O=>S({...v,message:O.target.value}),placeholder:"Enter custom warning message..."})]}),N==="block"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"alert alert-warning",children:[e.jsx("strong",{children:"Note:"})," This will block the patient from booking new appointments online. They can still walk in for services and access their account."]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Block Reason"}),e.jsx("textarea",{className:"form-control",rows:"3",value:v.reason||"",onChange:O=>S({...v,reason:O.target.value}),placeholder:"Enter reason for blocking appointment booking...",required:!0})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Block Type"}),e.jsxs("select",{className:"form-control",value:v.block_type||"account",onChange:O=>S({...v,block_type:O.target.value}),children:[e.jsx("option",{value:"account",children:"Account Only"}),e.jsx("option",{value:"ip",children:"IP Address Only"}),e.jsx("option",{value:"both",children:"Account + IP Address"})]})]}),(v.block_type==="ip"||v.block_type==="both")&&e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"IP Address"}),u&&e.jsx("div",{className:"mb-2",children:e.jsxs("small",{className:"text-muted",children:[e.jsx("i",{className:"bi bi-hourglass-split me-1"}),"Loading recent IP addresses..."]})}),!u&&((k=g==null?void 0:g.patient)==null?void 0:k.recent_ip_addresses)&&g.patient.recent_ip_addresses.length>0&&e.jsxs("div",{className:"mb-2",children:[e.jsx("small",{className:"text-muted",children:"Recent IP addresses:"}),e.jsxs("small",{className:"text-muted ms-2",children:[e.jsx("i",{className:"bi bi-info-circle me-1"}),"Multiple IPs may appear due to VPNs, mobile networks, or proxy usage"]}),e.jsx("div",{className:"mt-1",children:g.patient.recent_ip_addresses.slice(0,3).map((O,X)=>e.jsxs("button",{type:"button",className:"btn btn-outline-secondary btn-sm me-2 mb-1",onClick:()=>S({...v,ip:O.ip}),title:`Last seen: ${new Date(O.last_seen).toLocaleString()}`,children:[e.jsx("i",{className:"bi bi-ip-address me-1"}),O.ip,X===0&&e.jsx("span",{className:"badge bg-primary ms-1",children:"Latest"})]},X))})]}),e.jsx("input",{type:"text",className:"form-control",value:v.ip||"",onChange:O=>S({...v,ip:O.target.value}),placeholder:"Enter IP address to block..."}),v.ip&&e.jsxs("div",{className:"mt-1",children:[(v.ip==="127.0.0.1"||v.ip.startsWith("192.168.")||v.ip.startsWith("10.")||v.ip.startsWith("172."))&&e.jsxs("small",{className:"text-warning",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-1"}),"Warning: This appears to be a local/private IP address. Blocking this may affect multiple users."]}),v.ip==="0.0.0.0"&&e.jsxs("small",{className:"text-danger",children:[e.jsx("i",{className:"bi bi-x-circle me-1"}),"Invalid IP address. Please enter a valid public IP."]})]}),e.jsx("small",{className:"form-text text-muted",children:(E=g==null?void 0:g.patient)!=null&&E.recent_ip_addresses&&g.patient.recent_ip_addresses.length>0?"Click on a recent IP above to auto-fill, or enter a custom public IP address.":"Enter a valid public IP address to block. Private/local IPs (127.0.0.1, 192.168.x.x, etc.) are not recommended as they may affect multiple users."})]})]}),N==="unblock"&&e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Unblock Reason (Optional)"}),e.jsx("textarea",{className:"form-control",rows:"3",value:v.reason||"",onChange:O=>S({...v,reason:O.target.value}),placeholder:"Enter reason for unblocking..."})]}),N==="add-note"&&e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Admin Note"}),e.jsx("textarea",{className:"form-control",rows:"4",value:v.note||"",onChange:O=>S({...v,note:O.target.value}),placeholder:"Enter admin note...",required:!0})]}),N==="reset-no-shows"&&e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Reset Reason"}),e.jsx("textarea",{className:"form-control",rows:"3",value:v.reason||"",onChange:O=>S({...v,reason:O.target.value}),placeholder:"Enter reason for resetting no-show count...",required:!0}),e.jsxs("div",{className:"form-text text-warning",children:[e.jsx("strong",{children:"Warning:"})," This will reset the patient's no-show count to 0 and remove all warnings/blocks."]})]})]}),e.jsxs("div",{className:"modal-footer flex-shrink-0",style:{position:"sticky",bottom:0,zIndex:1,backgroundColor:"#fff",borderTop:"1px solid #dee2e6"},children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:H,children:"Cancel"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>A(N,g.id,v),children:"Confirm"})]})]})})})};return e.jsxs("div",{className:"patient-manager",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsx("h2",{children:"Patient Manager"}),e.jsxs("div",{className:"d-flex gap-2",children:[(b.status||b.min_no_shows||b.search)&&e.jsxs("button",{className:"btn btn-outline-secondary",onClick:()=>C({status:"",min_no_shows:"",search:""}),title:"Clear all filters",children:[e.jsx("i",{className:"bi bi-funnel"})," Clear Filters"]}),e.jsxs("button",{className:"btn btn-outline-primary",onClick:L,children:[e.jsx("i",{className:"bi bi-arrow-clockwise"})," Refresh"]})]})]}),e.jsxs("div",{className:"row mb-4",children:[e.jsx("div",{className:"col-md-3",children:e.jsx("div",{className:"card bg-primary text-white",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h5",{className:"card-title",children:"Total with No-shows"}),e.jsx("h3",{children:l?"...":(a==null?void 0:a.total_patients_with_no_shows)||0})]})})}),e.jsx("div",{className:"col-md-3",children:e.jsx("div",{className:`card bg-warning text-white ${b.status==="warning"?"border border-3 border-light":""}`,style:{cursor:"pointer"},onClick:()=>w("warning"),title:"Click to filter patients under warning",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h5",{className:"card-title",children:"Under Warning"}),e.jsx("h3",{children:l?"...":(a==null?void 0:a.patients_under_warning)||0}),b.status==="warning"&&e.jsxs("small",{children:[e.jsx("i",{className:"bi bi-funnel-fill"})," Filter Active"]})]})})}),e.jsx("div",{className:"col-md-3",children:e.jsx("div",{className:`card bg-danger text-white ${b.status==="blocked"?"border border-3 border-light":""}`,style:{cursor:"pointer"},onClick:()=>w("blocked"),title:"Click to filter blocked patients",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h5",{className:"card-title",children:"Blocked"}),e.jsx("h3",{children:l?"...":(a==null?void 0:a.blocked_patients)||0}),b.status==="blocked"&&e.jsxs("small",{children:[e.jsx("i",{className:"bi bi-funnel-fill"})," Filter Active"]})]})})}),e.jsx("div",{className:"col-md-3",children:e.jsx("div",{className:"card bg-info text-white",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h5",{className:"card-title",children:"Total No-shows"}),e.jsx("h3",{children:l?"...":(a==null?void 0:a.total_no_shows)||0})]})})})]}),e.jsx("div",{className:"card mb-4",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-3",children:[e.jsx("label",{className:"form-label",children:"Status"}),e.jsxs("select",{className:"form-control",value:b.status,onChange:F=>C({...b,status:F.target.value}),children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"warning",children:"Under Warning"}),e.jsx("option",{value:"blocked",children:"Blocked"})]})]}),e.jsxs("div",{className:"col-md-3",children:[e.jsx("label",{className:"form-label",children:"Min No-shows"}),e.jsx("input",{type:"number",className:"form-control",value:b.min_no_shows,onChange:F=>C({...b,min_no_shows:F.target.value}),placeholder:"Minimum no-shows"})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Search"}),e.jsx("input",{type:"text",className:"form-control",value:b.search,onChange:F=>C({...b,search:F.target.value}),placeholder:"Search by name or contact number... (min 2 characters)"}),b.search.length>0&&b.search.length<2&&e.jsxs("div",{className:"form-text text-warning",children:[e.jsx("i",{className:"bi bi-info-circle me-1"}),"Please enter at least 2 characters to search"]})]})]})})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body position-relative",children:[r&&e.jsx("div",{className:"position-absolute top-0 start-0 w-100 h-100 d-flex justify-content-center align-items-center",style:{backgroundColor:"rgba(255, 255, 255, 0.8)",zIndex:10,minHeight:"200px"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"mt-2 mb-0",children:"Updating table..."})]})}),o&&e.jsx("div",{className:"alert alert-danger",role:"alert",children:o}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Patient"}),e.jsx("th",{children:"Contact"}),e.jsx("th",{children:"No-shows"}),e.jsx("th",{children:"Warnings"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Last No-show"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:s&&s.length>0?s.map(F=>{var P,k,E,O,X;return e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsxs("strong",{children:[(P=F.patient)==null?void 0:P.first_name," ",(k=F.patient)==null?void 0:k.last_name]}),((O=(E=F.patient)==null?void 0:E.user)==null?void 0:O.email)&&e.jsx("div",{className:"text-muted small",children:F.patient.user.email})]}),e.jsx("td",{children:(X=F.patient)==null?void 0:X.contact_number}),e.jsx("td",{children:e.jsx("span",{className:"badge bg-danger",children:F.no_show_count})}),e.jsx("td",{children:e.jsx("span",{className:"badge bg-warning",children:F.warning_count})}),e.jsx("td",{children:e.jsx("span",{className:T(F.block_status).class,children:T(F.block_status).text})}),e.jsx("td",{children:F.last_no_show_at?new Date(F.last_no_show_at).toLocaleDateString():"Never"}),e.jsx("td",{children:e.jsxs("div",{className:"btn-group btn-group-sm",children:[e.jsx("button",{className:"btn btn-outline-warning",onClick:()=>_("send-warning",F),title:"Send Warning",children:e.jsx("i",{className:"bi bi-exclamation-triangle"})}),F.block_status!=="blocked"?e.jsx("button",{className:"btn btn-outline-danger",onClick:()=>_("block",F),title:"Block Appointment Booking",children:e.jsx("i",{className:"bi bi-ban"})}):e.jsx("button",{className:"btn btn-outline-success",onClick:()=>_("unblock",F),title:"Unblock Appointment Booking",children:e.jsx("i",{className:"bi bi-check-circle"})}),e.jsx("button",{className:"btn btn-outline-info",onClick:()=>_("add-note",F),title:"Add Note",children:e.jsx("i",{className:"bi bi-sticky"})}),e.jsx("button",{className:"btn btn-outline-secondary",onClick:()=>_("reset-no-shows",F),title:"Reset No-shows",children:e.jsx("i",{className:"bi bi-arrow-clockwise"})})]})})]},F.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"text-center py-4",children:e.jsxs("div",{className:"text-muted",children:[e.jsx("i",{className:"bi bi-inbox fs-1 d-block mb-2"}),r?"Loading patients...":"No patients found"]})})})})]})}),s&&s.length===0&&!r&&e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-muted",children:"No patients found matching the criteria."})})]})}),c()]})};function Qi(){const[s,i]=t.useState("week1"),[a,n]=t.useState([]),[r,d]=t.useState(!0),[l,h]=t.useState(null),x=(u=>{const j=new Date,b=new Date(j),C=j.getDay(),f=C===0?6:C-1;b.setDate(j.getDate()-f),b.setDate(b.getDate()+(u==="week2"?7:0));const D=[];for(let L=0;L<7;L++){const I=new Date(b);I.setDate(b.getDate()+L),D.push(I.toISOString().split("T")[0])}return D})(s),g=new Date(x[0]),p=new Date(x[6]);t.useEffect(()=>{m()},[s]);const m=async()=>{try{d(!0),h(null);const u=await z.get("/api/admin/time-block-utilization",{params:{start_date:x[0],end_date:x[6]}});n(u.data)}catch(u){console.error("Failed to fetch time block data:",u),h("Failed to load time block data. Please try again.")}finally{d(!1)}},y=u=>new Date(u).toLocaleDateString("en-US",{weekday:"short"}),N=u=>new Date(u).toLocaleDateString("en-US",{month:"short",day:"numeric"}),R=u=>u===0?"#e2e8f0":u<=25?"#dcfce7":u<=50?"#fef3c7":u<=75?"#fed7aa":"#fecaca",S=(()=>{const u=[];for(let j=8;j<17;j++)for(let b=0;b<60;b+=30){const C=`${j.toString().padStart(2,"0")}:${b.toString().padStart(2,"0")}`;u.push(C)}return u})();return e.jsx("div",{className:"time-block-utilization-dashboard",style:{background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",minHeight:"100vh",width:"100%",maxWidth:"100%",padding:"1.5rem",boxSizing:"border-box",overflow:"hidden"},children:e.jsx("div",{className:"row g-2 g-md-3 g-lg-4 m-0",children:e.jsx("div",{className:"col-12 p-0",children:e.jsxs("div",{className:"card border-0 shadow-sm",style:{background:"linear-gradient(135deg, #ffffff 0%, #f8fafc 100%)",borderRadius:"16px",width:"100%",maxWidth:"100%"},children:[e.jsxs("div",{className:"card-header border-0",style:{borderRadius:"16px 16px 0 0",background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",color:"#1e293b"},children:[e.jsxs("div",{className:"d-flex flex-column flex-lg-row justify-content-between align-items-start align-items-lg-center gap-3",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"card-title mb-0 fw-bold",style:{color:"#1e293b"},children:[e.jsx("i",{className:"bi bi-calendar-week me-2"}),"Time Block Utilization Dashboard"]}),e.jsx("p",{className:"mb-0 mt-2",style:{color:"#6b7280"},children:"Visual overview of appointment capacity and time block usage"})]}),e.jsxs("div",{className:"d-flex flex-column flex-sm-row gap-2",children:[e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsxs("label",{className:"form-label mb-0 fw-semibold",style:{color:"#1e293b"},children:[e.jsx("i",{className:"bi bi-calendar-range me-1"}),"Week:"]}),e.jsxs("select",{className:"form-select border-0 shadow-sm",style:{borderRadius:"12px",padding:"8px 12px",background:"white",border:"1px solid #e2e8f0",minWidth:"120px"},value:s,onChange:u=>i(u.target.value),children:[e.jsx("option",{value:"week1",children:"Week 1"}),e.jsx("option",{value:"week2",children:"Week 2"})]})]}),e.jsxs("button",{className:"btn border-0 shadow-sm",onClick:m,style:{background:"linear-gradient(135deg, #0d6efd 0%, #0b5ed7 100%)",color:"white",borderRadius:"12px",padding:"8px 16px",fontWeight:"600",transition:"all 0.3s ease"},children:[e.jsx("i",{className:"bi bi-arrow-clockwise me-1"}),"Refresh"]})]})]}),e.jsx("div",{className:"mt-3",children:e.jsxs("div",{className:"d-flex align-items-center gap-3",children:[e.jsxs("div",{className:"badge bg-primary fs-6 px-3 py-2",children:[g.toLocaleDateString("en-US",{month:"long",day:"numeric"})," - ",p.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})]}),e.jsx("small",{className:"text-muted",children:s==="week1"?"Next 7 days":"Following 7 days"})]})})]}),e.jsx("div",{className:"card-body p-4",style:{width:"100%",maxWidth:"100%"},children:r?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"400px"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"spinner-border text-primary mb-3",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"text-muted",children:"Loading time block data..."})]})}):l?e.jsxs("div",{className:"alert alert-danger d-flex align-items-center",role:"alert",children:[e.jsx("i",{className:"bi bi-exclamation-triangle-fill me-2"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Error:"})," ",l]})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("h6",{className:"fw-semibold mb-3",style:{color:"#1e293b"},children:[e.jsx("i",{className:"bi bi-info-circle me-2"}),"Utilization Legend"]}),e.jsx("div",{className:"d-flex flex-wrap gap-3",children:[{level:"Empty",color:"#e2e8f0",range:"0%"},{level:"Low",color:"#dcfce7",range:"1-25%"},{level:"Medium",color:"#fef3c7",range:"26-50%"},{level:"High",color:"#fed7aa",range:"51-75%"},{level:"Very High",color:"#fecaca",range:"76-100%"}].map(u=>e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("div",{style:{width:"20px",height:"20px",backgroundColor:u.color,borderRadius:"4px",border:"1px solid #d1d5db"}}),e.jsxs("span",{className:"text-muted small",children:[u.level," (",u.range,")"]})]},u.level))})]}),e.jsx("div",{className:"table-responsive",style:{maxHeight:"70vh",overflow:"auto"},children:e.jsxs("table",{className:"table table-bordered mb-0",style:{fontSize:"0.875rem"},children:[e.jsx("thead",{className:"table-primary sticky-top",children:e.jsxs("tr",{children:[e.jsxs("th",{className:"fw-semibold px-2 py-2 border-0 text-center",style:{minWidth:"80px",position:"sticky",left:0,backgroundColor:"#0d6efd",zIndex:10},children:[e.jsx("i",{className:"bi bi-clock me-1"}),"Time"]}),x.map((u,j)=>e.jsx("th",{className:"fw-semibold px-2 py-2 border-0 text-center",style:{minWidth:"120px"},children:e.jsxs("div",{className:"d-flex flex-column align-items-center",children:[e.jsx("div",{className:"fw-bold",children:y(u)}),e.jsx("small",{className:"text-muted",children:N(u)})]})},u))]})}),e.jsx("tbody",{children:S.map(u=>e.jsxs("tr",{children:[e.jsx("td",{className:"fw-semibold px-2 py-2 text-center border-0",style:{position:"sticky",left:0,backgroundColor:"#f8fafc",zIndex:5,borderRight:"2px solid #e2e8f0 !important"},children:u}),x.map(j=>{var I;const b=a.find(w=>w.date===j),C=(I=b==null?void 0:b.time_slots)==null?void 0:I.find(w=>w.time===u),f=(C==null?void 0:C.utilization_percentage)||0,D=(C==null?void 0:C.appointment_count)||0,L=(C==null?void 0:C.max_capacity)||1;return e.jsx("td",{className:"px-1 py-2 text-center border-0",style:{backgroundColor:R(f),border:"1px solid #e2e8f0",position:"relative",cursor:"pointer"},title:`${u} - ${y(j)} ${N(j)}
Utilization: ${f}%
Appointments: ${D}/${L}`,children:e.jsxs("div",{className:"d-flex flex-column align-items-center",children:[e.jsxs("small",{className:"fw-semibold",style:{fontSize:"0.75rem"},children:[f,"%"]}),e.jsxs("small",{className:"text-muted",style:{fontSize:"0.7rem"},children:[D,"/",L]})]})},`${j}-${u}`)})]},u))})]})}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("h6",{className:"fw-semibold mb-3",style:{color:"#1e293b"},children:[e.jsx("i",{className:"bi bi-bar-chart me-2"}),"Week Summary"]}),e.jsx("div",{className:"row g-3",children:x.map(u=>{const j=a.find(D=>D.date===u),b=(j==null?void 0:j.total_slots)||0,C=(j==null?void 0:j.total_utilization)||0,f=(j==null?void 0:j.total_appointments)||0;return e.jsx("div",{className:"col-12 col-md-6 col-lg-4",children:e.jsx("div",{className:"card border-0 shadow-sm h-100",children:e.jsxs("div",{className:"card-body p-3",children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-2",children:[e.jsx("h6",{className:"card-title mb-0 fw-semibold",children:y(u)}),e.jsx("small",{className:"text-muted",children:N(u)})]}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("div",{children:[e.jsx("small",{className:"text-muted d-block",children:"Appointments"}),e.jsx("span",{className:"fw-bold text-primary",children:f})]}),e.jsxs("div",{children:[e.jsx("small",{className:"text-muted d-block",children:"Avg. Utilization"}),e.jsxs("span",{className:"fw-bold text-success",children:[C,"%"]})]}),e.jsxs("div",{children:[e.jsx("small",{className:"text-muted d-block",children:"Time Slots"}),e.jsx("span",{className:"fw-bold text-info",children:b})]})]})]})})},u)})})]})]})})]})})})})}const _a=({show:s,onHide:i,receiptData:a})=>(t.useEffect(()=>(s?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[s]),!s||!a?null:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"modal-backdrop fade show",style:{zIndex:1050},onClick:i}),e.jsx("div",{className:"modal fade show d-block",tabIndex:"-1",style:{zIndex:1055},onClick:i,children:e.jsx("div",{className:"modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable",onClick:n=>n.stopPropagation(),children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header border-bottom-0",style:{background:"linear-gradient(135deg, #0077be 0%, #005a8f 100%)"},children:[e.jsxs("h5",{className:"modal-title text-white",children:[e.jsx("i",{className:"bi bi-receipt me-2"}),"Receipt - ",a.receipt_number]}),e.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:i,"aria-label":"Close"})]}),e.jsx("div",{className:"modal-body p-4",style:{backgroundColor:"#f8f9fa"},children:e.jsxs("div",{className:"receipt-container bg-white p-4 rounded shadow-sm",children:[e.jsxs("div",{className:"text-center border-bottom pb-3 mb-4",style:{borderBottomColor:"#0077be",borderBottomWidth:"3px"},children:[e.jsx("h2",{className:"mb-1",style:{color:"#0077be",fontSize:"28px",fontWeight:"bold"},children:a.clinic_name}),e.jsx("p",{className:"text-muted mb-0",style:{fontSize:"16px"},children:a.receipt_type==="visit"?"Visit Receipt":"Official Receipt"})]}),e.jsxs("div",{className:"row mb-4",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("h6",{className:"fw-bold mb-2 pb-1 border-bottom",style:{color:"#0077be"},children:"Receipt Information"}),e.jsxs("div",{className:"d-flex justify-content-between mb-1",children:[e.jsx("span",{className:"text-muted",children:"Receipt No:"}),e.jsx("span",{className:"fw-bold",children:a.receipt_number})]}),e.jsxs("div",{className:"d-flex justify-content-between mb-1",children:[e.jsx("span",{className:"text-muted",children:"Date:"}),e.jsx("span",{children:a.receipt_date})]}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("span",{className:"text-muted",children:"Time:"}),e.jsx("span",{children:a.receipt_time})]})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("h6",{className:"fw-bold mb-2 pb-1 border-bottom",style:{color:"#0077be"},children:"Clinic Information"}),e.jsxs("div",{className:"d-flex justify-content-between mb-1",children:[e.jsx("span",{className:"text-muted",children:"Address:"}),e.jsx("span",{className:"text-end",children:a.clinic_address})]}),e.jsxs("div",{className:"d-flex justify-content-between mb-1",children:[e.jsx("span",{className:"text-muted",children:"Phone:"}),e.jsx("span",{children:a.clinic_phone})]}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("span",{className:"text-muted",children:"Email:"}),e.jsx("span",{children:a.clinic_email})]})]})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{className:"fw-bold mb-2 pb-1 border-bottom",style:{color:"#0077be"},children:"Patient Information"}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6 d-flex justify-content-between mb-1",children:[e.jsx("span",{className:"text-muted",children:"Name:"}),e.jsx("span",{className:"fw-bold",children:a.patient_name})]}),a.patient_email&&e.jsxs("div",{className:"col-md-6 d-flex justify-content-between mb-1",children:[e.jsx("span",{className:"text-muted",children:"Email:"}),e.jsx("span",{children:a.patient_email})]}),a.patient_phone&&e.jsxs("div",{className:"col-md-6 d-flex justify-content-between mb-1",children:[e.jsx("span",{className:"text-muted",children:"Phone:"}),e.jsx("span",{children:a.patient_phone})]}),a.patient_address&&e.jsxs("div",{className:"col-md-6 d-flex justify-content-between mb-1",children:[e.jsx("span",{className:"text-muted",children:"Address:"}),e.jsx("span",{className:"text-end",children:a.patient_address})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{className:"fw-bold mb-2 pb-1 border-bottom",style:{color:"#0077be"},children:a.receipt_type==="visit"?"Visit Details":"Service Details"}),e.jsxs("div",{className:"p-3 rounded",style:{backgroundColor:"#f8f9fa",borderLeft:"4px solid #0077be"},children:[e.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[e.jsx("span",{className:"text-muted",children:"Service:"}),e.jsx("span",{className:"fw-bold",children:a.service_name})]}),a.service_description&&e.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[e.jsx("span",{className:"text-muted",children:"Description:"}),e.jsx("span",{className:"text-end",children:a.service_description})]}),a.receipt_type==="appointment"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[e.jsx("span",{className:"text-muted",children:"Appointment Date:"}),e.jsx("span",{children:a.service_date})]}),e.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[e.jsx("span",{className:"text-muted",children:"Time Slot:"}),e.jsx("span",{children:a.service_time})]}),a.teeth_count&&e.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[e.jsx("span",{className:"text-muted",children:"Teeth Count:"}),e.jsx("span",{children:a.teeth_description})]}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("span",{className:"text-muted",children:"Status:"}),e.jsx("span",{className:"badge bg-success",children:a.appointment_status})]})]}),a.receipt_type==="visit"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[e.jsx("span",{className:"text-muted",children:"Visit Date:"}),e.jsx("span",{children:a.visit_date})]}),a.start_time&&a.end_time&&e.jsxs("div",{className:"p-2 rounded mb-2",style:{backgroundColor:"#d4edda",borderLeft:"4px solid #28a745"},children:[e.jsxs("div",{className:"d-flex justify-content-between mb-1",children:[e.jsx("span",{className:"text-muted",children:"Start Time:"}),e.jsx("span",{children:a.start_time})]}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("span",{className:"text-muted",children:"End Time:"}),e.jsx("span",{children:a.end_time})]})]}),a.teeth_treated&&e.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[e.jsx("span",{className:"text-muted",children:"Teeth Treated:"}),e.jsx("span",{children:a.teeth_treated})]}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("span",{className:"text-muted",children:"Status:"}),e.jsx("span",{className:"badge bg-success",children:a.visit_status})]})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{className:"fw-bold mb-2 pb-1 border-bottom",style:{color:"#0077be"},children:"Payment Information"}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-bordered",children:[e.jsx("thead",{style:{backgroundColor:"#f8f9fa"},children:e.jsxs("tr",{children:[e.jsx("th",{style:{color:"#0077be"},children:"Payment Method"}),e.jsx("th",{style:{color:"#0077be"},children:"Reference"}),e.jsx("th",{style:{color:"#0077be"},children:"Amount"}),e.jsx("th",{style:{color:"#0077be"},children:"Date Paid"}),e.jsx("th",{style:{color:"#0077be"},children:"Status"})]})}),e.jsxs("tbody",{children:[a.payment_details&&a.payment_details.length>0?a.payment_details.map((n,r)=>e.jsxs("tr",{children:[e.jsx("td",{children:n.method}),e.jsx("td",{children:n.reference}),e.jsxs("td",{children:["â‚±",parseFloat(n.amount).toFixed(2)]}),e.jsx("td",{children:n.paid_at||"N/A"}),e.jsx("td",{children:e.jsx("span",{className:"badge bg-success",children:n.status})})]},r)):e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"text-center",children:"No payment records found"})}),e.jsxs("tr",{style:{backgroundColor:"#e3f2fd",fontWeight:"bold"},children:[e.jsx("td",{colSpan:"2",children:e.jsx("strong",{children:"Total Amount"})}),e.jsxs("td",{style:{color:"#28a745",fontSize:"16px"},children:["â‚±",parseFloat(a.total_amount).toFixed(2)]}),e.jsx("td",{colSpan:"2"})]}),e.jsxs("tr",{style:{backgroundColor:"#e3f2fd",fontWeight:"bold"},children:[e.jsx("td",{colSpan:"2",children:e.jsx("strong",{children:"Total Paid"})}),e.jsxs("td",{style:{color:"#28a745",fontSize:"16px"},children:["â‚±",parseFloat(a.total_paid).toFixed(2)]}),e.jsx("td",{colSpan:"2"})]})]})]})})]}),a.notes&&e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"p-3 rounded",style:{backgroundColor:"#fff3cd",border:"1px solid #ffeaa7"},children:[e.jsx("h6",{className:"mb-2",style:{color:"#856404"},children:"Additional Notes"}),e.jsx("p",{className:"mb-0",children:a.notes})]})}),a.receipt_type==="visit"&&a.has_notes&&e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"p-3 rounded",style:{backgroundColor:"#fff3cd",border:"1px solid #ffeaa7"},children:[e.jsx("h6",{className:"mb-2",style:{color:"#856404"},children:"Treatment Notes"}),e.jsx("p",{className:"mb-0",children:"Detailed treatment notes and findings are available in your patient record. Please contact the clinic if you need a copy of your treatment notes."})]})}),e.jsxs("div",{className:"text-center mt-4 pt-3 border-top",children:[e.jsx("p",{className:"fw-bold mb-2",children:"Thank you for choosing Kreative Dental & Orthodontics!"}),e.jsx("p",{className:"text-muted mb-1",style:{fontSize:"12px"},children:"Please keep this receipt for your records."}),e.jsxs("p",{className:"text-muted mb-1",style:{fontSize:"12px"},children:["For inquiries, please contact us at ",a.clinic_phone," or ",a.clinic_email]}),e.jsxs("p",{className:"text-muted",style:{fontSize:"10px"},children:["Generated on ",a.receipt_date," at ",a.receipt_time]})]})]})}),e.jsx("div",{className:"modal-footer",children:e.jsxs("button",{type:"button",className:"btn btn-secondary",onClick:i,children:[e.jsx("i",{className:"bi bi-x-circle me-2"}),"Close"]})})]})})})]}));_a.propTypes={show:ta.bool.isRequired,onHide:ta.func.isRequired,receiptData:ta.object};const Ji=()=>{const[s,i]=t.useState([]),[a,n]=t.useState(!0),[r,d]=t.useState(null),[l,h]=t.useState({current_page:1,last_page:1,per_page:20,total:0}),[o,x]=t.useState({search:"",appointment_date:"",visit_date:""}),[g,p]=t.useState(!1),[m,y]=t.useState(null),[N,R]=t.useState(!1),[v,S]=t.useState(null),[u,j]=t.useState(!0);t.useEffect(()=>{b(1),j(!1)},[]),t.useEffect(()=>{if(u)return;v&&clearTimeout(v);const w=o.search&&o.search.length>=2,A=o.appointment_date||o.visit_date;if(w){const _=setTimeout(()=>{b(1)},300);S(_)}else(A||o.search.length===0)&&b(1);return()=>{v&&clearTimeout(v)}},[o.search,o.appointment_date,o.visit_date]);const b=async(w=1)=>{try{n(!0),d(null);const A={page:w,...o};Object.keys(A).forEach(H=>{A[H]||delete A[H]});const _=await z.get("/api/admin/payment-records",{params:A});_.data&&_.data.data?(i(_.data.data),h(_.data.pagination||{current_page:1,last_page:1,per_page:20,total:0})):(i([]),h({current_page:1,last_page:1,per_page:20,total:0}))}catch(A){console.error("Failed to fetch payment records:",A),d("Failed to load payment records. Please try again.")}finally{n(!1)}},C=w=>{const{name:A,value:_}=w.target;x(H=>({...H,[A]:_}))},f=()=>{x({search:"",appointment_date:"",visit_date:""})},D=async w=>{try{R(!0);const A=await z.get(`/api/admin/payment-records/${w.id}/receipt-data`);y(A.data.data),p(!0)}catch(A){console.error("Failed to fetch receipt data:",A),K.error("Failed to load receipt. Please try again.")}finally{R(!1)}},L=()=>{p(!1),y(null)},I=w=>{b(w)};return e.jsxs("div",{className:"container-fluid py-4",children:[e.jsx("div",{className:"row",children:e.jsxs("div",{className:"col-12",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"mb-1",style:{color:"#0077be",fontWeight:"bold"},children:[e.jsx("i",{className:"bi bi-receipt me-2"}),"Payment Records"]}),e.jsx("p",{className:"text-muted mb-0",children:"Search and view payment receipts"})]}),l.total>0&&e.jsxs("div",{className:"badge bg-primary",style:{fontSize:"14px",padding:"10px 15px"},children:[e.jsx("i",{className:"bi bi-check-circle me-1"}),l.total," Paid ",l.total===1?"Payment":"Payments"]})]}),e.jsx("div",{className:"card shadow-sm mb-4",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("h5",{className:"card-title mb-3",children:[e.jsx("i",{className:"bi bi-funnel me-2"}),"Filters"]}),e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsxs("label",{className:"form-label fw-bold",children:[e.jsx("i",{className:"bi bi-person-search me-1"}),"Search Patient Name"]}),e.jsx("input",{type:"text",className:"form-control",name:"search",value:o.search,onChange:C,placeholder:"Enter patient name..."}),e.jsx("small",{className:"text-muted",children:"Minimum 2 characters"})]}),e.jsxs("div",{className:"col-md-3",children:[e.jsxs("label",{className:"form-label fw-bold",children:[e.jsx("i",{className:"bi bi-calendar-event me-1"}),"Appointment Date"]}),e.jsx("input",{type:"date",className:"form-control",name:"appointment_date",value:o.appointment_date,onChange:C})]}),e.jsxs("div",{className:"col-md-3",children:[e.jsxs("label",{className:"form-label fw-bold",children:[e.jsx("i",{className:"bi bi-calendar-check me-1"}),"Visit Date"]}),e.jsx("input",{type:"date",className:"form-control",name:"visit_date",value:o.visit_date,onChange:C})]}),e.jsx("div",{className:"col-md-2 d-flex align-items-end",children:e.jsxs("button",{className:"btn btn-outline-secondary w-100",onClick:f,disabled:!o.search&&!o.appointment_date&&!o.visit_date,children:[e.jsx("i",{className:"bi bi-x-circle me-1"}),"Clear"]})})]})]})}),e.jsx("div",{className:"card shadow-sm",children:e.jsx("div",{className:"card-body",children:a?e.jsxs("div",{className:"text-center py-5",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"mt-3 text-muted",children:"Loading payment records..."})]}):r?e.jsxs("div",{className:"alert alert-danger",role:"alert",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),r]}):s.length===0?e.jsxs("div",{className:"text-center py-5",children:[e.jsx("i",{className:"bi bi-inbox",style:{fontSize:"48px",color:"#ccc"}}),e.jsx("p",{className:"mt-3 text-muted",children:"No payment records found"}),(o.search||o.appointment_date||o.visit_date)&&e.jsx("button",{className:"btn btn-sm btn-outline-primary",onClick:f,children:"Clear Filters"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover align-middle",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Receipt #"}),e.jsx("th",{children:"Patient Name"}),e.jsx("th",{children:"Service"}),e.jsx("th",{children:"Appointment Date"}),e.jsx("th",{children:"Visit Date"}),e.jsx("th",{children:"Amount Paid"}),e.jsx("th",{children:"Payment Method"}),e.jsx("th",{children:"Date Paid"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:s.map(w=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("span",{className:"badge bg-info text-dark",children:w.receipt_number})}),e.jsx("td",{className:"fw-bold",children:w.patient_name}),e.jsx("td",{children:w.service_name}),e.jsx("td",{children:w.appointment_date?e.jsxs("span",{className:"text-muted",children:[e.jsx("i",{className:"bi bi-calendar-event me-1"}),new Date(w.appointment_date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})]}):e.jsx("span",{className:"text-muted",children:"-"})}),e.jsx("td",{children:w.visit_date?e.jsxs("span",{className:"text-muted",children:[e.jsx("i",{className:"bi bi-calendar-check me-1"}),new Date(w.visit_date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})]}):e.jsx("span",{className:"text-muted",children:"-"})}),e.jsxs("td",{className:"fw-bold text-success",children:["â‚±",parseFloat(w.amount_paid).toFixed(2)]}),e.jsx("td",{children:e.jsx("span",{className:"badge bg-secondary",children:w.payment_method})}),e.jsx("td",{className:"text-muted",style:{fontSize:"13px"},children:w.paid_at}),e.jsx("td",{children:e.jsx("span",{className:`badge ${w.type==="visit"?"bg-primary":"bg-success"}`,children:w.type==="visit"?"Visit":"Appointment"})}),e.jsx("td",{children:e.jsxs("button",{className:"btn btn-sm btn-outline-primary",onClick:()=>D(w),disabled:N,children:[e.jsx("i",{className:"bi bi-receipt me-1"}),"View Receipt"]})})]},w.id))})]})}),l.last_page>1&&e.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-3",children:[e.jsxs("div",{className:"text-muted",children:["Showing ",(l.current_page-1)*l.per_page+1," to"," ",Math.min(l.current_page*l.per_page,l.total)," of"," ",l.total," records"]}),e.jsx("nav",{children:e.jsxs("ul",{className:"pagination mb-0",children:[e.jsx("li",{className:`page-item ${l.current_page===1?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>I(l.current_page-1),disabled:l.current_page===1,children:"Previous"})}),[...Array(l.last_page)].map((w,A)=>{const _=A+1;return _===1||_===l.last_page||_>=l.current_page-1&&_<=l.current_page+1?e.jsx("li",{className:`page-item ${l.current_page===_?"active":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>I(_),children:_})},_):_===l.current_page-2||_===l.current_page+2?e.jsx("li",{className:"page-item disabled",children:e.jsx("span",{className:"page-link",children:"..."})},_):null}),e.jsx("li",{className:`page-item ${l.current_page===l.last_page?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>I(l.current_page+1),disabled:l.current_page===l.last_page,children:"Next"})})]})})]})]})})})]})}),e.jsx(_a,{show:g,onHide:L,receiptData:m})]})},dt=()=>{const[s,i]=t.useState(""),[a,n]=t.useState([]),[r,d]=t.useState(null),[l,h]=t.useState(!1),[o,x]=t.useState(""),[g,p]=t.useState([]),[m,y]=t.useState(null),[N,R]=t.useState(!1),[v,S]=t.useState(!1),[u,j]=t.useState(null),[b,C]=t.useState(""),f=()=>JSON.parse(localStorage.getItem("user")||"{}").role==="admin"?"/api/admin/patient-binding":"/api/staff/patient-binding",D=async()=>{if(!s.trim()){n([]);return}h(!0);try{const c=await z.get(`${f()}/unlinked-patients`,{params:{q:s}});n(c.data)}catch(c){console.error("Failed to search patients:",c),j("Failed to search patients. Please try again."),C("error")}finally{h(!1)}},L=async()=>{if(!o.trim()){p([]);return}R(!0);try{const c=await z.get(`${f()}/unlinked-users`,{params:{q:o}});p(c.data)}catch(c){console.error("Failed to search users:",c),j("Failed to search users. Please try again."),C("error")}finally{R(!1)}},I=async()=>{var c,F;if(!r||!m){j("Please select both a patient and a user to bind."),C("error");return}S(!0),j(null);try{const P=await z.post(`${f()}/bind`,{patient_id:r.id,user_id:m.id});j(P.data.message||"Successfully bound patient to user!"),C("success"),d(null),y(null),n([]),p([]),i(""),x("")}catch(P){const k=((F=(c=P.response)==null?void 0:c.data)==null?void 0:F.message)||"Failed to bind patient and user. Please try again.";j(k),C("error")}finally{S(!1)}},w=c=>{d(c),j(null)},A=c=>{y(c),j(null)},_=()=>{d(null)},H=()=>{y(null)},T=c=>c?new Date(c).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"N/A";return e.jsxs("div",{className:"container-fluid py-4",children:[e.jsx("div",{className:"row mb-4",children:e.jsxs("div",{className:"col-12",children:[e.jsxs("h2",{className:"mb-2",children:[e.jsx("i",{className:"bi bi-link-45deg me-2 text-primary"}),"Patient-User Account Binding"]}),e.jsx("p",{className:"text-muted",children:"Link existing patient records to user accounts. Search for unlinked patients and users, then bind them together."})]})}),u&&e.jsxs("div",{className:`alert alert-${b==="success"?"success":"danger"} alert-dismissible fade show`,role:"alert",children:[e.jsx("i",{className:`bi bi-${b==="success"?"check-circle":"exclamation-triangle"} me-2`}),u,e.jsx("button",{type:"button",className:"btn-close",onClick:()=>j(null)})]}),e.jsxs("div",{className:"row g-4",children:[e.jsx("div",{className:"col-lg-6",children:e.jsxs("div",{className:"card shadow-sm h-100",children:[e.jsx("div",{className:"card-header bg-primary text-white",children:e.jsxs("h5",{className:"mb-0",children:[e.jsx("i",{className:"bi bi-person-fill me-2"}),"Step 1: Select Patient Record"]})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Search Unlinked Patients"}),e.jsxs("div",{className:"input-group",children:[e.jsx("input",{type:"text",className:"form-control",placeholder:"Search by name or contact number...",value:s,onChange:c=>i(c.target.value),onKeyPress:c=>c.key==="Enter"&&D()}),e.jsx("button",{className:"btn btn-primary",onClick:D,disabled:l,children:l?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Searching..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-search me-1"}),"Search"]})})]}),e.jsx("small",{className:"form-text text-muted",children:"Only shows patients not linked to any user account"})]}),r&&e.jsx("div",{className:"alert alert-info border-info",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[e.jsxs("div",{children:[e.jsxs("h6",{className:"mb-1",children:[e.jsx("i",{className:"bi bi-check-circle-fill me-2"}),"Selected Patient"]}),e.jsx("p",{className:"mb-1",children:e.jsxs("strong",{children:[r.first_name," ",r.middle_name||""," ",r.last_name]})}),e.jsxs("small",{className:"text-muted",children:["ID: ",r.id," | Contact: ",r.contact_number||"N/A"," | Birthdate: ",T(r.birthdate)]})]}),e.jsx("button",{className:"btn btn-sm btn-outline-secondary",onClick:_,children:e.jsx("i",{className:"bi bi-x-lg"})})]})}),e.jsxs("div",{className:"search-results",style:{maxHeight:"400px",overflowY:"auto"},children:[a.length>0&&!r&&e.jsx("div",{className:"list-group",children:a.map(c=>e.jsx("button",{className:"list-group-item list-group-item-action",onClick:()=>w(c),children:e.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[e.jsxs("div",{children:[e.jsxs("h6",{className:"mb-1",children:[c.first_name," ",c.middle_name||""," ",c.last_name]}),e.jsxs("small",{className:"text-muted",children:["ID: ",c.id," |",c.contact_number&&` Contact: ${c.contact_number} |`,c.birthdate&&` Birthdate: ${T(c.birthdate)} |`,"Sex: ",c.sex||"N/A"]})]}),e.jsx("span",{className:"badge bg-secondary",children:"Select"})]})},c.id))}),!l&&s&&a.length===0&&e.jsxs("div",{className:"text-center text-muted py-4",children:[e.jsx("i",{className:"bi bi-search display-4"}),e.jsx("p",{className:"mt-2",children:"No unlinked patients found"})]}),!s&&a.length===0&&!r&&e.jsxs("div",{className:"text-center text-muted py-4",children:[e.jsx("i",{className:"bi bi-person-plus display-4"}),e.jsx("p",{className:"mt-2",children:"Enter a search query to find patients"})]})]})]})]})}),e.jsx("div",{className:"col-lg-6",children:e.jsxs("div",{className:"card shadow-sm h-100",children:[e.jsx("div",{className:"card-header bg-success text-white",children:e.jsxs("h5",{className:"mb-0",children:[e.jsx("i",{className:"bi bi-person-circle me-2"}),"Step 2: Select User Account"]})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Search Unlinked Patient Users"}),e.jsxs("div",{className:"input-group",children:[e.jsx("input",{type:"text",className:"form-control",placeholder:"Search by name, email, or contact...",value:o,onChange:c=>x(c.target.value),onKeyPress:c=>c.key==="Enter"&&L()}),e.jsx("button",{className:"btn btn-success",onClick:L,disabled:N,children:N?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Searching..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-search me-1"}),"Search"]})})]}),e.jsx("small",{className:"form-text text-muted",children:"Only shows patient role users without linked patient records"})]}),m&&e.jsx("div",{className:"alert alert-success border-success",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[e.jsxs("div",{children:[e.jsxs("h6",{className:"mb-1",children:[e.jsx("i",{className:"bi bi-check-circle-fill me-2"}),"Selected User"]}),e.jsx("p",{className:"mb-1",children:e.jsx("strong",{children:m.name})}),e.jsxs("small",{className:"text-muted",children:["ID: ",m.id," | Email: ",m.email," | Contact: ",m.contact_number||"N/A"]})]}),e.jsx("button",{className:"btn btn-sm btn-outline-secondary",onClick:H,children:e.jsx("i",{className:"bi bi-x-lg"})})]})}),e.jsxs("div",{className:"search-results",style:{maxHeight:"400px",overflowY:"auto"},children:[g.length>0&&!m&&e.jsx("div",{className:"list-group",children:g.map(c=>e.jsx("button",{className:"list-group-item list-group-item-action",onClick:()=>A(c),children:e.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[e.jsxs("div",{children:[e.jsx("h6",{className:"mb-1",children:c.name}),e.jsxs("small",{className:"text-muted",children:["ID: ",c.id," | Email: ",c.email,c.contact_number&&` | Contact: ${c.contact_number}`]})]}),e.jsx("span",{className:"badge bg-secondary",children:"Select"})]})},c.id))}),!N&&o&&g.length===0&&e.jsxs("div",{className:"text-center text-muted py-4",children:[e.jsx("i",{className:"bi bi-search display-4"}),e.jsx("p",{className:"mt-2",children:"No unlinked user accounts found"})]}),!o&&g.length===0&&!m&&e.jsxs("div",{className:"text-center text-muted py-4",children:[e.jsx("i",{className:"bi bi-person-circle display-4"}),e.jsx("p",{className:"mt-2",children:"Enter a search query to find users"})]})]})]})]})})]}),e.jsx("div",{className:"row mt-4",children:e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"card shadow-sm",children:e.jsxs("div",{className:"card-body text-center",children:[e.jsxs("h5",{className:"mb-3",children:[e.jsx("i",{className:"bi bi-arrow-left-right me-2"}),"Step 3: Bind Patient to User"]}),r&&m?e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"alert alert-light border",children:e.jsxs("div",{className:"row align-items-center",children:[e.jsxs("div",{className:"col-md-5 text-start",children:[e.jsx("strong",{className:"text-primary",children:"Patient:"}),e.jsxs("p",{className:"mb-0",children:[r.first_name," ",r.middle_name||""," ",r.last_name]}),e.jsxs("small",{className:"text-muted",children:["ID: ",r.id]})]}),e.jsx("div",{className:"col-md-2",children:e.jsx("i",{className:"bi bi-arrow-left-right display-6 text-warning"})}),e.jsxs("div",{className:"col-md-5 text-start",children:[e.jsx("strong",{className:"text-success",children:"User:"}),e.jsx("p",{className:"mb-0",children:m.name}),e.jsx("small",{className:"text-muted",children:m.email})]})]})}),e.jsx("button",{className:"btn btn-warning btn-lg",onClick:I,disabled:v,children:v?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Binding..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-link-45deg me-2"}),"Bind Patient to User Account"]})})]}):e.jsxs("div",{className:"text-muted",children:[e.jsx("i",{className:"bi bi-info-circle display-4"}),e.jsx("p",{className:"mt-2",children:"Select both a patient and a user to proceed with binding"})]})]})})})})]})},Zi=()=>e.jsx(dt,{});function Ea(){var $,q,J,ie;const[s,i]=t.useState([]),[a,n]=t.useState(!0),[r,d]=t.useState("all"),[l,h]=t.useState(null),[o,x]=t.useState(!1),[g,p]=t.useState(!1),[m,y]=t.useState(!1),[N,R]=t.useState(""),[v,S]=t.useState(!1),[u,j]=t.useState(null),[b,C]=t.useState(""),[f,D]=t.useState(""),[L,I]=t.useState(!1),[w,A]=t.useState(""),_=async()=>{n(!0);try{const B=r!=="all"?{status:r}:{},{data:le}=await z.get("/api/admin/refund-requests",{params:B});i(le)}catch(B){console.error("Failed to load refund requests",B)}finally{n(!1)}};t.useEffect(()=>{_()},[r]);const H=async B=>{var le,M;j(B);try{await z.post(`/api/admin/refund-requests/${B}/approve`,{admin_notes:N}),await _(),R(""),x(!1),h(null)}catch(U){K.error(((M=(le=U==null?void 0:U.response)==null?void 0:le.data)==null?void 0:M.message)||"Failed to approve refund request.")}finally{j(null)}},T=async B=>{var le,M;if(window.confirm("Are you sure you want to reject this refund request?")){j(B);try{await z.post(`/api/admin/refund-requests/${B}/reject`,{admin_notes:N}),await _(),R(""),x(!1),h(null)}catch(U){K.error(((M=(le=U==null?void 0:U.response)==null?void 0:le.data)==null?void 0:M.message)||"Failed to reject refund request.")}finally{j(null)}}},c=async B=>{var le,M;S(!0);try{await z.post(`/api/admin/refund-requests/${B}/process`,{admin_notes:N}),await _(),R(""),p(!1),h(null)}catch(U){K.error(((M=(le=U==null?void 0:U.response)==null?void 0:le.data)==null?void 0:M.message)||"Failed to process refund request.")}finally{S(!1)}},F=async B=>{var le,M;if(window.confirm("Mark this refund request as completed?")){j(B);try{await z.post(`/api/admin/refund-requests/${B}/complete`,{admin_notes:N}),await _(),R(""),h(null),x(!1)}catch(U){K.error(((M=(le=U==null?void 0:U.response)==null?void 0:le.data)==null?void 0:M.message)||"Failed to mark refund request as completed.")}finally{j(null)}}},P=B=>{h(B),R(B.admin_notes||""),x(!0)},k=B=>{h(B),R(B.admin_notes||""),p(!0)},E=B=>{h(B);const le=B!=null&&B.deadline_at?new Date(B.deadline_at).toISOString().slice(0,10):B==null?void 0:B.minimum_extend_deadline_date;C(le||(B==null?void 0:B.minimum_extend_deadline_date)||""),D((B==null?void 0:B.deadline_extension_reason)||""),A(""),y(!0)},O=async()=>{var B,le;if(l){if(!b||!f.trim()){A("New deadline and reason are required.");return}I(!0),A("");try{await z.post(`/api/admin/refund-requests/${l.id}/extend-deadline`,{new_deadline:b,reason:f}),await _(),y(!1),h(null),C(""),D("")}catch(M){A(((le=(B=M==null?void 0:M.response)==null?void 0:B.data)==null?void 0:le.message)||"Failed to extend deadline. Please try again.")}finally{I(!1)}}},X=B=>({pending:"warning",approved:"info",rejected:"danger",processed:"success",completed:"primary"})[B]||"secondary",ee=B=>`â‚±${Number(B).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`,ae=B=>B?new Date(B).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"â€”",ne=B=>{if(!B.deadline_at)return{badge:"secondary",text:"No deadline",icon:"calendar-x"};const U=new Date(B.deadline_at)-new Date,G=Math.ceil(U/(1e3*60*60*24));return G<0?{badge:"danger",text:`${Math.abs(G)} day${Math.abs(G)!==1?"s":""} overdue`,icon:"exclamation-triangle",isOverdue:!0}:G<=2?{badge:"warning",text:`${G} day${G!==1?"s":""} remaining`,icon:"clock",isApproaching:!0}:{badge:"success",text:`${G} day${G!==1?"s":""} remaining`,icon:"check-circle",isOnTime:!0}},re=B=>B?new Date(B).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"â€”",W={all:s.length,pending:s.filter(B=>B.status==="pending").length,approved:s.filter(B=>B.status==="approved").length,rejected:s.filter(B=>B.status==="rejected").length,processed:s.filter(B=>B.status==="processed").length,completed:s.filter(B=>B.status==="completed").length};return e.jsx("div",{className:"refund-request-manager-page",style:{background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",minHeight:"100vh",width:"100%",padding:"1.5rem 1rem",boxSizing:"border-box"},children:e.jsxs("div",{className:"container-fluid",children:[e.jsx("div",{className:"d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4 gap-3",children:e.jsxs("div",{children:[e.jsxs("h2",{className:"fw-bold mb-1",style:{color:"#1e293b"},children:[e.jsx("i",{className:"bi bi-arrow-counterclockwise me-2"}),"Refund Requests"]}),e.jsx("p",{className:"text-muted mb-0",children:"Manage patient refund requests and process refunds"})]})}),e.jsx("div",{className:"card border-0 shadow-sm mb-4",style:{borderRadius:"12px"},children:e.jsx("div",{className:"card-body p-3",children:e.jsx("div",{className:"d-flex flex-wrap gap-2",children:[{key:"all",label:"All",icon:"list"},{key:"pending",label:"Pending",icon:"clock"},{key:"approved",label:"Approved",icon:"check-circle"},{key:"rejected",label:"Rejected",icon:"x-circle"},{key:"processed",label:"Processed",icon:"check2"},{key:"completed",label:"Completed",icon:"check2-circle"}].map(B=>e.jsxs("button",{className:`btn ${r===B.key?"btn-primary":"btn-outline-primary"} btn-sm`,onClick:()=>d(B.key),children:[e.jsx("i",{className:`bi bi-${B.icon} me-1`}),B.label,W[B.key]>0&&e.jsx("span",{className:"badge bg-secondary ms-2",children:W[B.key]})]},B.key))})})}),a?e.jsx("div",{className:"text-center py-5",children:e.jsx(Pe,{})}):s.length===0?e.jsx("div",{className:"card border-0 shadow-sm",style:{borderRadius:"12px"},children:e.jsxs("div",{className:"card-body text-center py-5",children:[e.jsx("i",{className:"bi bi-inbox fs-1 text-muted mb-3"}),e.jsx("p",{className:"text-muted mb-0",children:"No refund requests found."})]})}):e.jsx("div",{className:"card border-0 shadow-sm",style:{borderRadius:"12px"},children:e.jsx("div",{className:"card-body p-0",children:e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover mb-0",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("th",{children:"Patient"}),e.jsx("th",{children:"Appointment"}),e.jsx("th",{children:"Original Amount"}),e.jsx("th",{children:"Cancellation Fee"}),e.jsx("th",{children:"Refund Amount"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Requested At"}),e.jsx("th",{children:"Deadline"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:s.map(B=>{var le,M,U,G;return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("strong",{children:["#",B.id]})}),e.jsx("td",{children:((M=(le=B.patient)==null?void 0:le.user)==null?void 0:M.name)||((U=B.patient)==null?void 0:U.name)||`Patient #${B.patient_id}`}),e.jsx("td",{children:B.appointment_id?e.jsxs("small",{children:["Appointment #",B.appointment_id,e.jsx("br",{}),((G=B.appointment)==null?void 0:G.date)&&e.jsx("span",{className:"text-muted",children:new Date(B.appointment.date).toLocaleDateString()})]}):"â€”"}),e.jsx("td",{children:ee(B.original_amount)}),e.jsx("td",{children:ee(B.cancellation_fee)}),e.jsx("td",{children:e.jsx("strong",{className:"text-success",children:ee(B.refund_amount)})}),e.jsx("td",{children:e.jsx("span",{className:`badge bg-${X(B.status)}`,children:B.status.toUpperCase()})}),e.jsx("td",{children:e.jsx("small",{children:ae(B.requested_at)})}),e.jsxs("td",{children:[B.deadline_at&&e.jsxs("div",{children:[e.jsx("small",{className:"d-block text-muted mb-1",children:re(B.deadline_at)}),(()=>{const Y=ne(B);return e.jsxs("span",{className:`badge bg-${Y.badge} d-inline-flex align-items-center gap-1`,title:Y.isOverdue?"Deadline has passed":Y.isApproaching?"Approaching deadline":"On track",children:[e.jsx("i",{className:`bi bi-${Y.icon}`}),Y.text]})})()]}),!B.deadline_at&&e.jsx("span",{className:"text-muted",children:"â€”"})]}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex gap-1",children:[e.jsx("button",{className:"btn btn-sm btn-outline-info",onClick:()=>P(B),title:"View Details",children:e.jsx("i",{className:"bi bi-eye"})}),B.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn btn-sm btn-outline-success",onClick:()=>H(B.id),disabled:u===B.id,title:"Approve",children:u===B.id?e.jsx("span",{className:"spinner-border spinner-border-sm",role:"status"}):e.jsx("i",{className:"bi bi-check"})}),e.jsx("button",{className:"btn btn-sm btn-outline-danger",onClick:()=>T(B.id),disabled:u===B.id,title:"Reject",children:e.jsx("i",{className:"bi bi-x"})})]}),B.status==="approved"&&e.jsx("button",{className:"btn btn-sm btn-primary",onClick:()=>k(B),title:"Mark as Processed",children:e.jsx("i",{className:"bi bi-check2-circle"})}),B.status==="processed"&&e.jsx("button",{className:"btn btn-sm btn-success",onClick:()=>F(B.id),disabled:u===B.id,title:"Mark as Completed",children:u===B.id?e.jsx("span",{className:"spinner-border spinner-border-sm",role:"status"}):e.jsx("i",{className:"bi bi-flag"})}),["pending","approved","processed"].includes(B.status)&&e.jsx("button",{className:"btn btn-sm btn-outline-primary",onClick:()=>E(B),title:"Extend Deadline",children:e.jsx("i",{className:"bi bi-calendar-plus"})})]})})]},B.id)})})]})})})}),o&&l&&e.jsx("div",{className:"modal d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:1050,display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem"},children:e.jsx("div",{className:"modal-dialog modal-lg",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h5",{className:"modal-title",children:["Refund Request #",l.id," Details"]}),e.jsx("button",{type:"button",className:"btn-close",onClick:()=>{x(!1),h(null),R("")}})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsx("strong",{children:"Status:"}),e.jsx("br",{}),e.jsx("span",{className:`badge bg-${X(l.status)}`,children:l.status.toUpperCase()})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("strong",{children:"Requested At:"}),e.jsx("br",{}),ae(l.requested_at)]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("strong",{children:"Processing Deadline:"}),e.jsx("br",{}),l.deadline_at?e.jsxs("div",{children:[e.jsx("div",{className:"mb-1",children:re(l.deadline_at)}),(()=>{const B=ne(l);return e.jsxs("span",{className:`badge bg-${B.badge} d-inline-flex align-items-center gap-1`,children:[e.jsx("i",{className:`bi bi-${B.icon}`}),B.text]})})()]}):e.jsx("span",{className:"text-muted",children:"No deadline set"})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("strong",{children:"Initial Pickup Notice Sent:"}),e.jsx("br",{}),l.pickup_notified_at?ae(l.pickup_notified_at):"â€”"]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("strong",{children:"Reminder Sent:"}),e.jsx("br",{}),l.pickup_reminder_sent_at?ae(l.pickup_reminder_sent_at):"â€”"]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("strong",{children:"Minimum Extend Deadline:"}),e.jsx("br",{}),l.minimum_extend_deadline_date?new Date(l.minimum_extend_deadline_date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"â€”"]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("strong",{children:"Last Extension:"}),e.jsx("br",{}),l.deadline_extended_at?`${ae(l.deadline_extended_at)} by ${(($=l.deadline_extended_by)==null?void 0:$.name)||"â€”"}`:"â€”"]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("strong",{children:"Processed At:"}),e.jsx("br",{}),l.processed_at?ae(l.processed_at):"â€”"]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("strong",{children:"Completed At:"}),e.jsx("br",{}),l.completed_at?ae(l.completed_at):"â€”"]})]}),l.deadline_extension_reason&&e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Extension Reason:"}),e.jsx("p",{className:"border rounded p-2 bg-light mb-0",children:l.deadline_extension_reason})]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("strong",{children:"Patient:"}),e.jsx("br",{}),((J=(q=l.patient)==null?void 0:q.user)==null?void 0:J.name)||((ie=l.patient)==null?void 0:ie.name)||`Patient #${l.patient_id}`]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("strong",{children:"Appointment:"}),e.jsx("br",{}),l.appointment_id?`#${l.appointment_id}`:"â€”"]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsx("strong",{children:"Original Amount:"}),e.jsx("br",{}),ee(l.original_amount)]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("strong",{children:"Cancellation Fee:"}),e.jsx("br",{}),ee(l.cancellation_fee)]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("strong",{children:"Refund Amount:"}),e.jsx("br",{}),e.jsx("span",{className:"text-success fw-bold",children:ee(l.refund_amount)})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Reason:"}),e.jsx("br",{}),e.jsx("p",{className:"border rounded p-2 bg-light",children:l.reason||"â€”"})]}),l.admin_notes&&e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Admin Notes:"}),e.jsx("br",{}),e.jsx("p",{className:"border rounded p-2 bg-light",children:l.admin_notes})]}),(l.status==="pending"||l.status==="approved"||l.status==="processed")&&e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:e.jsx("strong",{children:"Admin Notes:"})}),e.jsx("textarea",{className:"form-control",rows:"3",value:N,onChange:B=>R(B.target.value),placeholder:"Add notes about this refund request..."})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>{x(!1),h(null),R("")},children:"Close"}),l.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",className:"btn btn-success",onClick:()=>H(l.id),disabled:u===l.id,children:u===l.id?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status"}),"Approving..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-check me-2"}),"Approve"]})}),e.jsxs("button",{type:"button",className:"btn btn-danger",onClick:()=>T(l.id),disabled:u===l.id,children:[e.jsx("i",{className:"bi bi-x me-2"}),"Reject"]})]}),l.status==="processed"&&e.jsx("button",{type:"button",className:"btn btn-success",onClick:()=>F(l.id),disabled:u===l.id,children:u===l.id?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status"}),"Completing..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-flag me-2"}),"Mark as Completed"]})})]})]})})}),g&&l&&e.jsx("div",{className:"modal d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:1050,display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem"},children:e.jsx("div",{className:"modal-dialog",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header bg-primary text-white",children:[e.jsxs("h5",{className:"modal-title",children:["Process Refund Request #",l.id]}),e.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>{p(!1),h(null),R("")}})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"alert alert-info",children:[e.jsx("strong",{children:"Refund Amount:"})," ",ee(l.refund_amount)]}),e.jsx("p",{children:"Mark this refund request as processed after completing the refund transaction."}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:e.jsx("strong",{children:"Admin Notes (optional):"})}),e.jsx("textarea",{className:"form-control",rows:"3",value:N,onChange:B=>R(B.target.value),placeholder:"Add notes about the refund processing..."})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>{p(!1),h(null),R("")},children:"Cancel"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>c(l.id),disabled:v,children:v?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-check2-circle me-2"}),"Mark as Processed"]})})]})]})})}),m&&l&&e.jsx("div",{className:"modal d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:1050,display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem"},children:e.jsx("div",{className:"modal-dialog",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header bg-info text-white",children:[e.jsxs("h5",{className:"modal-title",children:["Extend Deadline for Refund #",l.id]}),e.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>{y(!1),h(null),C(""),D(""),A("")}})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("p",{children:["Minimum allowed deadline:Â ",e.jsx("strong",{children:l.minimum_extend_deadline_date?new Date(l.minimum_extend_deadline_date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"N/A"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:e.jsx("strong",{children:"New Deadline"})}),e.jsx("input",{type:"date",className:"form-control",min:l.minimum_extend_deadline_date||"",value:b,onChange:B=>C(B.target.value)})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:e.jsx("strong",{children:"Reason for Extension"})}),e.jsx("textarea",{className:"form-control",rows:"3",value:f,onChange:B=>D(B.target.value),placeholder:"Explain why the deadline is being extended..."})]}),w&&e.jsx("div",{className:"alert alert-danger py-2",children:w}),e.jsx("div",{className:"alert alert-warning",children:"A notification and email will be sent to the patient after extending the deadline."})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>{y(!1),h(null),C(""),D(""),A("")},children:"Cancel"}),e.jsx("button",{type:"button",className:"btn btn-info text-white",onClick:O,disabled:L,children:L?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-save me-2"}),"Save New Deadline"]})})]})]})})})]})})}function el(){const[s,i]=t.useState(!0),[a,n]=t.useState(!1),[r,d]=t.useState({cancellation_deadline_hours:24,monthly_cancellation_limit:3,create_zero_refund_request:!1,reminder_days:5}),[l,h]=t.useState(""),[o,x]=t.useState(""),g=async()=>{var m,y;i(!0),x("");try{const{data:N}=await z.get("/api/admin/refund-settings");d({cancellation_deadline_hours:N.cancellation_deadline_hours??24,monthly_cancellation_limit:N.monthly_cancellation_limit??3,create_zero_refund_request:N.create_zero_refund_request??!1,reminder_days:N.reminder_days??5})}catch(N){x(((y=(m=N==null?void 0:N.response)==null?void 0:m.data)==null?void 0:y.message)||"Failed to load refund settings."),console.error("Failed to load refund settings",N)}finally{i(!1)}},p=async()=>{var m,y;n(!0),h(""),x("");try{await z.patch("/api/admin/refund-settings",r),h("Refund settings saved successfully.")}catch(N){x(((y=(m=N==null?void 0:N.response)==null?void 0:m.data)==null?void 0:y.message)||"Failed to save refund settings.")}finally{n(!1)}};return t.useEffect(()=>{g()},[]),s?e.jsx("div",{className:"refund-settings-page",style:{background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",minHeight:"100vh",width:"100%",padding:"1.5rem 1rem",boxSizing:"border-box"},children:e.jsx("div",{className:"container-fluid",children:e.jsx(Pe,{})})}):e.jsx("div",{className:"refund-settings-page",style:{background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",minHeight:"100vh",width:"100%",padding:"1.5rem 1rem",boxSizing:"border-box"},children:e.jsx("div",{className:"container-fluid",children:e.jsx("div",{className:"row justify-content-center",children:e.jsxs("div",{className:"col-12 col-md-10 col-lg-8 col-xl-7",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsxs("h2",{className:"fw-bold mb-2",style:{color:"#1e293b"},children:[e.jsx("i",{className:"bi bi-arrow-counterclockwise me-2"}),"Refund & Cancellation Settings"]}),e.jsx("p",{className:"text-muted",children:"Configure global settings for appointment cancellations and refunds"})]}),l&&e.jsxs("div",{className:"alert alert-success alert-dismissible fade show",role:"alert",children:[e.jsx("i",{className:"bi bi-check-circle me-2"}),l,e.jsx("button",{type:"button",className:"btn-close",onClick:()=>h(""),"aria-label":"Close"})]}),o&&e.jsxs("div",{className:"alert alert-danger alert-dismissible fade show",role:"alert",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),o,e.jsx("button",{type:"button",className:"btn-close",onClick:()=>x(""),"aria-label":"Close"})]}),e.jsxs("div",{className:"card border-0 shadow-sm",style:{borderRadius:"16px"},children:[e.jsx("div",{className:"card-header border-0",style:{borderRadius:"16px 16px 0 0",background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)"},children:e.jsxs("h5",{className:"mb-0 fw-bold",style:{color:"#1e293b"},children:[e.jsx("i",{className:"bi bi-gear me-2"}),"Settings"]})}),e.jsxs("div",{className:"card-body p-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"form-label fw-bold",children:[e.jsx("i",{className:"bi bi-clock me-2"}),"Cancellation Deadline (Hours)"]}),e.jsx("input",{type:"number",className:"form-control",min:"0",max:"168",value:r.cancellation_deadline_hours,onChange:m=>d({...r,cancellation_deadline_hours:Number(m.target.value)})}),e.jsx("small",{className:"text-muted",children:"Minimum hours before appointment that patients must cancel to be eligible for refunds. (0-168 hours = 0-7 days)"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"form-label fw-bold",children:[e.jsx("i",{className:"bi bi-calendar-x me-2"}),"Monthly Cancellation Limit per Patient"]}),e.jsx("input",{type:"number",className:"form-control",min:"0",max:"50",value:r.monthly_cancellation_limit,onChange:m=>d({...r,monthly_cancellation_limit:Number(m.target.value)})}),e.jsx("small",{className:"text-muted",children:"Maximum number of cancellations allowed per patient per month. Set to 0 to disable the limit."})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"form-check form-switch",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"createZeroRefund",checked:r.create_zero_refund_request,onChange:m=>d({...r,create_zero_refund_request:m.target.checked})}),e.jsxs("label",{className:"form-check-label fw-bold",htmlFor:"createZeroRefund",children:[e.jsx("i",{className:"bi bi-info-circle me-2"}),"Create Refund Request Even if Amount is Zero"]})]}),e.jsx("small",{className:"text-muted d-block mt-1",children:"If enabled, a refund request will be created even when the refund amount is zero (e.g., when cancellation fee equals the payment amount)."})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"form-label fw-bold",children:[e.jsx("i",{className:"bi bi-bell me-2"}),"Reminder Days for Overdue Refunds"]}),e.jsx("input",{type:"number",className:"form-control",min:"1",max:"30",value:r.reminder_days,onChange:m=>d({...r,reminder_days:Number(m.target.value)})}),e.jsx("small",{className:"text-muted",children:"Number of days after approval before sending reminders for unprocessed refund requests. (1-30 days)"})]}),e.jsx("div",{className:"d-flex justify-content-end mt-4",children:e.jsx("button",{className:"btn btn-primary",onClick:p,disabled:a,children:a?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-save me-2"}),"Save Settings"]})})})]})]})]})})})})}function sl(){const[s,i]=t.useState(!0),[a,n]=t.useState(!1),[r,d]=t.useState(!1),[l,h]=t.useState({privacy_policy:"",terms_conditions:"",effective_date:"",contact_email:"",contact_phone:""}),[o,x]=t.useState(""),[g,p]=t.useState(""),[m,y]=t.useState([]),[N,R]=t.useState(null),[v,S]=t.useState(!1),u=async()=>{var f,D;i(!0),p("");try{const{data:L}=await z.get("/api/admin/policy-settings");h({privacy_policy:L.privacy_policy||"",terms_conditions:L.terms_conditions||"",effective_date:L.effective_date||new Date().toISOString().split("T")[0],contact_email:L.contact_email||"",contact_phone:L.contact_phone||""})}catch(L){p(((D=(f=L==null?void 0:L.response)==null?void 0:f.data)==null?void 0:D.message)||"Failed to load policy settings."),console.error("Failed to load policy settings",L)}finally{i(!1)}},j=async()=>{var f,D,L,I;if(n(!0),x(""),p(""),l.effective_date){const w=new Date(l.effective_date),A=new Date;if(A.setHours(0,0,0,0),w<A){p("Effective date cannot be in the past. Please select today or a future date."),n(!1);return}}try{await z.put("/api/admin/policy-settings",l),x("Policy settings saved successfully. All users have been notified about the policy update."),setTimeout(()=>x(""),5e3),b(),u()}catch(w){const A=((D=(f=w==null?void 0:w.response)==null?void 0:f.data)==null?void 0:D.message)||"Failed to save policy settings.",_=(I=(L=w==null?void 0:w.response)==null?void 0:L.data)==null?void 0:I.errors;_!=null&&_.effective_date?p(_.effective_date[0]||A):p(A)}finally{n(!1)}},b=async()=>{d(!0);try{const{data:f}=await z.get("/api/admin/policy-settings/history");y(f)}catch(f){console.error("Failed to load policy history",f)}finally{d(!1)}},C=async f=>{var D,L;try{const{data:I}=await z.get(`/api/admin/policy-settings/history/${f}`);R(I),S(!0)}catch(I){p(((L=(D=I==null?void 0:I.response)==null?void 0:D.data)==null?void 0:L.message)||"Failed to load policy version.")}};return t.useEffect(()=>{u(),b()},[]),s?e.jsx("div",{style:{background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",minHeight:"100vh",width:"100%",padding:"1.5rem 1rem",boxSizing:"border-box"},children:e.jsx("div",{className:"container-fluid",children:e.jsx(Pe,{})})}):e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        .table-row-hover:hover {
          background-color: #f0f0f0 !important;
        }
      `}),e.jsxs("div",{style:{background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",minHeight:"100vh",width:"100%",padding:"1.5rem 1rem",boxSizing:"border-box"},children:[e.jsx("div",{className:"container-fluid",children:e.jsx("div",{className:"row justify-content-center",children:e.jsxs("div",{className:"col-12 col-lg-10 col-xl-8",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsxs("h2",{className:"fw-bold mb-2",style:{color:"#1e293b"},children:[e.jsx("i",{className:"bi bi-file-text me-2"}),"Terms & Privacy Policy Settings"]}),e.jsx("p",{className:"text-muted",children:"Manage the Terms & Conditions and Privacy Policy content displayed to users"})]}),o&&e.jsxs("div",{className:"alert alert-success alert-dismissible fade show",role:"alert",children:[e.jsx("i",{className:"bi bi-check-circle me-2"}),o,e.jsx("button",{type:"button",className:"btn-close",onClick:()=>x("")})]}),g&&e.jsxs("div",{className:"alert alert-danger alert-dismissible fade show",role:"alert",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),g,e.jsx("button",{type:"button",className:"btn-close",onClick:()=>p("")})]}),e.jsx("div",{className:"card shadow-sm border-0",children:e.jsx("div",{className:"card-body p-4",children:e.jsxs("form",{onSubmit:f=>{f.preventDefault(),j()},children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("h5",{className:"mb-3",children:[e.jsx("i",{className:"bi bi-telephone me-2"}),"Contact Information"]}),e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label fw-semibold",children:"Contact Email"}),e.jsx("input",{type:"email",className:"form-control",value:l.contact_email,onChange:f=>h({...l,contact_email:f.target.value}),placeholder:"kreativedent@gmail.com"})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label fw-semibold",children:"Contact Phone"}),e.jsx("input",{type:"text",className:"form-control",value:l.contact_phone,onChange:f=>h({...l,contact_phone:f.target.value}),placeholder:"0927 759 2845"})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsxs("label",{className:"form-label fw-semibold",children:["Effective Date",e.jsx("span",{className:"text-danger ms-1",children:"*"})]}),e.jsx("input",{type:"date",className:"form-control",value:l.effective_date,min:new Date().toISOString().split("T")[0],onChange:f=>{const D=f.target.value,L=new Date().toISOString().split("T")[0];if(D<L){p("Effective date cannot be in the past. Please select today or a future date.");return}h({...l,effective_date:D}),p("")},required:!0}),e.jsxs("small",{className:"text-muted",children:[e.jsx("i",{className:"bi bi-info-circle me-1"}),"The effective date must be today or a future date. All users will be notified when the policy is updated."]})]})]})]}),e.jsx("hr",{}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("h5",{className:"mb-3",children:[e.jsx("i",{className:"bi bi-shield-lock me-2"}),"Privacy Policy"]}),e.jsxs("label",{className:"form-label fw-semibold",children:["Privacy Policy Content",e.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"0.7rem"},children:"Currently Active"})]}),e.jsx("textarea",{className:"form-control",rows:15,value:l.privacy_policy,onChange:f=>h({...l,privacy_policy:f.target.value}),placeholder:"Enter Privacy Policy content here...",style:{fontFamily:"monospace",fontSize:"0.9rem"}}),e.jsxs("small",{className:"text-muted",children:[e.jsx("i",{className:"bi bi-info-circle me-1"}),"This field is pre-filled with the currently active Privacy Policy displayed to users. You can edit and amend it as needed."]})]}),e.jsx("hr",{}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("h5",{className:"mb-3",children:[e.jsx("i",{className:"bi bi-file-earmark-text me-2"}),"Terms and Conditions"]}),e.jsxs("label",{className:"form-label fw-semibold",children:["Terms and Conditions Content",e.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"0.7rem"},children:"Currently Active"})]}),e.jsx("textarea",{className:"form-control",rows:15,value:l.terms_conditions,onChange:f=>h({...l,terms_conditions:f.target.value}),placeholder:"Enter Terms and Conditions content here...",style:{fontFamily:"monospace",fontSize:"0.9rem"}}),e.jsxs("small",{className:"text-muted",children:[e.jsx("i",{className:"bi bi-info-circle me-1"}),"This field is pre-filled with the currently active Terms and Conditions displayed to users. You can edit and amend it as needed."]})]}),e.jsxs("div",{className:"d-flex justify-content-end gap-2 mt-4",children:[e.jsxs("button",{type:"button",className:"btn btn-secondary",onClick:u,disabled:a,children:[e.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"Reset"]}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:a,children:a?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-save me-2"}),"Save Changes"]})})]})]})})}),e.jsx("div",{className:"card shadow-sm border-0 mt-4",children:e.jsxs("div",{className:"card-body p-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs("h5",{className:"mb-0",children:[e.jsx("i",{className:"bi bi-clock-history me-2"}),"Policy History"]}),e.jsxs("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:b,disabled:r,children:[e.jsx("i",{className:"bi bi-arrow-clockwise me-1"}),"Refresh"]})]}),e.jsx("p",{className:"text-muted small mb-3",children:"Click on any row to view the policy that was active on that date."}),r?e.jsx("div",{className:"text-center py-3",children:e.jsx("div",{className:"spinner-border spinner-border-sm",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})}):m.length===0?e.jsxs("div",{className:"text-center py-4 text-muted",children:[e.jsx("i",{className:"bi bi-inbox me-2"}),"No policy history available yet."]}):e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Effective Date"}),e.jsx("th",{children:"Created At"}),e.jsx("th",{children:"Created By"}),e.jsx("th",{children:"Content"})]})}),e.jsx("tbody",{children:m.map(f=>e.jsxs("tr",{onClick:()=>C(f.id),style:{cursor:"pointer"},className:"table-row-hover",children:[e.jsx("td",{children:e.jsx("strong",{children:f.effective_date})}),e.jsx("td",{children:f.created_at}),e.jsx("td",{children:f.created_by}),e.jsxs("td",{children:[f.has_privacy_policy&&e.jsxs("span",{className:"badge bg-info me-1",children:[e.jsx("i",{className:"bi bi-shield-lock me-1"}),"Privacy"]}),f.has_terms_conditions&&e.jsxs("span",{className:"badge bg-primary",children:[e.jsx("i",{className:"bi bi-file-earmark-text me-1"}),"Terms"]})]})]},f.id))})]})})]})})]})})}),v&&N&&e.jsxs("div",{className:"modal fade show",style:{display:"block"},tabIndex:"-1",role:"dialog",children:[e.jsx("div",{className:"modal-dialog modal-lg modal-dialog-scrollable",role:"document",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h5",{className:"modal-title",children:[e.jsx("i",{className:"bi bi-file-text me-2"}),"Policy Version - ",N.effective_date]}),e.jsx("button",{type:"button",className:"btn-close",onClick:()=>{S(!1),R(null)}})]}),e.jsxs("div",{className:"modal-body",children:[e.jsx("div",{className:"mb-3",children:e.jsxs("small",{className:"text-muted",children:[e.jsx("strong",{children:"Created:"})," ",N.created_at," by ",N.created_by]})}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("h6",{children:[e.jsx("i",{className:"bi bi-shield-lock me-2"}),"Privacy Policy"]}),e.jsx("div",{className:"border rounded p-3",style:{backgroundColor:"#f8f9fa",maxHeight:"300px",overflowY:"auto",fontFamily:"monospace",fontSize:"0.9rem",whiteSpace:"pre-wrap"},children:N.privacy_policy||e.jsx("span",{className:"text-muted",children:"No privacy policy content."})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("h6",{children:[e.jsx("i",{className:"bi bi-file-earmark-text me-2"}),"Terms and Conditions"]}),e.jsx("div",{className:"border rounded p-3",style:{backgroundColor:"#f8f9fa",maxHeight:"300px",overflowY:"auto",fontFamily:"monospace",fontSize:"0.9rem",whiteSpace:"pre-wrap"},children:N.terms_conditions||e.jsx("span",{className:"text-muted",children:"No terms and conditions content."})})]}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("strong",{children:"Contact Email:"})," ",N.contact_email||"N/A"]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("strong",{children:"Contact Phone:"})," ",N.contact_phone||"N/A"]})]})]}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>{S(!1),R(null)},children:"Close"})})]})}),e.jsx("div",{className:"modal-backdrop fade show"})]})]})]})}const al=10,tl=()=>{const[s,i]=t.useState([]),[a,n]=t.useState(!1),[r,d]=t.useState(null),[l,h]=t.useState(""),[o,x]=t.useState(""),[g,p]=t.useState(1),[m,y]=t.useState({current_page:1,last_page:1,total:0}),[N,R]=t.useState(0),[v,S]=t.useState(null),[u,j]=t.useState(null);t.useEffect(()=>{const w=setTimeout(()=>{x(l.trim()),p(1)},350);return()=>clearTimeout(w)},[l]),t.useEffect(()=>{let w=!0;return(async()=>{var _,H;n(!0),d(null);try{const T=new URLSearchParams;T.set("page",g),T.set("per_page",al),o&&T.set("search",o);const c=await z.get(`/api/admin/archived-patients?${T.toString()}`);if(!w)return;const F=c.data||{},P=F.data||[];if(P.length===0&&F.current_page>1){p(k=>Math.max(1,k-1));return}i(P),y({current_page:F.current_page||1,last_page:F.last_page||1,total:F.total||P.length})}catch(T){if(!w)return;console.error("Failed to load archived patients",T),d(((H=(_=T.response)==null?void 0:_.data)==null?void 0:H.message)||"Unable to load archived patients right now."),i([])}finally{w&&n(!1)}})(),()=>{w=!1}},[g,o,N]);const b=t.useMemo(()=>m.last_page||1,[m]),C=w=>{S(w)},f=()=>{S(null)},D=async()=>{var w,A;if(v){j(v.id);try{await z.post(`/api/admin/archived-patients/${v.id}/reactivate`),K.success("Patient account reactivated."),f(),R(_=>_+1)}catch(_){console.error("Failed to reactivate patient",_),K.error(((A=(w=_.response)==null?void 0:w.data)==null?void 0:A.message)||"Unable to reactivate patient. Please try again.")}finally{j(null)}}},L=()=>a?e.jsx("tr",{children:e.jsxs("td",{colSpan:6,className:"text-center py-5 text-muted",children:[e.jsx("div",{className:"spinner-border text-primary me-2",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),"Loading archived accountsâ€¦"]})}):r?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center py-4 text-danger",children:r})}):s.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center py-4 text-muted",children:"No archived patient accounts found."})}):s.map(w=>{const A=`${w.first_name||""} ${w.last_name||""}`.trim();return e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("div",{className:"fw-semibold",children:A||"Unnamed Patient"}),w.middle_name&&e.jsx("div",{className:"small text-muted",children:w.middle_name})]}),e.jsxs("td",{children:[e.jsx("div",{children:w.email||"â€”"}),e.jsx("div",{className:"small text-muted",children:w.contact_number||""})]}),e.jsx("td",{children:w.last_visit_date?e.jsx("span",{className:"badge bg-light text-dark",children:w.last_visit_date}):e.jsx("span",{className:"text-muted",children:"No visits recorded"})}),e.jsxs("td",{children:[e.jsx("div",{children:w.archived_at||"â€”"}),e.jsx("div",{className:"small text-muted",children:w.archived_reason||"Inactive for 5+ years"})]}),e.jsx("td",{children:w.archived_by?e.jsxs("div",{className:"small",children:[w.archived_by.name,e.jsx("div",{className:"text-muted",children:w.archived_by.email})]}):e.jsx("span",{className:"text-muted",children:"System"})}),e.jsx("td",{className:"text-end",children:e.jsx("button",{type:"button",className:"btn btn-sm btn-outline-success",onClick:()=>C(w),disabled:u===w.id,children:u===w.id?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status"}),"Workingâ€¦"]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-arrow-counterclockwise me-1"}),"Reactivate"]})})})]},w.id)}),I=()=>e.jsxs("div",{className:"d-flex justify-content-between align-items-center px-3 py-2",children:[e.jsxs("span",{className:"text-muted small",children:["Showing page ",m.current_page," of ",b," â€¢"," ",m.total," archived accounts"]}),e.jsxs("div",{className:"btn-group",role:"group",children:[e.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",disabled:m.current_page<=1,onClick:()=>p(w=>Math.max(1,w-1)),children:"Previous"}),e.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",disabled:m.current_page>=b,onClick:()=>p(w=>Math.min(b,w+1)),children:"Next"})]})]});return e.jsxs("div",{className:"archived-patients-page",children:[e.jsxs("div",{className:"card shadow-sm",children:[e.jsxs("div",{className:"card-header d-flex flex-column flex-md-row align-items-start align-items-md-center justify-content-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"mb-1",children:"Archived Patient Accounts"}),e.jsx("p",{className:"text-muted mb-0 small",children:"Patients with no visits recorded in the past 5 years. Reactivating removes them from this list immediately."})]}),e.jsxs("div",{className:"archived-search-group input-group",children:[e.jsx("span",{className:"input-group-text bg-white border-end-0",children:e.jsx("i",{className:"bi bi-search"})}),e.jsx("input",{type:"text",className:"form-control border-start-0",placeholder:"Search by name or emailâ€¦",value:l,onChange:w=>h(w.target.value)})]})]}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover align-middle mb-0",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",children:"Patient"}),e.jsx("th",{scope:"col",children:"Contact"}),e.jsx("th",{scope:"col",children:"Last Visit"}),e.jsx("th",{scope:"col",children:"Archived"}),e.jsx("th",{scope:"col",children:"Archived By"}),e.jsx("th",{scope:"col",className:"text-end",children:"Actions"})]})}),e.jsx("tbody",{children:L()})]})}),e.jsx(I,{})]}),e.jsx(Ze,{show:!!v,onConfirm:D,onCancel:f,title:"Reactivate Patient Account",message:`Reactivate access for ${v&&`${v.first_name||""} ${v.last_name||""}`.trim()||"this patient"}? They will be able to log in again immediately.`,confirmText:"Reactivate",cancelText:"Cancel",variant:"success"})]})};function il(){const s=we(),{user:i,logout:a}=Ce(),[n,r]=t.useState(!1),[d,l]=t.useState(!1),[h,o]=t.useState(null),[x,g]=t.useState(!1),[p,m]=t.useState(!1);t.useEffect(()=>{if(i&&i.role!=="staff"){const u=i.role==="admin"?"/admin":i.role==="patient"?"/patient":i.role==="dentist"?"/dentist":"/";s(u,{replace:!0})}},[i,s]),t.useEffect(()=>{let u=!0;return(async()=>{try{const{data:j}=await z.get("/api/inventory/settings");u&&r(!!(j!=null&&j.staff_can_receive))}catch{}finally{u&&l(!0)}})(),()=>{u=!1}},[]),t.useEffect(()=>{let u=!0;return(async()=>{try{const j=await Ts();z.defaults.headers.common["X-Device-Fingerprint"]=j;const b=await z.get("/api/device-status",{headers:{"X-Device-Fingerprint":j}});u&&o(b.data)}catch(j){console.error("Device check failed",j),u&&o({approved:!1})}finally{u&&g(!0)}})(),()=>{u=!1}},[]);const y=()=>{m(!0)},N=async()=>{m(!1),await a(),s("/")},R=()=>{m(!1)},v=u=>"nav-link"+(u?" active":""),S=()=>x&&h&&!h.approved;return e.jsxs("div",{className:"staff-shell sidebar-open",children:[e.jsx(ss,{position:"top-center"}),e.jsxs("aside",{className:"sidebar bg-dark text-white",children:[e.jsxs("div",{className:"sidebar-header d-flex align-items-center justify-content-between",children:[e.jsx("h6",{className:"m-0 fw-bold",children:"Staff Menu"}),e.jsx("button",{className:"btn btn-sm btn-outline-light d-lg-none",onClick:()=>setSidebarOpen(!1),"aria-label":"Close sidebar",children:"âœ•"})]}),e.jsxs("ul",{className:"nav flex-column nav-scroller",children:[e.jsx("li",{className:"nav-item",children:e.jsxs(he,{to:"/staff",end:!0,className:({isActive:u})=>v(u),children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"})}),e.jsx("span",{className:"label",children:"Dashboard"})]})}),e.jsx("li",{className:"nav-item",children:e.jsxs(he,{to:"/staff/appointments",className:({isActive:u})=>v(u)+(S()?" disabled text-muted":""),onClick:u=>{S()&&u.preventDefault()},style:{cursor:S()?"not-allowed":"pointer",opacity:S()?.5:1},children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M17 12h-5v5h5v-5zM16 1v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-1V1h-2zm3 18H5V8h14v11z"})}),e.jsx("span",{className:"label",children:"Appointments"})]})}),e.jsx("li",{className:"nav-item",children:e.jsxs(he,{to:"/staff/appointment-finder",className:({isActive:u})=>v(u)+(S()?" disabled text-muted":""),onClick:u=>{S()&&u.preventDefault()},style:{cursor:S()?"not-allowed":"pointer",opacity:S()?.5:1},children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"})}),e.jsx("span",{className:"label",children:"Appointment Finder"})]})}),e.jsx("li",{className:"nav-item",children:e.jsxs(he,{to:"/staff/appointment-reminders",className:({isActive:u})=>v(u)+(S()?" disabled text-muted":""),onClick:u=>{S()&&u.preventDefault()},style:{cursor:S()?"not-allowed":"pointer",opacity:S()?.5:1},children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"})}),e.jsx("span",{className:"label",children:"Reminders"})]})}),e.jsx("li",{className:"nav-item",children:e.jsxs(he,{to:"/staff/visit-tracker",className:({isActive:u})=>v(u)+(S()?" disabled text-muted":""),onClick:u=>{S()&&u.preventDefault()},style:{cursor:S()?"not-allowed":"pointer",opacity:S()?.5:1},children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"})}),e.jsx("span",{className:"label",children:"Patient Visit Tracker"})]})}),e.jsx("li",{className:"nav-item",children:e.jsxs(he,{to:"/staff/payment-records",className:({isActive:u})=>v(u)+(S()?" disabled text-muted":""),onClick:u=>{S()&&u.preventDefault()},style:{cursor:S()?"not-allowed":"pointer",opacity:S()?.5:1},children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M19 14V6c0-1.1-.9-2-2-2H3c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zm-9-1c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm13-6v11c0 1.1-.9 2-2 2H4v-2h17V7h2z"})}),e.jsx("span",{className:"label",children:"Payment Records"})]})}),e.jsx("li",{className:"nav-item",children:e.jsxs(he,{to:"/staff/refund-requests",className:({isActive:u})=>v(u)+(S()?" disabled text-muted":""),onClick:u=>{S()&&u.preventDefault()},style:{cursor:S()?"not-allowed":"pointer",opacity:S()?.5:1},children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm0 14H4v-6h16v6zm0-10H4V6h16v2z"})}),e.jsx("span",{className:"label",children:"Refund Requests"})]})}),e.jsx("li",{className:"nav-item",children:e.jsxs(he,{to:"/staff/patient-binding",className:({isActive:u})=>v(u)+(S()?" disabled text-muted":""),onClick:u=>{S()&&u.preventDefault()},style:{cursor:S()?"not-allowed":"pointer",opacity:S()?.5:1},children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M10.59 13.41c.41.39.41 1.03 0 1.42-.39.39-1.03.39-1.42 0a5.003 5.003 0 0 1 0-7.07l3.54-3.54a5.003 5.003 0 0 1 7.07 0 5.003 5.003 0 0 1 0 7.07l-1.49 1.49c.01-.82-.12-1.64-.4-2.42l.47-.48a2.982 2.982 0 0 0 0-4.24 2.982 2.982 0 0 0-4.24 0l-3.53 3.53a2.982 2.982 0 0 0 0 4.24zm2.82-4.24c.39-.39 1.03-.39 1.42 0a5.003 5.003 0 0 1 0 7.07l-3.54 3.54a5.003 5.003 0 0 1-7.07 0 5.003 5.003 0 0 1 0-7.07l1.49-1.49c-.01.82.12 1.64.4 2.43l-.47.47a2.982 2.982 0 0 0 0 4.24 2.982 2.982 0 0 0 4.24 0l3.53-3.53a2.982 2.982 0 0 0 0-4.24.973.973 0 0 1 0-1.42z"})}),e.jsx("span",{className:"label",children:"Patient-User Binding"})]})}),d&&n&&e.jsxs(e.Fragment,{children:[e.jsx("li",{className:"nav-item mt-2 small text-uppercase text-secondary ps-3",children:"Operations"}),e.jsx("li",{className:"nav-item",children:e.jsxs(he,{to:"/staff/inventory",className:({isActive:u})=>v(u)+(S()?" disabled text-muted":""),onClick:u=>{S()&&u.preventDefault()},style:{cursor:S()?"not-allowed":"pointer",opacity:S()?.5:1},children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M19 7h-3V6a4 4 0 0 0-8 0v1H5a1 1 0 0 0-1 1v11a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V8a1 1 0 0 0-1-1zM10 6a2 2 0 0 1 4 0v1h-4V6zm8 13a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V9h2v1a1 1 0 0 0 2 0V9h4v1a1 1 0 0 0 2 0V9h2v10z"})}),e.jsx("span",{className:"label",children:"Inventory"})]})})]}),e.jsx("li",{className:"nav-item",children:e.jsxs(he,{to:"/staff/profile",className:({isActive:u})=>v(u),children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 9V7L15 1H5C3.89 1 3 1.89 3 3V21C3 22.11 3.89 23 5 23H11V21H5V19H13V17H5V15H13V13H5V11H13V9H21M15 15V17H19V19H15V21H17V23H21V21H23V17H21V15H15Z"})}),e.jsx("span",{className:"label",children:"Account"})]})})]}),e.jsx("div",{className:"sidebar-footer",children:e.jsxs("button",{className:"btn btn-outline-danger w-100 d-flex align-items-center justify-content-center icon-only-btn",onClick:y,title:"Logout","aria-label":"Logout",children:[e.jsx("i",{className:"bi-box-arrow-right fs-5"}),e.jsx("span",{className:"visually-hidden",children:"Logout"})]})})]}),e.jsxs("div",{className:"content-area",children:[e.jsx("div",{className:"topbar d-flex align-items-center pe-0",children:e.jsx("div",{className:"topbar-bell",children:e.jsx(ea,{})})}),e.jsx("main",{className:"flex-grow-1 p-4 overflow-auto",children:e.jsx("div",{className:"container-fluid h-100",children:e.jsx(gs,{})})})]}),e.jsx("div",{className:"sidebar-overlay show",onClick:()=>setSidebarOpen(!1)}),e.jsx(Ze,{show:p,onConfirm:N,onCancel:R,title:"Confirm Logout",message:"Are you sure you want to logout? You will need to login again to access your account.",confirmText:"Logout",cancelText:"Cancel",variant:"danger"})]})}const ll=()=>{const s=we(),[i,a]=t.useState(null),[n,r]=t.useState(0),[d,l]=t.useState(0),[h,o]=t.useState(0),[x,g]=t.useState(0),[p,m]=t.useState(!1);t.useEffect(()=>{(async()=>{try{const R=await Ts();z.defaults.headers.common["X-Device-Fingerprint"]=R;const v=await z.get("/api/device-status",{headers:{"X-Device-Fingerprint":R}});a(v.data)}catch(R){console.error("Device check failed",R)}})()},[]);const y=t.useCallback(async()=>{m(!0);try{const N=await z.get("/api/visits/stats");r(N.data.today_visits||0),o(N.data.pending_visits||0);const R=await z.get("/api/appointments?status=pending");l(R.data.length||0);const v=await z.get("/api/appointments/remindable");g(v.data.length||0)}catch(N){console.error("Failed to load statistics",N)}finally{m(!1)}},[]);if(t.useEffect(()=>{i&&i.approved&&y()},[i,y]),!i)return e.jsx("p",{children:"Loading dashboard..."});if(!i.approved){const N=!i.temporary_code;return e.jsx("div",{className:"alert alert-warning",children:N?e.jsxs(e.Fragment,{children:["âŒ ",e.jsx("strong",{children:"This device has been rejected by the admin."}),e.jsx("br",{}),"If you believe this was a mistake, please contact the admin for clarification."]}):e.jsxs(e.Fragment,{children:["ðŸš« ",e.jsx("strong",{children:"This device is not yet approved."}),e.jsx("br",{}),"Provide the code below to the admin:",e.jsx("br",{}),e.jsx("strong",{children:"Temporary Code:"})," ",e.jsx("span",{className:"badge bg-secondary",children:i.temporary_code})]})})}return e.jsxs("div",{children:[e.jsx("h2",{className:"mb-4",children:"Welcome, Staff Member!"}),e.jsx("p",{className:"text-muted mb-4",children:"âœ… Your device is approved. You can now access all staff features from the menu."}),e.jsxs("div",{className:"row g-3 mb-4",children:[e.jsx("div",{className:"col-12 col-md-6 col-lg-3",children:e.jsx("div",{className:"card border-0 shadow-sm h-100",style:{borderRadius:"16px",cursor:"pointer"},onClick:()=>s("/staff/visit-tracker"),children:e.jsx("div",{className:"card-body p-4",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"bg-primary rounded-circle me-3 d-flex align-items-center justify-content-center flex-shrink-0",style:{width:"50px",height:"50px",fontSize:"1.5rem"},children:e.jsx("i",{className:"bi bi-calendar-day text-white"})}),e.jsxs("div",{className:"flex-grow-1 min-width-0",children:[e.jsx("div",{className:"text-muted small fw-semibold",children:"Today's Visits"}),e.jsx("div",{className:"fs-3 fw-bold text-primary",children:p?"...":n}),e.jsx("small",{className:"text-muted",children:"Running & Finished"})]})]})})})}),e.jsx("div",{className:"col-12 col-md-6 col-lg-3",children:e.jsx("div",{className:"card border-0 shadow-sm h-100",style:{borderRadius:"16px",cursor:"pointer"},onClick:()=>s("/staff/appointments"),children:e.jsx("div",{className:"card-body p-4",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"bg-warning rounded-circle me-3 d-flex align-items-center justify-content-center flex-shrink-0",style:{width:"50px",height:"50px",fontSize:"1.5rem"},children:e.jsx("i",{className:"bi bi-clock-history text-white"})}),e.jsxs("div",{className:"flex-grow-1 min-width-0",children:[e.jsx("div",{className:"text-muted small fw-semibold",children:"Pending Appointments"}),e.jsx("div",{className:"fs-3 fw-bold text-warning",children:p?"...":d}),e.jsx("small",{className:"text-muted",children:"Needs approval"})]})]})})})}),e.jsx("div",{className:"col-12 col-md-6 col-lg-3",children:e.jsx("div",{className:"card border-0 shadow-sm h-100",style:{borderRadius:"16px",cursor:"pointer"},onClick:()=>s("/staff/visit-tracker"),children:e.jsx("div",{className:"card-body p-4",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"bg-info rounded-circle me-3 d-flex align-items-center justify-content-center flex-shrink-0",style:{width:"50px",height:"50px",fontSize:"1.5rem"},children:e.jsx("i",{className:"bi bi-hourglass-split text-white"})}),e.jsxs("div",{className:"flex-grow-1 min-width-0",children:[e.jsx("div",{className:"text-muted small fw-semibold",children:"Pending Visits"}),e.jsx("div",{className:"fs-3 fw-bold text-info",children:p?"...":h}),e.jsx("small",{className:"text-muted",children:"Awaiting completion"})]})]})})})}),e.jsx("div",{className:"col-12 col-md-6 col-lg-3",children:e.jsx("div",{className:"card border-0 shadow-sm h-100",style:{borderRadius:"16px",cursor:"pointer"},onClick:()=>s("/staff/appointment-reminders"),children:e.jsx("div",{className:"card-body p-4",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"bg-success rounded-circle me-3 d-flex align-items-center justify-content-center flex-shrink-0",style:{width:"50px",height:"50px",fontSize:"1.5rem"},children:e.jsx("i",{className:"bi bi-bell text-white"})}),e.jsxs("div",{className:"flex-grow-1 min-width-0",children:[e.jsx("div",{className:"text-muted small fw-semibold",children:"Appointment Reminders"}),e.jsx("div",{className:"fs-3 fw-bold text-success",children:p?"...":x}),e.jsx("small",{className:"text-muted",children:"Needs to be sent"})]})]})})})})]})]})},nl=()=>{const[s,i]=t.useState(null),[a,n]=t.useState(""),[r,d]=t.useState(""),[l,h]=t.useState(!1);we();const{logout:o}=Ce();t.useEffect(()=>{(async()=>{try{const p=await z.get("/api/user");i(p.data)}catch(p){console.error("Failed to fetch user info",p)}})()},[]);const x=async()=>{var g,p;n(""),d(""),h(!0);try{const m=await z.post("/api/send-password-reset");n(m.data.message||"Password reset link sent to your email!")}catch(m){const y=((p=(g=m.response)==null?void 0:g.data)==null?void 0:p.message)||"Failed to send reset link";d(y)}finally{h(!1)}};return s?e.jsxs("div",{style:{maxWidth:"600px"},children:[e.jsx("h2",{className:"mb-4",children:"My Account"}),e.jsxs("div",{className:"mb-4 p-3 border rounded bg-light",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," ",s.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," ",s.email]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Role:"})," ",s.role]})]}),a&&e.jsx("div",{className:"alert alert-success mb-3",children:a}),r&&e.jsx("div",{className:"alert alert-danger mb-3",children:r}),e.jsx("button",{className:"btn btn-primary",onClick:x,disabled:l,children:l?"Sending...":"Send Password Reset Link"})]}):e.jsx("p",{children:"Loading..."})},rl=t.lazy(()=>Ae(()=>import("./StaffAppointmentManager-g1NktoFh.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),cl=t.lazy(()=>Ae(()=>import("./AppointmentFinder-De2lxLRl.js"),__vite__mapDeps([9,1,2,3,4,5,6,7,8]))),dl=t.lazy(()=>Ae(()=>import("./VisitTrackerManager-q-rrklrr.js"),__vite__mapDeps([10,1,2,3,4,5,6,7,8]))),ol=t.lazy(()=>Ae(()=>Promise.resolve().then(()=>hl),void 0));function ml(){const[s,i]=t.useState("appointments"),[a,n]=t.useState(null),[r,d]=t.useState(""),l=o=>{n("appointment"),d(o||""),i("visits")},h=({id:o,icon:x,label:g})=>e.jsxs("button",{className:`btn flex-fill flex-sm-grow-0 border-0 shadow-sm ${s===o?"":"btn-outline-primary"}`,onClick:()=>i(o),type:"button",style:{background:s===o?"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)":"transparent",color:s===o?"#1e293b":"#6b7280",border:s===o?"1px solid #e2e8f0":"1px solid #d1d5db",borderRadius:"8px",padding:"12px 16px",fontWeight:"600",transition:"all 0.3s ease",minWidth:"140px"},children:[e.jsx("i",{className:`bi bi-${x==="ðŸ“…"?"calendar":x==="ðŸ‘¥"?"people":x==="ðŸ”"?"search":"calendar-check"} me-2`}),e.jsx("span",{className:"d-none d-sm-inline",children:g}),e.jsx("span",{className:"d-sm-none",children:g.split(" ")[0]})]});return e.jsx("div",{className:"admin-appointment-manager-page",style:{background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",minHeight:"100vh",width:"100%",maxWidth:"100%",padding:"1.5rem",boxSizing:"border-box",overflowX:"hidden",overflowY:"auto"},children:e.jsx("div",{className:"row g-2 g-md-3 g-lg-4 m-0",children:e.jsx("div",{className:"col-12 p-0",children:e.jsxs("div",{className:"card border-0 shadow-sm",style:{background:"linear-gradient(135deg, #ffffff 0%, #f8fafc 100%)",borderRadius:"16px",width:"100%",maxWidth:"100%"},children:[e.jsxs("div",{className:"card-header border-0",style:{borderRadius:"16px 16px 0 0",background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",color:"#1e293b"},children:[e.jsxs("h2",{className:"card-title mb-0 fw-bold",style:{color:"#1e293b"},children:[e.jsx("i",{className:"bi bi-calendar-check me-2"}),"Admin Appointment & Visit Management"]}),e.jsx("p",{className:"mb-0 mt-2",style:{color:"#6b7280"},children:"Comprehensive appointment approval, finder, and patient visit tracking system"})]}),e.jsxs("div",{className:"card-body p-4",style:{width:"100%",maxWidth:"100%"},children:[e.jsxs("div",{className:"d-flex flex-column flex-sm-row gap-2 mb-4",role:"group","aria-label":"Appointment tabs",children:[e.jsx(h,{id:"appointments",icon:"ðŸ“…",label:"Appointment Approval"}),e.jsx(h,{id:"appointment-finder",icon:"ðŸ”",label:"Appointment Finder"}),e.jsx(h,{id:"visits",icon:"ðŸ‘¥",label:"Visit Tracking"}),e.jsx(h,{id:"sms-reminders",icon:"ðŸ””",label:"SMS Reminders"})]}),e.jsxs("div",{className:"tab-content",style:{width:"100%",maxWidth:"100%"},children:[s==="appointments"&&e.jsx("div",{className:"tab-pane fade show active",style:{width:"100%",maxWidth:"100%"},children:e.jsx(t.Suspense,{fallback:e.jsxs("div",{className:"text-center py-5",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"mt-3 text-muted",children:"Loading Appointment Manager..."})]}),children:e.jsx(rl,{})})}),s==="appointment-finder"&&e.jsx("div",{className:"tab-pane fade show active",style:{width:"100%",maxWidth:"100%"},children:e.jsx(t.Suspense,{fallback:e.jsxs("div",{className:"text-center py-5",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"mt-3 text-muted",children:"Loading Appointment Finder..."})]}),children:e.jsx(cl,{onSelectReferenceCode:l})})}),s==="visits"&&e.jsx("div",{className:"tab-pane fade show active",style:{width:"100%",maxWidth:"100%"},children:e.jsx(t.Suspense,{fallback:e.jsxs("div",{className:"text-center py-5",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"mt-3 text-muted",children:"Loading Visit Tracker..."})]}),children:e.jsx(dl,{initialVisitType:a,initialRefCode:r})})}),s==="sms-reminders"&&e.jsx("div",{className:"tab-pane fade show active",style:{width:"100%",maxWidth:"100%"},children:e.jsx(t.Suspense,{fallback:e.jsxs("div",{className:"text-center py-5",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"mt-3 text-muted",children:"Loading SMS Reminders..."})]}),children:e.jsx(ol,{})})})]})]})]})})})})}function ot(){const[s,i]=t.useState([]),[a,n]=t.useState(!0),[r,d]=t.useState({}),[l,h]=t.useState(null),[o,x]=t.useState(""),[g,p]=t.useState(!1),[m,y]=t.useState(!1);t.useEffect(()=>{N()},[]);const N=async()=>{n(!0);try{const S=await z.get("/api/appointments/remindable");i(S.data)}catch(S){console.error("Failed to load remindable appointments",S)}finally{n(!1)}},R=S=>{var b,C,f;if(S.status!=="approved"){K.error("Only approved appointments can receive reminders.");return}const j=`Hello ${((C=(b=S.patient)==null?void 0:b.user)==null?void 0:C.name)||"Patient"}, this is a reminder for your dental appointment on ${S.date} at ${S.time_slot} for ${(f=S.service)==null?void 0:f.name}. Ref: ${S.reference_code}. Please arrive on time. â€“ Kreative Dental Clinic`;h(S),x(j),y(!1),p(!0)},v=async()=>{if(!l)return;const S=l.id;d(u=>({...u,[S]:!0}));try{await z.post(`/api/appointments/${S}/send-reminder`,{message:o,edited:m}),K.success("SMS reminder sent!"),p(!1),N()}catch(u){K.error("Failed to send SMS reminder."),console.error(u)}finally{d(u=>({...u,[S]:!1}))}};return e.jsxs("div",{className:"container mt-4",children:[e.jsx("h3",{children:"ðŸ“¤ Appointment Reminders"}),a?e.jsx(Pe,{message:"Loading remindable appointments..."}):s.length===0?e.jsx("p",{className:"text-muted mt-3",children:"No appointments eligible for reminder at this time."}):e.jsx("div",{className:"table-responsive mt-3",children:e.jsxs("table",{className:"table table-bordered table-sm align-middle",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Time Slot"}),e.jsx("th",{children:"Patient"}),e.jsx("th",{children:"Service"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Contact"}),e.jsx("th",{children:"Action"})]})}),e.jsx("tbody",{children:s.map(S=>{var u,j,b,C,f;return e.jsxs("tr",{children:[e.jsx("td",{children:S.date}),e.jsx("td",{children:S.time_slot}),e.jsx("td",{children:((j=(u=S.patient)==null?void 0:u.user)==null?void 0:j.name)||"N/A"}),e.jsx("td",{children:(b=S.service)==null?void 0:b.name}),e.jsx("td",{children:e.jsx("span",{className:`badge ${S.status==="approved"?"bg-success":"bg-warning"}`,children:S.status})}),e.jsx("td",{children:((f=(C=S.patient)==null?void 0:C.user)==null?void 0:f.email)||"â€”"}),e.jsx("td",{children:e.jsx("button",{className:"btn btn-sm btn-primary",disabled:r[S.id]||S.status!=="approved",onClick:()=>R(S),children:r[S.id]?"Sending...":"Send SMS Reminder"})})]},S.id)})})]})}),e.jsxs(Rs,{show:g,onHide:()=>p(!1),size:"lg",children:[e.jsx(Rs.Header,{closeButton:!0,children:e.jsx(Rs.Title,{children:"Edit SMS Reminder Message"})}),e.jsxs(Rs.Body,{children:[e.jsxs(ia.Group,{controlId:"reminderMessage",children:[e.jsx(ia.Label,{children:"Message to be sent"}),e.jsx(ia.Control,{as:"textarea",rows:5,value:o,onChange:S=>{x(S.target.value),y(!0)}})]}),!m&&e.jsx("div",{className:"mt-2 text-muted small",children:"âœï¸ This is the default message. You can edit it before sending."})]}),e.jsxs(Rs.Footer,{children:[e.jsx(Da,{variant:"secondary",onClick:()=>p(!1),children:"Cancel"}),e.jsx(Da,{variant:"primary",onClick:v,disabled:r[l==null?void 0:l.id],children:r[l==null?void 0:l.id]?"Sending...":"Send SMS Reminder"})]})]})]})}const hl=Object.freeze(Object.defineProperty({__proto__:null,default:ot},Symbol.toStringTag,{value:"Module"}));function xl(){var m;const{id:s}=Xs(),i=es(),[a,n]=t.useState(null),[r,d]=t.useState([]),[l,h]=t.useState(!1),[o,x]=t.useState({item_id:"",quantity:"",notes:""}),g=((m=i.state)==null?void 0:m.visitFinished)===!0;if(t.useEffect(()=>{(async()=>{try{const{data:y}=await z.get(`/visits/${s}`);n(y);const N=await z.get("/inventory/items");d(N.data.data||[])}catch{}})()},[s]),!g)return e.jsx(Ha,{to:"/staff",replace:!0});const p=async y=>{var N,R;y.preventDefault(),h(!0);try{await z.post("/inventory/consume",{item_id:Number(o.item_id),quantity:Number(o.quantity),ref_type:"visit",ref_id:Number(s),notes:o.notes||null}),K.success("Stock consumed."),x({item_id:"",quantity:"",notes:""})}catch(v){K.error(((R=(N=v==null?void 0:v.response)==null?void 0:N.data)==null?void 0:R.message)||"Consume failed")}finally{h(!1)}};return e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("h1",{className:"text-xl font-semibold",children:["Consume Stock for Visit #",s]}),e.jsxs("form",{onSubmit:p,className:"space-y-3",children:[e.jsxs("select",{className:"border rounded px-3 py-2",value:o.item_id,onChange:y=>x(N=>({...N,item_id:y.target.value})),required:!0,children:[e.jsx("option",{value:"",children:"Select itemâ€¦"}),r.map(y=>e.jsxs("option",{value:y.id,children:[y.name," (",y.sku_code,")"]},y.id))]}),e.jsx("input",{className:"border rounded px-3 py-2",type:"number",min:"0.001",step:"0.001",placeholder:"Quantity",value:o.quantity,onChange:y=>x(N=>({...N,quantity:y.target.value})),required:!0}),e.jsx("textarea",{className:"border rounded px-3 py-2",rows:2,placeholder:"Notes (optional)",value:o.notes,onChange:y=>x(N=>({...N,notes:y.target.value}))}),e.jsx("button",{disabled:l,className:"border rounded px-3 py-2",children:l?"Savingâ€¦":"Consume"})]})]})}const ul=()=>{const[s,i]=t.useState([]),[a,n]=t.useState(!0),[r,d]=t.useState(null),[l,h]=t.useState({current_page:1,last_page:1,per_page:20,total:0}),[o,x]=t.useState({search:"",appointment_date:"",visit_date:""}),[g,p]=t.useState(!1),[m,y]=t.useState(null),[N,R]=t.useState(!1),[v,S]=t.useState(null),[u,j]=t.useState(!0);t.useEffect(()=>{b(1),j(!1)},[]),t.useEffect(()=>{if(u)return;v&&clearTimeout(v);const w=o.search&&o.search.length>=2,A=o.appointment_date||o.visit_date;if(w){const _=setTimeout(()=>{b(1)},300);S(_)}else(A||o.search.length===0)&&b(1);return()=>{v&&clearTimeout(v)}},[o.search,o.appointment_date,o.visit_date]);const b=async(w=1)=>{try{n(!0),d(null);const A={page:w,...o};Object.keys(A).forEach(H=>{A[H]||delete A[H]});const _=await z.get("/api/staff/payment-records",{params:A});_.data&&_.data.data?(i(_.data.data),h(_.data.pagination||{current_page:1,last_page:1,per_page:20,total:0})):(i([]),h({current_page:1,last_page:1,per_page:20,total:0}))}catch(A){console.error("Failed to fetch payment records:",A),d("Failed to load payment records. Please try again.")}finally{n(!1)}},C=w=>{const{name:A,value:_}=w.target;x(H=>({...H,[A]:_}))},f=()=>{x({search:"",appointment_date:"",visit_date:""})},D=async w=>{try{R(!0);const A=await z.get(`/api/staff/payment-records/${w.id}/receipt-data`);y(A.data.data),p(!0)}catch(A){console.error("Failed to fetch receipt data:",A),K.error("Failed to load receipt. Please try again.")}finally{R(!1)}},L=()=>{p(!1),y(null)},I=w=>{b(w)};return e.jsxs("div",{className:"container-fluid py-4",children:[e.jsx("div",{className:"row",children:e.jsxs("div",{className:"col-12",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"mb-1",style:{color:"#0077be",fontWeight:"bold"},children:[e.jsx("i",{className:"bi bi-receipt me-2"}),"Payment Records"]}),e.jsx("p",{className:"text-muted mb-0",children:"Search and view payment receipts"})]}),l.total>0&&e.jsxs("div",{className:"badge bg-primary",style:{fontSize:"14px",padding:"10px 15px"},children:[e.jsx("i",{className:"bi bi-check-circle me-1"}),l.total," Paid ",l.total===1?"Payment":"Payments"]})]}),e.jsx("div",{className:"card shadow-sm mb-4",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("h5",{className:"card-title mb-3",children:[e.jsx("i",{className:"bi bi-funnel me-2"}),"Filters"]}),e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsxs("label",{className:"form-label fw-bold",children:[e.jsx("i",{className:"bi bi-person-search me-1"}),"Search Patient Name"]}),e.jsx("input",{type:"text",className:"form-control",name:"search",value:o.search,onChange:C,placeholder:"Enter patient name..."}),e.jsx("small",{className:"text-muted",children:"Minimum 2 characters"})]}),e.jsxs("div",{className:"col-md-3",children:[e.jsxs("label",{className:"form-label fw-bold",children:[e.jsx("i",{className:"bi bi-calendar-event me-1"}),"Appointment Date"]}),e.jsx("input",{type:"date",className:"form-control",name:"appointment_date",value:o.appointment_date,onChange:C})]}),e.jsxs("div",{className:"col-md-3",children:[e.jsxs("label",{className:"form-label fw-bold",children:[e.jsx("i",{className:"bi bi-calendar-check me-1"}),"Visit Date"]}),e.jsx("input",{type:"date",className:"form-control",name:"visit_date",value:o.visit_date,onChange:C})]}),e.jsx("div",{className:"col-md-2 d-flex align-items-end",children:e.jsxs("button",{className:"btn btn-outline-secondary w-100",onClick:f,disabled:!o.search&&!o.appointment_date&&!o.visit_date,children:[e.jsx("i",{className:"bi bi-x-circle me-1"}),"Clear"]})})]})]})}),e.jsx("div",{className:"card shadow-sm",children:e.jsx("div",{className:"card-body",children:a?e.jsxs("div",{className:"text-center py-5",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"mt-3 text-muted",children:"Loading payment records..."})]}):r?e.jsxs("div",{className:"alert alert-danger",role:"alert",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),r]}):s.length===0?e.jsxs("div",{className:"text-center py-5",children:[e.jsx("i",{className:"bi bi-inbox",style:{fontSize:"48px",color:"#ccc"}}),e.jsx("p",{className:"mt-3 text-muted",children:"No payment records found"}),(o.search||o.appointment_date||o.visit_date)&&e.jsx("button",{className:"btn btn-sm btn-outline-primary",onClick:f,children:"Clear Filters"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover align-middle",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Receipt #"}),e.jsx("th",{children:"Patient Name"}),e.jsx("th",{children:"Service"}),e.jsx("th",{children:"Appointment Date"}),e.jsx("th",{children:"Visit Date"}),e.jsx("th",{children:"Amount Paid"}),e.jsx("th",{children:"Payment Method"}),e.jsx("th",{children:"Date Paid"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:s.map(w=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("span",{className:"badge bg-info text-dark",children:w.receipt_number})}),e.jsx("td",{className:"fw-bold",children:w.patient_name}),e.jsx("td",{children:w.service_name}),e.jsx("td",{children:w.appointment_date?e.jsxs("span",{className:"text-muted",children:[e.jsx("i",{className:"bi bi-calendar-event me-1"}),new Date(w.appointment_date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})]}):e.jsx("span",{className:"text-muted",children:"-"})}),e.jsx("td",{children:w.visit_date?e.jsxs("span",{className:"text-muted",children:[e.jsx("i",{className:"bi bi-calendar-check me-1"}),new Date(w.visit_date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})]}):e.jsx("span",{className:"text-muted",children:"-"})}),e.jsxs("td",{className:"fw-bold text-success",children:["â‚±",parseFloat(w.amount_paid).toFixed(2)]}),e.jsx("td",{children:e.jsx("span",{className:"badge bg-secondary",children:w.payment_method})}),e.jsx("td",{className:"text-muted",style:{fontSize:"13px"},children:w.paid_at}),e.jsx("td",{children:e.jsx("span",{className:`badge ${w.type==="visit"?"bg-primary":"bg-success"}`,children:w.type==="visit"?"Visit":"Appointment"})}),e.jsx("td",{children:e.jsxs("button",{className:"btn btn-sm btn-outline-primary",onClick:()=>D(w),disabled:N,children:[e.jsx("i",{className:"bi bi-receipt me-1"}),"View Receipt"]})})]},w.id))})]})}),l.last_page>1&&e.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-3",children:[e.jsxs("div",{className:"text-muted",children:["Showing ",(l.current_page-1)*l.per_page+1," to"," ",Math.min(l.current_page*l.per_page,l.total)," of"," ",l.total," records"]}),e.jsx("nav",{children:e.jsxs("ul",{className:"pagination mb-0",children:[e.jsx("li",{className:`page-item ${l.current_page===1?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>I(l.current_page-1),disabled:l.current_page===1,children:"Previous"})}),[...Array(l.last_page)].map((w,A)=>{const _=A+1;return _===1||_===l.last_page||_>=l.current_page-1&&_<=l.current_page+1?e.jsx("li",{className:`page-item ${l.current_page===_?"active":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>I(_),children:_})},_):_===l.current_page-2||_===l.current_page+2?e.jsx("li",{className:"page-item disabled",children:e.jsx("span",{className:"page-link",children:"..."})},_):null}),e.jsx("li",{className:`page-item ${l.current_page===l.last_page?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>I(l.current_page+1),disabled:l.current_page===l.last_page,children:"Next"})})]})})]})]})})})]})}),e.jsx(_a,{show:g,onHide:L,receiptData:m})]})},pl=()=>e.jsx(dt,{});function bl(){const s=we(),[i,a]=t.useState(null),{logout:n}=Ce(),[r,d]=t.useState(!1);t.useEffect(()=>{z.get("/api/user").then(x=>a(x.data)).catch(()=>a(null))},[]);const l=()=>{d(!0)},h=async()=>{d(!1),await n(),s("/")},o=()=>{d(!1)};return e.jsxs(e.Fragment,{children:[e.jsx("nav",{className:"navbar navbar-expand-lg navbar-light shadow-sm px-3",style:{background:"linear-gradient(135deg, #00b4d8 0%, #0077b6 100%)"},children:e.jsxs("div",{className:"container-fluid",children:[e.jsxs(je,{className:"navbar-brand d-flex align-items-center",to:"/patient",children:[e.jsx("img",{src:us,alt:"Kreative Dental Clinic",style:{height:"32px",width:"32px",objectFit:"contain",marginRight:"8px"}}),e.jsx("span",{className:"fst-bold",style:{color:"white"},children:"Kreative Dental & Orthodontics"})]}),e.jsx("button",{className:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#patientNavbarNav","aria-controls":"patientNavbarNav","aria-expanded":"false","aria-label":"Toggle navigation",children:e.jsx("span",{className:"navbar-toggler-icon"})}),e.jsx("div",{className:"collapse navbar-collapse",id:"patientNavbarNav",children:e.jsxs("div",{className:"navbar-nav ms-auto align-items-lg-center d-flex flex-row gap-2",children:[e.jsx(je,{to:"/patient",className:"btn d-flex align-items-center justify-content-center",title:"Home",style:{color:"white",border:"none",background:"rgba(255, 255, 255, 0.15)",borderRadius:"8px",padding:"0.5rem",width:"40px",height:"40px",textDecoration:"none",transition:"all 0.2s ease"},onMouseEnter:x=>{x.target.style.background="rgba(255, 255, 255, 0.2)"},onMouseLeave:x=>{x.target.style.background="rgba(255, 255, 255, 0.15)"},children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),e.jsx("polyline",{points:"9 22 9 12 15 12 15 22"})]})}),i&&e.jsx("div",{style:{marginLeft:"0.5rem"},children:e.jsx(ea,{})}),i&&e.jsxs("button",{onClick:l,className:"btn d-flex align-items-center ms-lg-2 mt-2 mt-lg-0",style:{background:"linear-gradient(90deg, #00b4d8 0%, #0077b6 100%)",color:"white",border:"none",fontWeight:"600",padding:"0.5rem 1rem",borderRadius:"8px",transition:"all 0.2s ease",fontSize:"0.9rem",letterSpacing:"0.5px",textTransform:"uppercase"},onMouseEnter:x=>{x.target.style.background="linear-gradient(90deg, #0096c7 0%, #0056b3 100%)",x.target.style.transform="translateY(-1px)"},onMouseLeave:x=>{x.target.style.background="linear-gradient(90deg, #00b4d8 0%, #0077b6 100%)",x.target.style.transform="translateY(0)"},children:[e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"#dc3545",style:{marginRight:"0.5rem"},children:e.jsx("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"})}),e.jsx("span",{children:"LOG OUT"})]})]})})]})}),e.jsx(Ze,{show:r,onConfirm:h,onCancel:o,title:"Confirm Logout",message:"Are you sure you want to logout? You will need to login again to access your account.",confirmText:"Logout",cancelText:"Cancel",variant:"danger"})]})}function fl({show:s}){const{user:i,setUser:a}=Ce(),[n,r]=t.useState(""),[d,l]=t.useState(!1),[h,o]=t.useState(null);if(t.useEffect(()=>{s&&(r(""),o(null))},[s,i==null?void 0:i.email]),!s||!i)return null;const x=i.email||"",g=async p=>{var N,R,v,S,u,j,b;if(p.preventDefault(),d)return;l(!0),o(null);const m=n.trim(),y=m?{email:m}:{};try{await z.get("/sanctum/csrf-cookie");const{data:C}=await z.post("/api/patient/verification/resend",y);K.success(C.message||"Verification email sent!",{style:{background:"#0d6efd",color:"#fff",borderRadius:"8px",padding:"14px"}}),a(f=>f&&{...f,email:C.email??f.email,email_verified_at:null}),m&&r("")}catch(C){if(((N=C.response)==null?void 0:N.status)===422){const f=(u=(S=(v=(R=C.response)==null?void 0:R.data)==null?void 0:v.errors)==null?void 0:S.email)==null?void 0:u[0];o(f||"Please enter a valid email address.")}else o(((b=(j=C.response)==null?void 0:j.data)==null?void 0:b.message)||"We couldn't send the verification email. Please try again.")}finally{l(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"modal show fade",style:{display:"block",backgroundColor:"rgba(0, 0, 0, 0.65)"},tabIndex:"-1","aria-modal":"true",role:"dialog",children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("div",{className:"modal-header bg-warning text-dark",children:e.jsxs("h5",{className:"modal-title d-flex align-items-center gap-2",children:[e.jsx("i",{className:"bi bi-envelope-check"}),"Verify Your Email"]})}),e.jsxs("div",{className:"modal-body",children:[e.jsx("p",{className:"text-muted",children:"We sent a verification link to your email. Please verify your email address to continue booking appointments and accessing your records."}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-semibold",children:"Current email on file"}),e.jsxs("div",{className:"input-group",children:[e.jsx("span",{className:"input-group-text",children:e.jsx("i",{className:"bi bi-at"})}),e.jsx("input",{type:"email",className:"form-control",value:x,readOnly:!0})]})]}),e.jsxs("form",{onSubmit:g,children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"newEmail",className:"form-label fw-semibold",children:"Update email (optional)"}),e.jsx("input",{id:"newEmail",type:"email",className:`form-control ${h?"is-invalid":""}`,placeholder:"Enter a new email address",value:n,onChange:p=>r(p.target.value)}),e.jsx("div",{className:"form-text",children:"Leave blank to resend the link to your current email."}),h&&e.jsx("div",{className:"invalid-feedback",children:h})]}),e.jsxs("div",{className:"d-grid gap-2",children:[e.jsx("button",{type:"submit",className:"btn btn-primary btn-lg",disabled:d,children:d?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-send me-2"}),"Send Verification Email"]})}),e.jsxs("p",{className:"small text-muted text-center mb-0",children:["Need help? Contact us at"," ",e.jsx("a",{href:"mailto:kreativedent@gmail.com",children:"kreativedent@gmail.com"})]})]})]})]})]})})}),e.jsx("div",{className:"modal-backdrop fade show"})]})}function gl(){const s=es(),i=we(),{user:a}=Ce(),{loading:n,accepting:r,error:d,policy:l,shouldShowModal:h,accept:o,dismissModal:x}=Qa();t.useEffect(()=>{if(a&&a.role!=="patient"){const m=a.role==="admin"?"/admin":a.role==="staff"?"/staff":a.role==="dentist"?"/dentist":"/";i(m,{replace:!0})}},[a,i]);const g=s.pathname==="/patient"||s.pathname==="/patient/",p=a&&a.role==="patient"&&!a.email_verified_at;return e.jsxs("div",{className:"d-flex flex-column min-vh-100 bg-light patient-layout",children:[e.jsx(ss,{position:"top-center"}),e.jsx(bl,{}),g?e.jsx("main",{className:"flex-grow-1",children:e.jsx(gs,{})}):e.jsx("main",{className:"flex-grow-1 py-4",children:e.jsx("div",{className:"container-fluid px-2 px-md-3 px-lg-4",children:e.jsx(gs,{})})}),h&&e.jsx("div",{className:"modal show fade",style:{display:"block",backgroundColor:"rgba(0, 0, 0, 0.5)"},tabIndex:"-1",children:e.jsx("div",{className:"modal-dialog modal-lg modal-dialog-scrollable",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header bg-primary text-white",children:[e.jsxs("h5",{className:"modal-title d-flex align-items-center gap-2",children:[e.jsx("i",{className:"bi bi-shield-lock"}),"Updated Terms & Privacy Policy"]}),e.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:x,disabled:r})]}),e.jsxs("div",{className:"modal-body",children:[d&&e.jsx("div",{className:"alert alert-danger",role:"alert",children:d}),n?e.jsx("div",{className:"text-center py-4",children:e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-muted mb-3",children:["Weâ€™ve updated our Terms & Conditions and Privacy Policy. Please review the latest version and click ",e.jsx("strong",{children:"Accept & Agree"})," to continue booking new appointments."]}),(l==null?void 0:l.effective_date)&&e.jsxs("p",{className:"small text-muted",children:[e.jsx("strong",{children:"Effective Date:"})," ",new Date(l.effective_date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("h6",{className:"fw-bold mb-2 d-flex align-items-center gap-2",children:[e.jsx("i",{className:"bi bi-shield-check text-primary"}),"Privacy Policy"]}),e.jsx("div",{className:"border rounded p-3 bg-light",style:{maxHeight:"220px",overflowY:"auto",whiteSpace:"pre-wrap"},children:(l==null?void 0:l.privacy_policy)||"No privacy policy content available."})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("h6",{className:"fw-bold mb-2 d-flex align-items-center gap-2",children:[e.jsx("i",{className:"bi bi-file-earmark-text text-primary"}),"Terms and Conditions"]}),e.jsx("div",{className:"border rounded p-3 bg-light",style:{maxHeight:"220px",overflowY:"auto",whiteSpace:"pre-wrap"},children:(l==null?void 0:l.terms_conditions)||"No terms and conditions content available."})]}),e.jsxs("div",{className:"alert alert-info",children:[e.jsx("strong",{children:"Need help?"})," If you have any questions, you can reach us at"," ",e.jsx("a",{href:`mailto:${(l==null?void 0:l.contact_email)||"kreativedent@gmail.com"}`,children:(l==null?void 0:l.contact_email)||"kreativedent@gmail.com"})," ","or call"," ",e.jsx("a",{href:`tel:${(l==null?void 0:l.contact_phone)||"09277592845"}`,children:(l==null?void 0:l.contact_phone)||"0927 759 2845"}),"."]})]})]}),e.jsxs("div",{className:"modal-footer d-flex justify-content-between",children:[e.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:x,disabled:r,children:"Close"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:o,disabled:r||n,children:r?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-check2-circle me-2"}),"Accept & Agree"]})})]})]})})}),h&&e.jsx("div",{className:"modal-backdrop fade show"}),e.jsx(fl,{show:p})]})}function jl(){var k;const{user:s,authLoading:i}=Ce(),[a,n]=t.useState([]),[r,d]=t.useState(!0),[l,h]=t.useState(null),[o,x]=t.useState(null),[g,p]=t.useState(!1),[m,y]=t.useState(null),[N,R]=t.useState([]),[v,S]=t.useState(!1),[u,j]=t.useState(null),[b,C]=t.useState(null),f=!!(s!=null&&s.email_verified_at);if(t.useEffect(()=>{if(!i){if(!s||!f){n([]),R([]),d(!1);return}d(!0),D(),L()}},[i,f]),i)return e.jsx(Pe,{message:"Loading dashboard..."});const D=async()=>{var E;try{const O=await z.get("/api/user-appointments?page=1&limit=3");n(O.data.data||[])}catch(O){((E=O.response)==null?void 0:E.status)!==403&&console.error("Failed to fetch appointments",O)}finally{d(!1)}},L=async()=>{var E,O;try{const X=await z.get("/api/refunds/pending-claims");R(((E=X.data)==null?void 0:E.data)||[])}catch(X){((O=X.response)==null?void 0:O.status)!==403&&console.error("Failed to fetch pending refunds",X)}},I=N.length?[...N].sort((E,O)=>E.deadline_at?O.deadline_at?new Date(E.deadline_at)-new Date(O.deadline_at):-1:1)[0]:null,w=()=>{const E=new Date().getHours();return E<12?"Good Morning":E<18?"Good Afternoon":"Good Evening"},A=E=>({approved:"success",pending:"warning",rejected:"danger",cancelled:"secondary",completed:"primary"})[E]||"secondary",_=E=>({paid:"success",awaiting_payment:"warning",failed:"danger",refunded:"info"})[E]||"secondary",H=async E=>{var O,X,ee,ae,ne;try{h(E),await z.get("/sanctum/csrf-cookie");const{data:re}=await z.post("/api/maya/payments",{appointment_id:E},{skip401Handler:!0});re!=null&&re.redirect_url?window.location.href=re.redirect_url:K.error("Payment link not available. Please try again.",{style:{background:"#dc3545",color:"#fff",borderRadius:"8px",padding:"16px"}})}catch(re){console.error("Create Maya payment failed",re);const W=((X=(O=re.response)==null?void 0:O.data)==null?void 0:X.message)||((ne=(ae=(ee=re.response)==null?void 0:ee.data)==null?void 0:ae.maya)==null?void 0:ne.message)||"Unable to start payment. Please try again.";K.error(W,{style:{background:"#dc3545",color:"#fff",borderRadius:"8px",padding:"16px"}})}finally{h(null)}},T=E=>{y(E),p(!0)},c=async()=>{var E,O;if(m)try{x(m),p(!1),await z.get("/sanctum/csrf-cookie"),await z.post(`/api/appointment/${m}/cancel`),K.success("Appointment cancelled successfully!",{style:{background:"#28a745",color:"#fff",borderRadius:"8px",padding:"16px",fontSize:"16px"},duration:4e3}),D(),y(null)}catch(X){console.error("Cancel appointment failed",X);const ee=((O=(E=X.response)==null?void 0:E.data)==null?void 0:O.message)||"Unable to cancel appointment. Please try again.";K.error(ee,{style:{background:"#dc3545",color:"#fff",borderRadius:"8px",padding:"16px"}})}finally{x(null)}},F=E=>{j(E),S(!0)},P=async()=>{var E,O;if(!(!u||b))try{C(u.id),await z.get("/sanctum/csrf-cookie"),await z.post(`/api/refunds/${u.id}/confirm`),K.success("Thanks! We've marked your refund as claimed.",{style:{background:"#28a745",color:"#fff",borderRadius:"8px",padding:"16px",fontSize:"16px"},duration:4e3}),await L(),R(X=>X.filter(ee=>ee.id!==u.id)),S(!1),j(null)}catch(X){console.error("Confirm refund failed",X);const ee=((O=(E=X.response)==null?void 0:E.data)==null?void 0:O.message)||"Unable to confirm refund right now. Please try again.";K.error(ee,{style:{background:"#dc3545",color:"#fff",borderRadius:"8px",padding:"16px"}})}finally{C(null)}};return e.jsxs("div",{className:"container-fluid py-4",children:[e.jsx(ss,{position:"top-center"}),s&&!f&&e.jsxs("div",{className:"alert alert-warning d-flex align-items-center gap-2 mb-4",role:"alert",children:[e.jsx("i",{className:"bi bi-exclamation-triangle-fill fs-4"}),e.jsx("div",{children:"Please verify your email address to unlock full access. A verification modal is displayed with options to resend or update your email."})]}),e.jsx(Ze,{show:g,onConfirm:c,onCancel:()=>{p(!1),y(null)},title:"Cancel Appointment",message:"Are you sure you want to cancel this appointment?",confirmText:"Yes, Cancel",cancelText:"No, Keep It",variant:"danger"}),e.jsx(Ze,{show:v,onConfirm:P,onCancel:()=>{S(!1),j(null)},title:"Confirm Refund Received",message:"This action cannot be undone. Please confirm only if you have already received your refund.",confirmText:b?"Confirming...":"Yes, I picked it up",cancelText:"Not yet",variant:"primary"}),e.jsx("div",{className:"row mb-4",children:e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"card border-0 shadow-sm",style:{background:"linear-gradient(135deg, #00b4d8 0%, #0077b6 100%)",color:"white"},children:e.jsx("div",{className:"card-body p-4",children:e.jsxs("div",{className:"row align-items-center",children:[e.jsxs("div",{className:"col-md-8",children:[e.jsxs("h1",{className:"h3 mb-2",children:[w(),", ",((k=s==null?void 0:s.name)==null?void 0:k.split(" ")[0])||"Patient","! ðŸ‘‹"]}),e.jsx("p",{className:"mb-0 opacity-75",children:"Welcome to your dental care dashboard. Manage your appointments, view your profile, and stay updated with your dental health journey."}),I&&e.jsx("div",{className:"alert alert-warning bg-white text-dark mt-3 mb-0 shadow-sm border-0",children:e.jsxs("div",{className:"d-flex align-items-start gap-3",children:[e.jsx("i",{className:"bi bi-cash-coin fs-3 text-warning"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Refund waiting for pickup!"}),e.jsxs("div",{children:["Please visit the clinic to claim â‚±",Number(I.refund_amount).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})," ","on or before"," ",I.formatted_deadline||(I.deadline_at?new Date(I.deadline_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"N/A"),". Tap the â€œRefundedâ€ button below once you've picked it up so we can update our records."]}),I.service_name&&e.jsxs("small",{className:"text-muted",children:["Service: ",I.service_name]})]})]})})]}),e.jsx("div",{className:"col-md-4 text-md-end",children:e.jsxs("div",{className:"d-flex flex-column align-items-md-end",children:[e.jsx("div",{className:"mb-2",children:e.jsx("i",{className:"bi bi-calendar-check fs-1 opacity-50"})}),e.jsxs("small",{className:"opacity-75",children:["Last login: ",new Date().toLocaleDateString()]})]})})]})})})})}),e.jsxs("div",{className:"row mb-4",children:[e.jsx("div",{className:"col-12",children:e.jsx("h2",{className:"h4 mb-3",children:"Quick Actions"})}),e.jsx("div",{className:"col-md-4 mb-3",children:e.jsx(je,{to:"/patient/appointment",className:"text-decoration-none",children:e.jsx("div",{className:"card h-100 border-0 shadow-sm hover-lift",children:e.jsxs("div",{className:"card-body text-center p-4",children:[e.jsx("div",{className:"mb-3",children:e.jsx("i",{className:"bi bi-calendar-plus fs-1 text-primary"})}),e.jsx("h5",{className:"card-title text-dark",children:"Book Appointment"}),e.jsx("p",{className:"card-text text-muted",children:"Schedule your next dental visit with our experienced team"}),e.jsxs("div",{className:"btn",style:{background:"linear-gradient(135deg, #00b4d8 0%, #0077b6 100%)",color:"white",border:"none"},children:[e.jsx("i",{className:"bi bi-plus-circle me-2"}),"Book Now"]})]})})})}),e.jsx("div",{className:"col-md-4 mb-3",children:e.jsx(je,{to:"/patient/appointments",className:"text-decoration-none",children:e.jsx("div",{className:"card h-100 border-0 shadow-sm hover-lift",children:e.jsxs("div",{className:"card-body text-center p-4",children:[e.jsx("div",{className:"mb-3",children:e.jsx("i",{className:"bi bi-calendar3 fs-1 text-success"})}),e.jsx("h5",{className:"card-title text-dark",children:"My Appointments"}),e.jsx("p",{className:"card-text text-muted",children:"View and manage your upcoming and past appointments"}),e.jsxs("div",{className:"btn",style:{background:"linear-gradient(135deg, #00b4d8 0%, #0077b6 100%)",color:"white",border:"none"},children:[e.jsx("i",{className:"bi bi-list-ul me-2"}),"View All"]})]})})})}),e.jsx("div",{className:"col-md-4 mb-3",children:e.jsx(je,{to:"/patient/profile",className:"text-decoration-none",children:e.jsx("div",{className:"card h-100 border-0 shadow-sm hover-lift",children:e.jsxs("div",{className:"card-body text-center p-4",children:[e.jsx("div",{className:"mb-3",children:e.jsx("i",{className:"bi bi-person-circle fs-1 text-info"})}),e.jsx("h5",{className:"card-title text-dark",children:"My Profile"}),e.jsx("p",{className:"card-text text-muted",children:"Update your personal information and HMO details"}),e.jsxs("div",{className:"btn",style:{background:"linear-gradient(135deg, #00b4d8 0%, #0077b6 100%)",color:"white",border:"none"},children:[e.jsx("i",{className:"bi bi-gear me-2"}),"Manage"]})]})})})})]}),e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card border-0 shadow-sm",children:[e.jsx("div",{className:"card-header bg-white border-0 pb-0",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("h3",{className:"h5 mb-0",children:"Recent Appointments"}),e.jsx(je,{to:"/patient/appointments",className:"btn btn-sm",style:{border:"2px solid #00b4d8",color:"#00b4d8",background:"transparent"},children:"View All"})]})}),e.jsx("div",{className:"card-body",children:r?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"mt-2 text-muted",children:"Loading appointments..."})]}):a.length===0?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("i",{className:"bi bi-calendar-x fs-1 text-muted"}),e.jsx("p",{className:"mt-2 text-muted",children:"No appointments yet"}),e.jsx(je,{to:"/patient/appointment",className:"btn",style:{background:"linear-gradient(135deg, #00b4d8 0%, #0077b6 100%)",color:"white",border:"none"},children:"Book Your First Appointment"})]}):e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Service"}),e.jsx("th",{children:"Payment Status"}),e.jsx("th",{children:"Appointment Status"}),e.jsx("th",{children:"Action"})]})}),e.jsx("tbody",{children:a.map(E=>{var X,ee;const O=N.find(ae=>ae.appointment_id===E.id);return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{children:[e.jsx("div",{className:"fw-medium",children:E.date}),e.jsx("small",{className:"text-muted",children:E.start_time})]})}),e.jsxs("td",{children:[e.jsx("div",{className:"fw-medium",children:((X=E.service)==null?void 0:X.name)||"â€”"}),e.jsx("small",{className:"text-muted",children:E.payment_method})]}),e.jsx("td",{children:e.jsx("span",{className:`badge bg-${_(E.payment_status)}`,children:((ee=E.payment_status)==null?void 0:ee.replace("_"," "))||"â€”"})}),e.jsx("td",{children:e.jsx("span",{className:`badge bg-${A(E.status)}`,children:E.status})}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex gap-2",children:[E.payment_method==="maya"&&E.payment_status==="awaiting_payment"&&E.status==="approved"&&e.jsx("button",{className:"btn btn-sm btn-primary",onClick:()=>H(E.id),disabled:l===E.id||o===E.id,children:l===E.id?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),"Redirecting..."]}):"Pay Now"}),E.payment_method==="maya"&&E.payment_status==="refunded"&&O&&e.jsx("button",{className:"btn btn-sm btn-outline-info",onClick:()=>F(O),disabled:b===O.id,children:b===O.id?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-check2-circle me-1"}),"Refunded"]})}),(E.status==="pending"||E.status==="approved"&&(E.payment_status==="unpaid"||E.payment_status==="awaiting_payment"))&&e.jsx("button",{className:"btn btn-sm btn-danger",onClick:()=>T(E.id),disabled:o===E.id||l===E.id,children:o===E.id?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),"Canceling..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-x-circle me-1"}),"Cancel"]})})]})})]},E.id)})})]})})})]})})}),e.jsx("div",{className:"row mt-4",children:e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"card border-0 shadow-sm bg-light",children:e.jsx("div",{className:"card-body p-4",children:e.jsxs("div",{className:"row align-items-center",children:[e.jsxs("div",{className:"col-md-8",children:[e.jsxs("h4",{className:"h5 mb-2",children:[e.jsx("i",{className:"bi bi-lightbulb text-warning me-2"}),"Dental Health Tip"]}),e.jsx("p",{className:"mb-0 text-muted",children:"Remember to brush your teeth twice daily and floss regularly. Regular dental check-ups help maintain optimal oral health!"})]}),e.jsx("div",{className:"col-md-4 text-md-end",children:e.jsx("i",{className:"bi bi-tooth fs-1 opacity-25",style:{color:"#00b4d8"}})})]})})})})}),e.jsx("style",{jsx:!0,children:`
        .hover-lift {
          transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .hover-lift:hover {
          transform: translateY(-5px);
          box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
        }
      `})]})}function vl({patientId:s,value:i,onChange:a,disabled:n=!1,required:r=!1}){const[d,l]=t.useState([]),[h,o]=t.useState(!1),[x,g]=t.useState("");t.useEffect(()=>{if(!s)return;let m=!0;return(async()=>{o(!0),g("");try{const{data:y}=await z.get(`/api/patients/${s}/hmos`);m&&l(Array.isArray(y)?y:[])}catch(y){m&&g(Nl(y))}finally{m&&o(!1)}})(),()=>{m=!1}},[s]);const p=t.useMemo(()=>(Array.isArray(d)?d:[]).sort((y,N)=>y.is_primary&&!N.is_primary?-1:!y.is_primary&&N.is_primary?1:(y.provider_name||"").localeCompare(N.provider_name||"")),[d]);return e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm text-zinc-700 dark:text-zinc-200",children:["HMO to use ",r&&e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("div",{className:"mt-1",children:[h?e.jsx("div",{className:"text-sm text-zinc-500",children:"Loading HMOsâ€¦"}):x?e.jsx("div",{className:"text-sm text-red-600",children:x}):e.jsxs("select",{className:"w-full rounded-xl border border-zinc-300 dark:border-zinc-700 bg-transparent p-2 text-sm focus:outline-none focus:ring-2 focus:ring-zinc-400",value:i??"",onChange:m=>a(m.target.value?Number(m.target.value):null),disabled:n||p.length===0,children:[e.jsx("option",{value:"",children:"â€” Self-pay / No HMO â€”"}),p.map(m=>e.jsxs("option",{value:m.id,children:[m.provider_name," - ",m.hmo_number,m.is_primary?" (Primary)":"",m.patient_fullname_on_card?` - ${m.patient_fullname_on_card}`:""]},m.id))]}),p.length===0&&!h&&!x&&e.jsx("div",{className:"text-xs mt-1 text-zinc-500",children:"No HMO available. Add or update HMO in profile first."})]})]})}function Nl(s){var i,a;return((a=(i=s==null?void 0:s.response)==null?void 0:i.data)==null?void 0:a.message)||(s==null?void 0:s.message)||"Request failed"}function yl({isOpen:s,onClose:i,services:a,loading:n,error:r,onServiceSelect:d,selectedDate:l,selectedService:h}){const[o,x]=t.useState(""),[g,p]=t.useState("grid"),[m,y]=t.useState(null),N=b=>b?new Date(b).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):"",R=t.useMemo(()=>!o.trim()||o.length<2?a:a.filter(b=>b.name.toLowerCase().includes(o.toLowerCase())),[a,o]),v=b=>{const C=b.target.value;x(C),m&&clearTimeout(m),C.length===0||C.length>=2},S=()=>{x("")},u=b=>{h&&h.id===b.id?p("grid"):(d(b),p("single"))},j=()=>{p("grid")};return e.jsxs(fs,{open:s,onClose:i,title:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("span",{className:"h3 mb-1 fw-bold",children:"Available Services"}),e.jsx("small",{className:"text-muted fs-6",children:N(l)})]}),maxWidth:"xl",children:[e.jsxs("div",{className:"container-fluid px-0",children:[n&&e.jsx("div",{className:"text-center py-5",children:e.jsx(Pe,{message:"Loading available services..."})}),r&&e.jsx("div",{className:"alert alert-danger border-0 rounded-3 shadow-sm",role:"alert",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("i",{className:"bi bi-exclamation-triangle-fill me-3 fs-5"}),e.jsxs("div",{children:[e.jsx("h6",{className:"alert-heading mb-1",children:"Error Loading Services"}),e.jsx("p",{className:"mb-0",children:r})]})]})}),!n&&!r&&a.length===0&&e.jsx("div",{className:"text-center py-5",children:e.jsxs("div",{className:"text-muted",children:[e.jsx("i",{className:"bi bi-calendar-x display-1 d-block mb-3 text-muted"}),e.jsx("h4",{className:"fw-normal",children:"No services available"}),e.jsx("p",{className:"lead",children:"There are no available services for the selected date."})]})}),!n&&!r&&a.length>0&&e.jsx(e.Fragment,{children:g==="single"&&h?e.jsxs("div",{className:"single-service-view",children:[e.jsx("div",{className:"row mb-4",children:e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"alert border-0 rounded-3 shadow-sm mb-0",style:{background:"linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%)",border:"1px solid #b8dacc"},children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("i",{className:"bi bi-check-circle-fill text-success me-3",style:{fontSize:"1.5rem"}}),e.jsxs("div",{children:[e.jsx("h5",{className:"alert-heading mb-1 text-success fw-bold",children:"Selected Service"}),e.jsx("p",{className:"mb-0",style:{color:"#155724"},children:"Click to change or confirm selection"})]})]})})})}),e.jsx("div",{className:"row justify-content-center",children:e.jsx("div",{className:"col-12 col-md-10 col-lg-8 col-xl-6",children:e.jsx("div",{className:"card border-0 selected-service-card",style:{borderRadius:"16px",background:"#ffffff",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)"},children:e.jsxs("div",{className:"card-body p-4 p-md-5 text-center",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h2",{className:"card-title fw-bold text-dark mb-4",style:{fontSize:"clamp(1.5rem, 4vw, 2.5rem)",lineHeight:"1.3",wordWrap:"break-word",overflowWrap:"break-word"},children:h.name}),h.type==="promo"&&e.jsxs("div",{className:"pricing-section-large",children:[e.jsxs("div",{className:"d-flex justify-content-center align-items-center mb-3",children:[e.jsxs("span",{className:"text-muted text-decoration-line-through me-3 fs-5",children:["â‚±",Number(h.original_price).toLocaleString(),h.per_teeth_service?" per tooth":""]}),e.jsxs("span",{className:"badge bg-danger fs-6",children:[h.discount_percent,"% OFF"]})]}),e.jsxs("div",{className:"display-6 text-success fw-bold mb-0",style:{fontSize:"clamp(2rem, 5vw, 3rem)",lineHeight:"1.2",wordWrap:"break-word"},children:["â‚±",Number(h.promo_price).toLocaleString(),h.per_teeth_service?" per tooth":""]}),h.per_teeth_service&&e.jsx("div",{className:"text-center mt-3",children:e.jsxs("small",{className:"d-inline-flex align-items-center",style:{color:"#007bff",fontSize:"0.875rem"},children:[e.jsx("i",{className:"bi bi-info-circle me-2",style:{fontSize:"1rem"}}),"Total cost depends on number of teeth treated"]})})]}),h.type==="special"&&e.jsxs("div",{className:"pricing-section-large",children:[e.jsxs("div",{className:"display-6 text-info fw-bold mb-3",style:{fontSize:"clamp(2rem, 5vw, 3rem)",lineHeight:"1.2",wordWrap:"break-word"},children:["â‚±",Number(h.price).toLocaleString(),h.per_teeth_service?" per tooth":""]}),e.jsx("span",{className:"badge bg-info fs-6",children:"Special Service"}),h.per_teeth_service&&e.jsx("div",{className:"text-center mt-3",children:e.jsxs("small",{className:"d-inline-flex align-items-center",style:{color:"#007bff",fontSize:"0.875rem"},children:[e.jsx("i",{className:"bi bi-info-circle me-2",style:{fontSize:"1rem"}}),"Total cost depends on number of teeth treated"]})})]}),h.type==="regular"&&e.jsxs("div",{className:"pricing-section-large",children:[e.jsxs("div",{className:"display-6 text-dark fw-bold mb-0",style:{fontSize:"clamp(2rem, 5vw, 3rem)",lineHeight:"1.2",wordWrap:"break-word"},children:["â‚±",Number(h.price).toLocaleString(),h.per_teeth_service?" per tooth":""]}),h.per_teeth_service&&e.jsx("div",{className:"text-center mt-3",children:e.jsxs("small",{className:"d-inline-flex align-items-center",style:{color:"#007bff",fontSize:"0.875rem"},children:[e.jsx("i",{className:"bi bi-info-circle me-2",style:{fontSize:"1rem"}}),"Total cost depends on number of teeth treated"]})})]}),h.is_follow_up&&e.jsxs("div",{className:"mt-4",children:[e.jsx("span",{className:"badge bg-primary fs-6 px-3 py-2",children:"Follow-up Service"}),e.jsxs("div",{className:"mt-3 text-muted",children:[e.jsx("strong",{children:"Parent Service:"})," ",h.follow_up_parent_name||"Assigned parent service"]}),e.jsx("div",{className:"text-muted",children:h.follow_up_max_gap_weeks===null||h.follow_up_max_gap_weeks===void 0?"No time limit between parent and follow-up visits.":`Book within ${h.follow_up_max_gap_weeks} week${h.follow_up_max_gap_weeks===1?"":"s"} of completing the parent service.`})]}),h.has_follow_up_services&&h.follow_up_services&&h.follow_up_services.length>0&&e.jsx("div",{className:"mt-4",children:e.jsx("div",{className:"alert alert-warning border-0 shadow-sm",role:"alert",children:e.jsxs("div",{className:"d-flex align-items-start",children:[e.jsx("i",{className:"bi bi-exclamation-triangle-fill me-3 fs-4 text-warning"}),e.jsxs("div",{children:[e.jsx("h6",{className:"alert-heading text-warning mb-2",children:e.jsx("strong",{children:"Are you sure you want to book this service?"})}),e.jsx("p",{className:"mb-2",children:"This service has a follow-up service available. If you've already completed this service before, you might want to book the follow-up service instead:"}),e.jsx("ul",{className:"mb-2 ps-3",children:h.follow_up_services.map(b=>e.jsx("li",{children:e.jsx("strong",{children:b.name})},b.id))}),e.jsxs("p",{className:"mb-0",children:[e.jsx("strong",{children:"Please confirm:"})," Do you want to book ",e.jsx("strong",{children:h.name})," (the parent service) or one of the follow-up services listed above?"]})]})]})})})]}),e.jsxs("div",{className:"d-grid gap-3 mt-4",children:[e.jsxs("button",{className:"btn btn-lg fw-bold",onClick:()=>{d(h),i()},style:{padding:"0.875rem 1.75rem",fontSize:"1rem",borderRadius:"10px",whiteSpace:"nowrap",background:"#28a745",border:"none",color:"white",transition:"all 0.2s ease"},onMouseEnter:b=>{b.target.style.background="#218838",b.target.style.transform="translateY(-1px)"},onMouseLeave:b=>{b.target.style.background="#28a745",b.target.style.transform="translateY(0)"},children:[e.jsx("i",{className:"bi bi-check-circle-fill me-2"}),"Confirm Selection"]}),e.jsxs("button",{className:"btn btn-lg",onClick:j,style:{padding:"0.75rem 1.5rem",fontSize:"0.95rem",borderRadius:"10px",whiteSpace:"nowrap",background:"transparent",border:"2px solid #007bff",color:"#007bff",fontWeight:"500",transition:"all 0.2s ease"},onMouseEnter:b=>{b.target.style.background="#007bff",b.target.style.color="white",b.target.style.transform="translateY(-1px)"},onMouseLeave:b=>{b.target.style.background="transparent",b.target.style.color="#007bff",b.target.style.transform="translateY(0)"},children:[e.jsx("i",{className:"bi bi-arrow-left-right me-2"}),"Choose Different Service"]}),e.jsxs("button",{className:"btn btn-lg",onClick:j,style:{padding:"0.75rem 1.5rem",fontSize:"0.95rem",borderRadius:"10px",whiteSpace:"nowrap",background:"linear-gradient(90deg, #00b4d8 0%, #0077b6 100%)",border:"none",color:"white",fontWeight:"500",transition:"all 0.2s ease"},onMouseEnter:b=>{b.target.style.background="linear-gradient(90deg, #0096c7 0%, #0056b3 100%)",b.target.style.transform="translateY(-1px)"},onMouseLeave:b=>{b.target.style.background="linear-gradient(90deg, #00b4d8 0%, #0077b6 100%)",b.target.style.transform="translateY(0)"},children:[e.jsx("i",{className:"bi bi-arrow-left me-2"}),"Back to All Services"]})]})]})})})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"row mb-4",children:e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-3",children:e.jsx("div",{className:"alert alert-light border-0 rounded-3 shadow-sm mb-0 flex-grow-1",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("i",{className:"bi bi-info-circle-fill text-primary me-3 fs-4"}),e.jsxs("div",{children:[e.jsxs("h5",{className:"alert-heading mb-1 text-primary",children:[R.length," of ",a.length," services available"]}),e.jsxs("p",{className:"mb-0 text-muted",children:["For ",N(l)]})]})]})})})})}),e.jsx("div",{className:"row mb-4",children:e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"position-relative",children:e.jsxs("div",{className:"input-group input-group-lg",children:[e.jsx("span",{className:"input-group-text bg-light border-end-0",children:e.jsx("i",{className:"bi bi-search text-muted"})}),e.jsx("input",{type:"text",className:"form-control border-start-0 ps-0",placeholder:"Search services by name... (min 2 characters)",value:o,onChange:v,style:{fontSize:"1.1rem"}}),o&&e.jsx("button",{className:"btn btn-outline-secondary border-start-0",type:"button",onClick:S,title:"Clear search",children:e.jsx("i",{className:"bi bi-x-lg"})})]})})})}),o.length>0&&o.length<2?e.jsxs("div",{className:"text-center py-5",children:[e.jsx("i",{className:"bi bi-info-circle display-4 text-warning d-block mb-3"}),e.jsx("h4",{className:"text-warning",children:"Please enter at least 2 characters"}),e.jsx("p",{className:"text-muted fs-5",children:"Type more characters to search for services"}),e.jsx("button",{className:"btn btn-outline-primary btn-lg",onClick:S,children:"Clear Search"})]}):R.length===0&&o?e.jsxs("div",{className:"text-center py-5",children:[e.jsx("i",{className:"bi bi-search display-4 text-muted d-block mb-3"}),e.jsx("h4",{className:"text-muted",children:"No services found"}),e.jsx("p",{className:"text-muted fs-5",children:"Try adjusting your search terms"}),e.jsx("button",{className:"btn btn-outline-primary btn-lg",onClick:S,children:"Clear Search"})]}):e.jsx("div",{className:"row g-3",children:R.map(b=>e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"card border-0 shadow-sm service-card",children:e.jsxs("div",{className:"card-body d-flex align-items-center p-4",children:[e.jsxs("div",{className:"flex-grow-1 me-4",children:[e.jsx("h4",{className:"card-title fw-bold text-dark mb-2",children:b.name}),b.type==="promo"&&e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsxs("span",{className:"text-muted text-decoration-line-through me-3",children:["â‚±",Number(b.original_price).toLocaleString(),b.per_teeth_service?" per tooth":""]}),e.jsxs("span",{className:"badge bg-danger me-3",children:[b.discount_percent,"% OFF"]}),e.jsxs("div",{className:"h4 text-success fw-bold mb-0",children:["â‚±",Number(b.promo_price).toLocaleString(),b.per_teeth_service?" per tooth":""]})]}),b.type==="special"&&e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsxs("div",{className:"h4 text-info fw-bold me-3",children:["â‚±",Number(b.price).toLocaleString(),b.per_teeth_service?" per tooth":""]}),e.jsx("span",{className:"badge bg-info",children:"Special Service"})]}),b.type==="regular"&&e.jsxs("div",{className:"h4 text-dark fw-bold mb-0",children:["â‚±",Number(b.price).toLocaleString(),b.per_teeth_service?" per tooth":""]}),b.is_follow_up&&e.jsxs("div",{className:"mt-3",children:[e.jsx("span",{className:"badge bg-primary me-2",children:"Follow-up"}),e.jsxs("div",{className:"text-muted small mt-1",children:["Parent: ",b.follow_up_parent_name||"Assigned parent service"]}),e.jsx("div",{className:"text-muted small",children:b.follow_up_max_gap_weeks===null||b.follow_up_max_gap_weeks===void 0?"No time limit between visits":`Book within ${b.follow_up_max_gap_weeks} week${b.follow_up_max_gap_weeks===1?"":"s"} of completing the parent service`})]})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("button",{className:"btn btn-primary btn-lg fw-semibold px-4",onClick:()=>u(b),children:[e.jsx("i",{className:"bi bi-check-circle-fill me-2"}),"Select Service"]})})]})})},`${b.id}-${b.type}`))}),e.jsx("div",{className:"row mt-5 pt-4 border-top",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{className:"text-muted",children:["Showing ",R.length," of ",a.length," services"]}),e.jsxs("button",{type:"button",className:"btn btn-outline-secondary btn-lg",onClick:i,children:[e.jsx("i",{className:"bi bi-x-circle me-2"}),"Close"]})]})})})]})})]}),e.jsx("style",{jsx:!0,children:`
        .service-card {
          transition: all 0.3s ease-in-out;
          border-radius: 16px;
          overflow: hidden;
          cursor: pointer;
          min-height: 100px;
        }
        
        .service-card:hover {
          transform: translateY(-4px);
          box-shadow: 0 12px 40px rgba(0,0,0,0.15) !important;
        }
        
        .selected-service-card {
          border-radius: 20px;
          background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
        }
        
        .pricing-section {
          min-height: 60px;
          display: flex;
          flex-direction: column;
          justify-content: center;
        }
        
        .pricing-section-large {
          min-height: 120px;
          display: flex;
          flex-direction: column;
          justify-content: center;
        }
        
        .card-title {
          font-size: 1.3rem;
          line-height: 1.4;
          margin-bottom: 0.5rem;
        }
        
        .btn-primary {
          background: linear-gradient(135deg, #0d6efd 0%, #0b5ed7 100%);
          border: none;
          border-radius: 12px;
          padding: 14px 28px;
          font-weight: 600;
          letter-spacing: 0.5px;
          font-size: 1rem;
        }
        
        .btn-primary:hover {
          background: linear-gradient(135deg, #0b5ed7 0%, #0a58ca 100%);
          transform: translateY(-2px);
        }
        
        .btn-lg {
          padding: 16px 32px;
          font-size: 1.1rem;
          border-radius: 14px;
        }
        
        .input-group-lg .form-control {
          border-radius: 14px;
          border: 2px solid #e9ecef;
          transition: all 0.3s ease;
          font-size: 1.1rem;
          padding: 16px 20px;
        }
        
        .input-group-lg .form-control:focus {
          border-color: #0d6efd;
          box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
        }
        
        .input-group-text {
          border-radius: 14px 0 0 14px;
          border: 2px solid #e9ecef;
          border-right: none;
          background: #f8f9fa;
          padding: 16px 20px;
        }
        
        .alert-light {
          background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }
        
        .badge {
          font-size: 0.8rem;
          padding: 0.6rem 0.9rem;
          border-radius: 10px;
          font-weight: 600;
        }
        
        /* Dynamic sizing based on screen width */
        @media (max-width: 576px) {
          .service-card .card-body {
            padding: 1.5rem;
            flex-direction: column;
            align-items: flex-start;
          }
          
          .service-card .flex-grow-1 {
            margin-right: 0;
            margin-bottom: 1rem;
          }
          
          .card-title {
            font-size: 1.1rem;
          }
          
          .h4 {
            font-size: 1.2rem;
          }
          
          .btn-lg {
            padding: 12px 24px;
            font-size: 0.95rem;
            width: 100%;
          }
          
          .input-group-lg .form-control {
            font-size: 1rem;
            padding: 14px 18px;
          }
          
          .input-group-text {
            padding: 14px 18px;
          }
        }
        
        @media (min-width: 577px) and (max-width: 768px) {
          .service-card .card-body {
            padding: 1.75rem;
          }
          
          .card-title {
            font-size: 1.2rem;
          }
          
          .h4 {
            font-size: 1.3rem;
          }
        }
        
        @media (min-width: 769px) and (max-width: 992px) {
          .service-card .card-body {
            padding: 2rem;
          }
          
          .card-title {
            font-size: 1.3rem;
          }
          
          .h4 {
            font-size: 1.4rem;
          }
        }
        
        @media (min-width: 993px) and (max-width: 1199px) {
          .service-card .card-body {
            padding: 2.25rem;
          }
          
          .card-title {
            font-size: 1.4rem;
          }
          
          .h4 {
            font-size: 1.5rem;
          }
        }
        
        @media (min-width: 1200px) {
          .service-card .card-body {
            padding: 2.5rem;
          }
          
          .card-title {
            font-size: 1.5rem;
          }
          
          .h4 {
            font-size: 1.6rem;
          }
          
          .btn-lg {
            padding: 18px 36px;
            font-size: 1.15rem;
          }
        }
        
        @media (min-width: 1400px) {
          .service-card .card-body {
            padding: 3rem;
          }
          
          .card-title {
            font-size: 1.6rem;
          }
          
          .h4 {
            font-size: 1.7rem;
          }
          
          .btn-lg {
            padding: 20px 40px;
            font-size: 1.2rem;
          }
        }
        
        /* Single service view responsive */
        .single-service-view .selected-service-card {
          max-width: 700px;
          margin: 0 auto;
          min-height: 400px;
        }
        
        .selected-service-card .card-body {
          min-height: 350px;
          display: flex;
          flex-direction: column;
          justify-content: center;
        }
        
        .pricing-section-large {
          min-height: 100px;
          display: flex;
          flex-direction: column;
          justify-content: center;
          align-items: center;
        }
        
        @media (max-width: 576px) {
          .single-service-view .selected-service-card .card-body {
            padding: 1.5rem !important;
            min-height: 300px;
          }
          
          .single-service-view h2 {
            font-size: 1.3rem !important;
            line-height: 1.4 !important;
          }
          
          .single-service-view .display-6 {
            font-size: 1.8rem !important;
            line-height: 1.3 !important;
          }
          
          .pricing-section-large {
            min-height: 80px;
          }
        }
        
        @media (min-width: 577px) and (max-width: 768px) {
          .single-service-view .selected-service-card .card-body {
            padding: 2rem !important;
            min-height: 350px;
          }
          
          .single-service-view h2 {
            font-size: 1.6rem !important;
            line-height: 1.3 !important;
          }
          
          .single-service-view .display-6 {
            font-size: 2.2rem !important;
            line-height: 1.2 !important;
          }
        }
        
        @media (min-width: 769px) {
          .single-service-view .selected-service-card .card-body {
            padding: 3rem !important;
            min-height: 400px;
          }
          
          .single-service-view h2 {
            font-size: 2rem !important;
            line-height: 1.3 !important;
          }
          
          .single-service-view .display-6 {
            font-size: 2.8rem !important;
            line-height: 1.2 !important;
          }
        }
      `})]})}function wl(){const s=new Date;return s.setDate(s.getDate()+1),s.toISOString().slice(0,10)}function _l(){const s=new Date;return s.setDate(s.getDate()+7),s.toISOString().slice(0,10)}function Sl(s){return s===!0||s===1||s==="1"}function kl(s){return Array.isArray(s)?s.map(i=>typeof i=="string"?{date:i,present:!0}:i&&typeof i=="object"&&typeof i.date=="string"?{date:i.date,present:Object.prototype.hasOwnProperty.call(i,"preferred_dentist_present")?!!i.preferred_dentist_present:!0}:null).filter(Boolean):[]}function Cl(){const s=we(),{needsAcceptance:i,reopenModal:a,loading:n}=Qa(),[r,d]=t.useState(""),[l,h]=t.useState([]),[o,x]=t.useState(!1),[g,p]=t.useState(""),[m,y]=t.useState(!1),[N,R]=t.useState(!1),[v,S]=t.useState(null),[u,j]=t.useState([]),[b,C]=t.useState(""),[f,D]=t.useState("cash"),[L,I]=t.useState(""),[w,A]=t.useState(""),[_,H]=t.useState(!0),[T,c]=t.useState(null),[F,P]=t.useState([]),[k,E]=t.useState(""),[O,X]=t.useState(null),ee=F.filter(ce=>ce.present!==!1).map(ce=>ce.date),ae=!!(r&&T&&ee.includes(r)),[ne,re]=t.useState(null),[W,$]=t.useState(null),[q,J]=t.useState(!1),[ie,B]=t.useState(null),le=Sl(v==null?void 0:v.per_teeth_service);t.useEffect(()=>{let ce=!0;return(async()=>{var be;J(!0);try{const{data:ve}=await z.get("/api/user"),Ie=((be=ve==null?void 0:ve.patient)==null?void 0:be.id)??null;ce&&Ie&&re(Number(Ie)),ce&&(ve!=null&&ve.warning_status)&&(B({under_warning:!0,allowed_payment_methods:["maya"]}),D("maya"))}catch{}finally{ce&&J(!1)}})(),()=>ce=!1},[]),t.useEffect(()=>{i||I("")},[i]);const M=async ce=>{var be,ve,Ie,js;x(!0),p("");try{const Ye=await z.get(`/api/appointment/available-services?date=${ce}&with_meta=1`),Es=((be=Ye.data)==null?void 0:be.services)??Ye.data??[];h(Es);const as=((ve=Ye.data)==null?void 0:ve.metadata)??null;if(as){c(as.preferred_dentist??null);const vs=kl(as.highlight_dates??[]);P(vs),E(as.highlight_note??"");const $s=as.preferred_dentist_present??vs.some(V=>V.date===ce&&V.present!==!1);H($s)}else c(null),P([]),E(""),H(!1)}catch(Ye){h([]),p(((js=(Ie=Ye==null?void 0:Ye.response)==null?void 0:Ie.data)==null?void 0:js.message)||"Something went wrong."),c(null),P([]),E(""),H(!1)}finally{x(!1)}},U=async(ce,be={})=>{const ve=Object.prototype.hasOwnProperty.call(be,"honorPreferredDentist")?be.honorPreferredDentist:_;j([]);try{const Ie=await z.get(`/api/appointment/available-slots?date=${r}&service_id=${ce}&honor_preferred_dentist=${ve?1:0}`);j(Ie.data.slots),X(Ie.data.metadata??null)}catch{j([]),X(null)}},G=ce=>{if(i){I("Please accept the updated Terms & Privacy Policy before booking an appointment.");return}const be=ce.target.value;d(be),h([]),S(null),j([]),C(""),D("cash"),$(null),c(null),P([]),E(""),H(!1),X(null),I(""),A(""),y(!1),be&&(M(be),y(!0))},Y=ce=>{if(!ae){H(!1);return}H(ce),v&&U(v.id,{honorPreferredDentist:ce})},se=ce=>{S(ce),U(ce.id),C(""),I(""),A(""),y(!1)},oe=ce=>{const be=ce.target.value;if(ie!=null&&ie.under_warning&&be!=="maya"){I(`âš ï¸ PAYMENT RESTRICTION

Your account is under warning due to previous no-shows. You can only book appointments using Maya (online payment) at this time.`);return}D(be),be!=="hmo"&&$(null)},pe=async()=>{var ce;if(i){I("Please accept the updated Terms & Privacy Policy before booking an appointment.");return}if(!N){if(!r||!v||!b||!f){I("Please complete all booking fields.");return}if(f==="hmo"&&!W){I("Please select an HMO for this appointment.");return}R(!0),I("");try{const be={service_id:v.id,date:r,start_time:b,payment_method:f,honor_preferred_dentist:_};f==="hmo"&&(be.patient_hmo_id=W),le&&w&&(be.teeth_count=parseInt(w)),await z.post("/api/appointment",be),I("âœ… Appointment successfully booked! Redirecting..."),setTimeout(()=>{s("/patient")},2e3)}catch(be){const ve=(ce=be==null?void 0:be.response)==null?void 0:ce.data;ve!=null&&ve.blocked||ve!=null&&ve.warning_status?I(ve.message):I((ve==null?void 0:ve.message)||"Booking failed.")}finally{R(!1)}}};return e.jsxs("div",{className:"w-100",children:[e.jsxs("div",{className:"card border-0 shadow-lg w-100 patient-page-card",children:[e.jsxs("div",{className:"card-header bg-gradient bg-primary text-white text-center py-4",children:[e.jsxs("h2",{className:"h3 mb-2",children:[e.jsx("i",{className:"bi bi-calendar-plus me-2"}),"Book an Appointment"]}),e.jsx("p",{className:"mb-0 opacity-75",children:"Schedule your dental visit with ease"})]}),e.jsxs("div",{className:"card-body p-5",children:[i&&e.jsxs("div",{className:"alert alert-warning d-flex flex-column flex-md-row align-items-start align-items-md-center justify-content-between gap-3",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Action required:"})," Please review and accept the updated Terms & Privacy Policy before booking a new appointment."]}),e.jsx("div",{className:"d-flex align-items-center gap-2",children:e.jsxs("button",{type:"button",className:"btn btn-outline-primary btn-sm",onClick:a,disabled:n,children:[e.jsx("i",{className:"bi bi-shield-lock me-1"}),"Review Policy"]})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"form-label fw-semibold fs-5 mb-3",htmlFor:"patientBookingDate",children:[e.jsx("i",{className:"bi bi-calendar3 me-2 text-primary"}),"Select a Date"]}),T&&e.jsxs("div",{className:"alert alert-info border-0 shadow-sm mb-3",role:"alert",children:[e.jsx("strong",{children:"Most recent dentist:"})," ",T.name??T.code,e.jsx("div",{className:"small mt-2",children:r?ae?"Your dentist is scheduled on this date.":"Your dentist is not scheduled on this date.":"Choose a date to see when your dentist is scheduled."}),ee.length>0&&e.jsxs("div",{className:"small text-muted mt-2",children:["Available on: ",ee.join(", ")]}),k&&e.jsx("div",{className:"small text-muted mt-2",children:k})]}),e.jsx("input",{type:"date",className:"form-control form-control-lg border-2",value:r,onChange:G,min:wl(),max:_l(),disabled:i,id:"patientBookingDate",style:{fontSize:"1.1rem"}}),e.jsxs("div",{className:"form-text mt-2",children:[e.jsx("i",{className:"bi bi-info-circle me-1"}),"Appointments can be booked from tomorrow up to 7 days in advance"]})]}),r&&!v&&e.jsxs("div",{className:"mt-5",children:[e.jsx("div",{className:"alert alert-info border-0 shadow-sm",role:"alert",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("i",{className:"bi bi-calendar-check me-3 fs-4"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Date Selected:"}),e.jsx("br",{}),e.jsx("span",{className:"fs-5",children:new Date(r).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]})]})}),e.jsx("div",{className:"text-center mt-4",children:e.jsx("button",{className:"btn btn-primary btn-lg px-5 py-3",onClick:()=>y(!0),disabled:o||i,style:{fontSize:"1.1rem",borderRadius:"10px"},children:o?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Loading Services..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-list-ul me-2"}),"View Available Services"]})})})]}),v&&e.jsx("div",{className:"mt-4",children:e.jsx("div",{className:"alert alert-success border-0 shadow-sm",role:"alert",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-between flex-wrap",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("i",{className:"bi bi-check-circle me-3 fs-4"}),e.jsxs("div",{children:[e.jsxs("div",{className:"form-check form-switch mb-2",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"honorPreferredDentistSwitch",checked:_,onChange:ce=>Y(ce.target.checked),disabled:!T||!ae}),e.jsx("label",{className:"form-check-label",htmlFor:"honorPreferredDentistSwitch",children:"Prefer my recent dentist"})]}),T&&e.jsx("small",{className:"text-muted d-block mb-2",children:ae?`Current setting: ${_?"Appointments will try to book with your dentist.":"Appointments will use any available dentist."}`:"Dentist not available on the selected date."}),e.jsx("strong",{children:"Service Selected:"}),e.jsx("br",{}),e.jsx("span",{className:"fs-5",children:v.name}),e.jsx("br",{}),e.jsxs("span",{className:"text-success fw-semibold",children:["â‚±",Number(v.price||v.promo_price).toLocaleString(),le?" per tooth":""]}),v.is_follow_up&&e.jsxs("div",{className:"mt-2",children:[e.jsx("span",{className:"badge bg-primary me-2",children:"Follow-up"}),e.jsxs("small",{className:"text-muted d-block",children:["Parent: ",v.follow_up_parent_name||"Assigned parent service"]}),e.jsx("small",{className:"text-muted",children:v.follow_up_max_gap_weeks===null||v.follow_up_max_gap_weeks===void 0?"No time limit between visits.":`Must be within ${v.follow_up_max_gap_weeks} week${v.follow_up_max_gap_weeks===1?"":"s"} of the parent service.`})]}),v.has_follow_up_services&&v.follow_up_services&&v.follow_up_services.length>0&&e.jsx("div",{className:"mt-3",children:e.jsx("div",{className:"alert alert-warning border-0 shadow-sm",role:"alert",children:e.jsxs("div",{className:"d-flex align-items-start",children:[e.jsx("i",{className:"bi bi-exclamation-triangle-fill me-2 text-warning"}),e.jsxs("div",{children:[e.jsx("strong",{className:"text-warning",children:"Are you sure you want to book this service?"}),e.jsx("p",{className:"mb-1 mt-2",children:"This service has a follow-up service available. If you've already completed this service before, you might want to book the follow-up service instead:"}),e.jsx("ul",{className:"mb-1 ps-3",children:v.follow_up_services.map(ce=>e.jsx("li",{children:e.jsx("strong",{children:ce.name})},ce.id))}),e.jsxs("small",{className:"text-muted",children:["Please confirm: Do you want to book ",e.jsx("strong",{children:v.name})," (the parent service) or one of the follow-up services listed above?"]})]})]})})}),le&&e.jsx("div",{className:"mt-2",children:e.jsxs("small",{className:"text-info",children:[e.jsx("i",{className:"bi bi-info-circle me-1"}),"Total cost depends on number of teeth treated"]})})]})]}),e.jsxs("button",{className:"btn btn-outline-success btn-sm mt-3 mt-md-0",onClick:()=>y(!0),children:[e.jsx("i",{className:"bi bi-pencil me-1"}),"Change Service"]})]})})}),v&&e.jsxs("div",{className:"mt-5",children:[le&&e.jsx("div",{className:"alert alert-info border-0 shadow-sm mb-4",role:"alert",children:e.jsxs("div",{className:"d-flex align-items-start",children:[e.jsx("i",{className:"bi bi-lightbulb me-3 fs-4 text-info"}),e.jsxs("div",{children:[e.jsxs("h6",{className:"alert-heading text-info mb-2",children:[e.jsx("i",{className:"bi bi-tooth me-2"}),"Per-Teeth Service Recommendation"]}),e.jsxs("p",{className:"mb-2",children:["For per-teeth services, we recommend scheduling a ",e.jsx("strong",{children:"consultation first"})," to determine:"]}),e.jsxs("ul",{className:"mb-2 ps-3",children:[e.jsx("li",{children:"How many teeth need treatment"}),e.jsx("li",{children:"The appropriate procedure for each tooth"}),e.jsx("li",{children:"Accurate cost estimation"})]}),e.jsx("p",{className:"mb-0",children:e.jsx("strong",{children:"If you already know the details, please proceed with booking."})})]})]})}),e.jsxs("div",{className:"border-top pt-4",children:[e.jsxs("h4",{className:"h5 mb-4",children:[e.jsx("i",{className:"bi bi-clock me-2 text-primary"}),"Complete Your Booking"]}),u.length===0&&e.jsxs("div",{className:"alert alert-warning border-0 shadow-sm",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),"No available slots for this date and service. Please select a different date or service."]}),u.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"form-label fw-semibold fs-6 mb-3",htmlFor:"patientTimeSlotSelect",children:[e.jsx("i",{className:"bi bi-clock me-2 text-primary"}),"Available Time Slots"]}),O&&O.preferred_dentist&&_&&e.jsxs("div",{className:"alert alert-info border-0 shadow-sm",children:[e.jsx("i",{className:"bi bi-person-badge me-2"}),"Scheduled with: ",O.preferred_dentist.name||O.preferred_dentist.code]}),e.jsxs("select",{className:"form-select form-select-lg border-2",value:b,onChange:ce=>C(ce.target.value),disabled:i,id:"patientTimeSlotSelect",style:{fontSize:"1.1rem"},children:[e.jsx("option",{value:"",children:"-- Select Time Slot --"}),u.map(ce=>e.jsx("option",{value:ce,children:ce},ce))]}),e.jsxs("div",{className:"form-text mt-2",children:[e.jsx("i",{className:"bi bi-info-circle me-1"}),"Time slots that overlap with your existing appointments are automatically excluded"]})]}),le&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"form-label fw-semibold fs-6 mb-3",children:[e.jsx("i",{className:"bi bi-tooth me-2 text-primary"}),"Number of Teeth to be Treated ",e.jsx("span",{className:"text-muted",children:"(optional)"})]}),e.jsx("input",{type:"number",className:"form-control form-control-lg border-2",placeholder:"e.g., 3",value:w,onChange:ce=>A(ce.target.value),min:"1",max:"32",disabled:i,style:{fontSize:"1.1rem"}}),e.jsxs("div",{className:"form-text mt-2",children:[e.jsx("i",{className:"bi bi-info-circle me-1"}),"Enter the number of teeth that need treatment. Leave blank if you're unsure - we'll determine this during your visit.",w&&e.jsxs("div",{className:"mt-2",children:[e.jsx("strong",{children:"Estimated cost:"})," â‚±",Number(v.price||v.promo_price)*parseInt(w||0).toLocaleString()]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"form-label fw-semibold fs-6 mb-3",children:[e.jsx("i",{className:"bi bi-credit-card me-2 text-primary"}),"Payment Method"]}),e.jsxs("select",{className:"form-select form-select-lg border-2",value:f,onChange:oe,disabled:i,style:{fontSize:"1.1rem"},children:[e.jsxs("option",{value:"cash",disabled:ie==null?void 0:ie.under_warning,children:["ðŸ’µ Cash (on-site payment)",(ie==null?void 0:ie.under_warning)&&" - Not available"]}),e.jsx("option",{value:"maya",children:"ðŸ’³ Maya (online payment)"}),e.jsxs("option",{value:"hmo",disabled:ie==null?void 0:ie.under_warning,children:["ðŸ¥ HMO (insurance)",(ie==null?void 0:ie.under_warning)&&" - Not available"]})]}),(ie==null?void 0:ie.under_warning)&&e.jsxs("div",{className:"alert alert-warning mt-3 border-0 shadow-sm",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),e.jsx("strong",{children:"Payment Restriction:"})," Your account is under warning due to previous no-shows. You can only book appointments using Maya (online payment) at this time."]})]}),f==="hmo"&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"form-label fw-semibold fs-6 mb-3",children:[e.jsx("i",{className:"bi bi-hospital me-2 text-primary"}),"Choose HMO Provider"]}),q?e.jsxs("div",{className:"text-muted p-3 border rounded",children:[e.jsx("i",{className:"bi bi-hourglass-split me-2"}),"Loading HMO listâ€¦"]}):ne?e.jsx(vl,{patientId:ne,value:W,onChange:$,disabled:i,required:!0}):e.jsxs("div",{className:"alert alert-warning border-0 shadow-sm",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),"We couldn't load your patient profile. You may need to link your account at the clinic, or try again later."]})]}),e.jsx("div",{className:"d-grid mt-5",children:e.jsx("button",{className:"btn btn-success btn-lg py-3",onClick:pe,disabled:N||i,style:{fontSize:"1.2rem",borderRadius:"10px"},children:N?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-hourglass-split me-2"}),"Booking in Progress..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-check-circle me-2"}),"Confirm Appointment"]})})}),L&&e.jsxs("div",{className:`alert mt-4 border-0 shadow-sm ${L.includes("âœ…")?"alert-success":L.includes("blocked")||L.includes("mistake")?"alert-danger":"alert-info"}`,children:[e.jsx("i",{className:`bi ${L.includes("âœ…")?"bi-check-circle":L.includes("blocked")||L.includes("mistake")?"bi-exclamation-triangle":"bi-info-circle"} me-2`}),e.jsx("div",{style:{whiteSpace:"pre-line"},children:L})]})]})]})]})]})]}),e.jsx(yl,{isOpen:m,onClose:()=>y(!1),services:l,loading:o,error:g,onServiceSelect:se,selectedDate:r,selectedService:v})]})}function Rl({patientId:s,currentUserRole:i,currentUserPatientId:a=null,compact:n=!1,onChange:r}){const[d,l]=t.useState([]),[h,o]=t.useState(!1),[x,g]=t.useState(""),[p,m]=t.useState(!1),[y,N]=t.useState(null),[R,v]=t.useState(null),S=t.useMemo(()=>i==="admin"||i==="staff"?!0:i==="patient"?Number(s)===Number(a):!1,[i,s,a]);t.useEffect(()=>{let f=!0;return(async()=>{o(!0),g("");try{const{data:D}=await z.get(`/api/patients/${s}/hmos`);f&&(l(D||[]),r&&r(D||[]))}catch(D){f&&g(xa(D))}finally{f&&o(!1)}})(),()=>f=!1},[s]);const u=()=>{N(null),m(!0)},j=f=>{N(f),m(!0)},b=(f,D)=>{m(!1),N(null),l(L=>{const I=$a(D==="create"?[f,...L]:L.map(w=>w.id===f.id?f:w));return r&&r(I),I})},C=async()=>{if(R)try{await z.delete(`/api/patients/${s}/hmos/${R.id}`),l(f=>{const D=f.filter(L=>L.id!==R.id);return r&&r(D),D})}catch(f){K.error(xa(f))}finally{v(null)}};return e.jsxs("div",{className:`w-full ${n?"p-3":"p-4"} rounded-2xl shadow-sm border hmo-card`,children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold hmo-title",children:"HMO"}),S&&e.jsx("button",{onClick:u,className:"px-3 py-1.5 rounded-xl text-sm font-medium text-white transition-colors duration-200",style:{backgroundColor:"#2563eb"},onMouseEnter:f=>f.target.style.backgroundColor="#1d4ed8",onMouseLeave:f=>f.target.style.backgroundColor="#2563eb",children:"+ Add HMO"})]}),h&&e.jsx("div",{className:"text-sm text-muted",children:"Loading HMOsâ€¦"}),x&&e.jsx("div",{className:"text-sm text-red-600",children:x}),!h&&!(d!=null&&d.length)&&e.jsx("div",{className:"text-sm text-muted",children:"No HMO on file."}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:d==null?void 0:d.map(f=>e.jsx(Pl,{item:f,onEdit:()=>j(f),onAskDelete:()=>v(f),canManage:S},f.id))}),p&&e.jsx(Dl,{onClose:()=>m(!1),onSaved:b,patientId:s,initial:y}),R&&e.jsx(Al,{title:"Delete HMO?",message:`This will remove ${R.provider_name} from this patient. You can restore from audit logs in backend if implemented.`,onCancel:()=>v(null),onConfirm:C})]})}function Pl({item:s,onEdit:i,onAskDelete:a,canManage:n}){return e.jsx("div",{className:"rounded-xl border p-3 hmo-card",style:{backgroundColor:"var(--card-bg)",borderColor:"var(--border-color)"},children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium hmo-provider-name",children:s.provider_name}),s.is_primary?e.jsx("span",{className:"px-2 py-0.5 text-xs rounded-full bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300",children:"Primary"}):null]}),e.jsxs("div",{className:"text-sm mt-2 space-y-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"hmo-label",children:"HMO Number:"})," ",e.jsx("span",{className:"hmo-value",children:s.hmo_number})]}),e.jsxs("div",{children:[e.jsx("span",{className:"hmo-label",children:"Name on Card:"})," ",e.jsx("span",{className:"hmo-value",children:s.patient_fullname_on_card})]})]})]}),n&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:i,className:"px-2.5 py-1 text-xs rounded-lg text-white transition-colors duration-200",style:{backgroundColor:"#2563eb"},onMouseEnter:r=>r.target.style.backgroundColor="#1d4ed8",onMouseLeave:r=>r.target.style.backgroundColor="#2563eb",children:"Edit"}),e.jsx("button",{onClick:a,className:"px-2.5 py-1 text-xs rounded-lg text-white transition-colors duration-200",style:{backgroundColor:"#dc2626"},onMouseEnter:r=>r.target.style.backgroundColor="#b91c1c",onMouseLeave:r=>r.target.style.backgroundColor="#dc2626",children:"Delete"})]})]})})}function Dl({onClose:s,onSaved:i,patientId:a,initial:n}){const r=!!n,[d,l]=t.useState(()=>({provider_name:(n==null?void 0:n.provider_name)||"",hmo_number:(n==null?void 0:n.hmo_number)||"",patient_fullname_on_card:(n==null?void 0:n.patient_fullname_on_card)||"",is_primary:!!(n!=null&&n.is_primary)})),[h,o]=t.useState(!1),[x,g]=t.useState(""),p=async()=>{o(!0),g("");try{let m;const y={provider_name:d.provider_name,hmo_number:d.hmo_number,patient_fullname_on_card:d.patient_fullname_on_card,is_primary:d.is_primary};r?(m=await z.put(`/api/patients/${a}/hmos/${n.id}`,y),i(m.data,"update")):(m=await z.post(`/api/patients/${a}/hmos`,y),i(m.data,"create"))}catch(m){g(xa(m))}finally{o(!1)}};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:s}),e.jsxs("div",{className:"relative w-full max-w-xl rounded-2xl shadow-xl border p-4 hmo-card",style:{backgroundColor:"var(--card-bg)",borderColor:"var(--border-color)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-base font-semibold hmo-title",children:r?"Edit HMO":"Add HMO"}),e.jsx("button",{onClick:s,className:"w-8 h-8 rounded-full button-close transition-colors duration-200 flex items-center justify-center",children:"âœ•"})]}),x&&e.jsx("div",{className:"mb-3 text-sm text-red-600",children:x}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsx(oa,{label:"Provider Name",required:!0,value:d.provider_name,onChange:m=>l({...d,provider_name:m})}),e.jsx(oa,{label:"HMO Number",required:!0,value:d.hmo_number,onChange:m=>l({...d,hmo_number:m})}),e.jsx(oa,{label:"Patient Full Name on Card",required:!0,value:d.patient_fullname_on_card,onChange:m=>l({...d,patient_fullname_on_card:m})}),e.jsxs("div",{className:"flex items-center gap-2 pt-2",children:[e.jsx("input",{id:"is_primary",type:"checkbox",className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border rounded",style:{borderColor:"var(--input-border)",backgroundColor:"var(--input-bg)"},checked:d.is_primary,onChange:m=>l({...d,is_primary:m.target.checked})}),e.jsx("label",{htmlFor:"is_primary",className:"text-sm hmo-form-label",children:"Mark as Primary"})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 mt-4",children:[e.jsx("button",{onClick:s,className:"px-3 py-1.5 text-sm rounded-xl text-white transition-colors duration-200",style:{backgroundColor:"#6b7280"},onMouseEnter:m=>m.target.style.backgroundColor="#4b5563",onMouseLeave:m=>m.target.style.backgroundColor="#6b7280",children:"Cancel"}),e.jsx("button",{onClick:p,disabled:h||!d.provider_name||!d.hmo_number||!d.patient_fullname_on_card,className:"px-3 py-1.5 text-sm rounded-xl text-white transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed",style:{backgroundColor:h||!d.provider_name||!d.hmo_number||!d.patient_fullname_on_card?"#9ca3af":"#2563eb"},onMouseEnter:m=>{!h&&d.provider_name&&d.hmo_number&&d.patient_fullname_on_card&&(m.target.style.backgroundColor="#1d4ed8")},onMouseLeave:m=>{!h&&d.provider_name&&d.hmo_number&&d.patient_fullname_on_card&&(m.target.style.backgroundColor="#2563eb")},children:h?"Savingâ€¦":r?"Save Changes":"Create"})]})]})]})}function Al({title:s,message:i,onCancel:a,onConfirm:n}){return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:a}),e.jsxs("div",{className:"relative w-full max-w-md rounded-2xl shadow-xl border p-4 hmo-card",style:{backgroundColor:"var(--card-bg)",borderColor:"var(--border-color)"},children:[e.jsx("h4",{className:"text-base font-semibold mb-2 hmo-title",children:s}),e.jsx("p",{className:"text-sm text-secondary mb-4",children:i}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:a,className:"px-3 py-1.5 text-sm rounded-xl text-white transition-colors duration-200",style:{backgroundColor:"#6b7280"},onMouseEnter:r=>r.target.style.backgroundColor="#4b5563",onMouseLeave:r=>r.target.style.backgroundColor="#6b7280",children:"Cancel"}),e.jsx("button",{onClick:n,className:"px-3 py-1.5 text-sm rounded-xl text-white transition-colors duration-200",style:{backgroundColor:"#dc2626"},onMouseEnter:r=>r.target.style.backgroundColor="#b91c1c",onMouseLeave:r=>r.target.style.backgroundColor="#dc2626",children:"Delete"})]})]})]})}function oa({label:s,value:i,onChange:a,required:n}){return e.jsxs("div",{children:[e.jsx(Ml,{required:n,children:s}),e.jsx("input",{type:"text",className:"w-full mt-1 rounded-xl border p-2 text-sm input-field focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",style:{backgroundColor:"var(--input-bg)",borderColor:"var(--input-border)",color:"var(--input-text)"},value:i,onChange:r=>a(r.target.value)})]})}function Ml({children:s,required:i=!1}){return e.jsxs("label",{className:"text-sm hmo-form-label",children:[s," ",i&&e.jsx("span",{className:"text-red-600",children:"*"})]})}function xa(s){var n,r,d,l;const i=((r=(n=s==null?void 0:s.response)==null?void 0:n.data)==null?void 0:r.message)||(s==null?void 0:s.message)||"Request failed",a=(l=(d=s==null?void 0:s.response)==null?void 0:d.data)==null?void 0:l.errors;if(a)try{const h=Object.values(a)[0];if(Array.isArray(h)&&h.length)return`${i}: ${h[0]}`}catch{}return i}function $a(s){return Array.isArray(s)?[...s].sort((i,a)=>{if(i.is_primary&&!a.is_primary)return-1;if(!i.is_primary&&a.is_primary)return 1;const n=(i.provider_name||"").toLowerCase(),r=(a.provider_name||"").toLowerCase();return n.localeCompare(r)}):[]}const Ll=()=>{var T;const[s,i]=t.useState(null),[a,n]=t.useState(!1),[r,d]=t.useState(""),[l,h]=t.useState(""),[o,x]=t.useState(""),[g,p]=t.useState(""),[m,y]=t.useState(""),[N,R]=t.useState(""),[v,S]=t.useState({}),[u,j]=t.useState(""),[b,C]=t.useState(!1);we();const f=async()=>{try{const c=await z.get("/api/user");i(c.data),console.log(c.data)}catch(c){console.error("Failed to fetch user info",c)}};t.useEffect(()=>{f()},[]);const D=async()=>{var c,F;j(""),S({}),C(!0);try{const P=await z.post("/api/send-password-reset");j(P.data.message||"Password reset link sent to your email!")}catch(P){const k=((F=(c=P.response)==null?void 0:c.data)==null?void 0:F.message)||"Failed to send reset link";j("âŒ "+k)}finally{C(!1)}},L=c=>{if(!c)return"Birthdate is required.";const F=new Date(c),P=new Date,k=new Date;return k.setFullYear(P.getFullYear()-4),F>P?"Birthdate cannot be in the future.":F>k?"You must be at least 4 years old.":null},I=()=>{const c=new Date;return c.setFullYear(c.getFullYear()-4),c.toISOString().split("T")[0]},w=async()=>{var F,P;C(!0),S({});const c=L(m);if(c){S({birthdate:[c]}),C(!1);return}try{await z.post("/api/patients/link-self",{contact_number:r,first_name:l,middle_name:o,last_name:g,birthdate:m,sex:N}),j("âœ… Profile linked successfully."),await f(),n(!1)}catch(k){(P=(F=k.response)==null?void 0:F.data)!=null&&P.errors?S(k.response.data.errors):j("âŒ Failed to link profile.")}finally{C(!1)}};if(!s)return e.jsx("p",{children:"Loading your profile..."});const A=!!s.patient&&s.patient.is_linked,_=s.role,H=(T=s.patient)==null?void 0:T.id;return e.jsx("div",{className:"w-100",children:e.jsxs("div",{className:"card border-0 shadow-lg w-100 patient-page-card",children:[e.jsxs("div",{className:"card-header bg-gradient bg-primary text-white text-center py-4",children:[e.jsxs("h2",{className:"h3 mb-2",children:[e.jsx("i",{className:"bi bi-person-circle me-2"}),"My Account"]}),e.jsx("p",{className:"mb-0 opacity-75",children:"Manage your personal information and preferences"})]}),e.jsxs("div",{className:"card-body p-5",children:[e.jsxs("div",{className:"mb-5",children:[e.jsxs("h4",{className:"h5 mb-3",children:[e.jsx("i",{className:"bi bi-person me-2 text-primary"}),"Personal Information"]}),e.jsx("div",{className:"card border-0 bg-light shadow-sm",children:e.jsx("div",{className:"card-body p-4",children:e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-12 col-md-6",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("i",{className:"bi bi-person-fill me-3 text-primary fs-5"}),e.jsxs("div",{children:[e.jsx("small",{className:"text-muted d-block",children:"Full Name"}),e.jsx("span",{className:"fw-semibold",children:s.name})]})]})}),e.jsx("div",{className:"col-12 col-md-6",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("i",{className:"bi bi-envelope-fill me-3 text-primary fs-5"}),e.jsxs("div",{children:[e.jsx("small",{className:"text-muted d-block",children:"Email Address"}),e.jsx("span",{className:"fw-semibold",children:s.email})]})]})})]})})})]}),e.jsxs("div",{className:"mb-5",children:[e.jsxs("h4",{className:"h5 mb-3",children:[e.jsx("i",{className:"bi bi-shield-lock me-2 text-primary"}),"Account Security"]}),e.jsx("div",{className:"card border-0 bg-light shadow-sm",children:e.jsxs("div",{className:"card-body p-4",children:[e.jsx("p",{className:"text-muted mb-3",children:"Need to change your password? We'll send a secure reset link to your email address."}),u&&e.jsx("div",{className:"alert alert-success mb-3",children:u}),e.jsxs("button",{className:"btn btn-primary btn-lg",onClick:D,disabled:b,children:[e.jsx("i",{className:"bi bi-envelope me-2"}),b?"Sending...":"Send Password Reset Link"]})]})})]}),!A&&e.jsxs("div",{className:"mb-5",children:[e.jsxs("h4",{className:"h5 mb-3",children:[e.jsx("i",{className:"bi bi-person-plus me-2 text-primary"}),"Link Patient Profile"]}),e.jsxs("div",{className:"card border-warning shadow-sm",children:[e.jsxs("div",{className:"card-header bg-warning-subtle border-warning",children:[e.jsxs("h5",{className:"h6 mb-1",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),"Profile Not Linked"]}),e.jsx("p",{className:"mb-0 text-muted",children:"You're not yet linked to a patient profile."})]}),e.jsxs("div",{className:"card-body",children:[e.jsx("p",{className:"mb-3",children:"Have you visited the clinic before?"}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"alert alert-info border-0 shadow-sm mb-3",children:[e.jsx("i",{className:"bi bi-check-circle me-2"}),e.jsx("strong",{children:"Yes"})," â€“ Please visit the clinic for assistance with linking your profile"]}),e.jsxs("button",{className:"btn btn-outline-primary btn-lg w-100",onClick:()=>{s!=null&&s.contact_number&&d(s.contact_number),n(!0)},children:[e.jsx("i",{className:"bi bi-x-circle me-2"}),"No â€“ I haven't visited before"]})]}),a&&e.jsxs("div",{className:"border-top pt-4",children:[e.jsxs("h6",{className:"mb-3",children:[e.jsx("i",{className:"bi bi-person-check me-2"}),"Verify Your Information"]}),e.jsx("p",{className:"text-muted mb-4",children:"Please confirm your details to create your patient profile. This information will be used for senior discounts and VAT exemptions."}),e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-12 col-md-4",children:[e.jsx("label",{className:"form-label fw-semibold",children:"First Name *"}),e.jsx("input",{className:`form-control form-control-lg border-2 ${v.first_name?"is-invalid":""}`,placeholder:"e.g. Juan",value:l,onChange:c=>h(c.target.value),style:{fontSize:"1.1rem"}}),v.first_name&&e.jsxs("div",{className:"text-danger mt-2",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-1"}),v.first_name[0]]})]}),e.jsxs("div",{className:"col-12 col-md-4",children:[e.jsx("label",{className:"form-label fw-semibold",children:"Middle Name"}),e.jsx("input",{className:`form-control form-control-lg border-2 ${v.middle_name?"is-invalid":""}`,placeholder:"e.g. Santos (optional)",value:o,onChange:c=>x(c.target.value),style:{fontSize:"1.1rem"}}),v.middle_name&&e.jsxs("div",{className:"text-danger mt-2",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-1"}),v.middle_name[0]]})]}),e.jsxs("div",{className:"col-12 col-md-4",children:[e.jsx("label",{className:"form-label fw-semibold",children:"Last Name *"}),e.jsx("input",{className:`form-control form-control-lg border-2 ${v.last_name?"is-invalid":""}`,placeholder:"e.g. Dela Cruz",value:g,onChange:c=>p(c.target.value),style:{fontSize:"1.1rem"}}),v.last_name&&e.jsxs("div",{className:"text-danger mt-2",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-1"}),v.last_name[0]]})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("label",{className:"form-label fw-semibold",children:"Contact Number *"}),e.jsx("input",{className:`form-control form-control-lg border-2 ${v.contact_number?"is-invalid":""}`,placeholder:"e.g. 09123456789",value:r,onChange:c=>d(c.target.value),style:{fontSize:"1.1rem"}}),v.contact_number&&e.jsxs("div",{className:"text-danger mt-2",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-1"}),v.contact_number[0]]})]}),e.jsxs("div",{className:"col-12 col-md-6",children:[e.jsx("label",{className:"form-label fw-semibold",children:"Birthdate *"}),e.jsx("input",{type:"date",className:`form-control form-control-lg border-2 ${v.birthdate?"is-invalid":""}`,value:m,onChange:c=>{const F=c.target.value;y(F);const P=L(F);S(P?k=>({...k,birthdate:[P]}):k=>({...k,birthdate:null}))},max:I(),min:new Date(new Date().setFullYear(new Date().getFullYear()-120)).toISOString().split("T")[0],style:{fontSize:"1.1rem"}}),v.birthdate&&e.jsxs("div",{className:"text-danger mt-2",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-1"}),Array.isArray(v.birthdate)?v.birthdate[0]:v.birthdate]})]}),e.jsxs("div",{className:"col-12 col-md-6",children:[e.jsx("label",{className:"form-label fw-semibold",children:"Sex *"}),e.jsxs("select",{className:`form-control form-control-lg border-2 ${v.sex?"is-invalid":""}`,value:N,onChange:c=>R(c.target.value),style:{fontSize:"1.1rem"},children:[e.jsx("option",{value:"",children:"Select your sex"}),e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"})]}),v.sex&&e.jsxs("div",{className:"text-danger mt-2",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-1"}),v.sex[0]]})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{className:"btn btn-success btn-lg w-100",onClick:w,disabled:b||!l||!g||!r||!m||!N,children:b?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Linking Profile..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-link me-2"}),"Link My Profile"]})})})]}),u&&e.jsxs("div",{className:`alert mt-4 border-0 shadow-sm ${u.includes("âœ…")?"alert-success":"alert-danger"}`,children:[e.jsx("i",{className:`bi ${u.includes("âœ…")?"bi-check-circle":"bi-exclamation-triangle"} me-2`}),u]})]})]})]}),A&&H&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("h4",{className:"h5 mb-3",children:[e.jsx("i",{className:"bi bi-hospital me-2 text-primary"}),"Health Maintenance Organization (HMO)"]}),e.jsx("div",{className:"card border-0 shadow-sm",children:e.jsx("div",{className:"card-body p-0",children:e.jsx(Rl,{patientId:H,currentUserRole:_,currentUserPatientId:H,compact:!1,onChange:c=>{}})})})]})]})]})})},mt="/assets/Teeth_Chart-BMsV1YlE.png",ht="/assets/Primary_Teeth_Chart-ZBPnKwPo.png",xt=[{key:"scheduling_convenience",label:"I felt the appointment scheduling process was convenient."},{key:"staff_communication",label:"The clinic staff communicated clearly before and after my visit."},{key:"wait_time_reasonable",label:"My wait time was reasonable."},{key:"comfort_and_care",label:"I felt comfortable and cared for throughout my visit."},{key:"treatment_clarity",label:"I understand the next steps in my treatment plan."},{key:"return_likelihood",label:"I am likely to return to this clinic for future dental needs."},{key:"recommendation_likelihood",label:"I would recommend this clinic to friends or family."}],Fl=[{value:1,label:"Strongly disagree"},{value:2,label:"Disagree"},{value:3,label:"Neutral"},{value:4,label:"Agree"},{value:5,label:"Strongly agree"}],Gs=()=>xt.reduce((s,i)=>(s[i.key]=3,s),{});function zl({show:s,onClose:i,visit:a,modalData:n,mode:r="create",loading:d=!1,onSaved:l}){var b,C;const[h,o]=t.useState(Gs()),[x,g]=t.useState(5),[p,m]=t.useState(""),[y,N]=t.useState(!1),R=r==="view"||r==="edit"&&!((b=n==null?void 0:n.feedback)!=null&&b.is_editable);if(t.useEffect(()=>{n&&(n.feedback?(o({...Gs(),...n.feedback.retention_responses||{}}),g(n.feedback.dentist_rating??5),m(n.feedback.dentist_issue_note??"")):(o(Gs()),g(5),m("")))},[n,a==null?void 0:a.id]),t.useEffect(()=>{s||(o(Gs()),g(5),m(""),N(!1))},[s]),!s)return null;const v=(f,D)=>{o(L=>({...L,[f]:Number(D)}))},S=async f=>{var D,L,I;if(f.preventDefault(),!(R||!a)){N(!0);try{await z.get("/sanctum/csrf-cookie");const w={retention_responses:h,dentist_rating:Number(x),dentist_issue_note:(p==null?void 0:p.trim())||null};r==="edit"&&((D=n==null?void 0:n.feedback)!=null&&D.id)?(await z.put(`/api/patient-feedback/${n.feedback.id}`,w),K.success("Feedback updated.")):(await z.post("/api/patient-feedback",{...w,patient_visit_id:a.id}),K.success("Thanks for rating your visit!")),l?await l():i==null||i()}catch(w){const A=((I=(L=w.response)==null?void 0:L.data)==null?void 0:I.message)||"Unable to save your feedback right now. Please try again.";K.error(A)}finally{N(!1)}}},u=r==="view"?"Your Visit Feedback":r==="edit"?"Update Visit Feedback":"Rate Your Visit",j=(C=n==null?void 0:n.eligibility)!=null&&C.rating_window_expires_at?new Date(n.eligibility.rating_window_expires_at).toLocaleString():null;return e.jsx("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.45)",zIndex:1060},tabIndex:"-1",children:e.jsx("div",{className:"modal-dialog modal-lg modal-dialog-centered",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title",children:u}),e.jsx("button",{type:"button",className:"btn-close",onClick:i,disabled:y})]}),e.jsx("div",{className:"modal-body",children:!n||d?e.jsxs("div",{className:"d-flex flex-column align-items-center py-5",children:[e.jsx("div",{className:"spinner-border text-primary mb-3",role:"status"}),e.jsx("p",{className:"text-muted mb-0",children:"Loading feedback form..."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"small text-muted mb-1",children:"Service"}),e.jsx("div",{className:"fw-semibold",children:(a==null?void 0:a.service_name)||"Not specified"})]}),j&&r!=="view"&&e.jsxs("div",{className:"alert alert-info py-2",children:["You can submit feedback for this visit until"," ",e.jsx("strong",{children:j}),"."]}),e.jsxs("form",{onSubmit:S,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{className:"fw-semibold text-primary mb-3",children:"Patient Retention Survey"}),xt.map(f=>e.jsxs("div",{className:"mb-3 p-3 border rounded bg-light",children:[e.jsx("label",{className:"form-label fw-semibold d-block",children:f.label}),e.jsx("div",{className:"d-flex flex-wrap gap-2",children:Fl.map(D=>e.jsxs("label",{className:`btn btn-sm ${h[f.key]===D.value?"btn-primary":"btn-outline-primary"}`,children:[e.jsx("input",{type:"radio",name:f.key,value:D.value,checked:h[f.key]===D.value,onChange:L=>v(f.key,Number(L.target.value)),disabled:R||y,className:"visually-hidden"}),D.label]},D.value))})]},f.key))]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"form-label fw-semibold",children:"Rate your dentist"}),e.jsx("div",{className:"d-flex gap-2 flex-wrap",children:[1,2,3,4,5].map(f=>e.jsxs("button",{type:"button",className:`btn ${x===f?"btn-warning text-dark":"btn-outline-secondary"}`,onClick:()=>g(f),disabled:R||y,children:[f," â˜…"]},f))}),e.jsx("small",{className:"text-muted",children:"1 = needs improvement, 5 = excellent care"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"form-label fw-semibold",children:"Specific issue with the dentist (optional)"}),e.jsx("textarea",{className:"form-control",rows:"3",placeholder:"Share any concerns or issues so the clinic can follow up.",value:p,onChange:f=>m(f.target.value),disabled:R||y})]}),R?e.jsxs("div",{className:"alert alert-secondary mb-0",children:[e.jsx("i",{className:"bi bi-lock-fill me-2"}),"Feedback is locked and cannot be edited."]}):e.jsx("div",{className:"d-flex justify-content-end",children:e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:y,children:y?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Saving..."]}):r==="edit"?"Update feedback":"Submit feedback"})})]})]})})]})})})}const Tl=()=>{var ie,B,le;const[s,i]=t.useState([]),[a,n]=t.useState(!1),[r,d]=t.useState(1),[l,h]=t.useState({}),[o,x]=t.useState(!1),[g,p]=t.useState("adult"),[m,y]=t.useState(!1),[N,R]=t.useState(null),[v,S]=t.useState(null),[u,j]=t.useState(!1),[b,C]=t.useState(null),[f,D]=t.useState(null),[L,I]=t.useState("create"),[w,A]=t.useState(!1),[_,H]=t.useState(""),[T,c]=t.useState("");t.useEffect(()=>{F(r)},[r]);const F=async(M=1)=>{try{n(!0);const U=new URLSearchParams({page:M.toString()});_&&U.append("start_date",_),T&&U.append("end_date",T);const G=await z.get(`/api/user-visit-history?${U.toString()}`,{skip401Handler:!0});i(G.data.data),h({current_page:G.data.meta.current_page,last_page:G.data.meta.last_page,per_page:G.data.meta.per_page,total:G.data.meta.total})}catch(U){console.error("Failed to fetch visit history",U)}finally{n(!1)}},P=()=>{d(1),F(1)},k=()=>{H(""),c(""),d(1),E(1)},E=async(M=1)=>{try{n(!0);const U=await z.get(`/api/user-visit-history?page=${M}`,{skip401Handler:!0});i(U.data.data),h({current_page:U.data.meta.current_page,last_page:U.data.meta.last_page,per_page:U.data.meta.per_page,total:U.data.meta.total})}catch(U){console.error("Failed to fetch visit history",U)}finally{n(!1)}},O=M=>{if(!M)return"â€”";const U=M.split(",").map(G=>G.trim()).filter(G=>G);return U.length===0?"â€”":U.join(", ")},X=M=>M?M.split(",").map(G=>G.trim()).filter(G=>G).length:0,ee=M=>{R(M),y(!0)},ae=()=>{y(!1),R(null)},ne=async M=>{var U,G;try{S(M);const Y=await z.get(`/api/receipts/visit/${M}`,{responseType:"blob",skip401Handler:!0}),se=new Blob([Y.data],{type:"application/pdf"}),oe=window.URL.createObjectURL(se),pe=document.createElement("a");pe.href=oe,pe.download=`visit-receipt-${M}.pdf`,document.body.appendChild(pe),pe.click(),document.body.removeChild(pe),window.URL.revokeObjectURL(oe)}catch(Y){console.error("Failed to download receipt",Y);const se=((G=(U=Y.response)==null?void 0:U.data)==null?void 0:G.message)||"Failed to download receipt. Please try again.";K.error(se)}finally{S(null)}},re=()=>{j(!1),C(null),D(null),I("create"),A(!1)},W=async()=>{await F(r),re()},$=async(M,U="create")=>{var G,Y;if(M){C(M),I(U),j(!0),A(!0),D(null);try{const{data:se}=await z.get(`/api/patient-feedback/visit/${M.id}`);D(se)}catch(se){const oe=((Y=(G=se.response)==null?void 0:G.data)==null?void 0:Y.message)||"Unable to load the feedback form for this visit.";K.error(oe),re()}finally{A(!1)}}},q=M=>({visit_not_completed:"Visit not completed yet",feedback_exists:"Feedback already submitted",window_elapsed:"Cannot rate (more than 7 days ago)"})[M]||"Not eligible to rate",J=M=>{const U=M.feedback,G=M.feedback_status||{},Y=!!U,se=!!G.can_rate,oe=!!G.can_edit;return Y?e.jsxs("div",{className:"d-flex flex-column gap-1",children:[e.jsx("button",{className:`btn btn-sm ${oe?"btn-outline-primary":"btn-outline-secondary"}`,onClick:()=>$(M,oe?"edit":"view"),children:oe?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-pencil-square me-1"}),"Edit rating"]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-eye me-1"}),"See rating"]})}),!oe&&(U==null?void 0:U.locked_at)&&e.jsxs("small",{className:"text-muted",children:["Locked ",new Date(U.locked_at).toLocaleDateString()]})]}):se?e.jsxs("button",{className:"btn btn-primary btn-sm",onClick:()=>$(M,"create"),children:[e.jsx("i",{className:"bi bi-star me-1"}),"Rate visit"]}):e.jsx("span",{className:"badge bg-light text-muted text-wrap",children:q(G.reason)})};return e.jsxs("div",{className:"card border-0 shadow-sm",children:[e.jsx("div",{className:"card-header bg-primary text-white",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("h6",{className:"card-title mb-0",children:[e.jsx("i",{className:"bi bi-clock-history me-2"}),"Service History"]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs("button",{className:"btn btn-sm btn-outline-light",onClick:()=>{x(M=>{const U=!M;return U&&p("adult"),U})},title:"Tooth Chart Reference",children:[e.jsx("i",{className:"bi bi-tooth me-1"}),"Chart"]}),e.jsxs("button",{className:"btn btn-sm btn-outline-light",onClick:()=>F(r),disabled:a,children:[a?e.jsx("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}):e.jsx("i",{className:"bi bi-arrow-clockwise me-1"}),"Refresh"]})]})]})}),e.jsxs("div",{className:"card-body border-bottom bg-light",children:[e.jsxs("div",{className:"row g-3 align-items-end",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsxs("label",{htmlFor:"historyStartDate",className:"form-label fw-semibold",children:[e.jsx("i",{className:"bi bi-calendar-check me-2 text-primary"}),"Start Date"]}),e.jsx("input",{id:"historyStartDate",type:"date",className:"form-control",value:_,onChange:M=>H(M.target.value),placeholder:"Select start date"}),e.jsx("small",{className:"text-muted",children:"Filter from this date"})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs("label",{htmlFor:"historyEndDate",className:"form-label fw-semibold",children:[e.jsx("i",{className:"bi bi-calendar-x me-2 text-primary"}),"End Date"]}),e.jsx("input",{id:"historyEndDate",type:"date",className:"form-control",value:T,onChange:M=>c(M.target.value),min:_||void 0,placeholder:"Select end date",disabled:!_}),e.jsx("small",{className:"text-muted",children:_?"Filter up to this date":"Select start date first"})]}),e.jsx("div",{className:"col-md-4",children:e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx("button",{className:"btn btn-primary flex-fill",onClick:P,disabled:!_||a,children:a?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),"Loading..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-funnel me-1"}),"Apply Filter"]})}),e.jsx("button",{className:"btn btn-outline-secondary",onClick:k,disabled:!_&&!T||a,title:"Clear filters",children:e.jsx("i",{className:"bi bi-x-circle"})})]})})]}),(_||T)&&e.jsx("div",{className:"mt-3",children:e.jsxs("div",{className:"alert alert-info mb-0 d-flex align-items-center",children:[e.jsx("i",{className:"bi bi-info-circle me-2"}),e.jsxs("span",{children:[_&&!T&&`Showing visits on ${_}`,_&&T&&`Showing visits from ${_} to ${T}`]})]})})]}),o&&(()=>{const M=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],U=[32,31,30,29,28,27,26,25,24,23,22,21,20,19,18,17],G=["A","B","C","D","E","F","G","H","I","J"],Y=["K","L","M","N","O","P","Q","R","S","T"];return e.jsx("div",{className:"border-bottom",style:{backgroundColor:"rgba(248, 249, 250, 0.95)",opacity:.95,padding:"15px",border:"1px solid #e5e7eb",borderRadius:"0"},children:e.jsxs("div",{className:"row align-items-center",children:[e.jsx("div",{className:"col-md-5 mb-3 mb-md-0",children:e.jsxs("div",{className:"text-center",children:[e.jsx("img",{src:g==="adult"?mt:ht,alt:g==="adult"?"Adult Teeth Chart Reference":"Primary Teeth Chart Reference",className:"img-fluid",style:{maxWidth:"250px",height:"auto",border:"1px solid #dee2e6",borderRadius:"8px",backgroundColor:"#f8f9fa"}}),e.jsx("small",{className:"text-muted d-block mt-2",children:g==="adult"?"Adult Teeth Reference Chart":"Primary Teeth Reference Chart"})]})}),e.jsxs("div",{className:"col-md-7",children:[e.jsx("div",{className:"text-center mb-3",children:e.jsxs("div",{className:"btn-group",role:"group","aria-label":"Tooth chart tabs",children:[e.jsxs("button",{type:"button",className:`btn btn-sm ${g==="adult"?"btn-primary":"btn-outline-primary"}`,onClick:()=>p("adult"),children:[e.jsx("i",{className:"bi bi-person me-1"}),"Adult Teeth (1-32)"]}),e.jsxs("button",{type:"button",className:`btn btn-sm ${g==="primary"?"btn-primary":"btn-outline-primary"}`,onClick:()=>p("primary"),children:[e.jsx("i",{className:"bi bi-person-heart me-1"}),"Primary Teeth (A-T)"]})]})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h6",{className:"text-primary mb-3",children:"Universal Numbering System"}),g==="adult"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("small",{className:"text-muted d-block mb-2",children:"UPPER TEETH (1-16)"}),e.jsx("div",{className:"d-flex justify-content-center flex-wrap gap-1",children:M.map(se=>e.jsx("span",{className:"badge bg-light text-dark border",style:{width:"20px",height:"20px",fontSize:"11px",display:"flex",alignItems:"center",justifyContent:"center"},children:se},se))})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("small",{className:"text-muted d-block mb-2",children:"LOWER TEETH (32-17)"}),e.jsx("div",{className:"d-flex justify-content-center flex-wrap gap-1",children:U.map(se=>e.jsx("span",{className:"badge bg-light text-dark border",style:{width:"20px",height:"20px",fontSize:"11px",display:"flex",alignItems:"center",justifyContent:"center"},children:se},se))})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("small",{className:"text-muted d-block mb-2",children:"UPPER TEETH (A-J)"}),e.jsx("div",{className:"d-flex justify-content-center flex-wrap gap-1",children:G.map(se=>e.jsx("span",{className:"badge bg-light text-dark border",style:{width:"20px",height:"20px",fontSize:"11px",display:"flex",alignItems:"center",justifyContent:"center"},children:se},se))})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("small",{className:"text-muted d-block mb-2",children:"LOWER TEETH (T-K)"}),e.jsx("div",{className:"d-flex justify-content-center flex-wrap gap-1",children:Y.map(se=>e.jsx("span",{className:"badge bg-light text-dark border",style:{width:"20px",height:"20px",fontSize:"11px",display:"flex",alignItems:"center",justifyContent:"center"},children:se},se))})]})]}),e.jsxs("div",{className:"alert alert-info py-2 mb-0",style:{fontSize:"11px"},children:[e.jsx("i",{className:"bi bi-info-circle me-1"}),"Use this chart to understand which teeth were treated"]})]})]})]})})})(),e.jsx("div",{className:"card-body p-0",children:e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover mb-0",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Service"}),e.jsx("th",{children:"Teeth Done"}),e.jsx("th",{children:"Dentist"}),e.jsx("th",{children:"Notes"}),e.jsx("th",{children:"Receipt"}),e.jsx("th",{children:"Feedback"})]})}),e.jsx("tbody",{children:a?e.jsx("tr",{children:e.jsxs("td",{colSpan:"6",className:"text-center py-5",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"text-muted mt-2 mb-0",children:"Loading service history..."})]})}):s.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:"6",className:"text-center py-5",children:[e.jsx("i",{className:"bi bi-calendar-x display-4 text-muted"}),e.jsx("h6",{className:"mt-3 text-muted",children:"No completed visits yet"}),e.jsx("p",{className:"text-muted mb-0",children:"Your completed dental visits will appear here."})]})}):s.map(M=>e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("div",{className:"fw-medium",children:new Date(M.visit_date).toLocaleDateString()}),e.jsx("small",{className:"text-muted",children:new Date(M.visit_date).toLocaleDateString("en-US",{weekday:"long"})})]}),e.jsx("td",{children:e.jsx("span",{className:"badge bg-primary",children:M.service_name||"Not specified"})}),e.jsx("td",{children:M.teeth_treated?e.jsxs("div",{children:[e.jsx("span",{className:"badge bg-info",children:O(M.teeth_treated)}),e.jsx("br",{}),e.jsxs("small",{className:"text-muted",children:[X(M.teeth_treated)," tooth",X(M.teeth_treated)!==1?"s":""]})]}):e.jsx("span",{className:"text-muted",children:"â€”"})}),e.jsx("td",{children:M.dentist_name?e.jsx("div",{className:"fw-semibold",children:M.dentist_name}):e.jsx("span",{className:"text-muted",children:"â€”"})}),e.jsx("td",{children:e.jsxs("button",{className:"btn btn-outline-primary btn-sm",onClick:()=>ee(M),children:[e.jsx("i",{className:"bi bi-journal-text me-1"}),"View Notes"]})}),e.jsx("td",{children:e.jsx("button",{className:"btn btn-success btn-sm",onClick:()=>ne(M.id),disabled:!M.receipt_available||v===M.id,children:v===M.id?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),"Downloading..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-receipt me-1"}),"Receipt"]})})}),e.jsx("td",{children:J(M)})]},M.id))})]})})}),l.last_page>1&&e.jsx("div",{className:"card-footer bg-light",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("button",{className:"btn btn-outline-secondary btn-sm",disabled:r===1,onClick:()=>d(r-1),children:[e.jsx("i",{className:"bi bi-chevron-left me-1"}),"Previous"]}),e.jsxs("span",{className:"text-muted",children:["Page ",l.current_page," of ",l.last_page]}),e.jsxs("button",{className:"btn btn-outline-secondary btn-sm",disabled:r===l.last_page,onClick:()=>d(r+1),children:["Next",e.jsx("i",{className:"bi bi-chevron-right ms-1"})]})]})}),e.jsx(zl,{show:u,visit:b,modalData:f,mode:L,loading:w,onClose:re,onSaved:W}),m&&e.jsx("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)",position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:1050,overflowY:"auto",display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem"},tabIndex:"-1",children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",style:{margin:"0 auto",maxHeight:"calc(100vh - 2rem)",width:"100%",maxWidth:"600px"},children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h5",{className:"modal-title",children:[e.jsx("i",{className:"bi bi-journal-text me-2"}),"Dentist Notes"]}),e.jsx("button",{type:"button",className:"btn-close",onClick:ae})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("small",{className:"text-muted d-block",children:"Service"}),e.jsx("div",{className:"fw-semibold",children:(N==null?void 0:N.service_name)||"Not specified"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("small",{className:"text-muted d-block",children:"Visit Date"}),e.jsx("div",{className:"fw-semibold",children:N?new Date(N.visit_date).toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"}):"â€”"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("small",{className:"text-muted text-uppercase d-block fw-semibold mb-1",children:"Dentist Notes"}),e.jsx("div",{className:"p-3 bg-light border rounded",style:{whiteSpace:"pre-wrap",minHeight:"80px"},children:(ie=N==null?void 0:N.dentist_notes)!=null&&ie.trim()?N.dentist_notes:"No dentist notes recorded for this visit."})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("small",{className:"text-muted text-uppercase d-block fw-semibold mb-1",children:"Findings"}),e.jsx("div",{className:"p-3 bg-light border rounded",style:{whiteSpace:"pre-wrap",minHeight:"80px"},children:(B=N==null?void 0:N.findings)!=null&&B.trim()?N.findings:"No findings documented for this visit."})]}),e.jsxs("div",{children:[e.jsx("small",{className:"text-muted text-uppercase d-block fw-semibold mb-1",children:"Treatment Plan"}),e.jsx("div",{className:"p-3 bg-light border rounded",style:{whiteSpace:"pre-wrap",minHeight:"80px"},children:(le=N==null?void 0:N.treatment_plan)!=null&&le.trim()?N.treatment_plan:"No treatment plan provided for this visit."})]})]}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:ae,children:"Close"})})]})})})]})};function El(){var le;const[s,i]=t.useState([]),[a,n]=t.useState(!1),[r,d]=t.useState(1),[l,h]=t.useState({}),[o,x]=t.useState(null),[g,p]=t.useState(null),[m,y]=t.useState(null),[N,R]=t.useState(!1),[v,S]=t.useState(null),[u,j]=t.useState(""),[b,C]=t.useState([]),[f,D]=t.useState(""),[L,I]=t.useState(!1),[w,A]=t.useState("appointments"),[_,H]=t.useState(""),[T,c]=t.useState(""),F=t.useRef({appointments:!1,history:!1}),P=t.useRef(!1);t.useEffect(()=>{(async()=>{try{await z.get("/sanctum/csrf-cookie"),P.current=!0,k(r)}catch(U){console.warn("CSRF prime failed (will retry later)",U),k(r)}})()},[]),t.useEffect(()=>{w==="appointments"&&P.current&&F.current.appointments&&k(r)},[r,w]),t.useEffect(()=>{const M=()=>{w==="appointments"&&(console.log("Page focused, refreshing appointments..."),k(r))},U=()=>{!document.hidden&&w==="appointments"&&(console.log("Page visible, refreshing appointments..."),k(r))};return window.addEventListener("focus",M),document.addEventListener("visibilitychange",U),()=>{window.removeEventListener("focus",M),document.removeEventListener("visibilitychange",U)}},[r,w]);const k=async(M=1)=>{try{n(!0);const U=new URLSearchParams({page:M.toString()});_&&U.append("start_date",_),T&&U.append("end_date",T);const G=await z.get(`/api/user-appointments?${U.toString()}`,{skip401Handler:!0});console.log("Appointments API Response:",G.data.data),i(G.data.data),h({current_page:G.data.current_page,last_page:G.data.last_page,per_page:G.data.per_page,total:G.data.total}),F.current.appointments=!0}catch(U){console.error("Failed to fetch appointments",U)}finally{n(!1)}},E=M=>{S(M),R(!0)},O=async()=>{var M,U,G;if(v)try{p(v),R(!1),await z.get("/sanctum/csrf-cookie");const Y=await z.post(`/api/appointment/${v}/cancel`),se=(M=Y==null?void 0:Y.data)!=null&&M.refund_request_created?" A refund request has been created and will be processed shortly.":"";K.success("Appointment cancelled successfully!"+se,{style:{background:"#28a745",color:"#fff",borderRadius:"8px",padding:"16px",fontSize:"16px"},duration:4e3}),k(r),S(null)}catch(Y){console.error("Cancel failed",Y);const se=((G=(U=Y.response)==null?void 0:U.data)==null?void 0:G.message)||"Failed to cancel appointment. Please try again.";K.error(se,{style:{background:"#dc3545",color:"#fff",borderRadius:"8px",padding:"16px"}})}finally{p(null)}},X=async M=>{var U,G,Y,se,oe;try{x(M),await z.get("/sanctum/csrf-cookie");const{data:pe}=await z.post("/api/maya/payments",{appointment_id:M},{skip401Handler:!0});pe!=null&&pe.redirect_url?window.location.href=pe.redirect_url:K.error("Payment link not available. Please try again.")}catch(pe){console.error("Create Maya payment failed",pe);const ce=((G=(U=pe.response)==null?void 0:U.data)==null?void 0:G.message)||((oe=(se=(Y=pe.response)==null?void 0:Y.data)==null?void 0:se.maya)==null?void 0:oe.message)||"Unable to start payment. Please try again.";K.error(ce)}finally{x(null)}},ee=M=>{y(M),j(""),C([]),D("")},ae=async M=>{const U=M.target.value;if(j(U),C([]),D(""),U&&m)try{const G=await z.get(`/api/appointment/available-slots?date=${U}&service_id=${m.service.id}`);C(G.data.slots)}catch(G){console.error("Failed to fetch available slots",G),C([])}},ne=async()=>{var M;if(!u||!f||!m){K.error("Please select both date and time slot.");return}try{I(!0),await z.post(`/api/appointments/${m.id}/reschedule`,{date:u,start_time:f}),K.success("Appointment rescheduled successfully! It will need staff approval."),y(null),j(""),C([]),D(""),k(r)}catch(U){console.error("Reschedule failed",U);const G=(M=U.response)==null?void 0:M.data;if(G!=null&&G.blocked)K.error(G.message);else{const Y=(G==null?void 0:G.message)||"Failed to reschedule appointment.";K.error(Y)}}finally{I(!1)}},re=()=>{y(null),j(""),C([]),D("")},W=()=>{d(1),k(1)},$=()=>{H(""),c(""),d(1),q(1)},q=async(M=1)=>{try{n(!0);const U=await z.get(`/api/user-appointments?page=${M}`,{skip401Handler:!0});console.log("Appointments API Response:",U.data.data),i(U.data.data),h({current_page:U.data.current_page,last_page:U.data.last_page,per_page:U.data.per_page,total:U.data.total}),F.current.appointments=!0}catch(U){console.error("Failed to fetch appointments",U)}finally{n(!1)}},J=()=>{const M=new Date;return M.setDate(M.getDate()+1),M.toISOString().slice(0,10)},ie=()=>{const M=new Date;return M.setDate(M.getDate()+7),M.toISOString().slice(0,10)},B=M=>{const U={approved:"bg-success",pending:"bg-warning text-dark",rejected:"bg-danger",cancelled:"bg-secondary text-white fw-semibold",completed:"bg-primary"};return e.jsx("span",{className:`badge ${U[M]||"bg-secondary"}`,children:M})};return e.jsxs(e.Fragment,{children:[e.jsx(ss,{position:"top-center"}),e.jsx(Ze,{show:N,onConfirm:O,onCancel:()=>{R(!1),S(null)},title:"Cancel Appointment",message:"Are you sure you want to cancel this appointment?",confirmText:"Yes, Cancel",cancelText:"No, Keep It",variant:"danger"}),e.jsxs("div",{className:"w-100",children:[e.jsxs("div",{className:"d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4",children:[e.jsxs("h2",{className:"h4 mb-3 mb-md-0",children:[e.jsx("i",{className:"bi bi-calendar3 me-2"}),"My Appointments & History"]}),e.jsx("div",{className:"d-flex gap-2",children:e.jsx("button",{className:"btn btn-outline-primary btn-sm",onClick:()=>k(r),disabled:a,children:a?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),"Refreshing..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-arrow-clockwise me-1"}),"Refresh"]})})})]}),e.jsxs("div",{className:"d-flex gap-2 mb-4",role:"group","aria-label":"Content tabs",children:[e.jsxs("button",{className:`btn flex-fill flex-sm-grow-0 border-0 shadow-sm ${w==="appointments"?"":"btn-outline-primary"}`,onClick:()=>A("appointments"),type:"button",style:{background:w==="appointments"?"linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)":"transparent",color:w==="appointments"?"white":"#3b82f6",border:w==="appointments"?"none":"1px solid #3b82f6",borderRadius:"8px",padding:"12px 16px",fontWeight:"600",transition:"all 0.3s ease",minWidth:"140px"},children:[e.jsx("i",{className:"bi bi-calendar3 me-2"}),e.jsx("span",{className:"d-none d-sm-inline",children:"Appointments"}),e.jsx("span",{className:"d-sm-none",children:"Appts"})]}),e.jsxs("button",{className:`btn flex-fill flex-sm-grow-0 border-0 shadow-sm ${w==="history"?"":"btn-outline-primary"}`,onClick:()=>A("history"),type:"button",style:{background:w==="history"?"linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)":"transparent",color:w==="history"?"white":"#3b82f6",border:w==="history"?"none":"1px solid #3b82f6",borderRadius:"8px",padding:"12px 16px",fontWeight:"600",transition:"all 0.3s ease",minWidth:"140px"},children:[e.jsx("i",{className:"bi bi-clock-history me-2"}),e.jsx("span",{className:"d-none d-sm-inline",children:"Service History"}),e.jsx("span",{className:"d-sm-none",children:"History"})]})]}),w==="appointments"&&e.jsx("div",{className:"card border-0 shadow-sm mb-4",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"row g-3 align-items-end",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsxs("label",{htmlFor:"startDate",className:"form-label fw-semibold",children:[e.jsx("i",{className:"bi bi-calendar-check me-2 text-primary"}),"Start Date"]}),e.jsx("input",{id:"startDate",type:"date",className:"form-control",value:_,onChange:M=>H(M.target.value),placeholder:"Select start date"}),e.jsx("small",{className:"text-muted",children:"Filter from this date"})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs("label",{htmlFor:"endDate",className:"form-label fw-semibold",children:[e.jsx("i",{className:"bi bi-calendar-x me-2 text-primary"}),"End Date"]}),e.jsx("input",{id:"endDate",type:"date",className:"form-control",value:T,onChange:M=>c(M.target.value),min:_||void 0,placeholder:"Select end date",disabled:!_}),e.jsx("small",{className:"text-muted",children:_?"Filter up to this date":"Select start date first"})]}),e.jsx("div",{className:"col-md-4",children:e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx("button",{className:"btn btn-primary flex-fill",onClick:W,disabled:!_||a,children:a?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),"Loading..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-funnel me-1"}),"Apply Filter"]})}),e.jsx("button",{className:"btn btn-outline-secondary",onClick:$,disabled:!_&&!T||a,title:"Clear filters",children:e.jsx("i",{className:"bi bi-x-circle"})})]})})]}),(_||T)&&e.jsx("div",{className:"mt-3",children:e.jsxs("div",{className:"alert alert-info mb-0 d-flex align-items-center",children:[e.jsx("i",{className:"bi bi-info-circle me-2"}),e.jsxs("span",{children:[_&&!T&&`Showing appointments on ${_}`,_&&T&&`Showing appointments from ${_} to ${T}`]})]})})]})}),e.jsxs("div",{className:"tab-content",children:[w==="appointments"&&e.jsxs("div",{className:"tab-pane fade show active",children:[e.jsx("div",{className:"d-none d-lg-block",children:e.jsx("div",{className:"card border-0 shadow-sm",children:e.jsx("div",{className:"card-body p-0",children:e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover mb-0",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date & Time"}),e.jsx("th",{children:"Service"}),e.jsx("th",{children:"Payment Method"}),e.jsx("th",{children:"Payment Status"}),e.jsx("th",{children:"Appointment Status"}),e.jsx("th",{children:"Notes"}),e.jsx("th",{style:{width:160},children:"Actions"})]})}),e.jsx("tbody",{children:a?e.jsx("tr",{children:e.jsxs("td",{colSpan:"7",className:"text-center py-5",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"text-muted mt-2 mb-0",children:"Loading appointments..."})]})}):s.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:"7",className:"text-center py-5",children:[e.jsx("i",{className:"bi bi-calendar-x display-4 text-muted"}),e.jsx("h6",{className:"mt-3 text-muted",children:"No appointments yet"}),e.jsx("p",{className:"text-muted mb-3",children:"You haven't booked any appointments yet."}),e.jsxs("a",{href:"/patient/appointment",className:"btn btn-primary",children:[e.jsx("i",{className:"bi bi-calendar-plus me-2"}),"Book Your First Appointment"]})]})}):s.map(M=>{var Y,se;const U=M.payment_method==="maya"&&M.payment_status==="awaiting_payment"&&M.status==="approved",G=M.payment_method==="maya"&&M.payment_status==="paid"&&(M.status==="approved"||M.status==="pending");return e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("div",{className:"fw-medium",children:M.date}),e.jsx("small",{className:"text-muted",children:M.start_time})]}),e.jsx("td",{children:e.jsx("div",{className:"fw-medium",children:((Y=M.service)==null?void 0:Y.name)||"â€”"})}),e.jsx("td",{children:e.jsx("span",{className:"badge bg-light text-dark text-capitalize",children:M.payment_method})}),e.jsx("td",{children:e.jsx("span",{className:`badge ${M.payment_status==="paid"?"bg-success":M.payment_status==="awaiting_payment"?"bg-warning text-dark":"bg-secondary"}`,children:(se=M.payment_status)==null?void 0:se.replace("_"," ")})}),e.jsxs("td",{children:[B(M.status),M.status==="cancelled"&&M.refund_request&&e.jsx("div",{className:"mt-1",children:e.jsxs("small",{className:`badge ${M.refund_request.status==="pending"?"bg-warning text-dark":M.refund_request.status==="approved"?"bg-info":M.refund_request.status==="processed"?"bg-success":M.refund_request.status==="completed"?"bg-primary":M.refund_request.status==="rejected"?"bg-danger":"bg-secondary"}`,children:["Refund: ",M.refund_request.status,M.refund_request.refund_amount>0&&` (â‚±${Number(M.refund_request.refund_amount).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})})`]})})]}),e.jsx("td",{className:"text-muted small",children:M.notes||"â€”"}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex gap-1 flex-wrap",children:[U&&e.jsx("button",{className:"btn btn-primary btn-sm",onClick:()=>X(M.id),disabled:o===M.id,children:o===M.id?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),"Redirecting..."]}):"Pay now"}),G&&e.jsxs("button",{className:"btn btn-warning btn-sm",onClick:()=>ee(M),title:"Reschedule Appointment",children:[e.jsx("i",{className:"bi bi-calendar-event me-1"}),"Reschedule"]}),(M.status==="pending"||M.status==="approved"&&(M.payment_status==="unpaid"||M.payment_status==="awaiting_payment"||M.payment_method==="maya"&&M.payment_status==="paid"))&&e.jsx("button",{className:"btn btn-outline-danger btn-sm",onClick:()=>E(M.id),disabled:g===M.id||o===M.id,children:g===M.id?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),"Canceling..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-x-circle me-1"}),"Cancel"]})})]})})]},M.id)})})]})})})})}),e.jsx("div",{className:"d-lg-none",children:a?e.jsx("div",{className:"card border-0 shadow-sm",children:e.jsxs("div",{className:"card-body text-center py-5",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"text-muted mt-2 mb-0",children:"Loading appointments..."})]})}):s.length===0?e.jsx("div",{className:"card border-0 shadow-sm",children:e.jsxs("div",{className:"card-body text-center py-5",children:[e.jsx("i",{className:"bi bi-calendar-x display-4 text-muted"}),e.jsx("h6",{className:"mt-3 text-muted",children:"No appointments yet"}),e.jsx("p",{className:"text-muted mb-3",children:"You haven't booked any appointments yet."}),e.jsxs("a",{href:"/patient/appointment",className:"btn btn-primary",children:[e.jsx("i",{className:"bi bi-calendar-plus me-2"}),"Book Your First Appointment"]})]})}):s.map(M=>{var Y,se;const U=M.payment_method==="maya"&&M.payment_status==="awaiting_payment"&&M.status==="approved",G=M.payment_method==="maya"&&M.payment_status==="paid"&&(M.status==="approved"||M.status==="pending");return e.jsx("div",{className:"card mb-3 border-0 shadow-sm",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-8",children:[e.jsx("h6",{className:"card-title mb-1",children:((Y=M.service)==null?void 0:Y.name)||"â€”"}),e.jsxs("p",{className:"card-text text-muted mb-2",children:[e.jsx("i",{className:"bi bi-calendar me-1"}),M.date," at ",M.start_time]})]}),e.jsx("div",{className:"col-4 text-end",children:B(M.status)})]}),e.jsxs("div",{className:"row mt-2",children:[e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted",children:"Payment Method:"}),e.jsx("div",{className:"badge bg-light text-dark text-capitalize",children:M.payment_method})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted",children:"Payment Status:"}),e.jsx("div",{children:e.jsx("span",{className:`badge ${M.payment_status==="paid"?"bg-success":M.payment_status==="awaiting_payment"?"bg-warning text-dark":"bg-secondary"}`,children:(se=M.payment_status)==null?void 0:se.replace("_"," ")})})]})]}),M.status==="cancelled"&&M.refund_request&&e.jsxs("div",{className:"mt-2",children:[e.jsx("small",{className:"text-muted",children:"Refund Status:"}),e.jsx("div",{children:e.jsxs("small",{className:`badge ${M.refund_request.status==="pending"?"bg-warning text-dark":M.refund_request.status==="approved"?"bg-info":M.refund_request.status==="processed"?"bg-success":M.refund_request.status==="rejected"?"bg-danger":"bg-secondary"}`,children:[M.refund_request.status,M.refund_request.refund_amount>0&&` - â‚±${Number(M.refund_request.refund_amount).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`]})})]}),M.notes&&e.jsxs("div",{className:"mt-2",children:[e.jsx("small",{className:"text-muted",children:"Notes:"}),e.jsx("p",{className:"small mb-0",children:M.notes})]}),e.jsxs("div",{className:"d-flex gap-2 mt-3",children:[U&&e.jsx("button",{className:"btn btn-primary btn-sm flex-fill",onClick:()=>X(M.id),disabled:o===M.id,children:o===M.id?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),"Redirecting..."]}):"Pay now"}),G&&e.jsxs("button",{className:"btn btn-warning btn-sm flex-fill",onClick:()=>ee(M),children:[e.jsx("i",{className:"bi bi-calendar-event me-1"}),"Reschedule"]}),(M.status==="pending"||M.status==="approved"&&(M.payment_status==="unpaid"||M.payment_status==="awaiting_payment"||M.payment_method==="maya"&&M.payment_status==="paid"))&&e.jsx("button",{className:"btn btn-outline-danger btn-sm flex-fill",onClick:()=>E(M.id),disabled:g===M.id||o===M.id,children:g===M.id?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),"Canceling..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-x-circle me-1"}),"Cancel"]})})]})]})},M.id)})}),!a&&l.last_page>1&&e.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-4",children:[e.jsxs("button",{className:"btn btn-outline-secondary btn-sm",disabled:r===1,onClick:()=>d(r-1),children:[e.jsx("i",{className:"bi bi-chevron-left me-1"}),"Previous"]}),e.jsxs("span",{className:"text-muted",children:["Page ",l.current_page," of ",l.last_page]}),e.jsxs("button",{className:"btn btn-outline-secondary btn-sm",disabled:r===l.last_page,onClick:()=>d(r+1),children:["Next",e.jsx("i",{className:"bi bi-chevron-right ms-1"})]})]})]}),w==="history"&&e.jsx("div",{className:"tab-pane fade show active",children:e.jsx(Tl,{})})]}),m&&e.jsx("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)",position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:1050,overflowY:"auto",display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem"},tabIndex:"-1",children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",style:{margin:"0 auto",maxHeight:"calc(100vh - 2rem)",width:"100%"},children:e.jsxs("div",{className:"modal-content",style:{display:"flex",flexDirection:"column",maxHeight:"calc(100vh - 2rem)",overflow:"hidden"},children:[e.jsxs("div",{className:"modal-header flex-shrink-0",style:{position:"sticky",top:0,zIndex:1,backgroundColor:"#fff",borderBottom:"1px solid #dee2e6"},children:[e.jsxs("h5",{className:"modal-title",children:[e.jsx("i",{className:"bi bi-calendar-event me-2"}),"Reschedule Appointment"]}),e.jsx("button",{type:"button",className:"btn-close",onClick:re,disabled:L})]}),e.jsxs("div",{className:"modal-body flex-grow-1",style:{overflowY:"auto",overflowX:"hidden",flex:"1 1 auto",minHeight:0},children:[e.jsxs("div",{className:"alert alert-info border-0",children:[e.jsx("i",{className:"bi bi-info-circle me-2"}),e.jsx("strong",{children:"Service:"})," ",(le=m.service)==null?void 0:le.name,e.jsx("br",{}),e.jsx("strong",{children:"Current Date:"})," ",m.date," at ",m.start_time,e.jsx("br",{}),e.jsx("small",{children:"All other details (payment method, service, etc.) will remain the same."})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label fw-semibold",children:[e.jsx("i",{className:"bi bi-calendar3 me-2 text-primary"}),"Select New Date"]}),e.jsx("input",{type:"date",className:"form-control",value:u,onChange:ae,min:J(),max:ie(),disabled:L}),e.jsx("div",{className:"form-text",children:"Appointments can be rescheduled from tomorrow up to 7 days in advance"})]}),u&&b.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label fw-semibold",children:[e.jsx("i",{className:"bi bi-clock me-2 text-primary"}),"Available Time Slots"]}),e.jsxs("select",{className:"form-select",value:f,onChange:M=>D(M.target.value),disabled:L,children:[e.jsx("option",{value:"",children:"-- Select Time Slot --"}),b.map(M=>e.jsx("option",{value:M,children:M},M))]})]}),u&&b.length===0&&e.jsxs("div",{className:"alert alert-warning border-0",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),"No available slots for this date. Please select a different date."]})]}),e.jsxs("div",{className:"modal-footer flex-shrink-0",style:{position:"sticky",bottom:0,zIndex:1,backgroundColor:"#fff",borderTop:"1px solid #dee2e6"},children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:re,disabled:L,children:"Cancel"}),e.jsx("button",{type:"button",className:"btn btn-warning",onClick:ne,disabled:!u||!f||L,children:L?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),"Rescheduling..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-calendar-event me-1"}),"Reschedule Appointment"]})})]})]})})})]})]})}function $l(){const s=we(),[i,a]=t.useState(null),{logout:n}=Ce(),[r,d]=t.useState(!1);t.useEffect(()=>{z.get("/api/user").then(x=>a(x.data)).catch(()=>a(null))},[]);const l=()=>{d(!0)},h=async()=>{d(!1),await n(),s("/")},o=()=>{d(!1)};return e.jsxs(e.Fragment,{children:[e.jsx("nav",{className:"navbar navbar-expand-lg navbar-light shadow-sm px-3",style:{background:"linear-gradient(135deg, #00b4d8 0%, #0077b6 100%)"},children:e.jsxs("div",{className:"container-fluid",children:[e.jsxs(je,{className:"navbar-brand d-flex align-items-center",to:"/dentist",children:[e.jsx("img",{src:us,alt:"Kreative Dental Clinic",style:{height:"32px",width:"32px",objectFit:"contain",marginRight:"8px"}}),e.jsx("span",{className:"fst-bold",style:{color:"white"},children:"Kreative Dental & Orthodontics"})]}),e.jsx("button",{className:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#dentistNavbarNav","aria-controls":"dentistNavbarNav","aria-expanded":"false","aria-label":"Toggle navigation",children:e.jsx("span",{className:"navbar-toggler-icon"})}),e.jsx("div",{className:"collapse navbar-collapse",id:"dentistNavbarNav",children:e.jsxs("div",{className:"navbar-nav ms-auto align-items-lg-center d-flex flex-row gap-2",children:[e.jsx(je,{to:"/dentist",className:"btn d-flex align-items-center justify-content-center",title:"Home",style:{color:"white",border:"none",background:"rgba(255, 255, 255, 0.15)",borderRadius:"8px",padding:"0.5rem",width:"40px",height:"40px",textDecoration:"none",transition:"all 0.2s ease"},onMouseEnter:x=>{x.target.style.background="rgba(255, 255, 255, 0.2)"},onMouseLeave:x=>{x.target.style.background="rgba(255, 255, 255, 0.15)"},children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),e.jsx("polyline",{points:"9 22 9 12 15 12 15 22"})]})}),i&&e.jsx("div",{style:{marginLeft:"0.5rem"},children:e.jsx(ea,{})}),i&&e.jsxs("button",{onClick:l,className:"btn d-flex align-items-center ms-lg-2 mt-2 mt-lg-0",style:{background:"linear-gradient(90deg, #00b4d8 0%, #0077b6 100%)",color:"white",border:"none",fontWeight:"600",padding:"0.5rem 1rem",borderRadius:"8px",transition:"all 0.2s ease",fontSize:"0.9rem",letterSpacing:"0.5px",textTransform:"uppercase"},onMouseEnter:x=>{x.target.style.background="linear-gradient(90deg, #0096c7 0%, #0056b3 100%)",x.target.style.transform="translateY(-1px)"},onMouseLeave:x=>{x.target.style.background="linear-gradient(90deg, #00b4d8 0%, #0077b6 100%)",x.target.style.transform="translateY(0)"},children:[e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"#dc3545",style:{marginRight:"0.5rem"},children:e.jsx("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"})}),e.jsx("span",{children:"LOG OUT"})]})]})})]})}),e.jsx(Ze,{show:r,onConfirm:h,onCancel:o,title:"Confirm Logout",message:"Are you sure you want to logout? You will need to login again to access your account.",confirmText:"Logout",cancelText:"Cancel",variant:"danger"})]})}function Ia({children:s}){const[i,a]=t.useState(!0),[n,r]=t.useState(!1),[d,l]=t.useState(""),[h,o]=t.useState(""),[x,g]=t.useState("");t.useEffect(()=>{let m=!0;return(async()=>{var y;try{const N=await z.get("/api/dentist/password-status");if(!m)return;const R=!((y=N==null?void 0:N.data)!=null&&y.password_changed);r(R)}catch(N){console.error("DentistPasswordGate - API Error:",N),r(!1)}finally{a(!1)}})(),()=>{m=!1}},[]);const p=async()=>{var m,y;if(g(""),!d||d.length<8){g("Password must be at least 8 characters.");return}if(d!==h){g("Passwords do not match.");return}try{await z.post("/api/dentist/change-password",{password:d}),r(!1),l(""),o("")}catch(N){g(((y=(m=N==null?void 0:N.response)==null?void 0:m.data)==null?void 0:y.message)||"Failed to change password")}};return i?e.jsx("div",{className:"p-4",children:"Checking accountâ€¦"}):n?e.jsxs("div",{className:"position-relative",children:[e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.7)",zIndex:1050,backdropFilter:"blur(2px)"}}),e.jsx("div",{style:{position:"fixed",inset:0,display:"flex",alignItems:"center",justifyContent:"center",zIndex:1060},children:e.jsxs("div",{className:"card shadow-lg border-warning",style:{width:450,maxWidth:"90vw"},children:[e.jsx("div",{className:"card-header bg-warning text-dark text-center",children:e.jsxs("h4",{className:"mb-0",children:[e.jsx("i",{className:"bi bi-shield-exclamation me-2"}),"Account Security Required"]})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"alert alert-warning mb-3",children:[e.jsx("i",{className:"bi bi-info-circle me-2"}),e.jsx("strong",{children:"You must change your temporary password to continue."}),e.jsx("br",{}),e.jsx("small",{children:"This is required for account security and cannot be skipped."})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-semibold",children:"New Password:"}),e.jsx("input",{type:"password",className:"form-control",value:d,onChange:m=>l(m.target.value),placeholder:"Enter your new password",autoFocus:!0})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-semibold",children:"Confirm Password:"}),e.jsx("input",{type:"password",className:"form-control",value:h,onChange:m=>o(m.target.value),placeholder:"Confirm your new password"})]}),x&&e.jsxs("div",{className:"alert alert-danger mb-3",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),x]}),e.jsx("div",{className:"d-grid",children:e.jsxs("button",{className:"btn btn-primary btn-lg",onClick:p,disabled:!d||!h,children:[e.jsx("i",{className:"bi bi-shield-check me-2"}),"Secure My Account"]})})]})]})})]}):s}function Il(){const s=es(),i=we(),{user:a}=Ce();t.useEffect(()=>{if(a&&a.role!=="dentist"){const r=a.role==="admin"?"/admin":a.role==="staff"?"/staff":a.role==="patient"?"/patient":"/";i(r,{replace:!0})}},[a,i]);const n=s.pathname==="/dentist"||s.pathname==="/dentist/";return e.jsxs("div",{className:"d-flex flex-column min-vh-100 bg-light dentist-layout",children:[e.jsx(ss,{position:"top-center"}),e.jsx($l,{}),n?e.jsx("main",{className:"flex-grow-1",children:e.jsx(Ia,{children:e.jsx(gs,{})})}):e.jsx("main",{className:"flex-grow-1",children:e.jsx(Ia,{children:e.jsx(gs,{})})})]})}function Wl(){var a;const{user:s}=Ce(),i=()=>{const n=new Date().getHours();return n<12?"Good Morning":n<18?"Good Afternoon":"Good Evening"};return e.jsxs("div",{className:"container-fluid py-4",children:[e.jsx("div",{className:"row mb-4",children:e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"card border-0 shadow-sm",style:{background:"linear-gradient(135deg, #00b4d8 0%, #0077b6 100%)",color:"white"},children:e.jsx("div",{className:"card-body p-4",children:e.jsxs("div",{className:"row align-items-center",children:[e.jsxs("div",{className:"col-md-8",children:[e.jsxs("h1",{className:"h3 mb-2",children:[i(),", Dr. ",((a=s==null?void 0:s.name)==null?void 0:a.split(" ")[0])||"Dentist","! ðŸ‘‹"]}),e.jsx("p",{className:"mb-0 opacity-75",children:"Welcome to your dental practice dashboard. Manage patient visits, view your schedule, and stay updated with your clinic operations."})]}),e.jsx("div",{className:"col-md-4 text-md-end",children:e.jsxs("div",{className:"d-flex flex-column align-items-md-end",children:[e.jsx("div",{className:"mb-2",children:e.jsx("i",{className:"bi bi-calendar-check fs-1 opacity-50"})}),e.jsxs("small",{className:"opacity-75",children:["Last login: ",new Date().toLocaleDateString()]})]})})]})})})})}),e.jsxs("div",{className:"row mb-4",children:[e.jsx("div",{className:"col-12",children:e.jsx("h2",{className:"h4 mb-3",children:"Quick Actions"})}),e.jsx("div",{className:"col-md-4 mb-3",children:e.jsx(je,{to:"/dentist/dashboard",className:"text-decoration-none",children:e.jsx("div",{className:"card h-100 border-0 shadow-sm hover-lift",children:e.jsxs("div",{className:"card-body text-center p-4",children:[e.jsx("div",{className:"mb-3",children:e.jsx("i",{className:"bi bi-key fs-1 text-primary"})}),e.jsx("h5",{className:"card-title text-dark",children:"Process Visit"}),e.jsx("p",{className:"card-text text-muted",children:"Enter visit codes to start patient consultations"}),e.jsxs("div",{className:"btn",style:{background:"linear-gradient(135deg, #00b4d8 0%, #0077b6 100%)",color:"white",border:"none"},children:[e.jsx("i",{className:"bi bi-qr-code me-2"}),"Visit Codes"]})]})})})}),e.jsx("div",{className:"col-md-4 mb-3",children:e.jsx(je,{to:"/dentist/schedule",className:"text-decoration-none",children:e.jsx("div",{className:"card h-100 border-0 shadow-sm hover-lift",children:e.jsxs("div",{className:"card-body text-center p-4",children:[e.jsx("div",{className:"mb-3",children:e.jsx("i",{className:"bi bi-calendar3 fs-1 text-success"})}),e.jsx("h5",{className:"card-title text-dark",children:"View Schedule"}),e.jsx("p",{className:"card-text text-muted",children:"View your clinic schedule and working hours"}),e.jsxs("div",{className:"btn",style:{background:"linear-gradient(135deg, #00b4d8 0%, #0077b6 100%)",color:"white",border:"none"},children:[e.jsx("i",{className:"bi bi-calendar-check me-2"}),"View Schedule"]})]})})})}),e.jsx("div",{className:"col-md-4 mb-3",children:e.jsx(je,{to:"/dentist/profile",className:"text-decoration-none",children:e.jsx("div",{className:"card h-100 border-0 shadow-sm hover-lift",children:e.jsxs("div",{className:"card-body text-center p-4",children:[e.jsx("div",{className:"mb-3",children:e.jsx("i",{className:"bi bi-person-circle fs-1 text-info"})}),e.jsx("h5",{className:"card-title text-dark",children:"My Profile"}),e.jsx("p",{className:"card-text text-muted",children:"Update your personal information and preferences"}),e.jsxs("div",{className:"btn",style:{background:"linear-gradient(135deg, #00b4d8 0%, #0077b6 100%)",color:"white",border:"none"},children:[e.jsx("i",{className:"bi bi-gear me-2"}),"Manage"]})]})})})})]}),e.jsx("div",{className:"row mt-4",children:e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"card border-0 shadow-sm bg-light",children:e.jsx("div",{className:"card-body p-4",children:e.jsxs("div",{className:"row align-items-center",children:[e.jsxs("div",{className:"col-md-8",children:[e.jsxs("h4",{className:"h5 mb-2",children:[e.jsx("i",{className:"bi bi-lightbulb text-warning me-2"}),"Practice Management Tip"]}),e.jsx("p",{className:"mb-0 text-muted",children:"Keep your schedule updated and maintain clear communication with patients. Regular follow-ups and efficient visit processing enhance patient satisfaction!"})]}),e.jsx("div",{className:"col-md-4 text-md-end",children:e.jsx("i",{className:"bi bi-tooth fs-1 opacity-25",style:{color:"#00b4d8"}})})]})})})})}),e.jsx("style",{jsx:!0,children:`
        .hover-lift {
          transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .hover-lift:hover {
          transform: translateY(-5px);
          box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
        }
      `})]})}const Bl=()=>{const[s,i]=t.useState(null),[a,n]=t.useState(!1),[r,d]=t.useState(""),[l,h]=t.useState(""),[o,x]=t.useState({}),[g,p]=t.useState(""),[m,y]=t.useState(!1);we();const N=async()=>{try{const u=await z.get("/api/user");i(u.data),console.log(u.data)}catch(u){console.error("Failed to fetch user info",u)}};t.useEffect(()=>{N()},[]);const R=async()=>{var u,j,b,C;if(p(""),x({}),y(!0),!r){x({newPassword:"New password is required"}),y(!1);return}if(r.length<8){x({newPassword:"Password must be at least 8 characters"}),y(!1);return}if(r!==l){x({confirmPassword:"Passwords do not match"}),y(!1);return}try{const f=await z.post("/api/dentist/change-password",{password:r});p("âœ… Password changed successfully!"),n(!1),d(""),h("")}catch(f){(j=(u=f.response)==null?void 0:u.data)!=null&&j.errors?x(f.response.data.errors):p("âŒ "+(((C=(b=f.response)==null?void 0:b.data)==null?void 0:C.message)||"Failed to change password"))}finally{y(!1)}},v=async()=>{var u,j;p(""),x({}),y(!0);try{const b=await z.post("/api/send-password-reset");p(b.data.message||"Password reset link sent to your email!")}catch(b){const C=((j=(u=b.response)==null?void 0:u.data)==null?void 0:j.message)||"Failed to send reset link";p("âŒ "+C)}finally{y(!1)}};if(!s)return e.jsx("p",{children:"Loading your profile..."});const S=s.role;return e.jsx("div",{className:"w-100",children:e.jsx("div",{className:"container-fluid px-4 py-4",children:e.jsxs("div",{className:"card border-0 shadow-lg w-100 dentist-page-card",children:[e.jsxs("div",{className:"card-header bg-gradient bg-primary text-white text-center py-4",children:[e.jsxs("h2",{className:"h3 mb-2",children:[e.jsx("i",{className:"bi bi-person-circle me-2"}),"My Account"]}),e.jsx("p",{className:"mb-0 opacity-75",children:"Manage your personal information and account settings"})]}),e.jsxs("div",{className:"card-body p-5",children:[e.jsxs("div",{className:"row mb-5",children:[e.jsx("div",{className:"col-12",children:e.jsxs("h4",{className:"h5 mb-3 text-primary",children:[e.jsx("i",{className:"bi bi-person me-2"}),"Personal Information"]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-semibold",children:"Full Name"}),e.jsx("div",{className:"form-control-plaintext bg-light p-3 rounded",children:s.name||"Not provided"})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-semibold",children:"Email Address"}),e.jsxs("div",{className:"form-control-plaintext bg-light p-3 rounded",children:[s.email||"Not provided",s.email_verified_at&&e.jsxs("span",{className:"badge bg-success ms-2",children:[e.jsx("i",{className:"bi bi-check-circle me-1"}),"Verified"]})]})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-semibold",children:"Role"}),e.jsx("div",{className:"form-control-plaintext bg-light p-3 rounded",children:e.jsx("span",{className:"badge bg-primary text-capitalize",children:S})})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-semibold",children:"Contact Number"}),e.jsx("div",{className:"form-control-plaintext bg-light p-3 rounded",children:s.contact_number||"Not provided"})]})})]}),e.jsxs("div",{className:"row mb-5",children:[e.jsx("div",{className:"col-12",children:e.jsxs("h4",{className:"h5 mb-3 text-primary",children:[e.jsx("i",{className:"bi bi-shield-lock me-2"}),"Account Security"]})}),e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"card border-0 bg-light",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("h6",{className:"mb-1",children:"Password"}),e.jsx("p",{className:"text-muted mb-0",children:"Last updated: Recently"})]}),e.jsxs("div",{children:[e.jsxs("button",{className:"btn btn-outline-primary me-2",onClick:()=>n(!a),children:[e.jsx("i",{className:"bi bi-key me-1"}),"Change Password"]}),e.jsxs("button",{className:"btn btn-outline-secondary",onClick:v,disabled:m,children:[e.jsx("i",{className:"bi bi-arrow-clockwise me-1"}),"Reset Password"]})]})]})})})})]}),a&&e.jsx("div",{className:"row mb-5",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card border-warning",children:[e.jsx("div",{className:"card-header bg-warning text-dark",children:e.jsxs("h5",{className:"mb-0",children:[e.jsx("i",{className:"bi bi-key me-2"}),"Change Password"]})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"New Password"}),e.jsx("input",{type:"password",className:`form-control ${o.newPassword?"is-invalid":""}`,value:r,onChange:u=>d(u.target.value),placeholder:"Enter new password"}),o.newPassword&&e.jsx("div",{className:"invalid-feedback",children:o.newPassword})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Confirm New Password"}),e.jsx("input",{type:"password",className:`form-control ${o.confirmPassword?"is-invalid":""}`,value:l,onChange:u=>h(u.target.value),placeholder:"Confirm new password"}),o.confirmPassword&&e.jsx("div",{className:"invalid-feedback",children:o.confirmPassword})]})}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx("button",{className:"btn btn-primary",onClick:R,disabled:m,children:m?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Changing..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-check-circle me-1"}),"Change Password"]})}),e.jsxs("button",{className:"btn btn-secondary",onClick:()=>{n(!1),d(""),h(""),x({})},children:[e.jsx("i",{className:"bi bi-x-circle me-1"}),"Cancel"]})]})})]})})]})})}),g&&e.jsx("div",{className:"row mb-4",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:`alert ${g.includes("âœ…")?"alert-success":"alert-danger"} alert-dismissible fade show`,children:[g,e.jsx("button",{type:"button",className:"btn-close",onClick:()=>p("")})]})})})]})]})})})},Hl=()=>{const{user:s}=Ce();return e.jsx("div",{className:"w-100",children:e.jsx("div",{className:"container-fluid px-4 py-4",children:e.jsx("div",{className:"row",children:e.jsxs("div",{className:"col-12",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsx("h2",{children:"ðŸ¦· Dentist Dashboard"}),e.jsxs("div",{className:"text-muted",children:["Welcome, Dr. ",(s==null?void 0:s.name)||"Dentist"]})]}),e.jsxs("div",{className:"row mb-4",children:[e.jsx("div",{className:"col-md-6 mb-3",children:e.jsx(je,{to:"/dentist/visit-manager",className:"text-decoration-none",children:e.jsx("div",{className:"card h-100 border-0 shadow-sm hover-lift",children:e.jsxs("div",{className:"card-body text-center p-4",children:[e.jsx("div",{className:"mb-3",children:e.jsx("i",{className:"bi bi-key fs-1 text-primary"})}),e.jsx("h5",{className:"card-title text-dark",children:"Visit Manager"}),e.jsx("p",{className:"card-text text-muted",children:"Enter visit codes to manage patient consultations, notes, and history"}),e.jsxs("div",{className:"btn btn-primary",children:[e.jsx("i",{className:"bi bi-key me-2"}),"Start Visit"]})]})})})}),e.jsx("div",{className:"col-md-6 mb-3",children:e.jsx(je,{to:"/dentist/schedule-view",className:"text-decoration-none",children:e.jsx("div",{className:"card h-100 border-0 shadow-sm hover-lift",children:e.jsxs("div",{className:"card-body text-center p-4",children:[e.jsx("div",{className:"mb-3",children:e.jsx("i",{className:"bi bi-calendar-check fs-1 text-info"})}),e.jsx("h5",{className:"card-title text-dark",children:"Clinic Schedule"}),e.jsx("p",{className:"card-text text-muted",children:"View clinic operating hours and capacity settings"}),e.jsxs("div",{className:"btn btn-info",children:[e.jsx("i",{className:"bi bi-calendar me-2"}),"View Schedule"]})]})})})})]}),e.jsxs("div",{className:"alert alert-info",children:[e.jsx("h5",{children:"How to use the Visit Manager:"}),e.jsxs("ol",{children:[e.jsx("li",{children:'Click "Start Visit" to access the Visit Manager'}),e.jsx("li",{children:"Enter the 6-character visit code provided by staff"}),e.jsx("li",{children:'Switch between "Enter Notes" and "Patient History" tabs'}),e.jsx("li",{children:"Enter your notes, findings, treatment plan, and teeth treated"}),e.jsx("li",{children:"View complete patient history for better context"}),e.jsx("li",{children:"Save your notes - staff can access them during completion"})]})]})]})})})})};function Vl(){const{user:s}=Ce(),[i,a]=t.useState(null),[n,r]=t.useState([]),[d,l]=t.useState(!0),[h,o]=t.useState(""),x=[{key:"sun",label:"Sunday"},{key:"mon",label:"Monday"},{key:"tue",label:"Tuesday"},{key:"wed",label:"Wednesday"},{key:"thu",label:"Thursday"},{key:"fri",label:"Friday"},{key:"sat",label:"Saturday"}];t.useEffect(()=>{g()},[]);const g=async()=>{try{l(!0),o("");const N=await z.get("/api/dentist/clinic-schedule");r(N.data);const R=await z.get("/api/dentist/my-schedule");a(R.data)}catch(N){console.error("Failed to fetch schedules",N),o("Failed to load schedule information. Please try again.")}finally{l(!1)}},p=()=>i?x.filter(N=>i[N.key]):[],m=N=>n.find(R=>R.weekday===N),y=N=>N?new Date(`2000-01-01T${N}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):"Closed";return d?e.jsx(Pe,{message:"Loading schedule..."}):h?e.jsx("div",{className:"container-fluid px-4 py-4",children:e.jsxs("div",{className:"alert alert-danger",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),h]})}):e.jsx("div",{className:"dentist-schedule w-100",children:e.jsxs("div",{className:"container-fluid px-4 py-4",children:[e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsx("h2",{className:"h3 mb-0",children:"ðŸ“… My Schedule"}),e.jsxs("div",{className:"text-muted",children:["Dr. ",(s==null?void 0:s.name)||(i==null?void 0:i.dentist_name)||(i==null?void 0:i.dentist_code)||"Dentist"]})]})})}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-lg-6 mb-4",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-primary text-white",children:e.jsxs("h5",{className:"mb-0",children:[e.jsx("i",{className:"bi bi-person-check me-2"}),"My Working Days"]})}),e.jsx("div",{className:"card-body",children:i?e.jsxs("div",{children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Dentist Code:"})," ",i.dentist_code]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Employment Type:"}),e.jsx("span",{className:`badge ms-2 ${i.employment_type==="full_time"?"bg-success":i.employment_type==="part_time"?"bg-warning":"bg-info"}`,children:i.employment_type.replace("_"," ").toUpperCase()})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Status:"}),e.jsx("span",{className:`badge ms-2 ${i.status==="active"?"bg-success":"bg-secondary"}`,children:i.status.toUpperCase()})]}),e.jsx("hr",{}),e.jsx("h6",{children:"Working Days:"}),e.jsx("div",{className:"row",children:x.map(N=>e.jsx("div",{className:"col-6 col-md-4 mb-2",children:e.jsxs("div",{className:`d-flex align-items-center ${i[N.key]?"text-success":"text-muted"}`,children:[e.jsx("i",{className:`bi ${i[N.key]?"bi-check-circle-fill":"bi-x-circle"} me-2`}),N.label]})},N.key))})]}):e.jsxs("div",{className:"text-muted",children:[e.jsx("i",{className:"bi bi-info-circle me-2"}),"No dentist schedule information available."]})})]})}),e.jsx("div",{className:"col-lg-6 mb-4",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-success text-white",children:e.jsxs("h5",{className:"mb-0",children:[e.jsx("i",{className:"bi bi-building me-2"}),"Clinic Operating Hours"]})}),e.jsx("div",{className:"card-body",children:n.length>0?e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Day"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Hours"}),e.jsx("th",{children:"Note"})]})}),e.jsx("tbody",{children:x.map((N,R)=>{const v=m(R);return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:N.label})}),e.jsx("td",{children:v?v.is_open?e.jsx("span",{className:"badge bg-success",children:"Open"}):e.jsx("span",{className:"badge bg-secondary",children:"Closed"}):e.jsx("span",{className:"badge bg-secondary",children:"Closed"})}),e.jsx("td",{children:v&&v.is_open?`${y(v.open_time)} - ${y(v.close_time)}`:"Closed"}),e.jsx("td",{children:v&&v.note&&e.jsx("small",{className:"text-muted",children:v.note})})]},N.key)})})]})}):e.jsxs("div",{className:"text-muted",children:[e.jsx("i",{className:"bi bi-info-circle me-2"}),"No clinic schedule information available."]})})]})})]}),e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-info text-white",children:e.jsxs("h5",{className:"mb-0",children:[e.jsx("i",{className:"bi bi-calendar-check me-2"}),"Schedule Summary"]})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("h6",{children:"Your Working Days:"}),e.jsx("p",{className:"text-muted",children:i?p().length>0?p().map(N=>N.label).join(", "):"No working days assigned":"Schedule information not available"})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("h6",{children:"Clinic Status:"}),e.jsx("p",{className:"text-muted",children:n.filter(N=>N.is_open).length>0?`Open ${n.filter(N=>N.is_open).length} days per week`:"Clinic schedule not available"})]})]})})]})})})]})})}const Ol=({selectedTeeth:s=[],onTeethChange:i,showChart:a=!1,onToggleChart:n,maxSelection:r=null})=>{const[d,l]=t.useState("adult"),h=[{number:1,name:"Third Molar",quadrant:"Upper Right"},{number:2,name:"Second Molar",quadrant:"Upper Right"},{number:3,name:"First Molar",quadrant:"Upper Right"},{number:4,name:"Second Premolar",quadrant:"Upper Right"},{number:5,name:"First Premolar",quadrant:"Upper Right"},{number:6,name:"Canine",quadrant:"Upper Right"},{number:7,name:"Lateral Incisor",quadrant:"Upper Right"},{number:8,name:"Central Incisor",quadrant:"Upper Right"},{number:9,name:"Central Incisor",quadrant:"Upper Left"},{number:10,name:"Lateral Incisor",quadrant:"Upper Left"},{number:11,name:"Canine",quadrant:"Upper Left"},{number:12,name:"First Premolar",quadrant:"Upper Left"},{number:13,name:"Second Premolar",quadrant:"Upper Left"},{number:14,name:"First Molar",quadrant:"Upper Left"},{number:15,name:"Second Molar",quadrant:"Upper Left"},{number:16,name:"Third Molar",quadrant:"Upper Left"},{number:17,name:"Third Molar",quadrant:"Lower Left"},{number:18,name:"Second Molar",quadrant:"Lower Left"},{number:19,name:"First Molar",quadrant:"Lower Left"},{number:20,name:"Second Premolar",quadrant:"Lower Left"},{number:21,name:"First Premolar",quadrant:"Lower Left"},{number:22,name:"Canine",quadrant:"Lower Left"},{number:23,name:"Lateral Incisor",quadrant:"Lower Left"},{number:24,name:"Central Incisor",quadrant:"Lower Left"},{number:25,name:"Central Incisor",quadrant:"Lower Right"},{number:26,name:"Lateral Incisor",quadrant:"Lower Right"},{number:27,name:"Canine",quadrant:"Lower Right"},{number:28,name:"First Premolar",quadrant:"Lower Right"},{number:29,name:"Second Premolar",quadrant:"Lower Right"},{number:30,name:"First Molar",quadrant:"Lower Right"},{number:31,name:"Second Molar",quadrant:"Lower Right"},{number:32,name:"Third Molar",quadrant:"Lower Right"}],o=[{letter:"A",name:"Second Molar",quadrant:"Upper Right"},{letter:"B",name:"First Molar",quadrant:"Upper Right"},{letter:"C",name:"Canine",quadrant:"Upper Right"},{letter:"D",name:"Lateral Incisor",quadrant:"Upper Right"},{letter:"E",name:"Central Incisor",quadrant:"Upper Right"},{letter:"F",name:"Central Incisor",quadrant:"Upper Left"},{letter:"G",name:"Lateral Incisor",quadrant:"Upper Left"},{letter:"H",name:"Canine",quadrant:"Upper Left"},{letter:"I",name:"First Molar",quadrant:"Upper Left"},{letter:"J",name:"Second Molar",quadrant:"Upper Left"},{letter:"K",name:"Second Molar",quadrant:"Lower Left"},{letter:"L",name:"First Molar",quadrant:"Lower Left"},{letter:"M",name:"Canine",quadrant:"Lower Left"},{letter:"N",name:"Lateral Incisor",quadrant:"Lower Left"},{letter:"O",name:"Central Incisor",quadrant:"Lower Left"},{letter:"P",name:"Central Incisor",quadrant:"Lower Right"},{letter:"Q",name:"Lateral Incisor",quadrant:"Lower Right"},{letter:"R",name:"Canine",quadrant:"Lower Right"},{letter:"S",name:"First Molar",quadrant:"Lower Right"},{letter:"T",name:"Second Molar",quadrant:"Lower Right"}],x=y=>{const N=y.toString();let R=[...s];if(R.includes(N))R=R.filter(v=>v!==N);else{if(r&&R.length>=r){K.error(`You can only select up to ${r} teeth as specified in the appointment.`);return}R.push(N)}d==="adult"?R.sort((v,S)=>parseInt(v)-parseInt(S)):R.sort(),i(R.join(","))},g=()=>{i("")},p=()=>{let y;d==="adult"?y=h.map(N=>N.number.toString()):y=o.map(N=>N.letter),r&&y.length>r&&(y=y.slice(0,r),K(`Selection limited to ${r} teeth as specified in the appointment.`,{icon:"â„¹ï¸"})),i(y.join(","))},m=y=>{y!==d&&(l(y),i(""))};return a?e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs("h6",{className:"mb-0",children:[e.jsx("i",{className:"bi bi-diagram-3 me-2"}),"Tooth Chart Reference"]}),e.jsxs("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:n,children:[e.jsx("i",{className:"bi bi-x-lg me-1"}),"Hide Chart"]})]}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"text-center mb-3",children:[e.jsx("h6",{className:"text-muted",children:"Universal Numbering System"}),e.jsx("p",{className:"text-muted small mb-0",children:"Click on tooth numbers/letters below to select/deselect"})]}),e.jsx("div",{className:"d-flex justify-content-center mb-4",children:e.jsxs("div",{className:"btn-group",role:"group","aria-label":"Tooth chart tabs",children:[e.jsxs("button",{type:"button",className:`btn ${d==="adult"?"btn-primary":"btn-outline-primary"}`,onClick:()=>m("adult"),children:[e.jsx("i",{className:"bi bi-person me-1"}),"Adult Teeth (1-32)"]}),e.jsxs("button",{type:"button",className:`btn ${d==="primary"?"btn-primary":"btn-outline-primary"}`,onClick:()=>m("primary"),children:[e.jsx("i",{className:"bi bi-person-heart me-1"}),"Primary Teeth (A-T)"]})]})}),e.jsxs("div",{className:"alert alert-info mb-4",children:[e.jsx("i",{className:"bi bi-info-circle me-2"}),e.jsx("strong",{children:"Note:"})," If the teeth done is in letters (A-T), it's primary teeth. If it's in numbers (1-32), it's adult teeth.",r&&e.jsxs("div",{className:"mt-2",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),e.jsx("strong",{children:"Selection Limit:"})," You can select up to ",r," teeth as specified in the appointment."]})]}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-5 mb-3",children:e.jsxs("div",{className:"text-center",children:[e.jsx("img",{src:d==="adult"?mt:ht,alt:d==="adult"?"Adult Dental Chart Reference":"Primary Teeth Chart Reference",className:"img-fluid",style:{maxWidth:"300px",height:"auto",border:"1px solid #dee2e6",borderRadius:"8px",backgroundColor:"#f8f9fa"}}),e.jsx("small",{className:"text-muted d-block mt-2",children:d==="adult"?"Adult Teeth Reference Chart":"Primary Teeth Reference Chart"})]})}),e.jsxs("div",{className:"col-md-7",children:[e.jsx("div",{className:"text-center mb-3",children:e.jsxs("h6",{className:"text-primary",children:[e.jsx("i",{className:"bi bi-mouse me-2"}),"Click to Select Teeth"]})}),d==="adult"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-center mb-3",children:e.jsx("strong",{className:"text-primary",children:"UPPER TEETH (1-16)"})}),e.jsx("div",{className:"d-flex justify-content-center flex-wrap gap-2",children:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16].map(y=>{const N=h.find(R=>R.number===y);return e.jsx("button",{type:"button",className:`btn ${s.includes(y.toString())?"btn-warning":"btn-outline-primary"}`,style:{width:y>=10?"50px":"45px",height:"45px",fontSize:"1rem",fontWeight:"bold",whiteSpace:"nowrap",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>x(y),title:`Tooth ${y}: ${N==null?void 0:N.name}`,children:y},y)})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-center mb-3",children:e.jsx("strong",{className:"text-primary",children:"LOWER TEETH (32-17)"})}),e.jsx("div",{className:"d-flex justify-content-center flex-wrap gap-2",children:[32,31,30,29,28,27,26,25,24,23,22,21,20,19,18,17].map(y=>{const N=h.find(R=>R.number===y);return e.jsx("button",{type:"button",className:`btn ${s.includes(y.toString())?"btn-warning":"btn-outline-primary"}`,style:{width:y>=10?"50px":"45px",height:"45px",fontSize:"1rem",fontWeight:"bold",whiteSpace:"nowrap",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>x(y),title:`Tooth ${y}: ${N==null?void 0:N.name}`,children:y},y)})})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-center mb-3",children:e.jsx("strong",{className:"text-primary",children:"UPPER TEETH (A-J)"})}),e.jsx("div",{className:"d-flex justify-content-center flex-wrap gap-2",children:["A","B","C","D","E","F","G","H","I","J"].map(y=>{const N=o.find(R=>R.letter===y);return e.jsx("button",{type:"button",className:`btn ${s.includes(y)?"btn-warning":"btn-outline-primary"}`,style:{width:"45px",height:"45px",fontSize:"1rem",fontWeight:"bold",whiteSpace:"nowrap",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>x(y),title:`Tooth ${y}: ${N==null?void 0:N.name}`,children:y},y)})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-center mb-3",children:e.jsx("strong",{className:"text-primary",children:"LOWER TEETH (K-T)"})}),e.jsx("div",{className:"d-flex justify-content-center flex-wrap gap-2",children:["K","L","M","N","O","P","Q","R","S","T"].map(y=>{const N=o.find(R=>R.letter===y);return e.jsx("button",{type:"button",className:`btn ${s.includes(y)?"btn-warning":"btn-outline-primary"}`,style:{width:"45px",height:"45px",fontSize:"1rem",fontWeight:"bold",whiteSpace:"nowrap",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>x(y),title:`Tooth ${y}: ${N==null?void 0:N.name}`,children:y},y)})})]})]})]})]}),e.jsxs("div",{className:"d-flex justify-content-center gap-2 mt-3",children:[e.jsxs("button",{type:"button",className:"btn btn-outline-success btn-sm",onClick:p,children:[e.jsx("i",{className:"bi bi-check-all me-1"}),"Select All"]}),e.jsxs("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:g,children:[e.jsx("i",{className:"bi bi-x-lg me-1"}),"Clear All"]})]}),s.length>0&&e.jsx("div",{className:"mt-3 p-3 bg-light rounded border",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[e.jsxs("div",{children:[e.jsx("small",{className:"text-muted d-block",children:"Selected teeth:"}),e.jsx("strong",{className:"text-primary fs-6",children:s.join(", ")})]}),e.jsxs("div",{className:"text-end",children:[e.jsx("small",{className:"text-muted d-block",children:"Total count:"}),e.jsxs("strong",{className:"text-success",children:[s.length," tooth",s.length!==1?"s":""]})]})]})})]})})]}):e.jsx("div",{className:"mb-3",children:e.jsxs("button",{type:"button",className:"btn btn-outline-primary btn-sm",onClick:n,children:[e.jsx("i",{className:"bi bi-diagram-3 me-1"}),"Show Tooth Chart"]})})};function Ul({medicalHistory:s}){if(!s)return e.jsxs("div",{className:"alert alert-info",children:[e.jsx("i",{className:"bi bi-info-circle me-2"}),"Medical history has not been completed for this visit."]});const i=n=>{if(!n)return"N/A";try{return new Date(n).toLocaleDateString()}catch{return n}},a=n=>n==null?"Not specified":n?"Yes":"No";return e.jsxs("div",{className:"medical-history-view",style:{maxHeight:"70vh",overflowY:"auto"},children:[e.jsxs("div",{className:"card mb-3",children:[e.jsx("div",{className:"card-header bg-primary text-white",children:e.jsxs("h6",{className:"mb-0",children:[e.jsx("i",{className:"bi bi-person me-2"}),"Patient Information"]})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Full Name:"})," ",s.full_name||"N/A"]}),e.jsxs("div",{className:"col-md-3 mb-2",children:[e.jsx("strong",{children:"Age:"})," ",s.age||"N/A"]}),e.jsxs("div",{className:"col-md-3 mb-2",children:[e.jsx("strong",{children:"Sex:"})," ",s.sex?s.sex.charAt(0).toUpperCase()+s.sex.slice(1):"N/A"]}),e.jsxs("div",{className:"col-md-12 mb-2",children:[e.jsx("strong",{children:"Address:"})," ",s.address||"N/A"]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Contact Number:"})," ",s.contact_number||"N/A"]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Email:"})," ",s.email||"N/A"]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Occupation:"})," ",s.occupation||"N/A"]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Date of Birth:"})," ",i(s.date_of_birth)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Previous Dentist:"})," ",s.previous_dentist||"N/A"]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Last Dental Visit:"})," ",i(s.last_dental_visit)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Physician Name:"})," ",s.physician_name||"N/A"]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Physician Address:"})," ",s.physician_address||"N/A"]})]})})]}),e.jsxs("div",{className:"card mb-3",children:[e.jsx("div",{className:"card-header bg-info text-white",children:e.jsxs("h6",{className:"mb-0",children:[e.jsx("i",{className:"bi bi-heart-pulse me-2"}),"Health Questions"]})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"In good health:"})," ",a(s.in_good_health)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Under medical treatment:"})," ",a(s.under_medical_treatment)]}),s.under_medical_treatment&&s.medical_treatment_details&&e.jsxs("div",{className:"col-12 mb-2",children:[e.jsx("strong",{children:"Treatment Details:"})," ",s.medical_treatment_details]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Serious illness or surgery:"})," ",a(s.serious_illness_surgery)]}),s.serious_illness_surgery&&s.illness_surgery_details&&e.jsxs("div",{className:"col-12 mb-2",children:[e.jsx("strong",{children:"Illness/Surgery Details:"})," ",s.illness_surgery_details]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Hospitalized:"})," ",a(s.hospitalized)]}),s.hospitalized&&s.hospitalization_details&&e.jsxs("div",{className:"col-12 mb-2",children:[e.jsx("strong",{children:"Hospitalization Details:"})," ",s.hospitalization_details]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Taking medications:"})," ",a(s.taking_medications)]}),s.taking_medications&&s.medications_list&&e.jsxs("div",{className:"col-12 mb-2",children:[e.jsx("strong",{children:"Medications List:"})," ",s.medications_list]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Uses tobacco:"})," ",a(s.uses_tobacco)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Uses alcohol/drugs:"})," ",a(s.uses_alcohol_drugs)]})]})})]}),e.jsxs("div",{className:"card mb-3",children:[e.jsx("div",{className:"card-header bg-warning text-dark",children:e.jsxs("h6",{className:"mb-0",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),"Allergies"]})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Local Anesthetic:"})," ",a(s.allergic_local_anesthetic)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Penicillin:"})," ",a(s.allergic_penicillin)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Sulfa:"})," ",a(s.allergic_sulfa)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Aspirin:"})," ",a(s.allergic_aspirin)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Latex:"})," ",a(s.allergic_latex)]}),s.allergic_others&&e.jsxs("div",{className:"col-12 mb-2",children:[e.jsx("strong",{children:"Other Allergies:"})," ",s.allergic_others]})]})})]}),s.sex==="female"&&e.jsxs("div",{className:"card mb-3",children:[e.jsx("div",{className:"card-header bg-secondary text-white",children:e.jsxs("h6",{className:"mb-0",children:[e.jsx("i",{className:"bi bi-gender-female me-2"}),"For Women Only"]})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-4 mb-2",children:[e.jsx("strong",{children:"Pregnant:"})," ",a(s.is_pregnant)]}),e.jsxs("div",{className:"col-md-4 mb-2",children:[e.jsx("strong",{children:"Nursing:"})," ",a(s.is_nursing)]}),e.jsxs("div",{className:"col-md-4 mb-2",children:[e.jsx("strong",{children:"Taking Birth Control:"})," ",a(s.taking_birth_control)]})]})})]}),e.jsxs("div",{className:"card mb-3",children:[e.jsx("div",{className:"card-header bg-danger text-white",children:e.jsxs("h6",{className:"mb-0",children:[e.jsx("i",{className:"bi bi-heartbeat me-2"}),"Vital Information"]})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-4 mb-2",children:[e.jsx("strong",{children:"Blood Type:"})," ",s.blood_type||"N/A"]}),e.jsxs("div",{className:"col-md-4 mb-2",children:[e.jsx("strong",{children:"Blood Pressure:"})," ",s.blood_pressure||"N/A"]}),e.jsxs("div",{className:"col-md-4 mb-2",children:[e.jsx("strong",{children:"Bleeding Time:"})," ",s.bleeding_time||"N/A"]})]})})]}),e.jsxs("div",{className:"card mb-3",children:[e.jsx("div",{className:"card-header bg-dark text-white",children:e.jsxs("h6",{className:"mb-0",children:[e.jsx("i",{className:"bi bi-file-medical me-2"}),"Medical Conditions"]})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"High Blood Pressure:"})," ",a(s.high_blood_pressure)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Low Blood Pressure:"})," ",a(s.low_blood_pressure)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Heart Disease:"})," ",a(s.heart_disease)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Heart Murmur:"})," ",a(s.heart_murmur)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Chest Pain:"})," ",a(s.chest_pain)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Stroke:"})," ",a(s.stroke)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Diabetes:"})," ",a(s.diabetes)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Hepatitis:"})," ",a(s.hepatitis)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Tuberculosis:"})," ",a(s.tuberculosis)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Kidney Disease:"})," ",a(s.kidney_disease)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Cancer:"})," ",a(s.cancer)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Asthma:"})," ",a(s.asthma)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Anemia:"})," ",a(s.anemia)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Arthritis:"})," ",a(s.arthritis)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Epilepsy:"})," ",a(s.epilepsy)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"AIDS/HIV:"})," ",a(s.aids_hiv)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Stomach Troubles:"})," ",a(s.stomach_troubles)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Thyroid Problems:"})," ",a(s.thyroid_problems)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Hay Fever:"})," ",a(s.hay_fever)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Head Injuries:"})," ",a(s.head_injuries)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Rapid Weight Loss:"})," ",a(s.rapid_weight_loss)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Joint Replacement:"})," ",a(s.joint_replacement)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Radiation Therapy:"})," ",a(s.radiation_therapy)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Swollen Ankles:"})," ",a(s.swollen_ankles)]}),s.other_conditions&&e.jsxs("div",{className:"col-12 mb-2",children:[e.jsx("strong",{children:"Other Conditions:"})," ",s.other_conditions]})]})})]}),s.completed_at&&e.jsx("div",{className:"alert alert-success",children:e.jsxs("small",{children:[e.jsx("i",{className:"bi bi-check-circle me-2"}),"Completed on ",i(s.completed_at),s.completedBy&&` by ${s.completedBy.name||"Staff"}`]})})]})}function Wa(){var T,c;const s=we(),{visitCode:i}=Xs(),[a,n]=t.useState(i||""),[r,d]=t.useState(!1),[l,h]=t.useState(""),[o,x]=t.useState(null),[g,p]=t.useState("notes"),[m,y]=t.useState({dentist_notes:"",findings:"",treatment_plan:"",teeth_treated:""}),[N,R]=t.useState(!1),[v,S]=t.useState(!1),[u,j]=t.useState(null),[b,C]=t.useState(null),[f,D]=t.useState("");t.useEffect(()=>{i&&!o&&!r&&(async()=>{var P,k;d(!0),h("");try{const E=await z.get(`/api/visits/resolve/${i.trim()}`);if(x(E.data),E.data.has_existing_notes){const O=await z.get(`/api/visits/${E.data.visit.id}/dentist-notes`);y({dentist_notes:O.data.dentist_notes||"",findings:O.data.findings||"",treatment_plan:O.data.treatment_plan||"",teeth_treated:O.data.teeth_treated||""})}}catch(E){h(((k=(P=E.response)==null?void 0:P.data)==null?void 0:k.message)||"Failed to resolve visit code"),x(null)}finally{d(!1)}})()},[i]);const L=({id:F,icon:P,label:k})=>e.jsxs("button",{className:`btn flex-fill flex-sm-grow-0 border-0 shadow-sm ${g===F?"":"btn-outline-primary"}`,onClick:()=>p(F),type:"button",style:{background:g===F?"linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)":"transparent",color:g===F?"white":"#3b82f6",border:g===F?"none":"1px solid #3b82f6",borderRadius:"8px",padding:"12px 16px",fontWeight:"600",transition:"all 0.3s ease",minWidth:"140px"},children:[e.jsx("i",{className:`bi bi-${P==="ðŸ“"?"pencil-square":P==="ðŸ¥"?"file-medical":"clock-history"} me-2`}),e.jsx("span",{className:"d-none d-sm-inline",children:k}),e.jsx("span",{className:"d-sm-none",children:k.split(" ")[0]})]}),I=async F=>{var P,k;if(F.preventDefault(),!!a.trim()){d(!0),h("");try{const E=await z.get(`/api/visits/resolve/${a.trim()}`);if(x(E.data),E.data.has_existing_notes){const O=await z.get(`/api/visits/${E.data.visit.id}/dentist-notes`);y({dentist_notes:O.data.dentist_notes||"",findings:O.data.findings||"",treatment_plan:O.data.treatment_plan||"",teeth_treated:O.data.teeth_treated||""})}}catch(E){h(((k=(P=E.response)==null?void 0:P.data)==null?void 0:k.message)||"Failed to resolve visit code"),x(null)}finally{d(!1)}}},w=async()=>{var F,P;if(o){R(!0);try{await z.post(`/api/visits/${o.visit.id}/save-dentist-notes`,m),confirm(`Notes saved successfully!

Do you want to finish this consultation and return to the main page?`)&&(H(),s("/dentist/dashboard"))}catch(k){K.error("Failed to save notes: "+(((P=(F=k.response)==null?void 0:F.data)==null?void 0:P.message)||"Unknown error"))}finally{R(!1)}}},A=async F=>{var P,k;j(F),D("");try{const E=await z.get(`/api/visits/${F}/dentist-notes`);C({visitId:F,...E.data})}catch(E){D(((k=(P=E.response)==null?void 0:P.data)==null?void 0:k.message)||"Failed to fetch visit notes")}finally{j(null)}},_=()=>{C(null),D("")},H=()=>{n(""),x(null),y({dentist_notes:"",findings:"",treatment_plan:"",teeth_treated:""}),h(""),C(null),D(""),S(!1),p("notes")};return e.jsxs("div",{className:"w-100",children:[e.jsx("div",{className:"container-fluid px-4 py-4",children:e.jsx("div",{className:"row",children:e.jsxs("div",{className:"col-12",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsx("h2",{children:"ðŸ¦· Dentist Visit Manager"}),e.jsxs("button",{className:"btn btn-outline-secondary",onClick:()=>s("/dentist/dashboard"),children:[e.jsx("i",{className:"bi bi-arrow-left me-2"}),"Back to Dashboard"]})]}),e.jsxs("div",{className:"card border-0 shadow-lg",style:{borderRadius:"16px"},children:[e.jsxs("div",{className:"card-header bg-primary text-white border-0",style:{borderRadius:"16px 16px 0 0"},children:[e.jsxs("h4",{className:"card-title mb-0 fw-bold",children:[e.jsx("i",{className:"bi bi-key me-2"}),"Dentist Visit Code"]}),e.jsx("p",{className:"mb-0 mt-2 opacity-75",children:"Enter visit code to access patient information and notes"})]}),e.jsx("div",{className:"card-body p-4",children:o?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"alert alert-info",children:[e.jsx("h5",{children:"Patient Information"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," ",o.patient.first_name," ",o.patient.last_name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Contact:"})," ",o.patient.contact_number||"Not provided"]}),o.service&&e.jsxs("p",{children:[e.jsx("strong",{children:"Service:"})," ",o.service.name]}),o.appointment&&o.appointment.teeth_count&&e.jsxs("p",{children:[e.jsx("strong",{children:"Number of Teeth to be Treated:"})," ",o.appointment.teeth_count]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Visit Date:"})," ",new Date(o.visit.visit_date).toLocaleDateString()]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Consultation Started:"})," ",new Date(o.visit.consultation_started_at).toLocaleString()]})]}),e.jsxs("div",{className:"d-flex flex-column flex-sm-row gap-2 mb-4",role:"group","aria-label":"Visit tabs",children:[e.jsx(L,{id:"notes",icon:"ðŸ“",label:"Enter Notes"}),e.jsx(L,{id:"medical-history",icon:"ðŸ¥",label:"Medical History"}),e.jsx(L,{id:"history",icon:"ðŸ“‹",label:"Patient History"})]}),e.jsxs("div",{className:"tab-content",children:[g==="notes"&&e.jsxs("div",{className:"tab-pane fade show active",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{children:"Dentist Notes"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"dentistNotes",className:"form-label",children:"Dentist Notes"}),e.jsx("textarea",{className:"form-control",id:"dentistNotes",rows:"4",value:m.dentist_notes,onChange:F=>y({...m,dentist_notes:F.target.value}),placeholder:"Enter consultation notes..."})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"findings",className:"form-label",children:"Findings"}),e.jsx("textarea",{className:"form-control",id:"findings",rows:"3",value:m.findings,onChange:F=>y({...m,findings:F.target.value}),placeholder:"Enter clinical findings..."})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"treatmentPlan",className:"form-label",children:"Treatment Plan"}),e.jsx("textarea",{className:"form-control",id:"treatmentPlan",rows:"3",value:m.treatment_plan,onChange:F=>y({...m,treatment_plan:F.target.value}),placeholder:"Enter treatment plan..."})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"teethTreated",className:"form-label",children:"Teeth Treated"}),e.jsx("input",{type:"text",className:"form-control",id:"teethTreated",value:m.teeth_treated,onChange:F=>y({...m,teeth_treated:F.target.value}),placeholder:"e.g., 1,2,3,4,5 or leave blank if not applicable"}),e.jsx("div",{className:"form-text",children:"Enter tooth numbers separated by commas (e.g., 1,2,3,4,5) or use the interactive tooth chart below for visual selection."}),e.jsx(Ol,{selectedTeeth:m.teeth_treated?m.teeth_treated.split(",").map(F=>F.trim()):[],onTeethChange:F=>y({...m,teeth_treated:F}),showChart:v,onToggleChart:()=>S(!v),maxSelection:((T=o.appointment)==null?void 0:T.teeth_count)||null})]})]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx("button",{className:"btn btn-success",onClick:w,disabled:N,children:N?"Saving...":"Save Notes"}),e.jsx("button",{className:"btn btn-secondary",onClick:H,children:"New Code"})]})]}),g==="medical-history"&&e.jsx("div",{className:"tab-pane fade show active",children:e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{children:"Medical and Dental History"}),e.jsx(Ul,{medicalHistory:o.medical_history})]})}),g==="history"&&e.jsx("div",{className:"tab-pane fade show active",children:o.patient_history&&o.patient_history.length>0?e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{children:"Complete Visit History"}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Service"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Teeth Treated"}),e.jsx("th",{children:"Notes"})]})}),e.jsx("tbody",{children:o.patient_history.map(F=>e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("strong",{children:new Date(F.visit_date).toLocaleDateString()}),e.jsx("br",{}),e.jsx("small",{className:"text-muted",children:new Date(F.visit_date).toLocaleDateString("en-US",{weekday:"long"})})]}),e.jsx("td",{children:e.jsx("span",{className:"badge bg-primary",children:F.service_name||"Not specified"})}),e.jsx("td",{children:e.jsx("span",{className:`badge ${F.status==="completed"?"bg-success":F.status==="pending"?"bg-warning":"bg-secondary"}`,children:F.status})}),e.jsx("td",{children:F.teeth_treated?e.jsxs("div",{children:[e.jsx("span",{className:"badge bg-info",children:F.teeth_treated}),e.jsx("br",{}),e.jsxs("small",{className:"text-muted",children:[F.teeth_treated.split(",").length," tooth",F.teeth_treated.split(",").length!==1?"s":""]})]}):e.jsx("span",{className:"text-muted",children:"-"})}),e.jsx("td",{children:F.has_notes?e.jsxs("div",{className:"d-flex gap-2 align-items-center",children:[e.jsx("span",{className:"badge bg-success",children:"Has Notes"}),e.jsx("button",{className:"btn btn-sm btn-outline-primary",onClick:()=>A(F.id),disabled:u===F.id,children:u===F.id?e.jsx("span",{className:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-eye me-1"}),"View Notes"]})})]}):e.jsx("span",{className:"badge bg-secondary",children:"No Notes"})})]},F.id))})]})})]}):e.jsxs("div",{className:"alert alert-warning",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),"No previous visit history found for this patient."]})})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("form",{onSubmit:I,children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"visitCode",className:"form-label",children:"Enter Visit Code"}),e.jsx("input",{type:"text",className:"form-control form-control-lg text-center",id:"visitCode",value:a,onChange:F=>n(F.target.value.toUpperCase()),placeholder:"Enter 6-character code",maxLength:"10",disabled:r})]}),e.jsx("div",{className:"d-grid",children:e.jsx("button",{type:"submit",className:"btn btn-primary btn-lg",disabled:r||!a.trim(),children:r?e.jsx(Pe,{message:"Resolving..."}):"Start Consultation"})})]}),l&&e.jsx("div",{className:"alert alert-danger mt-3",children:l})]})})]})]})})}),b&&e.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:1050,overflowY:"auto",display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem"},children:e.jsx("div",{className:"modal-dialog modal-lg",style:{margin:"0 auto",maxHeight:"calc(100vh - 2rem)",width:"100%"},children:e.jsxs("div",{className:"modal-content",style:{display:"flex",flexDirection:"column",maxHeight:"calc(100vh - 2rem)",overflow:"hidden"},children:[e.jsxs("div",{className:"modal-header flex-shrink-0",style:{position:"sticky",top:0,zIndex:1,backgroundColor:"#fff",borderBottom:"1px solid #dee2e6"},children:[e.jsxs("h5",{className:"modal-title",children:[e.jsx("i",{className:"bi bi-file-text me-2"}),"Visit Notes - ",new Date((c=o.patient_history.find(F=>F.id===b.visitId))==null?void 0:c.visit_date).toLocaleDateString()]}),e.jsx("button",{type:"button",className:"btn-close",onClick:_})]}),e.jsxs("div",{className:"modal-body flex-grow-1",style:{overflowY:"auto",overflowX:"hidden",flex:"1 1 auto",minHeight:0},children:[b.dentist_notes&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("h6",{className:"text-primary",children:[e.jsx("i",{className:"bi bi-sticky me-2"}),"Dentist Notes"]}),e.jsx("div",{className:"bg-light p-3 rounded border",children:e.jsx("p",{className:"mb-0",style:{whiteSpace:"pre-wrap"},children:b.dentist_notes})})]}),b.findings&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("h6",{className:"text-success",children:[e.jsx("i",{className:"bi bi-search me-2"}),"Clinical Findings"]}),e.jsx("div",{className:"bg-light p-3 rounded border",children:e.jsx("p",{className:"mb-0",style:{whiteSpace:"pre-wrap"},children:b.findings})})]}),b.treatment_plan&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("h6",{className:"text-info",children:[e.jsx("i",{className:"bi bi-clipboard-check me-2"}),"Treatment Plan"]}),e.jsx("div",{className:"bg-light p-3 rounded border",children:e.jsx("p",{className:"mb-0",style:{whiteSpace:"pre-wrap"},children:b.treatment_plan})})]}),b.teeth_treated&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("h6",{className:"text-warning",children:[e.jsx("i",{className:"bi bi-tooth me-2"}),"Teeth Treated"]}),e.jsx("div",{className:"bg-light p-3 rounded border",children:e.jsx("p",{className:"mb-0",children:b.teeth_treated})})]}),b.created_by&&e.jsxs("div",{className:"text-muted small border-top pt-3",children:[e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Created by:"})," ",b.created_by]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Created at:"})," ",new Date(b.created_at).toLocaleString()]}),b.updated_by&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Last updated by:"})," ",b.updated_by]}),e.jsxs("p",{className:"mb-0",children:[e.jsx("strong",{children:"Last updated at:"})," ",new Date(b.updated_at).toLocaleString()]})]})]}),!b.dentist_notes&&!b.findings&&!b.treatment_plan&&!b.teeth_treated&&e.jsxs("div",{className:"text-center py-4",children:[e.jsx("i",{className:"bi bi-file-text fs-1 text-muted"}),e.jsx("p",{className:"mt-2 text-muted",children:"No detailed notes available for this visit."})]})]}),e.jsx("div",{className:"modal-footer flex-shrink-0",style:{position:"sticky",bottom:0,zIndex:1,backgroundColor:"#fff",borderTop:"1px solid #dee2e6"},children:e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:_,children:"Close"})})]})})}),f&&e.jsxs("div",{className:"alert alert-danger mt-3",role:"alert",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),f]})]})}function ql(){const[s,i]=t.useState("calendar"),a=({id:n,icon:r,label:d})=>e.jsxs("button",{className:`btn flex-fill flex-sm-grow-0 border-0 shadow-sm ${s===n?"":"btn-outline-primary"}`,onClick:()=>i(n),type:"button",style:{background:s===n?"linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)":"transparent",color:s===n?"white":"#3b82f6",border:s===n?"none":"1px solid #3b82f6",borderRadius:"8px",padding:"12px 16px",fontWeight:"600",transition:"all 0.3s ease",minWidth:"140px"},children:[e.jsx("i",{className:`bi bi-${r==="ðŸ“…"?"calendar":r==="ðŸ”"?"arrow-repeat":"bar-chart"} me-2`}),e.jsx("span",{className:"d-none d-sm-inline",children:d}),e.jsx("span",{className:"d-sm-none",children:d.split(" ")[0]})]});return e.jsx("div",{className:"schedule-manager-page",style:{background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",minHeight:"100vh",padding:"2rem 0"},children:e.jsxs("div",{className:"container-fluid px-4",children:[e.jsx("div",{className:"row mb-4",children:e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"d-flex justify-content-between align-items-center",children:e.jsxs("div",{children:[e.jsxs("h2",{className:"h3 mb-1 fw-bold text-dark",children:[e.jsx("i",{className:"bi bi-calendar-check me-2 text-primary"}),"Clinic Schedule"]}),e.jsx("p",{className:"text-muted mb-0",children:"View clinic operating hours and capacity settings"})]})})})}),e.jsx("div",{className:"row mb-4",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"d-flex flex-column flex-sm-row gap-2",children:[e.jsx(a,{id:"calendar",icon:"ðŸ“…",label:"Calendar Overrides"}),e.jsx(a,{id:"weekly",icon:"ðŸ”",label:"Weekly Defaults"}),e.jsx(a,{id:"capacity",icon:"ðŸ“Š",label:"Capacity (14 days)"})]})})}),e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"card border-0 shadow-lg",style:{borderRadius:"16px"},children:e.jsxs("div",{className:"card-body p-4",children:[s==="calendar"&&e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex align-items-center mb-4",children:[e.jsx("div",{className:"bg-primary rounded-circle me-3 d-flex align-items-center justify-content-center",style:{width:"48px",height:"48px"},children:e.jsx("i",{className:"bi bi-calendar text-white fs-5"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"mb-1 fw-bold text-dark",children:"Calendar Overrides"}),e.jsx("p",{className:"text-muted mb-0",children:"Manage specific date exceptions and holidays"})]})]}),e.jsx(wa,{})]}),s==="weekly"&&e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex align-items-center mb-4",children:[e.jsx("div",{className:"bg-success rounded-circle me-3 d-flex align-items-center justify-content-center",style:{width:"48px",height:"48px"},children:e.jsx("i",{className:"bi bi-arrow-repeat text-white fs-5"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"mb-1 fw-bold text-dark",children:"Weekly Defaults"}),e.jsx("p",{className:"text-muted mb-0",children:"Set regular operating hours for each day of the week"})]})]}),e.jsx(rt,{})]}),s==="capacity"&&e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex align-items-center mb-4",children:[e.jsx("div",{className:"bg-info rounded-circle me-3 d-flex align-items-center justify-content-center",style:{width:"48px",height:"48px"},children:e.jsx("i",{className:"bi bi-bar-chart text-white fs-5"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"mb-1 fw-bold text-dark",children:"Capacity Planner"}),e.jsx("p",{className:"text-muted mb-0",children:"Adjust appointment capacity for the next 14 days"})]})]}),e.jsx(ct,{})]})]})})})})]})})}function Yl(){const{items:s,loading:i,error:a,loadList:n}=Ga(),r=we();t.useEffect(()=>{s.length===0&&n()},[s.length,n]);const d=h=>{var o,x,g,p,m;return(o=h.title)!=null&&o.toLowerCase().includes("appointment")?"bi-calendar-check":(x=h.title)!=null&&x.toLowerCase().includes("payment")?"bi-credit-card":(g=h.title)!=null&&g.toLowerCase().includes("reminder")?"bi-bell":(p=h.title)!=null&&p.toLowerCase().includes("update")?"bi-arrow-clockwise":(m=h.title)!=null&&m.toLowerCase().includes("welcome")?"bi-person-plus":"bi-info-circle"},l=h=>{if(!h)return"";const o=new Date,x=new Date(h),g=Math.floor((o-x)/1e3);return g<60?"Just now":g<3600?`${Math.floor(g/60)}m ago`:g<86400?`${Math.floor(g/3600)}h ago`:g<604800?`${Math.floor(g/86400)}d ago`:`${Math.floor(g/86400)}d ago`};return e.jsxs("div",{className:"notifications-page",children:[e.jsx("div",{className:"notifications-header",children:e.jsxs("div",{className:"d-flex align-items-center mb-4",children:[e.jsxs("button",{onClick:()=>r(-1),className:"btn btn-outline-secondary btn-sm d-flex align-items-center me-3 notifications-back-btn",title:"Go back","aria-label":"Go back",children:[e.jsx("i",{className:"bi bi-arrow-left me-2"}),"Back"]}),e.jsxs("div",{className:"notifications-title-section",children:[e.jsx("h2",{className:"notifications-title mb-1",children:"All Notifications"}),e.jsx("p",{className:"notifications-subtitle mb-0",children:s.length>0?`${s.length} notification${s.length===1?"":"s"}`:"No notifications yet"})]})]})}),e.jsxs("div",{className:"notifications-content",children:[i&&e.jsx("div",{className:"notifications-loading",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-center py-5",children:[e.jsx("div",{className:"spinner-border text-primary me-3",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("span",{className:"text-muted",children:"Loading notifications..."})]})}),a&&e.jsx("div",{className:"notifications-error",children:e.jsxs("div",{className:"alert alert-danger d-flex align-items-center",role:"alert",children:[e.jsx("i",{className:"bi bi-exclamation-triangle-fill me-3"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Error loading notifications"}),e.jsx("div",{className:"small",children:a})]})]})}),!i&&!a&&s.length===0&&e.jsx("div",{className:"notifications-empty",children:e.jsxs("div",{className:"text-center py-5",children:[e.jsx("div",{className:"notifications-empty-icon mb-4",children:e.jsx("i",{className:"bi bi-bell"})}),e.jsx("h4",{className:"notifications-empty-title mb-3",children:"No notifications yet"}),e.jsx("p",{className:"notifications-empty-description text-muted mb-4",children:"You'll see important updates, reminders, and announcements here when they arrive."}),e.jsxs("button",{className:"btn btn-primary",onClick:()=>n(),children:[e.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"Refresh"]})]})}),!i&&!a&&s.length>0&&e.jsx("div",{className:"notifications-list",children:s.map((h,o)=>{var x;return e.jsxs("div",{className:"notification-item",children:[e.jsx("div",{className:"notification-icon",children:e.jsx("i",{className:`bi ${d(h)}`})}),e.jsxs("div",{className:"notification-content",children:[e.jsxs("div",{className:"notification-header",children:[e.jsx("h6",{className:"notification-title mb-1",children:h.title||"Notification"}),e.jsx("small",{className:"notification-time text-muted",children:l(h.created_at)})]}),h.body&&e.jsx("p",{className:"notification-body mb-2",children:h.body}),((x=h.data)==null?void 0:x.date)&&e.jsx("div",{className:"notification-meta",children:e.jsxs("small",{className:"text-muted",children:[e.jsx("i",{className:"bi bi-calendar3 me-1"}),h.data.date]})})]})]},h.id)})})]}),!i&&!a&&s.length>0&&e.jsx("div",{className:"notifications-footer",children:e.jsx("div",{className:"text-center",children:e.jsxs("button",{className:"btn btn-outline-primary btn-sm",onClick:()=>n(),children:[e.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"Refresh Notifications"]})})})]})}function ma({to:s="/patient"}){const i=we();return t.useEffect(()=>{i(s,{replace:!0})},[i,s]),null}const Kl=t.lazy(()=>Ae(()=>import("./DentistScheduleManager-Cpl80tkl.js"),__vite__mapDeps([11,1,2,3,4,5,6,7,8]))),Gl=t.lazy(()=>Ae(()=>import("./StaffAppointmentManager-g1NktoFh.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),Xl=t.lazy(()=>Ae(()=>import("./AppointmentFinder-De2lxLRl.js"),__vite__mapDeps([9,1,2,3,4,5,6,7,8]))),Ql=t.lazy(()=>Ae(()=>import("./VisitTrackerManager-q-rrklrr.js"),__vite__mapDeps([10,1,2,3,4,5,6,7,8])));function Jl(){return e.jsxs(ft,{basename:"/",children:[e.jsx(Lt,{})," ",e.jsxs(gt,{children:[e.jsx(Z,{path:"/",element:e.jsx(zt,{})}),e.jsx(Z,{path:"/login",element:e.jsx(Yt,{})}),e.jsx(Z,{path:"/register",element:e.jsx(Kt,{})}),e.jsx(Z,{path:"/forgot-password",element:e.jsx(Gt,{})}),e.jsx(Z,{path:"/password-reset/:token",element:e.jsx(Xt,{})}),e.jsx(Z,{path:"/verify-email",element:e.jsx(Qt,{})}),e.jsx(Z,{path:"/verify-success",element:e.jsx(Jt,{})}),e.jsx(Z,{path:"/verify-email/:id/:hash",element:e.jsx(Zt,{})}),e.jsx(Z,{path:"/notifications",element:e.jsx(Yl,{})}),e.jsxs(Z,{path:"/admin",element:e.jsx(si,{}),children:[e.jsx(Z,{index:!0,element:e.jsx(wi,{})}),e.jsx(Z,{path:"devices",element:e.jsx(ki,{})}),e.jsx(Z,{path:"staff-register",element:e.jsx(Ci,{})}),e.jsx(Z,{path:"profile",element:e.jsx(Ri,{})}),e.jsx(Z,{path:"services",element:e.jsx(Di,{})}),e.jsx(Z,{path:"service-discounts",element:e.jsx(Li,{})}),e.jsx(Z,{path:"promo-archive",element:e.jsx(zi,{})}),e.jsx(Z,{path:"schedule",element:e.jsx($i,{})}),e.jsx(Z,{path:"clinic-calendar",element:e.jsx(wa,{})}),e.jsx(Z,{path:"monthly-report",element:e.jsx(Ii,{})}),e.jsx(Z,{path:"analytics",element:e.jsx(Ki,{})}),e.jsx(Z,{path:"goals",element:e.jsx(Wi,{})}),e.jsx(Z,{path:"dentists",element:e.jsx(t.Suspense,{fallback:e.jsx("div",{children:"Loadingâ€¦"}),children:e.jsx(Kl,{})})}),e.jsx(Z,{path:"dentist-performance",element:e.jsx(Gi,{})}),e.jsx(Z,{path:"inventory",element:e.jsx(na,{allow:({user:s})=>(s==null?void 0:s.role)==="admin",to:"/admin",children:e.jsx(Ma,{})})}),e.jsx(Z,{path:"appointments",element:e.jsx(ml,{})}),e.jsx(Z,{path:"patient-manager",element:e.jsx(Xi,{})}),e.jsx(Z,{path:"payment-records",element:e.jsx(Ji,{})}),e.jsx(Z,{path:"backup-restore",element:e.jsx(Hi,{})}),e.jsx(Z,{path:"system-logs",element:e.jsx(Bi,{})}),e.jsx(Z,{path:"time-blocks",element:e.jsx(Qi,{})}),e.jsx(Z,{path:"patient-binding",element:e.jsx(Zi,{})}),e.jsx(Z,{path:"refund-requests",element:e.jsx(Ea,{})}),e.jsx(Z,{path:"refund-settings",element:e.jsx(el,{})}),e.jsx(Z,{path:"policy-settings",element:e.jsx(sl,{})}),e.jsx(Z,{path:"archived-patients",element:e.jsx(tl,{})})]}),e.jsxs(Z,{path:"/staff",element:e.jsx(il,{}),children:[e.jsx(Z,{index:!0,element:e.jsx(ll,{})}),e.jsx(Z,{path:"profile",element:e.jsx(nl,{})}),e.jsx(Z,{path:"appointments",element:e.jsx(t.Suspense,{fallback:e.jsx("div",{children:"Loading appointments..."}),children:e.jsx(Gl,{})})}),e.jsx(Z,{path:"appointment-finder",element:e.jsx(t.Suspense,{fallback:e.jsx("div",{children:"Loading appointment finder..."}),children:e.jsx(Xl,{})})}),e.jsx(Z,{path:"appointment-reminders",element:e.jsx(ot,{})}),e.jsx(Z,{path:"payment-records",element:e.jsx(ul,{})}),e.jsx(Z,{path:"refund-requests",element:e.jsx(Ea,{})}),e.jsx(Z,{path:"patient-binding",element:e.jsx(pl,{})}),e.jsx(Z,{path:"visit-tracker",element:e.jsx(t.Suspense,{fallback:e.jsx("div",{children:"Loading visit tracker..."}),children:e.jsx(Ql,{})})}),e.jsx(Z,{path:"inventory",element:e.jsx(na,{allow:Ut,to:"/staff",children:e.jsx(Ma,{})})}),e.jsx(Z,{path:"visits/:id/consume",element:e.jsx(na,{allow:({user:s,settings:i})=>qt({user:s,settings:i,visitFinished:!0}),to:"/staff",children:e.jsx(xl,{})})})]}),e.jsxs(Z,{path:"/patient",element:e.jsx(gl,{}),children:[e.jsx(Z,{index:!0,element:e.jsx(jl,{})}),e.jsx(Z,{path:"appointment",element:e.jsx(Cl,{})}),e.jsx(Z,{path:"profile",element:e.jsx(Ll,{})}),e.jsx(Z,{path:"appointments",element:e.jsx(El,{})})]}),e.jsxs(Z,{path:"/dentist",element:e.jsx(Il,{}),children:[e.jsx(Z,{index:!0,element:e.jsx(Wl,{})}),e.jsx(Z,{path:"dashboard",element:e.jsx(Hl,{})}),e.jsx(Z,{path:"profile",element:e.jsx(Bl,{})}),e.jsx(Z,{path:"schedule",element:e.jsx(Vl,{})}),e.jsx(Z,{path:"visit-manager",element:e.jsx(Wa,{})}),e.jsx(Z,{path:"visit/:visitCode",element:e.jsx(Wa,{})}),e.jsx(Z,{path:"schedule-view",element:e.jsx(ql,{})})]}),e.jsx(Z,{path:"/pay/success",element:e.jsx(ma,{to:"/patient"})}),e.jsx(Z,{path:"/pay/failure",element:e.jsx(ma,{to:"/patient"})}),e.jsx(Z,{path:"/pay/cancel",element:e.jsx(ma,{to:"/patient"})}),e.jsx(Z,{path:"*",element:e.jsx(ei,{})})]})]})}function Zl(){const{authLoading:s}=Ce();return t.useEffect(()=>{Ts()},[]),s?e.jsx(Pe,{message:"Checking session..."}):e.jsx(Jl,{})}typeof K.warning!="function"&&(K.warning=(s,i)=>K(s,{icon:"âš ï¸",duration:5e3,...typeof i=="object"?i:{}}));const Ba=document.getElementById("root");Ba?(console.log("React app starting..."),jt.createRoot(Ba).render(e.jsx(t.StrictMode,{children:e.jsx(Mt,{children:e.jsx(Pt,{children:e.jsx(At,{children:e.jsx(Dt,{children:e.jsx(Zl,{})})})})})})),console.log("React app rendered successfully")):console.error("Root element not found! Make sure there's a <div id='root'></div> in index.html");export{Pe as L,z as a};
