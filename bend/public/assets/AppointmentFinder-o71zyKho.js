import{r as i,j as e}from"./react-vendor-D3yaKSZ_.js";import{a as v,L}from"./index-BuQRZoiN.js";import"./chart-vendor-BsnJAHr2.js";import"./bootstrap-vendor-CM53U_Of.js";import"./vendor-axios-ngrFHoWO.js";import"./pdf-vendor-BZobkf7J.js";import"./vendor-utils-DLELI0UM.js";import"./excel-vendor-6kUf8nhb.js";function $(){const[r,p]=i.useState(""),[m,o]=i.useState([]),[u,h]=i.useState([]),[x,n]=i.useState(!1),[a,b]=i.useState(null),[N,d]=i.useState(!1),[g,l]=i.useState(""),c=i.useRef(null);i.useEffect(()=>(c.current&&clearTimeout(c.current),r.length>=2?c.current=setTimeout(()=>{y()},300):(o([]),d(!1),b(null),h([])),()=>{c.current&&clearTimeout(c.current)}),[r]);const y=async()=>{n(!0),l("");try{const s=await v.get(`/api/patients/search?q=${encodeURIComponent(r)}`);o(s.data),d(!0)}catch(s){console.error("Search failed:",s),l("Failed to search patients. Please try again.")}finally{n(!1)}},w=async s=>{b(s),d(!1),n(!0),l("");try{const j=(await v.get("/api/appointments",{params:{patient_id:s.id,status:"approved"}})).data.filter(f=>f.patient_id===s.id&&f.status==="approved");h(j)}catch(t){console.error("Failed to fetch appointments:",t),l("Failed to fetch appointments. Please try again.")}finally{n(!1)}},S=s=>new Date(s).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),_=s=>{if(!s)return"";const[t,j]=s.split("-");return`${t} - ${j}`},A=s=>{switch(s){case"approved":return"badge bg-success";case"pending":return"badge bg-warning";case"completed":return"badge bg-info";case"cancelled":return"badge bg-secondary";case"rejected":return"badge bg-danger";default:return"badge bg-secondary"}},C=()=>{p(""),o([]),h([]),b(null),d(!1),l("")};return e.jsx("div",{className:"container-fluid px-4 py-4",children:e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"bg-white rounded-3 shadow-sm p-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"h3 fw-bold mb-1",style:{color:"#1e293b"},children:[e.jsx("i",{className:"bi bi-search me-2"}),"Appointment Finder"]}),e.jsx("p",{className:"text-muted mb-0",children:"Search for patient appointments by name to find reference codes"})]}),a&&e.jsxs("button",{className:"btn btn-outline-secondary",onClick:C,children:[e.jsx("i",{className:"bi bi-arrow-left me-1"}),"New Search"]})]}),!a&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"position-relative",children:[e.jsx("input",{type:"text",className:"form-control form-control-lg",placeholder:"Type patient name (minimum 2 letters)...",value:r,onChange:s=>p(s.target.value),style:{paddingLeft:"3rem",border:"2px solid #e2e8f0",borderRadius:"12px",fontSize:"1.1rem"}}),e.jsx("i",{className:"bi bi-search position-absolute",style:{left:"1rem",top:"50%",transform:"translateY(-50%)",color:"#6b7280",fontSize:"1.2rem"}}),x&&e.jsx("div",{className:"position-absolute",style:{right:"1rem",top:"50%",transform:"translateY(-50%)"},children:e.jsx(L,{size:"sm"})})]}),r.length>0&&r.length<2&&e.jsx("div",{className:"mt-2",children:e.jsxs("small",{className:"text-warning",children:[e.jsx("i",{className:"bi bi-info-circle me-1"}),"Please type at least 2 letters to search"]})}),N&&m.length>0&&e.jsx("div",{className:"position-absolute bg-white border rounded-3 shadow-lg mt-1",style:{width:"100%",maxHeight:"300px",overflowY:"auto",zIndex:1e3},children:m.map(s=>e.jsx("div",{className:"p-3 border-bottom cursor-pointer",onClick:()=>w(s),style:{cursor:"pointer",transition:"background-color 0.2s"},onMouseEnter:t=>t.target.style.backgroundColor="#f8fafc",onMouseLeave:t=>t.target.style.backgroundColor="transparent",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsxs("h6",{className:"mb-1 fw-semibold",children:[s.first_name," ",s.last_name,s.middle_name&&` ${s.middle_name}`]}),e.jsxs("small",{className:"text-muted",children:[s.contact_number&&e.jsxs("span",{className:"me-3",children:[e.jsx("i",{className:"bi bi-telephone me-1"}),s.contact_number]}),s.birthdate&&e.jsxs("span",{children:[e.jsx("i",{className:"bi bi-calendar me-1"}),new Date(s.birthdate).toLocaleDateString()]})]})]}),e.jsx("i",{className:"bi bi-chevron-right text-muted"})]})},s.id))}),N&&m.length===0&&r.length>=2&&e.jsx("div",{className:"mt-3 p-3 bg-light rounded-3",children:e.jsxs("div",{className:"text-center",children:[e.jsx("i",{className:"bi bi-person-x display-4 text-muted mb-2"}),e.jsxs("p",{className:"text-muted mb-0",children:['No patients found matching "',r,'"']})]})})]}),g&&e.jsxs("div",{className:"alert alert-danger d-flex align-items-center",role:"alert",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),g]}),a&&e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"bg-light rounded-3 p-3",children:[e.jsxs("h5",{className:"fw-semibold mb-2",children:[e.jsx("i",{className:"bi bi-person-circle me-2"}),"Selected Patient"]}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Name:"})," ",a.first_name," ",a.last_name,a.middle_name&&` ${a.middle_name}`]}),a.contact_number&&e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Contact:"})," ",a.contact_number]})]}),e.jsxs("div",{className:"col-md-6",children:[a.birthdate&&e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Birthdate:"})," ",new Date(a.birthdate).toLocaleDateString()]}),a.sex&&e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Sex:"})," ",a.sex.charAt(0).toUpperCase()+a.sex.slice(1)]})]})]})]})}),a&&e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex align-items-center mb-3",children:[e.jsxs("h5",{className:"fw-semibold mb-0",children:[e.jsx("i",{className:"bi bi-calendar-check me-2"}),"Approved Appointments"]}),x&&e.jsxs("div",{className:"d-flex align-items-center text-muted ms-3",children:[e.jsx("div",{className:"spinner-border spinner-border-sm me-2",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("small",{children:"Loading appointments..."})]})]}),u.length===0&&!x?e.jsxs("div",{className:"text-center py-5",children:[e.jsx("i",{className:"bi bi-calendar-x display-1 text-muted mb-3"}),e.jsx("h4",{className:"fw-normal text-muted",children:"No Approved Appointments"}),e.jsx("p",{className:"text-muted",children:"This patient has no approved appointments or all appointments are still pending."})]}):e.jsx("div",{className:"row g-3",children:u.map(s=>{var t;return e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"card border-0 shadow-sm",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row align-items-center",children:[e.jsxs("div",{className:"col-md-8",children:[e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx("h6",{className:"fw-semibold mb-0 me-3",children:((t=s.service)==null?void 0:t.name)||"Service"}),e.jsx("span",{className:A(s.status),children:s.status.charAt(0).toUpperCase()+s.status.slice(1)})]}),e.jsxs("div",{className:"row text-muted small",children:[e.jsxs("div",{className:"col-sm-6",children:[e.jsxs("p",{className:"mb-1",children:[e.jsx("i",{className:"bi bi-calendar me-1"}),e.jsx("strong",{children:"Date:"})," ",S(s.date)]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("i",{className:"bi bi-clock me-1"}),e.jsx("strong",{children:"Time:"})," ",_(s.time_slot)]})]}),e.jsxs("div",{className:"col-sm-6",children:[e.jsxs("p",{className:"mb-1",children:[e.jsx("i",{className:"bi bi-currency-dollar me-1"}),e.jsx("strong",{children:"Payment:"})," ",s.payment_method.charAt(0).toUpperCase()+s.payment_method.slice(1)]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("i",{className:"bi bi-calendar-plus me-1"}),e.jsx("strong",{children:"Booked:"})," ",new Date(s.created_at).toLocaleDateString()]})]})]})]}),e.jsxs("div",{className:"col-md-4 text-md-end",children:[e.jsxs("div",{className:"bg-primary text-white rounded-3 p-3 text-center",children:[e.jsx("div",{className:"small mb-1",children:"Reference Code"}),e.jsx("div",{className:"h5 fw-bold mb-0 font-monospace",children:s.reference_code||"N/A"})]}),s.teeth_count&&e.jsx("div",{className:"mt-2",children:e.jsxs("span",{className:"badge bg-info",children:[e.jsx("i",{className:"bi bi-tooth me-1"}),s.teeth_count," tooth",s.teeth_count>1?"s":""]})})]})]})})})},s.id)})})]}),!a&&r.length===0&&e.jsxs("div",{className:"text-center py-5",children:[e.jsx("i",{className:"bi bi-search display-1 text-muted mb-3"}),e.jsx("h4",{className:"fw-normal text-muted",children:"Find Patient Appointments"}),e.jsx("p",{className:"text-muted",children:"Type a patient's name to search for their approved appointments and reference codes."}),e.jsx("div",{className:"mt-4",children:e.jsx("div",{className:"row justify-content-center",children:e.jsx("div",{className:"col-md-8",children:e.jsxs("div",{className:"bg-light rounded-3 p-3",children:[e.jsxs("h6",{className:"fw-semibold mb-2",children:[e.jsx("i",{className:"bi bi-info-circle me-2"}),"How it works:"]}),e.jsxs("ul",{className:"list-unstyled mb-0 text-start",children:[e.jsxs("li",{className:"mb-1",children:[e.jsx("i",{className:"bi bi-1-circle text-primary me-2"}),"Type at least 2 letters of the patient's name"]}),e.jsxs("li",{className:"mb-1",children:[e.jsx("i",{className:"bi bi-2-circle text-primary me-2"}),"Select the correct patient from the search results"]}),e.jsxs("li",{className:"mb-0",children:[e.jsx("i",{className:"bi bi-3-circle text-primary me-2"}),"View their approved appointments and reference codes"]})]})]})})})})]})]})})})})}export{$ as default};
