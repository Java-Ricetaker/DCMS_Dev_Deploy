import{r,j as e}from"./react-vendor-D3yaKSZ_.js";import{a as g}from"./index-D5dIKIqo.js";import"./chart-vendor-BsnJAHr2.js";import"./bootstrap-vendor-CM53U_Of.js";import"./vendor-axios-ngrFHoWO.js";import"./pdf-vendor-BZobkf7J.js";import"./vendor-utils-DLELI0UM.js";import"./excel-vendor-6kUf8nhb.js";function $(d){if(!d)return"";const c=String(d);return c.includes("T")?c.split("T")[0]:c}function X(){var H,P,O;const[d,c]=r.useState([]),[Y,A]=r.useState(!1),[m,w]=r.useState(null),[o,b]=r.useState(""),[h,k]=r.useState("health_safety_concern"),[E,C]=r.useState(""),[u,f]=r.useState(null),[R,j]=r.useState(null),[i,_]=r.useState(null),[W,L]=r.useState(""),[y,S]=r.useState(null),[x,M]=r.useState("");r.useEffect(()=>{v()},[]);const v=async()=>{A(!0);try{const t=await g.get("/api/appointments?status=pending");c(t.data)}catch(t){console.error("Failed to load appointments",t)}finally{A(!1)}},z=async t=>{var n,a,l,p,s;f(t);try{await g.post(`/api/appointments/${t}/approve`),v()}catch(N){console.error("Approve error:",((n=N.response)==null?void 0:n.data)||N.message),alert(((l=(a=N.response)==null?void 0:a.data)==null?void 0:l.message)||((s=(p=N.response)==null?void 0:p.data)==null?void 0:s.error)||"Approval failed")}finally{f(null)}},I=t=>{if(t.payment_method!=="hmo")return alert("Only for HMO payments");j(t.id),_(t),L(""),S(null),M(""),b("")},V=async()=>{var t,n;try{const{data:a}=await g.post(`/api/appointments/${R}/hmo/reveal`,{password:W});S(a)}catch(a){alert(((n=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:n.message)||"Invalid password or error")}},T=async()=>{var t,n;if(!o.trim())return alert("Please enter a note to send to the patient.");try{await g.post(`/api/appointments/${R}/hmo/notify`,{message:o,coverage_amount:x?Number(x):void 0,approve:!0}),j(null),_(null),S(null),M(""),b(""),v()}catch(a){alert(((n=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:n.message)||"Failed to send coverage update")}},F=async()=>{var t,n,a;if(!o.trim())return alert("Note is required");f(m.id);try{await g.post(`/api/appointments/${m.id}/reject`,{note:o,cancellation_reason:h,treatment_adjustment_notes:E||null}),w(null),b(""),k("health_safety_concern"),C(""),v()}catch(l){console.error("Reject error:",((t=l.response)==null?void 0:t.data)||l.message),alert(((a=(n=l.response)==null?void 0:n.data)==null?void 0:a.error)||"Rejection failed")}finally{f(null)}};return e.jsxs("div",{className:"w-100",style:{padding:0,margin:0},children:[e.jsx("div",{className:"container-fluid px-0 py-0",children:e.jsx("div",{className:"row g-0",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"bg-white p-4",style:{minHeight:"100vh"},children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsx("h1",{className:"h3 fw-bold mb-0",style:{color:"#1e293b"},children:"Pending Appointments"}),Y&&e.jsxs("div",{className:"d-flex align-items-center text-muted",children:[e.jsx("div",{className:"spinner-border spinner-border-sm me-2",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("small",{children:"Loading appointments..."})]})]}),d.length===0?e.jsxs("div",{className:"d-flex flex-column justify-content-center align-items-center",style:{minHeight:"60vh"},children:[e.jsx("i",{className:"bi bi-calendar-x display-1 d-block mb-3 text-muted"}),e.jsx("h4",{className:"fw-normal text-muted",children:"No pending appointments"}),e.jsx("p",{className:"text-muted",children:"All appointments have been processed."})]}):e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover mb-0",style:{borderRadius:"12px",overflow:"hidden",boxShadow:"0 2px 10px rgba(0,0,0,0.1)"},children:[e.jsx("thead",{style:{background:"linear-gradient(135deg, #00b4d8 0%, #0077b6 100%)",color:"white"},children:e.jsxs("tr",{children:[e.jsx("th",{className:"border-0 py-3 px-4 fw-semibold",children:"#"}),e.jsx("th",{className:"border-0 py-3 px-4 fw-semibold",children:"Service"}),e.jsx("th",{className:"border-0 py-3 px-4 fw-semibold",children:"Date"}),e.jsx("th",{className:"border-0 py-3 px-4 fw-semibold",children:"Time"}),e.jsx("th",{className:"border-0 py-3 px-4 fw-semibold",children:"Payment"}),e.jsx("th",{className:"border-0 py-3 px-4 fw-semibold",children:"Status"}),e.jsx("th",{className:"border-0 py-3 px-4 fw-semibold text-center",children:"Action"})]})}),e.jsx("tbody",{children:d.map((t,n)=>{var a,l,p;return e.jsxs("tr",{style:{borderBottom:"1px solid #f1f3f4",transition:"background-color 0.2s ease"},onMouseEnter:s=>{s.target.style.backgroundColor="#f8f9fa"},onMouseLeave:s=>{s.target.style.backgroundColor="transparent"},children:[e.jsx("td",{className:"py-3 px-4 fw-semibold",style:{color:"#6c757d"},children:n+1}),e.jsx("td",{className:"py-3 px-4 fw-semibold",style:{color:"#1e293b"},children:(a=t.service)==null?void 0:a.name}),e.jsx("td",{className:"py-3 px-4",style:{color:"#495057"},children:t.date}),e.jsx("td",{className:"py-3 px-4",style:{color:"#495057"},children:t.time_slot}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:"badge",style:{backgroundColor:t.payment_method==="hmo"?"#6366f1":"#00b4d8",color:"white",fontSize:"0.75rem",fontWeight:"600",padding:"0.4rem 0.8rem",borderRadius:"20px"},children:(l=t.payment_method)==null?void 0:l.toUpperCase()})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:"badge",style:{backgroundColor:"#ffc107",color:"#000",fontSize:"0.75rem",fontWeight:"600",padding:"0.4rem 0.8rem",borderRadius:"20px"},children:(p=t.status)==null?void 0:p.toUpperCase()})}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsxs("div",{className:"d-flex justify-content-center gap-2 flex-wrap",children:[e.jsxs("button",{onClick:()=>z(t.id),disabled:u===t.id,className:"btn btn-sm text-white rounded-pill disabled:opacity-50",style:{background:"linear-gradient(135deg, #00b4d8 0%, #0077b6 100%)",border:"none",fontWeight:"600",transition:"all 0.3s ease",padding:"0.5rem 1rem",fontSize:"0.8rem"},onMouseEnter:s=>{s.target.disabled||(s.target.style.background="linear-gradient(135deg, #0096c7 0%, #0056b3 100%)",s.target.style.transform="translateY(-1px)")},onMouseLeave:s=>{s.target.disabled||(s.target.style.background="linear-gradient(135deg, #00b4d8 0%, #0077b6 100%)",s.target.style.transform="translateY(0)")},children:[e.jsx("i",{className:"bi bi-check-circle me-1"}),u===t.id?"Approving...":"Approve"]}),t.payment_method==="hmo"&&e.jsxs("button",{onClick:()=>I(t),className:"btn btn-sm text-white rounded-pill",style:{background:"linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)",border:"none",fontWeight:"600",transition:"all 0.3s ease",padding:"0.5rem 1rem",fontSize:"0.8rem"},onMouseEnter:s=>{s.target.style.background="linear-gradient(135deg, #5b5bd6 0%, #4338ca 100%)",s.target.style.transform="translateY(-1px)"},onMouseLeave:s=>{s.target.style.background="linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)",s.target.style.transform="translateY(0)"},children:[e.jsx("i",{className:"bi bi-shield-check me-1"}),"Verify HMO"]}),e.jsxs("button",{onClick:()=>w(t),disabled:u===t.id,className:"btn btn-sm text-white rounded-pill disabled:opacity-50",style:{background:"linear-gradient(135deg, #dc3545 0%, #c82333 100%)",border:"none",fontWeight:"600",transition:"all 0.3s ease",padding:"0.5rem 1rem",fontSize:"0.8rem"},onMouseEnter:s=>{s.target.disabled||(s.target.style.background="linear-gradient(135deg, #c82333 0%, #a71e2a 100%)",s.target.style.transform="translateY(-1px)")},onMouseLeave:s=>{s.target.disabled||(s.target.style.background="linear-gradient(135deg, #dc3545 0%, #c82333 100%)",s.target.style.transform="translateY(0)")},children:[e.jsx("i",{className:"bi bi-x-circle me-1"}),u===t.id?"Rejecting...":"Reject"]})]})})]},t.id)})})]})})]})})})}),m&&e.jsx("div",{className:"position-fixed top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:1050},children:e.jsx("div",{className:"bg-white rounded-3 shadow-lg",style:{width:"500px",maxWidth:"90vw",maxHeight:"90vh",overflowY:"auto"},children:e.jsxs("div",{className:"p-4",children:[e.jsx("h2",{className:"h4 fw-bold mb-3",style:{color:"#1e293b"},children:"Reject Appointment"}),e.jsxs("p",{className:"text-muted mb-3",children:["Enter reason for rejecting appointment on ",e.jsx("strong",{children:m.date})," at"," ",e.jsx("strong",{children:m.time_slot})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-semibold",children:"Cancellation Reason"}),e.jsxs("select",{className:"form-select",value:h,onChange:t=>k(t.target.value),style:{borderRadius:"8px",border:"2px solid #e9ecef"},children:[e.jsx("option",{value:"health_safety_concern",children:"Health/Safety Concern"}),e.jsx("option",{value:"medical_contraindication",children:"Medical Contraindication"}),e.jsx("option",{value:"clinic_cancellation",children:"Clinic Cancellation"}),e.jsx("option",{value:"admin_cancellation",children:"Admin Cancellation"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-semibold",children:"Rejection Note (Required)"}),e.jsx("textarea",{value:o,onChange:t=>b(t.target.value),className:"form-control",rows:3,placeholder:"Enter rejection reason...",style:{borderRadius:"8px",border:"2px solid #e9ecef"}})]}),(h==="health_safety_concern"||h==="medical_contraindication"||h==="other")&&e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-semibold",children:"Treatment Adjustment Notes"}),e.jsx("textarea",{value:E,onChange:t=>C(t.target.value),className:"form-control",rows:3,placeholder:"Provide detailed notes about the treatment adjustment...",style:{borderRadius:"8px",border:"2px solid #e9ecef"}}),e.jsx("small",{className:"text-muted",children:"Optional: Add detailed notes about health/safety concerns or medical contraindications"})]}),e.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[e.jsx("button",{className:"btn btn-outline-secondary",onClick:()=>{w(null),k("health_safety_concern"),C("")},style:{borderRadius:"8px",fontWeight:"600"},children:"Cancel"}),e.jsxs("button",{className:"btn text-white",onClick:F,style:{background:"linear-gradient(135deg, #dc3545 0%, #c82333 100%)",border:"none",borderRadius:"8px",fontWeight:"600"},onMouseEnter:t=>{t.target.style.background="linear-gradient(135deg, #c82333 0%, #a71e2a 100%)"},onMouseLeave:t=>{t.target.style.background="linear-gradient(135deg, #dc3545 0%, #c82333 100%)"},children:[e.jsx("i",{className:"bi bi-x-circle me-1"}),"Reject"]})]})]})})}),R&&e.jsx("div",{className:"position-fixed top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:1060},children:e.jsx("div",{className:"bg-white rounded-3 shadow-lg",style:{width:"520px",maxWidth:"90vw"},children:e.jsxs("div",{className:"p-4",children:[e.jsx("h2",{className:"h4 fw-bold mb-3",style:{color:"#1e293b"},children:"HMO Verification"}),i&&e.jsx("div",{className:"mb-3 p-3 rounded",style:{backgroundColor:"#f8f9fa"},children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-6",children:[e.jsx("strong",{children:"Service:"})," ",((H=i.service)==null?void 0:H.name)||"—"]}),e.jsxs("div",{className:"col-6",children:[e.jsx("strong",{children:"Price:"})," ₱",Number(((P=i.service)==null?void 0:P.price)??0).toLocaleString()]}),e.jsxs("div",{className:"col-12 mt-2",children:[e.jsx("strong",{children:"Date:"})," ",$(i.date)]})]})}),y?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-3 p-3 rounded",style:{backgroundColor:"#f8f9fa"},children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-6",children:[e.jsx("strong",{children:"Provider:"})," ",y.provider_name]}),e.jsxs("div",{className:"col-6",children:[e.jsx("strong",{children:"HMO Number:"})," ",y.hmo_number||"—"]}),e.jsxs("div",{className:"col-12 mt-2",children:[e.jsx("strong",{children:"Name on Card:"})," ",y.patient_fullname_on_card||"—"]})]})}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-semibold",children:"Coverage Amount (₱)"}),e.jsx("input",{type:"number",min:"0",step:"0.01",className:"form-control",value:x,onChange:t=>M(t.target.value),style:{borderRadius:"8px",border:"2px solid #e9ecef"}}),i&&x&&e.jsxs("div",{className:"text-muted mt-1 small",children:["Estimated balance: ₱",Math.max(0,Number(((O=i.service)==null?void 0:O.price)??0)-Number(x||0)).toLocaleString()]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-semibold",children:"Note to patient"}),e.jsx("textarea",{className:"form-control",rows:3,value:o,onChange:t=>b(t.target.value),placeholder:"What coverage means, balance, etc.",style:{borderRadius:"8px",border:"2px solid #e9ecef"}})]}),e.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[e.jsx("button",{className:"btn btn-outline-secondary",onClick:()=>{j(null),_(null)},style:{borderRadius:"8px",fontWeight:"600"},children:"Close"}),e.jsxs("button",{className:"btn text-white",onClick:T,style:{background:"linear-gradient(135deg, #00b4d8 0%, #0077b6 100%)",border:"none",borderRadius:"8px",fontWeight:"600"},onMouseEnter:t=>{t.target.style.background="linear-gradient(135deg, #0096c7 0%, #0056b3 100%)"},onMouseLeave:t=>{t.target.style.background="linear-gradient(135deg, #00b4d8 0%, #0077b6 100%)"},children:[e.jsx("i",{className:"bi bi-send me-1"}),"Send & Approve"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-muted mb-3",children:"Enter your password to reveal patient HMO details."}),e.jsx("input",{type:"password",className:"form-control mb-3",value:W,onChange:t=>L(t.target.value),placeholder:"Your password",style:{borderRadius:"8px",border:"2px solid #e9ecef"}}),e.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[e.jsx("button",{className:"btn btn-outline-secondary",onClick:()=>j(null),style:{borderRadius:"8px",fontWeight:"600"},children:"Cancel"}),e.jsxs("button",{className:"btn text-white",onClick:V,style:{background:"linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)",border:"none",borderRadius:"8px",fontWeight:"600"},onMouseEnter:t=>{t.target.style.background="linear-gradient(135deg, #5b5bd6 0%, #4338ca 100%)"},onMouseLeave:t=>{t.target.style.background="linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)"},children:[e.jsx("i",{className:"bi bi-eye me-1"}),"Reveal"]})]})]})]})})})]})}export{X as default};
