import{r,j as e,z as o}from"./react-vendor-D3yaKSZ_.js";import{a as u}from"./index-CptAJIlB.js";import"./chart-vendor-BsnJAHr2.js";import"./bootstrap-vendor-CM53U_Of.js";import"./vendor-axios-ngrFHoWO.js";import"./pdf-vendor-BZobkf7J.js";import"./vendor-utils-DLELI0UM.js";import"./excel-vendor-6kUf8nhb.js";function D(c){if(!c)return"";const m=String(c);return m.includes("T")?m.split("T")[0]:m}function Z(){var z,P,O;const[c,m]=r.useState([]),[Y,E]=r.useState(!1),[b,k]=r.useState(null),[i,h]=r.useState(""),[x,C]=r.useState("health_safety_concern"),[W,R]=r.useState(""),[f,j]=r.useState(null),[_,y]=r.useState(null),[d,S]=r.useState(null),[L,H]=r.useState(""),[v,M]=r.useState(null),[p,A]=r.useState("");r.useEffect(()=>{N()},[]);const N=async()=>{E(!0);try{const s=await u.get("/api/appointments?status=pending");m(s.data)}catch(s){console.error("Failed to load appointments",s)}finally{E(!1)}},I=async s=>{var n,a,l,g,t;j(s);try{await u.post(`/api/appointments/${s}/approve`),N()}catch(w){console.error("Approve error:",((n=w.response)==null?void 0:n.data)||w.message),o.error(((l=(a=w.response)==null?void 0:a.data)==null?void 0:l.message)||((t=(g=w.response)==null?void 0:g.data)==null?void 0:t.error)||"Approval failed")}finally{j(null)}},V=s=>{if(s.payment_method!=="hmo")return o.error("Only for HMO payments");y(s.id),S(s),H(""),M(null),A(""),h("")},T=async()=>{var s,n;try{const{data:a}=await u.post(`/api/appointments/${_}/hmo/reveal`,{password:L});M(a)}catch(a){o.error(((n=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:n.message)||"Invalid password or error")}},F=async()=>{var s,n;if(!i.trim())return o.error("Please enter a note to send to the patient.");try{await u.post(`/api/appointments/${_}/hmo/notify`,{message:i,coverage_amount:p?Number(p):void 0,approve:!0}),y(null),S(null),M(null),A(""),h(""),N()}catch(a){o.error(((n=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:n.message)||"Failed to send coverage update")}},$=async()=>{var s,n,a;if(!i.trim())return o.error("Note is required");j(b.id);try{await u.post(`/api/appointments/${b.id}/reject`,{note:i,cancellation_reason:x,treatment_adjustment_notes:W||null}),k(null),h(""),C("health_safety_concern"),R(""),N()}catch(l){console.error("Reject error:",((s=l.response)==null?void 0:s.data)||l.message),o.error(((a=(n=l.response)==null?void 0:n.data)==null?void 0:a.error)||"Rejection failed")}finally{j(null)}};return e.jsxs("div",{className:"w-100",style:{padding:0,margin:0},children:[e.jsx("div",{className:"container-fluid px-0 py-0",children:e.jsx("div",{className:"row g-0",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"bg-white p-4",style:{minHeight:"100vh"},children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsx("h1",{className:"h3 fw-bold mb-0",style:{color:"#1e293b"},children:"Pending Appointments"}),Y&&e.jsxs("div",{className:"d-flex align-items-center text-muted",children:[e.jsx("div",{className:"spinner-border spinner-border-sm me-2",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("small",{children:"Loading appointments..."})]})]}),c.length===0?e.jsxs("div",{className:"d-flex flex-column justify-content-center align-items-center",style:{minHeight:"60vh"},children:[e.jsx("i",{className:"bi bi-calendar-x display-1 d-block mb-3 text-muted"}),e.jsx("h4",{className:"fw-normal text-muted",children:"No pending appointments"}),e.jsx("p",{className:"text-muted",children:"All appointments have been processed."})]}):e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover mb-0",style:{borderRadius:"12px",overflow:"hidden",boxShadow:"0 2px 10px rgba(0,0,0,0.1)"},children:[e.jsx("thead",{style:{background:"linear-gradient(135deg, #00b4d8 0%, #0077b6 100%)",color:"white"},children:e.jsxs("tr",{children:[e.jsx("th",{className:"border-0 py-3 px-4 fw-semibold",children:"#"}),e.jsx("th",{className:"border-0 py-3 px-4 fw-semibold",children:"Service"}),e.jsx("th",{className:"border-0 py-3 px-4 fw-semibold",children:"Date"}),e.jsx("th",{className:"border-0 py-3 px-4 fw-semibold",children:"Time"}),e.jsx("th",{className:"border-0 py-3 px-4 fw-semibold",children:"Payment"}),e.jsx("th",{className:"border-0 py-3 px-4 fw-semibold",children:"Status"}),e.jsx("th",{className:"border-0 py-3 px-4 fw-semibold text-center",children:"Action"})]})}),e.jsx("tbody",{children:c.map((s,n)=>{var a,l,g;return e.jsxs("tr",{style:{borderBottom:"1px solid #f1f3f4",transition:"background-color 0.2s ease"},onMouseEnter:t=>{t.target.style.backgroundColor="#f8f9fa"},onMouseLeave:t=>{t.target.style.backgroundColor="transparent"},children:[e.jsx("td",{className:"py-3 px-4 fw-semibold",style:{color:"#6c757d"},children:n+1}),e.jsx("td",{className:"py-3 px-4 fw-semibold",style:{color:"#1e293b"},children:(a=s.service)==null?void 0:a.name}),e.jsx("td",{className:"py-3 px-4",style:{color:"#495057"},children:s.date}),e.jsx("td",{className:"py-3 px-4",style:{color:"#495057"},children:s.time_slot}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:"badge",style:{backgroundColor:s.payment_method==="hmo"?"#6366f1":"#00b4d8",color:"white",fontSize:"0.75rem",fontWeight:"600",padding:"0.4rem 0.8rem",borderRadius:"20px"},children:(l=s.payment_method)==null?void 0:l.toUpperCase()})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:"badge",style:{backgroundColor:"#ffc107",color:"#000",fontSize:"0.75rem",fontWeight:"600",padding:"0.4rem 0.8rem",borderRadius:"20px"},children:(g=s.status)==null?void 0:g.toUpperCase()})}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsxs("div",{className:"d-flex justify-content-center gap-2 flex-wrap",children:[e.jsxs("button",{onClick:()=>I(s.id),disabled:f===s.id,className:"btn btn-sm text-white rounded-pill disabled:opacity-50",style:{background:"linear-gradient(135deg, #00b4d8 0%, #0077b6 100%)",border:"none",fontWeight:"600",transition:"all 0.3s ease",padding:"0.5rem 1rem",fontSize:"0.8rem"},onMouseEnter:t=>{t.target.disabled||(t.target.style.background="linear-gradient(135deg, #0096c7 0%, #0056b3 100%)",t.target.style.transform="translateY(-1px)")},onMouseLeave:t=>{t.target.disabled||(t.target.style.background="linear-gradient(135deg, #00b4d8 0%, #0077b6 100%)",t.target.style.transform="translateY(0)")},children:[e.jsx("i",{className:"bi bi-check-circle me-1"}),f===s.id?"Approving...":"Approve"]}),s.payment_method==="hmo"&&e.jsxs("button",{onClick:()=>V(s),className:"btn btn-sm text-white rounded-pill",style:{background:"linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)",border:"none",fontWeight:"600",transition:"all 0.3s ease",padding:"0.5rem 1rem",fontSize:"0.8rem"},onMouseEnter:t=>{t.target.style.background="linear-gradient(135deg, #5b5bd6 0%, #4338ca 100%)",t.target.style.transform="translateY(-1px)"},onMouseLeave:t=>{t.target.style.background="linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)",t.target.style.transform="translateY(0)"},children:[e.jsx("i",{className:"bi bi-shield-check me-1"}),"Verify HMO"]}),e.jsxs("button",{onClick:()=>k(s),disabled:f===s.id,className:"btn btn-sm text-white rounded-pill disabled:opacity-50",style:{background:"linear-gradient(135deg, #dc3545 0%, #c82333 100%)",border:"none",fontWeight:"600",transition:"all 0.3s ease",padding:"0.5rem 1rem",fontSize:"0.8rem"},onMouseEnter:t=>{t.target.disabled||(t.target.style.background="linear-gradient(135deg, #c82333 0%, #a71e2a 100%)",t.target.style.transform="translateY(-1px)")},onMouseLeave:t=>{t.target.disabled||(t.target.style.background="linear-gradient(135deg, #dc3545 0%, #c82333 100%)",t.target.style.transform="translateY(0)")},children:[e.jsx("i",{className:"bi bi-x-circle me-1"}),f===s.id?"Rejecting...":"Reject"]})]})})]},s.id)})})]})})]})})})}),b&&e.jsx("div",{className:"position-fixed top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:1050},children:e.jsx("div",{className:"bg-white rounded-3 shadow-lg",style:{width:"500px",maxWidth:"90vw",maxHeight:"90vh",overflowY:"auto"},children:e.jsxs("div",{className:"p-4",children:[e.jsx("h2",{className:"h4 fw-bold mb-3",style:{color:"#1e293b"},children:"Reject Appointment"}),e.jsxs("p",{className:"text-muted mb-3",children:["Enter reason for rejecting appointment on ",e.jsx("strong",{children:b.date})," at"," ",e.jsx("strong",{children:b.time_slot})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-semibold",children:"Cancellation Reason"}),e.jsxs("select",{className:"form-select",value:x,onChange:s=>C(s.target.value),style:{borderRadius:"8px",border:"2px solid #e9ecef"},children:[e.jsx("option",{value:"health_safety_concern",children:"Health/Safety Concern"}),e.jsx("option",{value:"medical_contraindication",children:"Medical Contraindication"}),e.jsx("option",{value:"clinic_cancellation",children:"Clinic Cancellation"}),e.jsx("option",{value:"admin_cancellation",children:"Admin Cancellation"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-semibold",children:"Rejection Note (Required)"}),e.jsx("textarea",{value:i,onChange:s=>h(s.target.value),className:"form-control",rows:3,placeholder:"Enter rejection reason...",style:{borderRadius:"8px",border:"2px solid #e9ecef"}})]}),(x==="health_safety_concern"||x==="medical_contraindication"||x==="other")&&e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-semibold",children:"Treatment Adjustment Notes"}),e.jsx("textarea",{value:W,onChange:s=>R(s.target.value),className:"form-control",rows:3,placeholder:"Provide detailed notes about the treatment adjustment...",style:{borderRadius:"8px",border:"2px solid #e9ecef"}}),e.jsx("small",{className:"text-muted",children:"Optional: Add detailed notes about health/safety concerns or medical contraindications"})]}),e.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[e.jsx("button",{className:"btn btn-outline-secondary",onClick:()=>{k(null),C("health_safety_concern"),R("")},style:{borderRadius:"8px",fontWeight:"600"},children:"Cancel"}),e.jsxs("button",{className:"btn text-white",onClick:$,style:{background:"linear-gradient(135deg, #dc3545 0%, #c82333 100%)",border:"none",borderRadius:"8px",fontWeight:"600"},onMouseEnter:s=>{s.target.style.background="linear-gradient(135deg, #c82333 0%, #a71e2a 100%)"},onMouseLeave:s=>{s.target.style.background="linear-gradient(135deg, #dc3545 0%, #c82333 100%)"},children:[e.jsx("i",{className:"bi bi-x-circle me-1"}),"Reject"]})]})]})})}),_&&e.jsx("div",{className:"position-fixed top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:1060},children:e.jsx("div",{className:"bg-white rounded-3 shadow-lg",style:{width:"520px",maxWidth:"90vw"},children:e.jsxs("div",{className:"p-4",children:[e.jsx("h2",{className:"h4 fw-bold mb-3",style:{color:"#1e293b"},children:"HMO Verification"}),d&&e.jsx("div",{className:"mb-3 p-3 rounded",style:{backgroundColor:"#f8f9fa"},children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-6",children:[e.jsx("strong",{children:"Service:"})," ",((z=d.service)==null?void 0:z.name)||"—"]}),e.jsxs("div",{className:"col-6",children:[e.jsx("strong",{children:"Price:"})," ₱",Number(((P=d.service)==null?void 0:P.price)??0).toLocaleString()]}),e.jsxs("div",{className:"col-12 mt-2",children:[e.jsx("strong",{children:"Date:"})," ",D(d.date)]})]})}),v?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-3 p-3 rounded",style:{backgroundColor:"#f8f9fa"},children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-6",children:[e.jsx("strong",{children:"Provider:"})," ",v.provider_name]}),e.jsxs("div",{className:"col-6",children:[e.jsx("strong",{children:"HMO Number:"})," ",v.hmo_number||"—"]}),e.jsxs("div",{className:"col-12 mt-2",children:[e.jsx("strong",{children:"Name on Card:"})," ",v.patient_fullname_on_card||"—"]})]})}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-semibold",children:"Coverage Amount (₱)"}),e.jsx("input",{type:"number",min:"0",step:"0.01",className:"form-control",value:p,onChange:s=>A(s.target.value),style:{borderRadius:"8px",border:"2px solid #e9ecef"}}),d&&p&&e.jsxs("div",{className:"text-muted mt-1 small",children:["Estimated balance: ₱",Math.max(0,Number(((O=d.service)==null?void 0:O.price)??0)-Number(p||0)).toLocaleString()]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-semibold",children:"Note to patient"}),e.jsx("textarea",{className:"form-control",rows:3,value:i,onChange:s=>h(s.target.value),placeholder:"What coverage means, balance, etc.",style:{borderRadius:"8px",border:"2px solid #e9ecef"}})]}),e.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[e.jsx("button",{className:"btn btn-outline-secondary",onClick:()=>{y(null),S(null)},style:{borderRadius:"8px",fontWeight:"600"},children:"Close"}),e.jsxs("button",{className:"btn text-white",onClick:F,style:{background:"linear-gradient(135deg, #00b4d8 0%, #0077b6 100%)",border:"none",borderRadius:"8px",fontWeight:"600"},onMouseEnter:s=>{s.target.style.background="linear-gradient(135deg, #0096c7 0%, #0056b3 100%)"},onMouseLeave:s=>{s.target.style.background="linear-gradient(135deg, #00b4d8 0%, #0077b6 100%)"},children:[e.jsx("i",{className:"bi bi-send me-1"}),"Send & Approve"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-muted mb-3",children:"Enter your password to reveal patient HMO details."}),e.jsx("input",{type:"password",className:"form-control mb-3",value:L,onChange:s=>H(s.target.value),placeholder:"Your password",style:{borderRadius:"8px",border:"2px solid #e9ecef"}}),e.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[e.jsx("button",{className:"btn btn-outline-secondary",onClick:()=>y(null),style:{borderRadius:"8px",fontWeight:"600"},children:"Cancel"}),e.jsxs("button",{className:"btn text-white",onClick:T,style:{background:"linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)",border:"none",borderRadius:"8px",fontWeight:"600"},onMouseEnter:s=>{s.target.style.background="linear-gradient(135deg, #5b5bd6 0%, #4338ca 100%)"},onMouseLeave:s=>{s.target.style.background="linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)"},children:[e.jsx("i",{className:"bi bi-eye me-1"}),"Reveal"]})]})]})]})})})]})}export{Z as default};
