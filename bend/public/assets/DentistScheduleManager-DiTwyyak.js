import{r,z as o,j as e}from"./react-vendor-D3yaKSZ_.js";import{a as p}from"./index-D6e0cRYS.js";import"./chart-vendor-BsnJAHr2.js";import"./bootstrap-vendor-CM53U_Of.js";import"./vendor-axios-ngrFHoWO.js";import"./pdf-vendor-BZobkf7J.js";import"./vendor-utils-DLELI0UM.js";import"./excel-vendor-6kUf8nhb.js";const T=[{value:"full_time",label:"Full-time"},{value:"part_time",label:"Part-time"},{value:"locum",label:"Locum"}],L=[{value:"active",label:"Active"},{value:"inactive",label:"Inactive"}],v=[{key:"sun",label:"Sun"},{key:"mon",label:"Mon"},{key:"tue",label:"Tue"},{key:"wed",label:"Wed"},{key:"thu",label:"Thu"},{key:"fri",label:"Fri"},{key:"sat",label:"Sat"}];function le(){const _={id:null,dentist_code:"",dentist_name:"",is_pseudonymous:!0,employment_type:"full_time",status:"active",contract_end_date:"",email:"",temporary_password:"",email_verified:!1,password_changed:!1,sun:!1,mon:!0,tue:!0,wed:!0,thu:!0,fri:!0,sat:!1},[y,P]=r.useState([]),[R,w]=r.useState(!0),[k,S]=r.useState(!1),[g,q]=r.useState(""),[a,u]=r.useState(_),[l,j]=r.useState({}),[z,x]=r.useState(!1),[f,C]=r.useState(!1),[Y,N]=r.useState(!1),[c,V]=r.useState(null),[m,D]=r.useState({email:"",name:""}),[A,E]=r.useState(!1);r.useEffect(()=>{b()},[]);const b=async()=>{try{w(!0);const s=await p.get("/api/dentists");P(s.data)}catch(s){console.error(s),o.error("Failed to load dentists. Check admin auth and routes.")}finally{w(!1)}},$=r.useMemo(()=>{const s=g.trim().toLowerCase();return s?y.filter(t=>(t.dentist_code||"").toLowerCase().includes(s)||(t.dentist_name||"").toLowerCase().includes(s)||(t.employment_type||"").toLowerCase().includes(s)||(t.status||"").toLowerCase().includes(s)):y},[y,g]),W=()=>{u(_),j({}),C(!1),x(!0)},F=s=>{u({id:s.id,dentist_code:s.dentist_code||"",dentist_name:s.dentist_name||"",is_pseudonymous:!!s.is_pseudonymous,employment_type:s.employment_type||"full_time",status:s.status||"active",contract_end_date:s.contract_end_date||"",email:s.email||"",temporary_password:s.temporary_password||"",email_verified:!!s.email_verified,password_changed:!!s.password_changed,sun:!!s.sun,mon:!!s.mon,tue:!!s.tue,wed:!!s.wed,thu:!!s.thu,fri:!!s.fri,sat:!!s.sat}),j({}),C(!0),x(!0)},I=()=>{const s={};return a.dentist_code.trim()||(s.dentist_code="Dentist code is required."),T.find(i=>i.value===a.employment_type)||(s.employment_type="Invalid employment type."),L.find(i=>i.value===a.status)||(s.status="Invalid status."),v.some(i=>!!a[i.key])||(s.weekdays="Select at least one working day."),a.contract_end_date&&!/^\d{4}-\d{2}-\d{2}$/.test(a.contract_end_date)&&(s.contract_end_date="Use YYYY-MM-DD format."),!a.email||!a.email.trim()?s.email="Email address is required.":/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.email.trim())||(s.email="Please enter a valid email address."),j(s),Object.keys(s).length===0},U=async s=>{var t,i,n;if(s.preventDefault(),!!I()){S(!0);try{const d={dentist_code:a.dentist_code.trim(),dentist_name:((t=a.dentist_name)==null?void 0:t.trim())||null,is_pseudonymous:!!a.is_pseudonymous,employment_type:a.employment_type,status:a.status,contract_end_date:a.contract_end_date||null,email:(i=a.email)==null?void 0:i.trim(),sun:!!a.sun,mon:!!a.mon,tue:!!a.tue,wed:!!a.wed,thu:!!a.thu,fri:!!a.fri,sat:!!a.sat};f&&a.id?(await p.put(`/api/dentists/${a.id}`,d),o.success("Dentist updated.")):(await p.post("/api/dentists",d),o.success("Dentist created.")),x(!1),b()}catch(d){const h=(n=d==null?void 0:d.response)==null?void 0:n.data;h!=null&&h.errors?j(h.errors):o.error((h==null?void 0:h.message)||"Save failed")}finally{S(!1)}}},J=async s=>{var t,i;if(confirm(`Delete dentist ${s.dentist_code}? This cannot be undone.`))try{await p.delete(`/api/dentists/${s.id}`),o.success("Deleted."),b()}catch(n){o.error(((i=(t=n==null?void 0:n.response)==null?void 0:t.data)==null?void 0:i.message)||"Delete failed.")}},O=async()=>{var s,t,i,n;if(c){if(!m.email||!m.email.trim()){o.error("Email address is required.");return}if(!m.name||!m.name.trim()){o.error("Full name is required.");return}E(!0);try{const d=await p.post("/api/dentist/create-account",{dentist_schedule_id:c.id,email:m.email.trim(),name:m.name.trim()});o.success(`Account created successfully! Temporary password: ${d.data.temporary_password}`),N(!1),b()}catch(d){const h=((t=(s=d==null?void 0:d.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to create account.",M=(n=(i=d==null?void 0:d.response)==null?void 0:i.data)==null?void 0:n.errors;if(M){const K=Object.values(M).flat().join(`
`);o.error(`Validation errors:
${K}`)}else o.error(h)}finally{E(!1)}}},B=async s=>{var t,i;if(!s.email){o.error(`Please add an email address for ${s.dentist_code} first.`);return}if(confirm(`Create account for ${s.dentist_code}? This will send a temporary password to ${s.email}.`))try{const n=await p.post("/api/dentist/create-account",{dentist_schedule_id:s.id,email:s.email,name:s.dentist_name||s.dentist_code});o.success(`Account created successfully! Temporary password: ${n.data.temporary_password}`),b()}catch(n){o.error(((i=(t=n==null?void 0:n.response)==null?void 0:t.data)==null?void 0:i.message)||"Failed to create account.")}},H=({on:s,label:t})=>e.jsx("span",{className:`badge ${s?"bg-success":"bg-light text-muted"}`,style:{fontSize:"0.7rem"},children:t});return e.jsxs("div",{className:"dentist-schedule-manager-page",style:{background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",minHeight:"100vh",width:"100%",padding:"1.5rem",boxSizing:"border-box"},children:[e.jsxs("div",{className:"d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4 gap-3",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"m-0 fw-bold",style:{color:"#1e293b"},children:[e.jsx("i",{className:"bi bi-person-badge me-2"}),"Dentist Schedule Management"]}),e.jsx("p",{className:"text-muted mb-0 mt-1",children:"Manage dentist schedules, employment types, and account creation"})]}),e.jsx("div",{className:"d-flex gap-2 flex-wrap",children:e.jsxs("button",{className:"btn border-0 shadow-sm",onClick:W,style:{background:"linear-gradient(135deg, #00b4d8 0%, #0077b6 100%)",color:"white",borderRadius:"12px",padding:"12px 24px",fontWeight:"600",transition:"all 0.3s ease"},children:[e.jsx("i",{className:"bi bi-plus-circle me-2"}),"Add New Dentist"]})})]}),e.jsx("div",{className:"card border-0 shadow-sm",style:{borderRadius:"16px"},children:e.jsxs("div",{className:"card-body p-4",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"input-group",style:{maxWidth:"400px"},children:[e.jsx("span",{className:"input-group-text bg-white border-end-0",style:{borderRadius:"12px 0 0 12px"},children:e.jsx("i",{className:"bi bi-search text-muted"})}),e.jsx("input",{type:"text",className:"form-control border-start-0",style:{borderRadius:"0 12px 12px 0"},placeholder:"Search by code, name, type, or status...",value:g,onChange:s=>q(s.target.value)})]})}),R?e.jsxs("div",{className:"text-center py-5",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"mt-2 text-muted",children:"Loading dentists..."})]}):e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover align-middle",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"fw-semibold",children:"Code"}),e.jsx("th",{scope:"col",className:"fw-semibold",children:"Name"}),e.jsx("th",{scope:"col",className:"fw-semibold",children:"Email"}),e.jsx("th",{scope:"col",className:"fw-semibold",children:"Account Status"}),e.jsx("th",{scope:"col",className:"fw-semibold",children:"Pseudonymous"}),e.jsx("th",{scope:"col",className:"fw-semibold",children:"Employment"}),e.jsx("th",{scope:"col",className:"fw-semibold",children:"Status"}),e.jsx("th",{scope:"col",className:"fw-semibold",children:"Weekdays"}),e.jsx("th",{scope:"col",className:"fw-semibold",children:"Contract End"}),e.jsx("th",{scope:"col",className:"fw-semibold",children:"Actions"})]})}),e.jsxs("tbody",{children:[$.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"fw-medium",children:s.dentist_code}),e.jsx("td",{children:s.dentist_name||e.jsx("span",{className:"text-muted",children:"—"})}),e.jsx("td",{children:s.email?e.jsxs("div",{children:[e.jsx("div",{className:"text-sm",children:s.email}),s.temporary_password&&e.jsxs("div",{className:"text-xs text-muted",children:["Temp: ",s.temporary_password]})]}):e.jsx("span",{className:"text-muted",children:"—"})}),e.jsx("td",{children:e.jsx("div",{className:"d-flex flex-column gap-1",children:s.email?e.jsx("span",{className:`badge ${s.password_changed?"bg-success":"bg-warning"}`,children:s.password_changed?"✓ Password Changed":"⚠ Temp Password"}):e.jsx("span",{className:"text-muted text-xs",children:"No Account"})})}),e.jsx("td",{children:e.jsx("span",{className:`badge ${s.is_pseudonymous?"bg-info":"bg-secondary"}`,children:s.is_pseudonymous?"Yes":"No"})}),e.jsx("td",{children:e.jsx("span",{className:"badge bg-primary",children:s.employment_type})}),e.jsx("td",{children:e.jsx("span",{className:`badge ${s.status==="active"?"bg-success":"bg-danger"}`,children:s.status})}),e.jsx("td",{children:e.jsx("div",{className:"d-flex flex-wrap gap-1",children:v.map(t=>e.jsx(H,{on:!!s[t.key],label:t.label},t.key))})}),e.jsx("td",{children:s.contract_end_date||e.jsx("span",{className:"text-muted",children:"—"})}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex flex-column gap-1",children:[e.jsxs("div",{className:"btn-group btn-group-sm",role:"group",children:[e.jsxs("button",{className:"btn btn-outline-primary btn-sm",onClick:()=>F(s),style:{fontSize:"0.75rem",padding:"0.25rem 0.5rem"},children:[e.jsx("i",{className:"bi bi-pencil"})," Edit"]}),e.jsxs("button",{className:"btn btn-outline-danger btn-sm",onClick:()=>J(s),style:{fontSize:"0.75rem",padding:"0.25rem 0.5rem"},children:[e.jsx("i",{className:"bi bi-trash"})," Delete"]})]}),s.email?s.temporary_password?e.jsx("span",{className:"text-muted text-xs",children:"Account Created"}):e.jsxs("button",{className:"btn btn-success btn-sm",onClick:()=>B(s),style:{fontSize:"0.75rem",padding:"0.25rem 0.5rem"},children:[e.jsx("i",{className:"bi bi-person-plus"})," Create Account"]}):e.jsxs("button",{className:"btn btn-primary btn-sm",onClick:()=>F(s),style:{fontSize:"0.75rem",padding:"0.25rem 0.5rem"},children:[e.jsx("i",{className:"bi bi-envelope-plus"})," Add Email"]})]})})]},s.id)),$.length===0&&e.jsx("tr",{children:e.jsxs("td",{className:"text-center text-muted py-4",colSpan:10,children:[e.jsx("i",{className:"bi bi-search display-6 d-block mb-2"}),"No dentists found matching your search criteria."]})})]})]})})]})}),z&&e.jsx("div",{className:"modal fade show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"},tabIndex:"-1",children:e.jsx("div",{className:"modal-dialog modal-lg",children:e.jsxs("div",{className:"modal-content border-0 shadow-lg",style:{borderRadius:"16px"},children:[e.jsxs("div",{className:"modal-header border-0 pb-0",style:{background:"linear-gradient(135deg, #00b4d8 0%, #0077b6 100%)",borderRadius:"16px 16px 0 0"},children:[e.jsxs("h5",{className:"modal-title text-white fw-bold",children:[e.jsx("i",{className:"bi bi-person-badge me-2"}),f?"Edit Dentist":"Add New Dentist"]}),e.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>x(!1),"aria-label":"Close"})]}),e.jsx("div",{className:"modal-body",children:e.jsx("form",{id:"dentist-form",onSubmit:U,children:e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsxs("label",{className:"form-label fw-semibold",children:["Dentist Code ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"text",className:`form-control ${l.dentist_code?"is-invalid":""}`,value:a.dentist_code,onChange:s=>u({...a,dentist_code:s.target.value}),placeholder:"e.g., D001"}),l.dentist_code&&e.jsx("div",{className:"invalid-feedback",children:String(l.dentist_code)})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label fw-semibold",children:"Dentist Name (optional)"}),e.jsx("input",{type:"text",className:"form-control",value:a.dentist_name,onChange:s=>u({...a,dentist_name:s.target.value}),placeholder:"Dr. John Doe"})]}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"isPseudo",checked:!!a.is_pseudonymous,onChange:s=>u({...a,is_pseudonymous:s.target.checked})}),e.jsx("label",{className:"form-check-label",htmlFor:"isPseudo",children:"Use pseudonymous identity (hide real names)"})]})}),e.jsxs("div",{className:"col-md-6",children:[e.jsxs("label",{className:"form-label fw-semibold",children:["Employment Type ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("select",{className:`form-select ${l.employment_type?"is-invalid":""}`,value:a.employment_type,onChange:s=>u({...a,employment_type:s.target.value}),children:T.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))}),l.employment_type&&e.jsx("div",{className:"invalid-feedback",children:String(l.employment_type)})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsxs("label",{className:"form-label fw-semibold",children:["Status ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("select",{className:`form-select ${l.status?"is-invalid":""}`,value:a.status,onChange:s=>u({...a,status:s.target.value}),children:L.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))}),l.status&&e.jsx("div",{className:"invalid-feedback",children:String(l.status)})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label fw-semibold",children:"Contract End Date (optional)"}),e.jsx("input",{type:"date",className:`form-control ${l.contract_end_date?"is-invalid":""}`,value:a.contract_end_date||"",onChange:s=>u({...a,contract_end_date:s.target.value})}),l.contract_end_date&&e.jsx("div",{className:"invalid-feedback",children:String(l.contract_end_date)})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsxs("label",{className:"form-label fw-semibold",children:["Email Address ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"email",className:`form-control ${l.email?"is-invalid":""}`,value:a.email||"",onChange:s=>u({...a,email:s.target.value}),placeholder:"dentist@example.com",required:!0}),l.email&&e.jsx("div",{className:"invalid-feedback",children:String(l.email)})]}),f&&a.temporary_password&&e.jsxs("div",{className:"col-12",children:[e.jsx("label",{className:"form-label fw-semibold",children:"Temporary Password"}),e.jsxs("div",{className:"form-control-plaintext bg-light border rounded p-2",children:[e.jsx("code",{children:a.temporary_password}),e.jsx("small",{className:"text-muted ms-2",children:"(Auto-generated)"})]})]}),e.jsxs("div",{className:"col-12",children:[e.jsxs("label",{className:"form-label fw-semibold",children:["Working Days ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("div",{className:"row g-2",children:v.map(s=>e.jsx("div",{className:"col-6 col-md-4 col-lg-3",children:e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:`day-${s.key}`,checked:!!a[s.key],onChange:t=>u({...a,[s.key]:t.target.checked})}),e.jsx("label",{className:"form-check-label",htmlFor:`day-${s.key}`,children:s.label})]})},s.key))}),l.weekdays&&e.jsx("div",{className:"text-danger small mt-1",children:String(l.weekdays)})]})]})})}),e.jsxs("div",{className:"modal-footer border-0 pt-0",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>x(!1),children:"Cancel"}),e.jsx("button",{disabled:k,type:"submit",form:"dentist-form",className:"btn btn-primary",style:{background:"linear-gradient(135deg, #00b4d8 0%, #0077b6 100%)",border:"none"},children:k?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-check-circle me-2"}),f?"Save Changes":"Create Dentist"]})})]})]})})}),Y&&e.jsx("div",{className:"modal fade show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"},tabIndex:"-1",children:e.jsx("div",{className:"modal-dialog",children:e.jsxs("div",{className:"modal-content border-0 shadow-lg",style:{borderRadius:"16px"},children:[e.jsxs("div",{className:"modal-header border-0 pb-0",style:{background:"linear-gradient(135deg, #00b4d8 0%, #0077b6 100%)",borderRadius:"16px 16px 0 0"},children:[e.jsxs("h5",{className:"modal-title text-white fw-bold",children:[e.jsx("i",{className:"bi bi-person-plus me-2"}),"Create Dentist Account"]}),e.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>N(!1),"aria-label":"Close"})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-semibold",children:"Selected Dentist"}),e.jsx("div",{className:"form-control-plaintext bg-light border rounded p-3",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("i",{className:"bi bi-person-badge text-primary me-2"}),e.jsxs("div",{children:[e.jsx("strong",{children:c==null?void 0:c.dentist_code}),(c==null?void 0:c.dentist_name)&&e.jsxs("span",{className:"text-muted ms-2",children:["- ",c.dentist_name]})]})]})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-semibold",children:"Email Address"}),e.jsx("input",{type:"email",className:"form-control",value:m.email,onChange:s=>D({...m,email:s.target.value}),placeholder:"dentist@example.com",required:!0}),(c==null?void 0:c.email)&&m.email!==c.email&&e.jsxs("div",{className:"alert alert-warning mt-2 py-2",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),e.jsxs("small",{children:["Email differs from schedule email (",c.email,") - this will be logged as an email change"]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-semibold",children:"Full Name"}),e.jsx("input",{type:"text",className:"form-control",value:m.name,onChange:s=>D({...m,name:s.target.value}),placeholder:"Dr. John Doe",required:!0})]}),e.jsxs("div",{className:"alert alert-info",children:[e.jsx("i",{className:"bi bi-info-circle me-2"}),e.jsx("strong",{children:"Note:"})," A temporary password will be generated and sent to the email address. The dentist will need to verify their email and change their password on first login."]})]}),e.jsxs("div",{className:"modal-footer border-0",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>N(!1),children:"Cancel"}),e.jsx("button",{disabled:A,onClick:O,className:"btn btn-primary",style:{background:"linear-gradient(135deg, #00b4d8 0%, #0077b6 100%)",border:"none"},children:A?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-person-plus me-2"}),"Create Account"]})})]})]})})})]})}export{le as default};
